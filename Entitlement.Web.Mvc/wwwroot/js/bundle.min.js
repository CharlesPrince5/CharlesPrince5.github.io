(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
// Â© 2001-2015 INOVx Solutions, Inc.
// 114 Pacifica Suite 300, Irvine, CA 92618 USA
// All rights reserved.
//
// This software is confidential, proprietary and unpublished property of
// INOVx Solutions, Inc.  It may NOT be copied in part or in whole on any
// medium, either electronic or printed, without the express written consent
// of INOVx Solutions, Inc.
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var ReactDOM = require("react-dom");
var EntitlementApp = require("./components/EntitlementApp");
try {
    InovxLoader.updateHelp('entitlement');
}
catch (e) {
}
ReactDOM.render(React.createElement(EntitlementApp, null), document.getElementById('entitlementapp'));

},{"./components/EntitlementApp":3,"react":"react","react-dom":"react-dom"}],2:[function(require,module,exports){
"use strict";
var Inovx = require("shared.web.client");
var EntitlementConstants = require("./../constants/EntitlementConstants");
var EntitlementServices = require("./../services/EntitlementServices");
var EntitlementStore = require("./../stores/EntitlementStore");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
function receiveEntitlementData(data) {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: EntitlementConstants.ENTITLEMENT_RECIEVE_DATA,
        data: data
    });
}
function _finishEdit() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: EntitlementConstants.ENTITLEMENT_FINISH_EDIT
    });
}
function sendInvalidSave() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: EntitlementConstants.ENTITLEMENT_FORM_INVALID_SAVE
    });
}
var EntitlementActions = {
    getAllEntitlement: function (callback, errorCallback, ignoreDefaultError) {
        EntitlementServices.getAll(function (data) {
            if (callback !== 'undefined' && callback != null) {
                callback(data);
            }
            receiveEntitlementData(data);
        }, function (error) {
            if (errorCallback) {
                errorCallback(error);
            }
        }, ignoreDefaultError);
    },
    beginAdd: function () {
        EntitlementServices.getApplicationPermissions(function (data) {
            Inovx.Shared.Flux.AppDispatcher.dispatch({
                actionType: EntitlementConstants.ENTITLEMENT_BEGIN_ADD,
                applicationPermissions: data
            });
        }, function (error) {
        });
    },
    createEntitlement: function (callback) {
        if (EntitlementStore.getIsValidObject(EntitlementConstants.ENTITLEMENT_ADD_FORM)) {
            if (!SystemStore.isActionInProgress(EntitlementConstants.ENTITLEMENT_ADD)) {
                SystemActions.beginAction(EntitlementConstants.ENTITLEMENT_ADD);
                var securityGroup = EntitlementStore.getSecurityGroup();
                var securtyGroupDetail = EntitlementStore.getSecurityGroupDetail();
                var applicationPermissions = securtyGroupDetail.ApplicationPermissions;
                var groupUsers = securtyGroupDetail.GroupUsers;
                var permissionIDs = [];
                var groupUserIDs = [];
                for (var index in applicationPermissions) {
                    var applicationPermission = applicationPermissions[index];
                    for (var subIndex in applicationPermission.Permissions) {
                        var permission = applicationPermission.Permissions[subIndex];
                        if (permission.Assigned) {
                            permissionIDs.push(permission.ID);
                        }
                    }
                }
                for (var index in groupUsers) {
                    var groupUser = groupUsers[index];
                    groupUserIDs.push(groupUser.UserID);
                }
                EntitlementServices.create(securityGroup, permissionIDs, groupUserIDs, function () {
                    EntitlementActions.refreshData();
                    if (callback !== undefined && callback != null) {
                        callback();
                    }
                    _finishEdit();
                    SystemActions.endAction(EntitlementConstants.ENTITLEMENT_ADD);
                }, function () {
                    SystemActions.endAction(EntitlementConstants.ENTITLEMENT_ADD);
                });
            }
        }
        else {
            sendInvalidSave();
        }
    },
    beginEdit: function (securityGroup) {
        EntitlementServices.getDetail(securityGroup.ID, function (data) {
            Inovx.Shared.Flux.AppDispatcher.dispatch({
                actionType: EntitlementConstants.ENTITLEMENT_BEGIN_EDIT,
                securityGroup: securityGroup,
                securityGroupDetail: data
            });
        }, function (error) {
        });
    },
    updateEntitlement: function (callback) {
        if (EntitlementStore.getIsValidObject(EntitlementConstants.ENTITLEMENT_ADD_FORM)) {
            if (!EntitlementStore.getIsValidEditObject()) {
                EntitlementActions.displayInvalidEdit();
                sendInvalidSave();
            }
            else {
                if (!SystemStore.isActionInProgress(EntitlementConstants.ENTITLEMENT_EDIT)) {
                    SystemActions.beginAction(EntitlementConstants.ENTITLEMENT_EDIT);
                    var securityGroup = EntitlementStore.getSecurityGroup();
                    var securtyGroupDetail = EntitlementStore.getSecurityGroupDetail();
                    var applicationPermissions = securtyGroupDetail.ApplicationPermissions;
                    var groupUsers = securtyGroupDetail.GroupUsers;
                    var permissionIDs = [];
                    var groupUserIDs = [];
                    for (var index in applicationPermissions) {
                        var applicationPermission = applicationPermissions[index];
                        for (var subIndex in applicationPermission.Permissions) {
                            var permission = applicationPermission.Permissions[subIndex];
                            if (permission.Assigned) {
                                permissionIDs.push(permission.ID);
                            }
                        }
                    }
                    for (var index in groupUsers) {
                        var groupUser = groupUsers[index];
                        groupUserIDs.push(groupUser.UserID);
                    }
                    EntitlementServices.update(securityGroup, permissionIDs, groupUserIDs, function (data) {
                        EntitlementActions.refreshData();
                        if (callback !== undefined && callback != null) {
                            callback();
                        }
                        _finishEdit();
                        SystemActions.endAction(EntitlementConstants.ENTITLEMENT_EDIT);
                    }, function (error) {
                        SystemActions.endAction(EntitlementConstants.ENTITLEMENT_EDIT);
                    });
                }
            }
        }
        else {
            sendInvalidSave();
        }
    },
    finishEdit: function () {
        if (EntitlementStore.getHasChanges()) {
            var saveFunct = EntitlementStore.getIsEditing() ? EntitlementActions.updateEntitlement : EntitlementActions.createEntitlement;
            SystemActions.displaySaveChangesDialog({
                message: InovxLoader.t("common:msgBox.saveChanges"),
                cancelCallback: _finishEdit,
                confirmCallback: saveFunct
            });
        }
        else {
            _finishEdit();
        }
    },
    deleteEntitlement: function (securityGroup, callback) {
        if (!SystemStore.isActionInProgress(EntitlementConstants.ENTITLEMENT_DELETE)) {
            SystemActions.beginAction(EntitlementConstants.ENTITLEMENT_DELETE);
            EntitlementServices.delete(securityGroup, function () {
                EntitlementActions.refreshData();
                if (callback !== 'undefined' && callback != null) {
                    callback();
                }
                SystemActions.endAction(EntitlementConstants.ENTITLEMENT_DELETE);
            }, function (error) {
                SystemActions.endAction(EntitlementConstants.ENTITLEMENT_DELETE);
            });
        }
    },
    refreshData: function () {
        this.getAllEntitlement();
    },
    editSecurityGroup: function (comp, key, value) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: EntitlementConstants.ENTITLEMENT_UPDATE_SECURITY_GROUP,
            component: comp,
            key: key,
            value: value
        });
    },
    editPermissions: function (uid, value) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: EntitlementConstants.ENTITLEMENT_UPDATE_PERMISSIONS,
            uid: uid,
            value: value
        });
    },
    addUsers: function (users) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: EntitlementConstants.ENTITLEMENT_ADD_USER,
            users: users
        });
    },
    deleteUser: function (user) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: EntitlementConstants.ENTITLEMENT_DELETE_USER,
            user: user
        });
    },
    displayInvalidEdit: function () {
        var messageObject = {
            message: InovxLoader.t('Entitlement:message.systemSecurityGroupUserNotFound')
        };
        SystemActions.displayErrorMessage(messageObject);
    }
};
module.exports = EntitlementActions;

},{"./../constants/EntitlementConstants":5,"./../services/EntitlementServices":6,"./../stores/EntitlementStore":7,"shared.web.client":"shared.web.client"}],3:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var React = require("react");
var Inovx = require("shared.web.client");
var EntitlementForm = require("./EntitlementForm");
var EntitlementActions = require("./../actions/EntitlementActions");
var EntitlementStore = require("./../stores/EntitlementStore");
var EntitlementConstants = require("./../constants/EntitlementConstants");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
function getEntitlementState() {
    return {
        allSecurityGroup: EntitlementStore.getAll(),
        modalVisible: EntitlementStore.getModalVisible(),
        isActionInProgress: SystemStore.isActionInProgress(EntitlementConstants.ENTITLEMENT_DELETE)
    };
}
var EntitlementApp = /** @class */ (function (_super) {
    __extends(EntitlementApp, _super);
    function EntitlementApp(props, context) {
        var _this = _super.call(this, 'Entitlement', props, context) || this;
        _this._onChange = function () {
            _this.setState(getEntitlementState());
        };
        _this._onSystemChange = function () {
            _this.setState({
                isActionInProgress: SystemStore.isActionInProgress(EntitlementConstants.ENTITLEMENT_DELETE)
            });
        };
        _this._hideModal = function () {
            EntitlementActions.finishEdit();
        };
        _this._beginEditEntitlement = function (e, securityGroup) {
            EntitlementActions.beginEdit(securityGroup);
        };
        _this._deleteEntitlement = function (e, securityGroup) {
            var messageObject = {
                message: InovxLoader.t('Entitlement:message.confirmDelete'),
                confirmCallback: function () {
                    EntitlementActions.deleteEntitlement(securityGroup, null);
                }
            };
            SystemActions.displayConfirmationMessage(messageObject);
        };
        _this._showAddEntitlement = function () {
            EntitlementActions.beginAdd();
        };
        _this._initialize = function () {
            EntitlementActions.getAllEntitlement(function () {
                _this._appLoaded = true;
            }, function (error) {
                _this._handlePermissionError(error);
            }, true);
        };
        _this.state = getEntitlementState();
        return _this;
    }
    EntitlementApp.prototype.componentWillMount = function () {
        this.componentWillMountBase();
    };
    EntitlementApp.prototype.componentDidMount = function () {
        EntitlementStore.addChangeListener(this._onChange);
        SystemStore.addChangeListener(this._onSystemChange);
    };
    EntitlementApp.prototype.componentWillUnmount = function () {
        EntitlementStore.removeChangeListener(this._onChange);
        SystemStore.removeChangeListener(this._onSystemChange);
    };
    EntitlementApp.prototype.render = function () {
        var columns = [{
                field: "Name",
                headerText: InovxLoader.t('Entitlement:grid.name'),
                type: "string"
            }, {
                field: "Description",
                headerText: InovxLoader.t('Entitlement:grid.description'),
                type: "string"
            }];
        var commands = {
            command: [
                {
                    iconClassName: 'glyphicon glyphicon-pencil',
                    className: 'grid-button',
                    click: this._beginEditEntitlement
                }, {
                    iconClassName: 'glyphicon glyphicon-trash',
                    className: 'grid-button',
                    click: this._deleteEntitlement
                }
            ],
            width: "85px",
            headerText: InovxLoader.t('Entitlement:grid.commands')
        };
        var defaultSort = [{
                field: "Name",
                dir: "ascending"
            }];
        var iconHeaderProps = {
            iconUrl: "".concat(UrlUtilities.getBaseApplicationUrl(), "/images/Entitlement.png"),
            iconAtt: { alt: "entitlement" },
            title: InovxLoader.t('Entitlement:header.entitlement'),
            rcClass: "cd-btn add-btn",
            onClick: this._showAddEntitlement,
            btnUrl: "".concat(UrlUtilities.getBaseApplicationUrl(), "/images/addSecurityGroup.png"),
            btnAtt: {
                alt: InovxLoader.t('Entitlement:header.newSecurityGroup'),
                title: InovxLoader.t('Entitlement:header.newSecurityGroup'),
                id: 'entApp-addSecGroup-btn',
            }
        };
        for (var i = 0; i < this.state.allSecurityGroup.length; i++) {
            var group = this.state.allSecurityGroup[i];
            if (group.Description == null)
                group.Description = "";
        }
        return (React.createElement(Inovx.Shared.Core.ReactLoader, { appReady: this.isAppLoaded(), errorStatus: this._errorStatus },
            React.createElement("div", { className: "entitlement-app-content" },
                React.createElement(Inovx.Shared.Layout.IconHeader, __assign({}, iconHeaderProps)),
                React.createElement(Inovx.Shared.Controls.Grid, { dataSource: this.state.allSecurityGroup, commands: commands, columns: columns, defaultSort: defaultSort, filter: true, sort: true, pageable: { pageCount: 5, pageSize: 10, pageSizes: [10, 20, 50] } })),
            React.createElement(Inovx.Shared.Controls.ModalSlider, { isOpen: this.state.modalVisible, onClose: this._hideModal },
                React.createElement(EntitlementForm, null))));
    };
    return EntitlementApp;
}(Inovx.Shared.ReactExt.BaseAppComponent));
module.exports = EntitlementApp;

},{"./../actions/EntitlementActions":2,"./../constants/EntitlementConstants":5,"./../stores/EntitlementStore":7,"./EntitlementForm":4,"react":"react","shared.web.client":"shared.web.client"}],4:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var React = require("react");
var EntitlementStore = require("./../stores/EntitlementStore");
var EntitlementConstants = require("./../constants/EntitlementConstants");
var EntitlementActions = require("./../actions/EntitlementActions");
var Inovx = require("shared.web.client");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
var InovxControls = Inovx.Shared.Controls;
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
var ListHelper = Inovx.Shared.Common.ListHelper;
function getActionInProgress() {
    return SystemStore.isActionInProgress(EntitlementConstants.ENTITLEMENT_ADD) ||
        SystemStore.isActionInProgress(EntitlementConstants.ENTITLEMENT_EDIT);
}
var _displaySelectUserState;
var _actionInProgressMsg;
function getFormState() {
    return {
        securityGroup: EntitlementStore.getSecurityGroup(),
        isAdding: EntitlementStore.getIsAdding(),
        isEditing: EntitlementStore.getIsEditing(),
        isActionInProgress: getActionInProgress(),
        actionInProgressMsg: _actionInProgressMsg,
        applicationPermissions: EntitlementStore.getSecurityGroupDetail().ApplicationPermissions,
        groupUsers: EntitlementStore.getSecurityGroupDetail().GroupUsers,
        validation: EntitlementStore.getValidation(EntitlementConstants.ENTITLEMENT_ADD_FORM)
    };
}
var EntitlementForm = /** @class */ (function (_super) {
    __extends(EntitlementForm, _super);
    function EntitlementForm(props) {
        var _this = _super.call(this, props) || this;
        _this._onChange = function (event) {
            EntitlementActions.editSecurityGroup(EntitlementConstants.ENTITLEMENT_ADD_FORM, event.target.name, event.target.value);
        };
        _this._loadState = function () {
            _this.setState(getFormState());
        };
        _this._systemChange = function () {
            _this.setState({
                isActionInProgress: getActionInProgress()
            });
        };
        _this._validateEntitlement = function () {
            if (!EntitlementStore.getIsValidEditObject()) {
                EntitlementActions.displayInvalidEdit();
                return false;
            }
            return EntitlementStore.getIsValidObject(EntitlementConstants.ENTITLEMENT_ADD_FORM);
        };
        _this._saveEntitlement = function () {
            if (_this._validateEntitlement()) {
                if (_this.state.isAdding) {
                    EntitlementActions.createEntitlement();
                }
                else {
                    EntitlementActions.updateEntitlement();
                }
                _this.setState({ actionInProgressMsg: InovxLoader.t('Entitlement:form.saving') });
            }
            else {
                _this.setState({});
            }
        };
        _this._cancel = function () {
            EntitlementActions.finishEdit();
        };
        _this._updatePermissions = function (id, event) {
            EntitlementActions.editPermissions(id, event.target.checked);
        };
        _this._isEmptyOrNull = function (value) {
            return value && value.length > 0;
        };
        _this._validateUsers = function (users) {
            var assignedUsers = _this.state.groupUsers;
            var messageObject = {
                message: InovxLoader.t("Entitlement:message.duplicateUser")
            };
            var dupUsers = [];
            for (var i = 0; i < users.length; i++) {
                var user = users[i];
                for (var j = 0; j < assignedUsers.length; j++) {
                    var assignedUser = assignedUsers[j];
                    if (user.UserName === assignedUser.UserName && user.UserID === assignedUser.UserID) {
                        var duplicatUserFound = true;
                        dupUsers.push(user.UserName);
                    }
                }
            }
            messageObject.message += dupUsers.join(", ");
            if (duplicatUserFound)
                SystemActions.displayWarningMessage(messageObject);
        };
        _this._addsecurityGroupUser = function (users) {
            _this._validateUsers(users);
            if (users.length > 0) {
                EntitlementActions.addUsers(users);
            }
        };
        _this._deleteSecurityGroupUser = function (e, user) {
            EntitlementActions.deleteUser(user);
        };
        _this._checkForUnsavedChanges = function (event) {
            if (EntitlementStore.getHasChanges()) {
                event.returnValue = InovxLoader.t('common:msgBox.browserSaveChanges');
            }
            ;
        };
        _this.state = getFormState();
        return _this;
    }
    EntitlementForm.prototype.componentDidMount = function () {
        EntitlementStore.addChangeListener(this._loadState);
        SystemStore.addChangeListener(this._systemChange);
        window.addEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    EntitlementForm.prototype.componentWillUnmount = function () {
        EntitlementStore.removeChangeListener(this._loadState);
        SystemStore.removeChangeListener(this._systemChange);
        window.removeEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    EntitlementForm.prototype.render = function () {
        var _this = this;
        ListHelper.sort(this.state.applicationPermissions, "ApplicationDisplayName");
        var inputObj = {
            className: 'form-control',
            type: 'text'
        };
        var securityGroup = this.state.securityGroup;
        var nameInput = jQuery.extend({
            name: 'Name',
            id: 'entApp-groupName-input',
            value: securityGroup.Name
        }, inputObj);
        var descriptionInput = jQuery.extend({
            name: 'Description',
            id: 'entApp-desc-input',
            value: securityGroup.Description
        }, inputObj);
        var header = this.state.isAdding ? InovxLoader.t('Entitlement:header.newSecurityGroup') : InovxLoader.t('Entitlement:header.editSecurityGroup');
        var columns = [{
                field: "UserName",
                headerText: InovxLoader.t('Entitlement:common.username')
            }, {
                field: "FirstName",
                headerText: InovxLoader.t('Entitlement:common.firstname')
            }, {
                field: "LastName",
                headerText: InovxLoader.t('Entitlement:common.lastname')
            }, {
                field: "Enabled",
                headerText: InovxLoader.t('Entitlement:common.userStatus'),
                width: "165px",
                values: [
                    { value: true, text: InovxLoader.t('Entitlement:common.enabled') },
                    { value: false, text: InovxLoader.t('Entitlement:common.disabled') }
                ]
            }];
        var userDataSource = this.state.groupUsers;
        var userDefaultSort = [{
                field: "UserName",
                dir: "ascending"
            }];
        var userCommands = {
            command: [
                {
                    iconClassName: "glyphicon glyphicon-trash",
                    click: this._deleteSecurityGroupUser
                }
            ],
            width: "85px",
            headerText: InovxLoader.t('Entitlement:common.commands')
        };
        var gridWidths = {
            permissionName: { width: "calc(40% - 40px)" },
            enabled: { width: "80px" },
            description: { width: "calc(60% - 40px)" }
        };
        return (React.createElement(InovxControls.StaticHeaderForm, { title: header, saveOnClick: this._saveEntitlement, saveBtnId: "entApp-save-btn", cancelOnClick: this._cancel, cancelBtnId: "entApp-cancel-btn", isActionInProgress: this.state.isActionInProgress, inProgressMessage: this.state.actionInProgressMsg },
            React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("Entitlement:form.name")).concat(securityGroup.IsSystemDefault ? '' : '*'), inputName: 'Name' },
                React.createElement(InovxControls.ValidationInput, __assign({}, nameInput, { className: "form-control", onChange: this._onChange, readOnly: securityGroup.IsSystemDefault, validation: this.state.validation['Name'] }))),
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("Entitlement:form.description"), inputName: 'Description' },
                React.createElement("input", __assign({}, descriptionInput, { onChange: this._onChange, readOnly: securityGroup.IsSystemDefault }))),
            React.createElement(InovxControls.TabControl, { tabs: [InovxLoader.t("Entitlement:form.permissions"), InovxLoader.t("Entitlement:form.users")] },
                React.createElement(InovxControls.Content, null,
                    React.createElement("div", { className: "entitlement-permissions" }, this.state.applicationPermissions.map(function (applicationPermission) {
                        ListHelper.sort(applicationPermission.Permissions, "DisplayName");
                        return (React.createElement(InovxControls.Expander, { title: applicationPermission.ApplicationDisplayName, key: applicationPermission.ApplicationDisplayName },
                            React.createElement("div", { className: "tg-table" },
                                React.createElement("div", { className: "tg-grid" },
                                    React.createElement("div", { className: "tg-header-container" },
                                        React.createElement("div", { className: "tg-header tg-row" },
                                            React.createElement("div", { className: "tg-cell", style: gridWidths.permissionName },
                                                React.createElement("div", { className: "tg-hdr-ctnt" },
                                                    React.createElement("div", { className: "tg-title" }, InovxLoader.t('Entitlement:permission.name')))),
                                            React.createElement("div", { className: "tg-cell", style: gridWidths.enabled },
                                                React.createElement("div", { className: "tg-hdr-ctnt" },
                                                    React.createElement("div", { className: "tg-title" }, InovxLoader.t('Entitlement:permission.enabled')))),
                                            React.createElement("div", { className: "tg-cell", style: gridWidths.description },
                                                React.createElement("div", { className: "tg-hdr-ctnt" },
                                                    React.createElement("div", { className: "tg-title" }, InovxLoader.t('Entitlement:permission.description'))))))),
                                React.createElement("div", { className: "tg-content-container", style: { overflow: 'initial' } },
                                    React.createElement("div", { className: 'tg-content' }, applicationPermission.Permissions.map(function (permission) {
                                        return (React.createElement("div", { className: 'tg-row', "data-uid": permission.ID, key: permission.ID },
                                            React.createElement("div", { style: gridWidths.permissionName, className: 'tg-cell' }, permission.DisplayName),
                                            React.createElement("div", { style: gridWidths.enabled, className: 'tg-cell' },
                                                " ",
                                                React.createElement("input", { type: "checkbox", onChange: function (event) { return _this._updatePermissions(permission.ID, event); }, disabled: securityGroup.IsSystemDefault, checked: permission.Assigned, className: "checkbox" })),
                                            React.createElement("div", { style: gridWidths.description, className: 'tg-cell' }, permission.Description)));
                                    }))))));
                    }))),
                React.createElement(InovxControls.Content, { class: 'fc-margin' },
                    React.createElement(InovxControls.FormField, { title: InovxLoader.t("Entitlement:form.assignUsers"), inputName: 'AssignUsers' },
                        React.createElement(InovxControls.MultiSelect, { minLength: 1, displayProp: "UserName", url: "".concat(UrlUtilities.getApiUrl(), "/EntitlementApi/api/User/SearchUsers"), onClick: this._addsecurityGroupUser, parameters: { maxNumberOfResults: 5 }, numParameter: 'maxNumberOfResults', searchProperty: 'searchString', btnLabel: InovxLoader.t("Entitlement:form.addUserName"), keyProp: "UserID" })),
                    React.createElement(Inovx.Shared.Controls.Grid, { dataSource: userDataSource, commands: userCommands, columns: columns, defaultSort: userDefaultSort, sort: true })))));
    };
    return EntitlementForm;
}(React.Component));
module.exports = EntitlementForm;

},{"./../actions/EntitlementActions":2,"./../constants/EntitlementConstants":5,"./../stores/EntitlementStore":7,"react":"react","shared.web.client":"shared.web.client"}],5:[function(require,module,exports){
"use strict";
var keymirror = require("fbjs/lib/keymirror");
var EntitlementConstants = keymirror({
    ENTITLEMENT_ADD_FORM: null,
    ENTITLEMENT_FORM_INVALID_SAVE: null,
    ENTITLEMENT_RECIEVE_DATA: null,
    ENTITLEMENT_UPDATE_SECURITY_GROUP: null,
    ENTITLEMENT_ADD_USER: null,
    ENTITLEMENT_DELETE_USER: null,
    ENTITLEMENT_UPDATE_PERMISSIONS: null,
    ENTITLEMENT_BEGIN_ADD: null,
    ENTITLEMENT_ADD: null,
    ENTITLEMENT_BEGIN_EDIT: null,
    ENTITLEMENT_EDIT: null,
    ENTITLEMENT_FINISH_EDIT: null,
    ENTITLEMENT_DELETE: null
});
module.exports = EntitlementConstants;

},{"fbjs/lib/keymirror":"fbjs/lib/keymirror"}],6:[function(require,module,exports){
"use strict";
var Inovx = require("shared.web.client");
var assign = require("object-assign");
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
var url = "".concat(UrlUtilities.getApiUrl(), "/EntitlementApi/api/entitlementgroup");
var EntitlementServices = assign({}, Inovx.Shared.Flux.BaseService, {
    getAll: function (successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.get(url, null, function (retData) {
            successCallback(retData);
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    getApplicationPermissions: function (successCallback, errorCallback) {
        var _this = this;
        this.get("".concat(url, "/ApplicationPermissions"), null, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    getDetail: function (id, successCallback, errorCallback) {
        var _this = this;
        this.get("".concat(url, "/").concat(id), {}, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    create: function (entitlementGroup, permissionIDs, groupUserIDs, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/Create"), { entitlementGroup: entitlementGroup, permissionIDs: permissionIDs, groupUserIDs: groupUserIDs }, function (data) {
            successCallback(data);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    update: function (entitlementGroup, permissionIDs, groupUserIDs, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/Update"), { entitlementGroup: entitlementGroup, permissionIDs: permissionIDs, groupUserIDs: groupUserIDs }, function (data) {
            successCallback(data);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    delete: function (entitlementGroup, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/Delete"), { ID: entitlementGroup.ID, VersionToken: entitlementGroup.VersionToken }, function (data) {
            successCallback();
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
});
module.exports = EntitlementServices;

},{"object-assign":9,"shared.web.client":"shared.web.client"}],7:[function(require,module,exports){
"use strict";
var NodeEvents = require("events");
var Inovx = require("shared.web.client");
var assign = require("object-assign");
var EntitlementConstants = require("./../constants/EntitlementConstants");
var EventEmitter = NodeEvents.EventEmitter;
var CommonMessages = Inovx.Shared.Common.CommonMessages;
var ENTITLEMENT_CHANGE_EVENT = 'Entitlement.change';
var _securityGroups = [], _securityGroup = getBlankSecurityGroup(), _applicationPermissions = [], _securityGroupDetail = getBlankSecurityGroupDetail(_applicationPermissions), _user = getBlankUser(), _beginAdd = false, _beginEdit = false, _modalVisible = false, _hasChanges = false, _validation = {};
function loadEntitlementData(data) {
    _securityGroups = data;
}
function _updateSecurityGroup(comp, key, value) {
    switch (comp) {
        case EntitlementConstants.ENTITLEMENT_ADD_FORM:
            _updateChanges(key, value);
            _hasChanges = true;
            break;
    }
}
function _updateChanges(name, value) {
    switch (name) {
        case "Name":
            _securityGroup[name] = value;
            if (value) {
                var dupName = false;
                for (var i = 0; i < _securityGroups.length; i++) {
                    if (_securityGroup.Name.toUpperCase() === _securityGroups[i].Name.toUpperCase()
                        && _securityGroup.ID.toUpperCase() !== _securityGroups[i].ID.toUpperCase()) {
                        dupName = true;
                        break;
                    }
                }
                if (dupName) {
                    _validation[EntitlementConstants.ENTITLEMENT_ADD_FORM][name].invalidValue = true;
                    _validation[EntitlementConstants.ENTITLEMENT_ADD_FORM][name].invalidValueMessage = InovxLoader.t("Entitlement:message.invalidSecurityGroupName");
                }
                else {
                    _setValidValidation(EntitlementConstants.ENTITLEMENT_ADD_FORM, name);
                }
            }
            else {
                _validation[EntitlementConstants.ENTITLEMENT_ADD_FORM][name].invalidValue = true;
                _validation[EntitlementConstants.ENTITLEMENT_ADD_FORM][name].invalidValueMessage = CommonMessages.Validation.Required;
            }
            break;
        default:
            if (name != 'ID' && name != 'VersionToken') {
                _securityGroup[name] = value;
            }
            _setValidValidation(EntitlementConstants.ENTITLEMENT_ADD_FORM, name);
            break;
    }
}
function updatePermissions(uid, value) {
    var applicationPermissions = _securityGroupDetail.ApplicationPermissions;
    for (var index in applicationPermissions) {
        var applicationPermission = applicationPermissions[index];
        for (var subIndex in applicationPermission.Permissions) {
            var permission = applicationPermission.Permissions[subIndex];
            if (permission.ID == uid) {
                permission.Assigned = value;
                _hasChanges = true;
                break;
            }
        }
    }
}
function addUsers(users) {
    for (var indx in users) {
        var exists = false;
        for (var grpIndx in _securityGroupDetail.GroupUsers) {
            if (users[indx].UserID === _securityGroupDetail.GroupUsers[grpIndx].UserID) {
                exists = true;
                break;
            }
        }
        if (!exists) {
            _securityGroupDetail.GroupUsers.push(users[indx]);
        }
    }
    _hasChanges = true;
}
function deleteUser(user) {
    for (var index in _securityGroupDetail.GroupUsers) {
        if (_securityGroupDetail.GroupUsers[index].UserName == user.UserName) {
            _securityGroupDetail.GroupUsers.splice(index, 1);
            _hasChanges = true;
            break;
        }
    }
    ;
}
function setAddingEntitlement(applicationPermissions) {
    _beginAdd = _modalVisible = true;
    _beginEdit = false;
    _securityGroup = getBlankSecurityGroup();
    _securityGroupDetail = getBlankSecurityGroupDetail(applicationPermissions);
    _user = getBlankUser();
    _hasChanges = false;
    _initalizeValidation(EntitlementConstants.ENTITLEMENT_ADD_FORM);
}
function setEditingEntitlement(securityGroup, securityGroupDetail) {
    _modalVisible = _beginEdit = true;
    _beginAdd = false;
    _securityGroup = $.extend({}, securityGroup);
    _securityGroupDetail = $.extend({}, securityGroupDetail);
    _user = getBlankUser();
    _hasChanges = false;
    _initalizeValidation(EntitlementConstants.ENTITLEMENT_ADD_FORM);
}
function _initalizeValidation(comp) {
    switch (comp) {
        case EntitlementConstants.ENTITLEMENT_ADD_FORM:
            var valiObj = _validation[EntitlementConstants.ENTITLEMENT_ADD_FORM] = {};
            for (var k in _securityGroup) {
                _setValidValidation(EntitlementConstants.ENTITLEMENT_ADD_FORM, k);
            }
            break;
    }
}
function _setValidValidation(comp, name) {
    if (_validation[comp][name]) {
        _validation[comp][name].invalidInput = false;
        _validation[comp][name].invalidValue = false;
    }
    else {
        _validation[comp][name] = _getNewValidationObject();
    }
}
function _getNewValidationObject() {
    return {
        invalidInput: false,
        invalidValue: false
    };
}
function _validate(comp) {
    switch (comp) {
        case EntitlementConstants.ENTITLEMENT_ADD_FORM:
            return _validateObject(comp, _securityGroup);
    }
    return false;
}
function _ensureValidObject(comp, obj) {
    for (var k in obj) {
        switch (comp) {
            case EntitlementConstants.ENTITLEMENT_ADD_FORM:
                var objType = typeof (obj[k]);
                if (objType !== 'function') {
                    if (obj[k] === null || objType !== 'object') {
                        _updateChanges(k, obj[k]);
                    }
                    else if (obj.constructor !== Array) {
                        _ensureValidObject(comp, obj[k]);
                    }
                }
        }
    }
}
function _validateObject(comp, obj) {
    _ensureValidObject(comp, obj);
    for (var k in _validation[EntitlementConstants.ENTITLEMENT_ADD_FORM]) {
        if (_validation[EntitlementConstants.ENTITLEMENT_ADD_FORM][k].invalidValue) {
            return false;
        }
    }
    return true;
}
function finishedEditing() {
    _modalVisible = false;
    _hasChanges = false;
}
function getBlankSecurityGroup() {
    return {
        ID: '',
        VersionToken: '',
        Name: '',
        Description: '',
        IsSystemDefault: false,
    };
}
function getBlankSecurityGroupDetail(applicationPermissions) {
    return {
        ApplicationPermissions: applicationPermissions,
        GroupUsers: []
    };
}
function getBlankApplicationPermission() {
    return {
        ApplicationDisplayName: null,
        Permissions: []
    };
}
function getBlankUser() {
    return {
        UserID: null,
        UserName: null,
        UserVersionToken: null,
        FirstName: null,
        LastName: null,
        Enabled: null,
    };
}
var EntitlementStore = assign({}, EventEmitter.prototype, {
    // Add store getters here
    getAll: function () {
        return _securityGroups;
    },
    getSecurityGroup: function () {
        return _securityGroup;
    },
    getSecurityGroupDetail: function () {
        return _securityGroupDetail;
    },
    getUser: function () {
        return _user;
    },
    getIsAdding: function () {
        return _beginAdd;
    },
    getIsEditing: function () {
        return _beginEdit;
    },
    getHasChanges: function () {
        return _hasChanges;
    },
    getModalVisible: function () {
        return _modalVisible;
    },
    getValidation: function (key) {
        return _validation[key];
    },
    getIsValidObject: function (key) {
        return _validate(key);
    },
    getIsValidEditObject: function () {
        return !(_securityGroup.IsSystemDefault && _securityGroup.Name === 'System Administrator' && _securityGroupDetail.GroupUsers.length == 0);
    },
    emitChange: function () {
        this.emit(ENTITLEMENT_CHANGE_EVENT);
    },
    addChangeListener: function (callback) {
        this.on(ENTITLEMENT_CHANGE_EVENT, callback);
    },
    removeChangeListener: function (callback) {
        this.removeListener(ENTITLEMENT_CHANGE_EVENT, callback);
    }
});
Inovx.Shared.Flux.AppDispatcher.register(function (payload) {
    switch (payload.actionType) {
        case EntitlementConstants.ENTITLEMENT_BEGIN_ADD:
            setAddingEntitlement(payload.applicationPermissions);
            break;
        case EntitlementConstants.ENTITLEMENT_BEGIN_EDIT:
            setEditingEntitlement(payload.securityGroup, payload.securityGroupDetail);
            break;
        case EntitlementConstants.ENTITLEMENT_FINISH_EDIT:
            finishedEditing();
            break;
        case EntitlementConstants.ENTITLEMENT_RECIEVE_DATA:
            loadEntitlementData(payload.data);
            break;
        case EntitlementConstants.ENTITLEMENT_UPDATE_SECURITY_GROUP:
            _updateSecurityGroup(payload.component, payload.key, payload.value);
            break;
        case EntitlementConstants.ENTITLEMENT_UPDATE_PERMISSIONS:
            updatePermissions(payload.uid, payload.value);
            break;
        case EntitlementConstants.ENTITLEMENT_ADD_USER:
            addUsers(payload.users);
            break;
        case EntitlementConstants.ENTITLEMENT_DELETE_USER:
            deleteUser(payload.user);
            break;
        case EntitlementConstants.ENTITLEMENT_FORM_INVALID_SAVE:
            break;
        default: return true;
    }
    EntitlementStore.emitChange();
    return true;
});
module.exports = EntitlementStore;

},{"./../constants/EntitlementConstants":5,"events":8,"object-assign":9,"shared.web.client":"shared.web.client"}],8:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var objectCreate = Object.create || objectCreatePolyfill
var objectKeys = Object.keys || objectKeysPolyfill
var bind = Function.prototype.bind || functionBindPolyfill

function EventEmitter() {
  if (!this._events || !Object.prototype.hasOwnProperty.call(this, '_events')) {
    this._events = objectCreate(null);
    this._eventsCount = 0;
  }

  this._maxListeners = this._maxListeners || undefined;
}
module.exports = EventEmitter;

// Backwards-compat with node 0.10.x
EventEmitter.EventEmitter = EventEmitter;

EventEmitter.prototype._events = undefined;
EventEmitter.prototype._maxListeners = undefined;

// By default EventEmitters will print a warning if more than 10 listeners are
// added to it. This is a useful default which helps finding memory leaks.
var defaultMaxListeners = 10;

var hasDefineProperty;
try {
  var o = {};
  if (Object.defineProperty) Object.defineProperty(o, 'x', { value: 0 });
  hasDefineProperty = o.x === 0;
} catch (err) { hasDefineProperty = false }
if (hasDefineProperty) {
  Object.defineProperty(EventEmitter, 'defaultMaxListeners', {
    enumerable: true,
    get: function() {
      return defaultMaxListeners;
    },
    set: function(arg) {
      // check whether the input is a positive number (whose value is zero or
      // greater and not a NaN).
      if (typeof arg !== 'number' || arg < 0 || arg !== arg)
        throw new TypeError('"defaultMaxListeners" must be a positive number');
      defaultMaxListeners = arg;
    }
  });
} else {
  EventEmitter.defaultMaxListeners = defaultMaxListeners;
}

// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
EventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {
  if (typeof n !== 'number' || n < 0 || isNaN(n))
    throw new TypeError('"n" argument must be a positive number');
  this._maxListeners = n;
  return this;
};

function $getMaxListeners(that) {
  if (that._maxListeners === undefined)
    return EventEmitter.defaultMaxListeners;
  return that._maxListeners;
}

EventEmitter.prototype.getMaxListeners = function getMaxListeners() {
  return $getMaxListeners(this);
};

// These standalone emit* functions are used to optimize calling of event
// handlers for fast cases because emit() itself often has a variable number of
// arguments and can be deoptimized because of that. These functions always have
// the same number of arguments and thus do not get deoptimized, so the code
// inside them can execute faster.
function emitNone(handler, isFn, self) {
  if (isFn)
    handler.call(self);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self);
  }
}
function emitOne(handler, isFn, self, arg1) {
  if (isFn)
    handler.call(self, arg1);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1);
  }
}
function emitTwo(handler, isFn, self, arg1, arg2) {
  if (isFn)
    handler.call(self, arg1, arg2);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1, arg2);
  }
}
function emitThree(handler, isFn, self, arg1, arg2, arg3) {
  if (isFn)
    handler.call(self, arg1, arg2, arg3);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1, arg2, arg3);
  }
}

function emitMany(handler, isFn, self, args) {
  if (isFn)
    handler.apply(self, args);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].apply(self, args);
  }
}

EventEmitter.prototype.emit = function emit(type) {
  var er, handler, len, args, i, events;
  var doError = (type === 'error');

  events = this._events;
  if (events)
    doError = (doError && events.error == null);
  else if (!doError)
    return false;

  // If there is no 'error' event listener then throw.
  if (doError) {
    if (arguments.length > 1)
      er = arguments[1];
    if (er instanceof Error) {
      throw er; // Unhandled 'error' event
    } else {
      // At least give some kind of context to the user
      var err = new Error('Unhandled "error" event. (' + er + ')');
      err.context = er;
      throw err;
    }
    return false;
  }

  handler = events[type];

  if (!handler)
    return false;

  var isFn = typeof handler === 'function';
  len = arguments.length;
  switch (len) {
      // fast cases
    case 1:
      emitNone(handler, isFn, this);
      break;
    case 2:
      emitOne(handler, isFn, this, arguments[1]);
      break;
    case 3:
      emitTwo(handler, isFn, this, arguments[1], arguments[2]);
      break;
    case 4:
      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);
      break;
      // slower
    default:
      args = new Array(len - 1);
      for (i = 1; i < len; i++)
        args[i - 1] = arguments[i];
      emitMany(handler, isFn, this, args);
  }

  return true;
};

function _addListener(target, type, listener, prepend) {
  var m;
  var events;
  var existing;

  if (typeof listener !== 'function')
    throw new TypeError('"listener" argument must be a function');

  events = target._events;
  if (!events) {
    events = target._events = objectCreate(null);
    target._eventsCount = 0;
  } else {
    // To avoid recursion in the case that type === "newListener"! Before
    // adding it to the listeners, first emit "newListener".
    if (events.newListener) {
      target.emit('newListener', type,
          listener.listener ? listener.listener : listener);

      // Re-assign `events` because a newListener handler could have caused the
      // this._events to be assigned to a new object
      events = target._events;
    }
    existing = events[type];
  }

  if (!existing) {
    // Optimize the case of one listener. Don't need the extra array object.
    existing = events[type] = listener;
    ++target._eventsCount;
  } else {
    if (typeof existing === 'function') {
      // Adding the second element, need to change to array.
      existing = events[type] =
          prepend ? [listener, existing] : [existing, listener];
    } else {
      // If we've already got an array, just append.
      if (prepend) {
        existing.unshift(listener);
      } else {
        existing.push(listener);
      }
    }

    // Check for listener leak
    if (!existing.warned) {
      m = $getMaxListeners(target);
      if (m && m > 0 && existing.length > m) {
        existing.warned = true;
        var w = new Error('Possible EventEmitter memory leak detected. ' +
            existing.length + ' "' + String(type) + '" listeners ' +
            'added. Use emitter.setMaxListeners() to ' +
            'increase limit.');
        w.name = 'MaxListenersExceededWarning';
        w.emitter = target;
        w.type = type;
        w.count = existing.length;
        if (typeof console === 'object' && console.warn) {
          console.warn('%s: %s', w.name, w.message);
        }
      }
    }
  }

  return target;
}

EventEmitter.prototype.addListener = function addListener(type, listener) {
  return _addListener(this, type, listener, false);
};

EventEmitter.prototype.on = EventEmitter.prototype.addListener;

EventEmitter.prototype.prependListener =
    function prependListener(type, listener) {
      return _addListener(this, type, listener, true);
    };

function onceWrapper() {
  if (!this.fired) {
    this.target.removeListener(this.type, this.wrapFn);
    this.fired = true;
    switch (arguments.length) {
      case 0:
        return this.listener.call(this.target);
      case 1:
        return this.listener.call(this.target, arguments[0]);
      case 2:
        return this.listener.call(this.target, arguments[0], arguments[1]);
      case 3:
        return this.listener.call(this.target, arguments[0], arguments[1],
            arguments[2]);
      default:
        var args = new Array(arguments.length);
        for (var i = 0; i < args.length; ++i)
          args[i] = arguments[i];
        this.listener.apply(this.target, args);
    }
  }
}

function _onceWrap(target, type, listener) {
  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };
  var wrapped = bind.call(onceWrapper, state);
  wrapped.listener = listener;
  state.wrapFn = wrapped;
  return wrapped;
}

EventEmitter.prototype.once = function once(type, listener) {
  if (typeof listener !== 'function')
    throw new TypeError('"listener" argument must be a function');
  this.on(type, _onceWrap(this, type, listener));
  return this;
};

EventEmitter.prototype.prependOnceListener =
    function prependOnceListener(type, listener) {
      if (typeof listener !== 'function')
        throw new TypeError('"listener" argument must be a function');
      this.prependListener(type, _onceWrap(this, type, listener));
      return this;
    };

// Emits a 'removeListener' event if and only if the listener was removed.
EventEmitter.prototype.removeListener =
    function removeListener(type, listener) {
      var list, events, position, i, originalListener;

      if (typeof listener !== 'function')
        throw new TypeError('"listener" argument must be a function');

      events = this._events;
      if (!events)
        return this;

      list = events[type];
      if (!list)
        return this;

      if (list === listener || list.listener === listener) {
        if (--this._eventsCount === 0)
          this._events = objectCreate(null);
        else {
          delete events[type];
          if (events.removeListener)
            this.emit('removeListener', type, list.listener || listener);
        }
      } else if (typeof list !== 'function') {
        position = -1;

        for (i = list.length - 1; i >= 0; i--) {
          if (list[i] === listener || list[i].listener === listener) {
            originalListener = list[i].listener;
            position = i;
            break;
          }
        }

        if (position < 0)
          return this;

        if (position === 0)
          list.shift();
        else
          spliceOne(list, position);

        if (list.length === 1)
          events[type] = list[0];

        if (events.removeListener)
          this.emit('removeListener', type, originalListener || listener);
      }

      return this;
    };

EventEmitter.prototype.removeAllListeners =
    function removeAllListeners(type) {
      var listeners, events, i;

      events = this._events;
      if (!events)
        return this;

      // not listening for removeListener, no need to emit
      if (!events.removeListener) {
        if (arguments.length === 0) {
          this._events = objectCreate(null);
          this._eventsCount = 0;
        } else if (events[type]) {
          if (--this._eventsCount === 0)
            this._events = objectCreate(null);
          else
            delete events[type];
        }
        return this;
      }

      // emit removeListener for all listeners on all events
      if (arguments.length === 0) {
        var keys = objectKeys(events);
        var key;
        for (i = 0; i < keys.length; ++i) {
          key = keys[i];
          if (key === 'removeListener') continue;
          this.removeAllListeners(key);
        }
        this.removeAllListeners('removeListener');
        this._events = objectCreate(null);
        this._eventsCount = 0;
        return this;
      }

      listeners = events[type];

      if (typeof listeners === 'function') {
        this.removeListener(type, listeners);
      } else if (listeners) {
        // LIFO order
        for (i = listeners.length - 1; i >= 0; i--) {
          this.removeListener(type, listeners[i]);
        }
      }

      return this;
    };

function _listeners(target, type, unwrap) {
  var events = target._events;

  if (!events)
    return [];

  var evlistener = events[type];
  if (!evlistener)
    return [];

  if (typeof evlistener === 'function')
    return unwrap ? [evlistener.listener || evlistener] : [evlistener];

  return unwrap ? unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);
}

EventEmitter.prototype.listeners = function listeners(type) {
  return _listeners(this, type, true);
};

EventEmitter.prototype.rawListeners = function rawListeners(type) {
  return _listeners(this, type, false);
};

EventEmitter.listenerCount = function(emitter, type) {
  if (typeof emitter.listenerCount === 'function') {
    return emitter.listenerCount(type);
  } else {
    return listenerCount.call(emitter, type);
  }
};

EventEmitter.prototype.listenerCount = listenerCount;
function listenerCount(type) {
  var events = this._events;

  if (events) {
    var evlistener = events[type];

    if (typeof evlistener === 'function') {
      return 1;
    } else if (evlistener) {
      return evlistener.length;
    }
  }

  return 0;
}

EventEmitter.prototype.eventNames = function eventNames() {
  return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [];
};

// About 1.5x faster than the two-arg version of Array#splice().
function spliceOne(list, index) {
  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)
    list[i] = list[k];
  list.pop();
}

function arrayClone(arr, n) {
  var copy = new Array(n);
  for (var i = 0; i < n; ++i)
    copy[i] = arr[i];
  return copy;
}

function unwrapListeners(arr) {
  var ret = new Array(arr.length);
  for (var i = 0; i < ret.length; ++i) {
    ret[i] = arr[i].listener || arr[i];
  }
  return ret;
}

function objectCreatePolyfill(proto) {
  var F = function() {};
  F.prototype = proto;
  return new F;
}
function objectKeysPolyfill(obj) {
  var keys = [];
  for (var k in obj) if (Object.prototype.hasOwnProperty.call(obj, k)) {
    keys.push(k);
  }
  return k;
}
function functionBindPolyfill(context) {
  var fn = this;
  return function () {
    return fn.apply(context, arguments);
  };
}

},{}],9:[function(require,module,exports){
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/

'use strict';
/* eslint-disable no-unused-vars */
var getOwnPropertySymbols = Object.getOwnPropertySymbols;
var hasOwnProperty = Object.prototype.hasOwnProperty;
var propIsEnumerable = Object.prototype.propertyIsEnumerable;

function toObject(val) {
	if (val === null || val === undefined) {
		throw new TypeError('Object.assign cannot be called with null or undefined');
	}

	return Object(val);
}

function shouldUseNative() {
	try {
		if (!Object.assign) {
			return false;
		}

		// Detect buggy property enumeration order in older V8 versions.

		// https://bugs.chromium.org/p/v8/issues/detail?id=4118
		var test1 = new String('abc');  // eslint-disable-line no-new-wrappers
		test1[5] = 'de';
		if (Object.getOwnPropertyNames(test1)[0] === '5') {
			return false;
		}

		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
		var test2 = {};
		for (var i = 0; i < 10; i++) {
			test2['_' + String.fromCharCode(i)] = i;
		}
		var order2 = Object.getOwnPropertyNames(test2).map(function (n) {
			return test2[n];
		});
		if (order2.join('') !== '0123456789') {
			return false;
		}

		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
		var test3 = {};
		'abcdefghijklmnopqrst'.split('').forEach(function (letter) {
			test3[letter] = letter;
		});
		if (Object.keys(Object.assign({}, test3)).join('') !==
				'abcdefghijklmnopqrst') {
			return false;
		}

		return true;
	} catch (err) {
		// We don't expect any of the above to throw, but better to be safe.
		return false;
	}
}

module.exports = shouldUseNative() ? Object.assign : function (target, source) {
	var from;
	var to = toObject(target);
	var symbols;

	for (var s = 1; s < arguments.length; s++) {
		from = Object(arguments[s]);

		for (var key in from) {
			if (hasOwnProperty.call(from, key)) {
				to[key] = from[key];
			}
		}

		if (getOwnPropertySymbols) {
			symbols = getOwnPropertySymbols(from);
			for (var i = 0; i < symbols.length; i++) {
				if (propIsEnumerable.call(from, symbols[i])) {
					to[symbols[i]] = from[symbols[i]];
				}
			}
		}
	}

	return to;
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJiaW4vanMtb3V0L2FwcC9BcHAuanMiLCJiaW4vanMtb3V0L2FwcC9hY3Rpb25zL0VudGl0bGVtZW50QWN0aW9ucy5qcyIsImJpbi9qcy1vdXQvYXBwL2NvbXBvbmVudHMvRW50aXRsZW1lbnRBcHAuanMiLCJiaW4vanMtb3V0L2FwcC9jb21wb25lbnRzL0VudGl0bGVtZW50Rm9ybS5qcyIsImJpbi9qcy1vdXQvYXBwL2NvbnN0YW50cy9FbnRpdGxlbWVudENvbnN0YW50cy5qcyIsImJpbi9qcy1vdXQvYXBwL3NlcnZpY2VzL0VudGl0bGVtZW50U2VydmljZXMuanMiLCJiaW4vanMtb3V0L2FwcC9zdG9yZXMvRW50aXRsZW1lbnRTdG9yZS5qcyIsIm5vZGVfbW9kdWxlcy9ldmVudHMvZXZlbnRzLmpzIiwibm9kZV9tb2R1bGVzL29iamVjdC1hc3NpZ24vaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdFBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIMKpIDIwMDEtMjAxNSBJTk9WeCBTb2x1dGlvbnMsIEluYy5cclxuLy8gMTE0IFBhY2lmaWNhIFN1aXRlIDMwMCwgSXJ2aW5lLCBDQSA5MjYxOCBVU0FcclxuLy8gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy9cclxuLy8gVGhpcyBzb2Z0d2FyZSBpcyBjb25maWRlbnRpYWwsIHByb3ByaWV0YXJ5IGFuZCB1bnB1Ymxpc2hlZCBwcm9wZXJ0eSBvZlxyXG4vLyBJTk9WeCBTb2x1dGlvbnMsIEluYy4gIEl0IG1heSBOT1QgYmUgY29waWVkIGluIHBhcnQgb3IgaW4gd2hvbGUgb24gYW55XHJcbi8vIG1lZGl1bSwgZWl0aGVyIGVsZWN0cm9uaWMgb3IgcHJpbnRlZCwgd2l0aG91dCB0aGUgZXhwcmVzcyB3cml0dGVuIGNvbnNlbnRcclxuLy8gb2YgSU5PVnggU29sdXRpb25zLCBJbmMuXHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xyXG52YXIgUmVhY3RET00gPSByZXF1aXJlKFwicmVhY3QtZG9tXCIpO1xyXG52YXIgRW50aXRsZW1lbnRBcHAgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL0VudGl0bGVtZW50QXBwXCIpO1xyXG50cnkge1xyXG4gICAgSW5vdnhMb2FkZXIudXBkYXRlSGVscCgnZW50aXRsZW1lbnQnKTtcclxufVxyXG5jYXRjaCAoZSkge1xyXG59XHJcblJlYWN0RE9NLnJlbmRlcihSZWFjdC5jcmVhdGVFbGVtZW50KEVudGl0bGVtZW50QXBwLCBudWxsKSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VudGl0bGVtZW50YXBwJykpO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBJbm92eCA9IHJlcXVpcmUoXCJzaGFyZWQud2ViLmNsaWVudFwiKTtcclxudmFyIEVudGl0bGVtZW50Q29uc3RhbnRzID0gcmVxdWlyZShcIi4vLi4vY29uc3RhbnRzL0VudGl0bGVtZW50Q29uc3RhbnRzXCIpO1xyXG52YXIgRW50aXRsZW1lbnRTZXJ2aWNlcyA9IHJlcXVpcmUoXCIuLy4uL3NlcnZpY2VzL0VudGl0bGVtZW50U2VydmljZXNcIik7XHJcbnZhciBFbnRpdGxlbWVudFN0b3JlID0gcmVxdWlyZShcIi4vLi4vc3RvcmVzL0VudGl0bGVtZW50U3RvcmVcIik7XHJcbnZhciBTeXN0ZW1BY3Rpb25zID0gSW5vdnguU2hhcmVkLlN5c3RlbS5BY3Rpb25zO1xyXG52YXIgU3lzdGVtU3RvcmUgPSBJbm92eC5TaGFyZWQuU3lzdGVtLlN0b3JlO1xyXG5mdW5jdGlvbiByZWNlaXZlRW50aXRsZW1lbnREYXRhKGRhdGEpIHtcclxuICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgIGFjdGlvblR5cGU6IEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX1JFQ0lFVkVfREFUQSxcclxuICAgICAgICBkYXRhOiBkYXRhXHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBfZmluaXNoRWRpdCgpIHtcclxuICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgIGFjdGlvblR5cGU6IEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0ZJTklTSF9FRElUXHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBzZW5kSW52YWxpZFNhdmUoKSB7XHJcbiAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICBhY3Rpb25UeXBlOiBFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9GT1JNX0lOVkFMSURfU0FWRVxyXG4gICAgfSk7XHJcbn1cclxudmFyIEVudGl0bGVtZW50QWN0aW9ucyA9IHtcclxuICAgIGdldEFsbEVudGl0bGVtZW50OiBmdW5jdGlvbiAoY2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIGlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgIEVudGl0bGVtZW50U2VydmljZXMuZ2V0QWxsKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gJ3VuZGVmaW5lZCcgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVjZWl2ZUVudGl0bGVtZW50RGF0YShkYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgaWYgKGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgaWdub3JlRGVmYXVsdEVycm9yKTtcclxuICAgIH0sXHJcbiAgICBiZWdpbkFkZDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIEVudGl0bGVtZW50U2VydmljZXMuZ2V0QXBwbGljYXRpb25QZXJtaXNzaW9ucyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0JFR0lOX0FERCxcclxuICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9uUGVybWlzc2lvbnM6IGRhdGFcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgY3JlYXRlRW50aXRsZW1lbnQ6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgIGlmIChFbnRpdGxlbWVudFN0b3JlLmdldElzVmFsaWRPYmplY3QoRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQUREX0ZPUk0pKSB7XHJcbiAgICAgICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERCkpIHtcclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuYmVnaW5BY3Rpb24oRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQUREKTtcclxuICAgICAgICAgICAgICAgIHZhciBzZWN1cml0eUdyb3VwID0gRW50aXRsZW1lbnRTdG9yZS5nZXRTZWN1cml0eUdyb3VwKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VjdXJ0eUdyb3VwRGV0YWlsID0gRW50aXRsZW1lbnRTdG9yZS5nZXRTZWN1cml0eUdyb3VwRGV0YWlsKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXBwbGljYXRpb25QZXJtaXNzaW9ucyA9IHNlY3VydHlHcm91cERldGFpbC5BcHBsaWNhdGlvblBlcm1pc3Npb25zO1xyXG4gICAgICAgICAgICAgICAgdmFyIGdyb3VwVXNlcnMgPSBzZWN1cnR5R3JvdXBEZXRhaWwuR3JvdXBVc2VycztcclxuICAgICAgICAgICAgICAgIHZhciBwZXJtaXNzaW9uSURzID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIgZ3JvdXBVc2VySURzID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCBpbiBhcHBsaWNhdGlvblBlcm1pc3Npb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFwcGxpY2F0aW9uUGVybWlzc2lvbiA9IGFwcGxpY2F0aW9uUGVybWlzc2lvbnNbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHN1YkluZGV4IGluIGFwcGxpY2F0aW9uUGVybWlzc2lvbi5QZXJtaXNzaW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGVybWlzc2lvbiA9IGFwcGxpY2F0aW9uUGVybWlzc2lvbi5QZXJtaXNzaW9uc1tzdWJJbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwZXJtaXNzaW9uLkFzc2lnbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uSURzLnB1c2gocGVybWlzc2lvbi5JRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCBpbiBncm91cFVzZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwVXNlciA9IGdyb3VwVXNlcnNbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwVXNlcklEcy5wdXNoKGdyb3VwVXNlci5Vc2VySUQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgRW50aXRsZW1lbnRTZXJ2aWNlcy5jcmVhdGUoc2VjdXJpdHlHcm91cCwgcGVybWlzc2lvbklEcywgZ3JvdXBVc2VySURzLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRW50aXRsZW1lbnRBY3Rpb25zLnJlZnJlc2hEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBfZmluaXNoRWRpdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQUREKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzZW5kSW52YWxpZFNhdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgYmVnaW5FZGl0OiBmdW5jdGlvbiAoc2VjdXJpdHlHcm91cCkge1xyXG4gICAgICAgIEVudGl0bGVtZW50U2VydmljZXMuZ2V0RGV0YWlsKHNlY3VyaXR5R3JvdXAuSUQsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQkVHSU5fRURJVCxcclxuICAgICAgICAgICAgICAgIHNlY3VyaXR5R3JvdXA6IHNlY3VyaXR5R3JvdXAsXHJcbiAgICAgICAgICAgICAgICBzZWN1cml0eUdyb3VwRGV0YWlsOiBkYXRhXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIHVwZGF0ZUVudGl0bGVtZW50OiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoRW50aXRsZW1lbnRTdG9yZS5nZXRJc1ZhbGlkT2JqZWN0KEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERF9GT1JNKSkge1xyXG4gICAgICAgICAgICBpZiAoIUVudGl0bGVtZW50U3RvcmUuZ2V0SXNWYWxpZEVkaXRPYmplY3QoKSkge1xyXG4gICAgICAgICAgICAgICAgRW50aXRsZW1lbnRBY3Rpb25zLmRpc3BsYXlJbnZhbGlkRWRpdCgpO1xyXG4gICAgICAgICAgICAgICAgc2VuZEludmFsaWRTYXZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIVN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9FRElUKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuYmVnaW5BY3Rpb24oRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfRURJVCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlY3VyaXR5R3JvdXAgPSBFbnRpdGxlbWVudFN0b3JlLmdldFNlY3VyaXR5R3JvdXAoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2VjdXJ0eUdyb3VwRGV0YWlsID0gRW50aXRsZW1lbnRTdG9yZS5nZXRTZWN1cml0eUdyb3VwRGV0YWlsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFwcGxpY2F0aW9uUGVybWlzc2lvbnMgPSBzZWN1cnR5R3JvdXBEZXRhaWwuQXBwbGljYXRpb25QZXJtaXNzaW9ucztcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JvdXBVc2VycyA9IHNlY3VydHlHcm91cERldGFpbC5Hcm91cFVzZXJzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwZXJtaXNzaW9uSURzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwVXNlcklEcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4IGluIGFwcGxpY2F0aW9uUGVybWlzc2lvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFwcGxpY2F0aW9uUGVybWlzc2lvbiA9IGFwcGxpY2F0aW9uUGVybWlzc2lvbnNbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBzdWJJbmRleCBpbiBhcHBsaWNhdGlvblBlcm1pc3Npb24uUGVybWlzc2lvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwZXJtaXNzaW9uID0gYXBwbGljYXRpb25QZXJtaXNzaW9uLlBlcm1pc3Npb25zW3N1YkluZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwZXJtaXNzaW9uLkFzc2lnbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbklEcy5wdXNoKHBlcm1pc3Npb24uSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4IGluIGdyb3VwVXNlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwVXNlciA9IGdyb3VwVXNlcnNbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cFVzZXJJRHMucHVzaChncm91cFVzZXIuVXNlcklEKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgRW50aXRsZW1lbnRTZXJ2aWNlcy51cGRhdGUoc2VjdXJpdHlHcm91cCwgcGVybWlzc2lvbklEcywgZ3JvdXBVc2VySURzLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBFbnRpdGxlbWVudEFjdGlvbnMucmVmcmVzaERhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfZmluaXNoRWRpdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9FRElUKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfRURJVCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHNlbmRJbnZhbGlkU2F2ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBmaW5pc2hFZGl0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKEVudGl0bGVtZW50U3RvcmUuZ2V0SGFzQ2hhbmdlcygpKSB7XHJcbiAgICAgICAgICAgIHZhciBzYXZlRnVuY3QgPSBFbnRpdGxlbWVudFN0b3JlLmdldElzRWRpdGluZygpID8gRW50aXRsZW1lbnRBY3Rpb25zLnVwZGF0ZUVudGl0bGVtZW50IDogRW50aXRsZW1lbnRBY3Rpb25zLmNyZWF0ZUVudGl0bGVtZW50O1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmRpc3BsYXlTYXZlQ2hhbmdlc0RpYWxvZyh7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBJbm92eExvYWRlci50KFwiY29tbW9uOm1zZ0JveC5zYXZlQ2hhbmdlc1wiKSxcclxuICAgICAgICAgICAgICAgIGNhbmNlbENhbGxiYWNrOiBfZmluaXNoRWRpdCxcclxuICAgICAgICAgICAgICAgIGNvbmZpcm1DYWxsYmFjazogc2F2ZUZ1bmN0XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgX2ZpbmlzaEVkaXQoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZGVsZXRlRW50aXRsZW1lbnQ6IGZ1bmN0aW9uIChzZWN1cml0eUdyb3VwLCBjYWxsYmFjaykge1xyXG4gICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0RFTEVURSkpIHtcclxuICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5iZWdpbkFjdGlvbihFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9ERUxFVEUpO1xyXG4gICAgICAgICAgICBFbnRpdGxlbWVudFNlcnZpY2VzLmRlbGV0ZShzZWN1cml0eUdyb3VwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBFbnRpdGxlbWVudEFjdGlvbnMucmVmcmVzaERhdGEoKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gJ3VuZGVmaW5lZCcgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9ERUxFVEUpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0RFTEVURSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICByZWZyZXNoRGF0YTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuZ2V0QWxsRW50aXRsZW1lbnQoKTtcclxuICAgIH0sXHJcbiAgICBlZGl0U2VjdXJpdHlHcm91cDogZnVuY3Rpb24gKGNvbXAsIGtleSwgdmFsdWUpIHtcclxuICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgYWN0aW9uVHlwZTogRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfVVBEQVRFX1NFQ1VSSVRZX0dST1VQLFxyXG4gICAgICAgICAgICBjb21wb25lbnQ6IGNvbXAsXHJcbiAgICAgICAgICAgIGtleToga2V5LFxyXG4gICAgICAgICAgICB2YWx1ZTogdmFsdWVcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBlZGl0UGVybWlzc2lvbnM6IGZ1bmN0aW9uICh1aWQsIHZhbHVlKSB7XHJcbiAgICAgICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgIGFjdGlvblR5cGU6IEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX1VQREFURV9QRVJNSVNTSU9OUyxcclxuICAgICAgICAgICAgdWlkOiB1aWQsXHJcbiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGFkZFVzZXJzOiBmdW5jdGlvbiAodXNlcnMpIHtcclxuICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgYWN0aW9uVHlwZTogRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQUREX1VTRVIsXHJcbiAgICAgICAgICAgIHVzZXJzOiB1c2Vyc1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGRlbGV0ZVVzZXI6IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgIGFjdGlvblR5cGU6IEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0RFTEVURV9VU0VSLFxyXG4gICAgICAgICAgICB1c2VyOiB1c2VyXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZGlzcGxheUludmFsaWRFZGl0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIG1lc3NhZ2VPYmplY3QgPSB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IElub3Z4TG9hZGVyLnQoJ0VudGl0bGVtZW50Om1lc3NhZ2Uuc3lzdGVtU2VjdXJpdHlHcm91cFVzZXJOb3RGb3VuZCcpXHJcbiAgICAgICAgfTtcclxuICAgICAgICBTeXN0ZW1BY3Rpb25zLmRpc3BsYXlFcnJvck1lc3NhZ2UobWVzc2FnZU9iamVjdCk7XHJcbiAgICB9XHJcbn07XHJcbm1vZHVsZS5leHBvcnRzID0gRW50aXRsZW1lbnRBY3Rpb25zO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1FbnRpdGxlbWVudEFjdGlvbnMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBmdW5jdGlvbiAoKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXHJcbiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn07XHJcbnZhciBSZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcclxudmFyIElub3Z4ID0gcmVxdWlyZShcInNoYXJlZC53ZWIuY2xpZW50XCIpO1xyXG52YXIgRW50aXRsZW1lbnRGb3JtID0gcmVxdWlyZShcIi4vRW50aXRsZW1lbnRGb3JtXCIpO1xyXG52YXIgRW50aXRsZW1lbnRBY3Rpb25zID0gcmVxdWlyZShcIi4vLi4vYWN0aW9ucy9FbnRpdGxlbWVudEFjdGlvbnNcIik7XHJcbnZhciBFbnRpdGxlbWVudFN0b3JlID0gcmVxdWlyZShcIi4vLi4vc3RvcmVzL0VudGl0bGVtZW50U3RvcmVcIik7XHJcbnZhciBFbnRpdGxlbWVudENvbnN0YW50cyA9IHJlcXVpcmUoXCIuLy4uL2NvbnN0YW50cy9FbnRpdGxlbWVudENvbnN0YW50c1wiKTtcclxudmFyIFN5c3RlbUFjdGlvbnMgPSBJbm92eC5TaGFyZWQuU3lzdGVtLkFjdGlvbnM7XHJcbnZhciBTeXN0ZW1TdG9yZSA9IElub3Z4LlNoYXJlZC5TeXN0ZW0uU3RvcmU7XHJcbnZhciBVcmxVdGlsaXRpZXMgPSBJbm92eC5TaGFyZWQuQ29tbW9uLlVybFV0aWxpdGllcztcclxuZnVuY3Rpb24gZ2V0RW50aXRsZW1lbnRTdGF0ZSgpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgYWxsU2VjdXJpdHlHcm91cDogRW50aXRsZW1lbnRTdG9yZS5nZXRBbGwoKSxcclxuICAgICAgICBtb2RhbFZpc2libGU6IEVudGl0bGVtZW50U3RvcmUuZ2V0TW9kYWxWaXNpYmxlKCksXHJcbiAgICAgICAgaXNBY3Rpb25JblByb2dyZXNzOiBTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfREVMRVRFKVxyXG4gICAgfTtcclxufVxyXG52YXIgRW50aXRsZW1lbnRBcHAgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRW50aXRsZW1lbnRBcHAsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBFbnRpdGxlbWVudEFwcChwcm9wcywgY29udGV4dCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsICdFbnRpdGxlbWVudCcsIHByb3BzLCBjb250ZXh0KSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9vbkNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoZ2V0RW50aXRsZW1lbnRTdGF0ZSgpKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vblN5c3RlbUNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICAgICAgaXNBY3Rpb25JblByb2dyZXNzOiBTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfREVMRVRFKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9oaWRlTW9kYWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEVudGl0bGVtZW50QWN0aW9ucy5maW5pc2hFZGl0KCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fYmVnaW5FZGl0RW50aXRsZW1lbnQgPSBmdW5jdGlvbiAoZSwgc2VjdXJpdHlHcm91cCkge1xyXG4gICAgICAgICAgICBFbnRpdGxlbWVudEFjdGlvbnMuYmVnaW5FZGl0KHNlY3VyaXR5R3JvdXApO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2RlbGV0ZUVudGl0bGVtZW50ID0gZnVuY3Rpb24gKGUsIHNlY3VyaXR5R3JvdXApIHtcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2VPYmplY3QgPSB7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBJbm92eExvYWRlci50KCdFbnRpdGxlbWVudDptZXNzYWdlLmNvbmZpcm1EZWxldGUnKSxcclxuICAgICAgICAgICAgICAgIGNvbmZpcm1DYWxsYmFjazogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIEVudGl0bGVtZW50QWN0aW9ucy5kZWxldGVFbnRpdGxlbWVudChzZWN1cml0eUdyb3VwLCBudWxsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5kaXNwbGF5Q29uZmlybWF0aW9uTWVzc2FnZShtZXNzYWdlT2JqZWN0KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9zaG93QWRkRW50aXRsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEVudGl0bGVtZW50QWN0aW9ucy5iZWdpbkFkZCgpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2luaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEVudGl0bGVtZW50QWN0aW9ucy5nZXRBbGxFbnRpdGxlbWVudChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5fYXBwTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5faGFuZGxlUGVybWlzc2lvbkVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5zdGF0ZSA9IGdldEVudGl0bGVtZW50U3RhdGUoKTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBFbnRpdGxlbWVudEFwcC5wcm90b3R5cGUuY29tcG9uZW50V2lsbE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuY29tcG9uZW50V2lsbE1vdW50QmFzZSgpO1xyXG4gICAgfTtcclxuICAgIEVudGl0bGVtZW50QXBwLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBFbnRpdGxlbWVudFN0b3JlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX29uQ2hhbmdlKTtcclxuICAgICAgICBTeXN0ZW1TdG9yZS5hZGRDaGFuZ2VMaXN0ZW5lcih0aGlzLl9vblN5c3RlbUNoYW5nZSk7XHJcbiAgICB9O1xyXG4gICAgRW50aXRsZW1lbnRBcHAucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIEVudGl0bGVtZW50U3RvcmUucmVtb3ZlQ2hhbmdlTGlzdGVuZXIodGhpcy5fb25DaGFuZ2UpO1xyXG4gICAgICAgIFN5c3RlbVN0b3JlLnJlbW92ZUNoYW5nZUxpc3RlbmVyKHRoaXMuX29uU3lzdGVtQ2hhbmdlKTtcclxuICAgIH07XHJcbiAgICBFbnRpdGxlbWVudEFwcC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBjb2x1bW5zID0gW3tcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBcIk5hbWVcIixcclxuICAgICAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoJ0VudGl0bGVtZW50OmdyaWQubmFtZScpLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxyXG4gICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJEZXNjcmlwdGlvblwiLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyVGV4dDogSW5vdnhMb2FkZXIudCgnRW50aXRsZW1lbnQ6Z3JpZC5kZXNjcmlwdGlvbicpLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxyXG4gICAgICAgICAgICB9XTtcclxuICAgICAgICB2YXIgY29tbWFuZHMgPSB7XHJcbiAgICAgICAgICAgIGNvbW1hbmQ6IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiAnZ2x5cGhpY29uIGdseXBoaWNvbi1wZW5jaWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2dyaWQtYnV0dG9uJyxcclxuICAgICAgICAgICAgICAgICAgICBjbGljazogdGhpcy5fYmVnaW5FZGl0RW50aXRsZW1lbnRcclxuICAgICAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiAnZ2x5cGhpY29uIGdseXBoaWNvbi10cmFzaCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3JpZC1idXR0b24nLFxyXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrOiB0aGlzLl9kZWxldGVFbnRpdGxlbWVudFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICB3aWR0aDogXCI4NXB4XCIsXHJcbiAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoJ0VudGl0bGVtZW50OmdyaWQuY29tbWFuZHMnKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIGRlZmF1bHRTb3J0ID0gW3tcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBcIk5hbWVcIixcclxuICAgICAgICAgICAgICAgIGRpcjogXCJhc2NlbmRpbmdcIlxyXG4gICAgICAgICAgICB9XTtcclxuICAgICAgICB2YXIgaWNvbkhlYWRlclByb3BzID0ge1xyXG4gICAgICAgICAgICBpY29uVXJsOiBcIlwiLmNvbmNhdChVcmxVdGlsaXRpZXMuZ2V0QmFzZUFwcGxpY2F0aW9uVXJsKCksIFwiL2ltYWdlcy9FbnRpdGxlbWVudC5wbmdcIiksXHJcbiAgICAgICAgICAgIGljb25BdHQ6IHsgYWx0OiBcImVudGl0bGVtZW50XCIgfSxcclxuICAgICAgICAgICAgdGl0bGU6IElub3Z4TG9hZGVyLnQoJ0VudGl0bGVtZW50OmhlYWRlci5lbnRpdGxlbWVudCcpLFxyXG4gICAgICAgICAgICByY0NsYXNzOiBcImNkLWJ0biBhZGQtYnRuXCIsXHJcbiAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuX3Nob3dBZGRFbnRpdGxlbWVudCxcclxuICAgICAgICAgICAgYnRuVXJsOiBcIlwiLmNvbmNhdChVcmxVdGlsaXRpZXMuZ2V0QmFzZUFwcGxpY2F0aW9uVXJsKCksIFwiL2ltYWdlcy9hZGRTZWN1cml0eUdyb3VwLnBuZ1wiKSxcclxuICAgICAgICAgICAgYnRuQXR0OiB7XHJcbiAgICAgICAgICAgICAgICBhbHQ6IElub3Z4TG9hZGVyLnQoJ0VudGl0bGVtZW50OmhlYWRlci5uZXdTZWN1cml0eUdyb3VwJyksXHJcbiAgICAgICAgICAgICAgICB0aXRsZTogSW5vdnhMb2FkZXIudCgnRW50aXRsZW1lbnQ6aGVhZGVyLm5ld1NlY3VyaXR5R3JvdXAnKSxcclxuICAgICAgICAgICAgICAgIGlkOiAnZW50QXBwLWFkZFNlY0dyb3VwLWJ0bicsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zdGF0ZS5hbGxTZWN1cml0eUdyb3VwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBncm91cCA9IHRoaXMuc3RhdGUuYWxsU2VjdXJpdHlHcm91cFtpXTtcclxuICAgICAgICAgICAgaWYgKGdyb3VwLkRlc2NyaXB0aW9uID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICBncm91cC5EZXNjcmlwdGlvbiA9IFwiXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuQ29yZS5SZWFjdExvYWRlciwgeyBhcHBSZWFkeTogdGhpcy5pc0FwcExvYWRlZCgpLCBlcnJvclN0YXR1czogdGhpcy5fZXJyb3JTdGF0dXMgfSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJlbnRpdGxlbWVudC1hcHAtY29udGVudFwiIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5MYXlvdXQuSWNvbkhlYWRlciwgX19hc3NpZ24oe30sIGljb25IZWFkZXJQcm9wcykpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuQ29udHJvbHMuR3JpZCwgeyBkYXRhU291cmNlOiB0aGlzLnN0YXRlLmFsbFNlY3VyaXR5R3JvdXAsIGNvbW1hbmRzOiBjb21tYW5kcywgY29sdW1uczogY29sdW1ucywgZGVmYXVsdFNvcnQ6IGRlZmF1bHRTb3J0LCBmaWx0ZXI6IHRydWUsIHNvcnQ6IHRydWUsIHBhZ2VhYmxlOiB7IHBhZ2VDb3VudDogNSwgcGFnZVNpemU6IDEwLCBwYWdlU2l6ZXM6IFsxMCwgMjAsIDUwXSB9IH0pKSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuQ29udHJvbHMuTW9kYWxTbGlkZXIsIHsgaXNPcGVuOiB0aGlzLnN0YXRlLm1vZGFsVmlzaWJsZSwgb25DbG9zZTogdGhpcy5faGlkZU1vZGFsIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEVudGl0bGVtZW50Rm9ybSwgbnVsbCkpKSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEVudGl0bGVtZW50QXBwO1xyXG59KElub3Z4LlNoYXJlZC5SZWFjdEV4dC5CYXNlQXBwQ29tcG9uZW50KSk7XHJcbm1vZHVsZS5leHBvcnRzID0gRW50aXRsZW1lbnRBcHA7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUVudGl0bGVtZW50QXBwLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxudmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkge1xyXG4gICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHtcclxuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxyXG4gICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfTtcclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59O1xyXG52YXIgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XHJcbnZhciBFbnRpdGxlbWVudFN0b3JlID0gcmVxdWlyZShcIi4vLi4vc3RvcmVzL0VudGl0bGVtZW50U3RvcmVcIik7XHJcbnZhciBFbnRpdGxlbWVudENvbnN0YW50cyA9IHJlcXVpcmUoXCIuLy4uL2NvbnN0YW50cy9FbnRpdGxlbWVudENvbnN0YW50c1wiKTtcclxudmFyIEVudGl0bGVtZW50QWN0aW9ucyA9IHJlcXVpcmUoXCIuLy4uL2FjdGlvbnMvRW50aXRsZW1lbnRBY3Rpb25zXCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBTeXN0ZW1BY3Rpb25zID0gSW5vdnguU2hhcmVkLlN5c3RlbS5BY3Rpb25zO1xyXG52YXIgU3lzdGVtU3RvcmUgPSBJbm92eC5TaGFyZWQuU3lzdGVtLlN0b3JlO1xyXG52YXIgSW5vdnhDb250cm9scyA9IElub3Z4LlNoYXJlZC5Db250cm9scztcclxudmFyIFVybFV0aWxpdGllcyA9IElub3Z4LlNoYXJlZC5Db21tb24uVXJsVXRpbGl0aWVzO1xyXG52YXIgTGlzdEhlbHBlciA9IElub3Z4LlNoYXJlZC5Db21tb24uTGlzdEhlbHBlcjtcclxuZnVuY3Rpb24gZ2V0QWN0aW9uSW5Qcm9ncmVzcygpIHtcclxuICAgIHJldHVybiBTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQUREKSB8fFxyXG4gICAgICAgIFN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9FRElUKTtcclxufVxyXG52YXIgX2Rpc3BsYXlTZWxlY3RVc2VyU3RhdGU7XHJcbnZhciBfYWN0aW9uSW5Qcm9ncmVzc01zZztcclxuZnVuY3Rpb24gZ2V0Rm9ybVN0YXRlKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBzZWN1cml0eUdyb3VwOiBFbnRpdGxlbWVudFN0b3JlLmdldFNlY3VyaXR5R3JvdXAoKSxcclxuICAgICAgICBpc0FkZGluZzogRW50aXRsZW1lbnRTdG9yZS5nZXRJc0FkZGluZygpLFxyXG4gICAgICAgIGlzRWRpdGluZzogRW50aXRsZW1lbnRTdG9yZS5nZXRJc0VkaXRpbmcoKSxcclxuICAgICAgICBpc0FjdGlvbkluUHJvZ3Jlc3M6IGdldEFjdGlvbkluUHJvZ3Jlc3MoKSxcclxuICAgICAgICBhY3Rpb25JblByb2dyZXNzTXNnOiBfYWN0aW9uSW5Qcm9ncmVzc01zZyxcclxuICAgICAgICBhcHBsaWNhdGlvblBlcm1pc3Npb25zOiBFbnRpdGxlbWVudFN0b3JlLmdldFNlY3VyaXR5R3JvdXBEZXRhaWwoKS5BcHBsaWNhdGlvblBlcm1pc3Npb25zLFxyXG4gICAgICAgIGdyb3VwVXNlcnM6IEVudGl0bGVtZW50U3RvcmUuZ2V0U2VjdXJpdHlHcm91cERldGFpbCgpLkdyb3VwVXNlcnMsXHJcbiAgICAgICAgdmFsaWRhdGlvbjogRW50aXRsZW1lbnRTdG9yZS5nZXRWYWxpZGF0aW9uKEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERF9GT1JNKVxyXG4gICAgfTtcclxufVxyXG52YXIgRW50aXRsZW1lbnRGb3JtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEVudGl0bGVtZW50Rm9ybSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEVudGl0bGVtZW50Rm9ybShwcm9wcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9vbkNoYW5nZSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBFbnRpdGxlbWVudEFjdGlvbnMuZWRpdFNlY3VyaXR5R3JvdXAoRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQUREX0ZPUk0sIGV2ZW50LnRhcmdldC5uYW1lLCBldmVudC50YXJnZXQudmFsdWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2xvYWRTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoZ2V0Rm9ybVN0YXRlKCkpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX3N5c3RlbUNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICAgICAgaXNBY3Rpb25JblByb2dyZXNzOiBnZXRBY3Rpb25JblByb2dyZXNzKClcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fdmFsaWRhdGVFbnRpdGxlbWVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCFFbnRpdGxlbWVudFN0b3JlLmdldElzVmFsaWRFZGl0T2JqZWN0KCkpIHtcclxuICAgICAgICAgICAgICAgIEVudGl0bGVtZW50QWN0aW9ucy5kaXNwbGF5SW52YWxpZEVkaXQoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gRW50aXRsZW1lbnRTdG9yZS5nZXRJc1ZhbGlkT2JqZWN0KEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERF9GT1JNKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9zYXZlRW50aXRsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChfdGhpcy5fdmFsaWRhdGVFbnRpdGxlbWVudCgpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuc3RhdGUuaXNBZGRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICBFbnRpdGxlbWVudEFjdGlvbnMuY3JlYXRlRW50aXRsZW1lbnQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIEVudGl0bGVtZW50QWN0aW9ucy51cGRhdGVFbnRpdGxlbWVudCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBhY3Rpb25JblByb2dyZXNzTXNnOiBJbm92eExvYWRlci50KCdFbnRpdGxlbWVudDpmb3JtLnNhdmluZycpIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe30pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBFbnRpdGxlbWVudEFjdGlvbnMuZmluaXNoRWRpdCgpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX3VwZGF0ZVBlcm1pc3Npb25zID0gZnVuY3Rpb24gKGlkLCBldmVudCkge1xyXG4gICAgICAgICAgICBFbnRpdGxlbWVudEFjdGlvbnMuZWRpdFBlcm1pc3Npb25zKGlkLCBldmVudC50YXJnZXQuY2hlY2tlZCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5faXNFbXB0eU9yTnVsbCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUgJiYgdmFsdWUubGVuZ3RoID4gMDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl92YWxpZGF0ZVVzZXJzID0gZnVuY3Rpb24gKHVzZXJzKSB7XHJcbiAgICAgICAgICAgIHZhciBhc3NpZ25lZFVzZXJzID0gX3RoaXMuc3RhdGUuZ3JvdXBVc2VycztcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2VPYmplY3QgPSB7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBJbm92eExvYWRlci50KFwiRW50aXRsZW1lbnQ6bWVzc2FnZS5kdXBsaWNhdGVVc2VyXCIpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZhciBkdXBVc2VycyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHVzZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXNlciA9IHVzZXJzW2ldO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBhc3NpZ25lZFVzZXJzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2lnbmVkVXNlciA9IGFzc2lnbmVkVXNlcnNbal07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIuVXNlck5hbWUgPT09IGFzc2lnbmVkVXNlci5Vc2VyTmFtZSAmJiB1c2VyLlVzZXJJRCA9PT0gYXNzaWduZWRVc2VyLlVzZXJJRCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZHVwbGljYXRVc2VyRm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXBVc2Vycy5wdXNoKHVzZXIuVXNlck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtZXNzYWdlT2JqZWN0Lm1lc3NhZ2UgKz0gZHVwVXNlcnMuam9pbihcIiwgXCIpO1xyXG4gICAgICAgICAgICBpZiAoZHVwbGljYXRVc2VyRm91bmQpXHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmRpc3BsYXlXYXJuaW5nTWVzc2FnZShtZXNzYWdlT2JqZWN0KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9hZGRzZWN1cml0eUdyb3VwVXNlciA9IGZ1bmN0aW9uICh1c2Vycykge1xyXG4gICAgICAgICAgICBfdGhpcy5fdmFsaWRhdGVVc2Vycyh1c2Vycyk7XHJcbiAgICAgICAgICAgIGlmICh1c2Vycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBFbnRpdGxlbWVudEFjdGlvbnMuYWRkVXNlcnModXNlcnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fZGVsZXRlU2VjdXJpdHlHcm91cFVzZXIgPSBmdW5jdGlvbiAoZSwgdXNlcikge1xyXG4gICAgICAgICAgICBFbnRpdGxlbWVudEFjdGlvbnMuZGVsZXRlVXNlcih1c2VyKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9jaGVja0ZvclVuc2F2ZWRDaGFuZ2VzID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChFbnRpdGxlbWVudFN0b3JlLmdldEhhc0NoYW5nZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSBJbm92eExvYWRlci50KCdjb21tb246bXNnQm94LmJyb3dzZXJTYXZlQ2hhbmdlcycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLnN0YXRlID0gZ2V0Rm9ybVN0YXRlKCk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgRW50aXRsZW1lbnRGb3JtLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBFbnRpdGxlbWVudFN0b3JlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX2xvYWRTdGF0ZSk7XHJcbiAgICAgICAgU3lzdGVtU3RvcmUuYWRkQ2hhbmdlTGlzdGVuZXIodGhpcy5fc3lzdGVtQ2hhbmdlKTtcclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlcyk7XHJcbiAgICB9O1xyXG4gICAgRW50aXRsZW1lbnRGb3JtLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBFbnRpdGxlbWVudFN0b3JlLnJlbW92ZUNoYW5nZUxpc3RlbmVyKHRoaXMuX2xvYWRTdGF0ZSk7XHJcbiAgICAgICAgU3lzdGVtU3RvcmUucmVtb3ZlQ2hhbmdlTGlzdGVuZXIodGhpcy5fc3lzdGVtQ2hhbmdlKTtcclxuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlcyk7XHJcbiAgICB9O1xyXG4gICAgRW50aXRsZW1lbnRGb3JtLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBMaXN0SGVscGVyLnNvcnQodGhpcy5zdGF0ZS5hcHBsaWNhdGlvblBlcm1pc3Npb25zLCBcIkFwcGxpY2F0aW9uRGlzcGxheU5hbWVcIik7XHJcbiAgICAgICAgdmFyIGlucHV0T2JqID0ge1xyXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdmb3JtLWNvbnRyb2wnLFxyXG4gICAgICAgICAgICB0eXBlOiAndGV4dCdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBzZWN1cml0eUdyb3VwID0gdGhpcy5zdGF0ZS5zZWN1cml0eUdyb3VwO1xyXG4gICAgICAgIHZhciBuYW1lSW5wdXQgPSBqUXVlcnkuZXh0ZW5kKHtcclxuICAgICAgICAgICAgbmFtZTogJ05hbWUnLFxyXG4gICAgICAgICAgICBpZDogJ2VudEFwcC1ncm91cE5hbWUtaW5wdXQnLFxyXG4gICAgICAgICAgICB2YWx1ZTogc2VjdXJpdHlHcm91cC5OYW1lXHJcbiAgICAgICAgfSwgaW5wdXRPYmopO1xyXG4gICAgICAgIHZhciBkZXNjcmlwdGlvbklucHV0ID0galF1ZXJ5LmV4dGVuZCh7XHJcbiAgICAgICAgICAgIG5hbWU6ICdEZXNjcmlwdGlvbicsXHJcbiAgICAgICAgICAgIGlkOiAnZW50QXBwLWRlc2MtaW5wdXQnLFxyXG4gICAgICAgICAgICB2YWx1ZTogc2VjdXJpdHlHcm91cC5EZXNjcmlwdGlvblxyXG4gICAgICAgIH0sIGlucHV0T2JqKTtcclxuICAgICAgICB2YXIgaGVhZGVyID0gdGhpcy5zdGF0ZS5pc0FkZGluZyA/IElub3Z4TG9hZGVyLnQoJ0VudGl0bGVtZW50OmhlYWRlci5uZXdTZWN1cml0eUdyb3VwJykgOiBJbm92eExvYWRlci50KCdFbnRpdGxlbWVudDpoZWFkZXIuZWRpdFNlY3VyaXR5R3JvdXAnKTtcclxuICAgICAgICB2YXIgY29sdW1ucyA9IFt7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJVc2VyTmFtZVwiLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyVGV4dDogSW5vdnhMb2FkZXIudCgnRW50aXRsZW1lbnQ6Y29tbW9uLnVzZXJuYW1lJylcclxuICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwiRmlyc3ROYW1lXCIsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJUZXh0OiBJbm92eExvYWRlci50KCdFbnRpdGxlbWVudDpjb21tb24uZmlyc3RuYW1lJylcclxuICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwiTGFzdE5hbWVcIixcclxuICAgICAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoJ0VudGl0bGVtZW50OmNvbW1vbi5sYXN0bmFtZScpXHJcbiAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBcIkVuYWJsZWRcIixcclxuICAgICAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoJ0VudGl0bGVtZW50OmNvbW1vbi51c2VyU3RhdHVzJyksXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogXCIxNjVweFwiLFxyXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogdHJ1ZSwgdGV4dDogSW5vdnhMb2FkZXIudCgnRW50aXRsZW1lbnQ6Y29tbW9uLmVuYWJsZWQnKSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgdmFsdWU6IGZhbHNlLCB0ZXh0OiBJbm92eExvYWRlci50KCdFbnRpdGxlbWVudDpjb21tb24uZGlzYWJsZWQnKSB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1dO1xyXG4gICAgICAgIHZhciB1c2VyRGF0YVNvdXJjZSA9IHRoaXMuc3RhdGUuZ3JvdXBVc2VycztcclxuICAgICAgICB2YXIgdXNlckRlZmF1bHRTb3J0ID0gW3tcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBcIlVzZXJOYW1lXCIsXHJcbiAgICAgICAgICAgICAgICBkaXI6IFwiYXNjZW5kaW5nXCJcclxuICAgICAgICAgICAgfV07XHJcbiAgICAgICAgdmFyIHVzZXJDb21tYW5kcyA9IHtcclxuICAgICAgICAgICAgY29tbWFuZDogW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWU6IFwiZ2x5cGhpY29uIGdseXBoaWNvbi10cmFzaFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrOiB0aGlzLl9kZWxldGVTZWN1cml0eUdyb3VwVXNlclxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICB3aWR0aDogXCI4NXB4XCIsXHJcbiAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoJ0VudGl0bGVtZW50OmNvbW1vbi5jb21tYW5kcycpXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgZ3JpZFdpZHRocyA9IHtcclxuICAgICAgICAgICAgcGVybWlzc2lvbk5hbWU6IHsgd2lkdGg6IFwiY2FsYyg0MCUgLSA0MHB4KVwiIH0sXHJcbiAgICAgICAgICAgIGVuYWJsZWQ6IHsgd2lkdGg6IFwiODBweFwiIH0sXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB7IHdpZHRoOiBcImNhbGMoNjAlIC0gNDBweClcIiB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5TdGF0aWNIZWFkZXJGb3JtLCB7IHRpdGxlOiBoZWFkZXIsIHNhdmVPbkNsaWNrOiB0aGlzLl9zYXZlRW50aXRsZW1lbnQsIHNhdmVCdG5JZDogXCJlbnRBcHAtc2F2ZS1idG5cIiwgY2FuY2VsT25DbGljazogdGhpcy5fY2FuY2VsLCBjYW5jZWxCdG5JZDogXCJlbnRBcHAtY2FuY2VsLWJ0blwiLCBpc0FjdGlvbkluUHJvZ3Jlc3M6IHRoaXMuc3RhdGUuaXNBY3Rpb25JblByb2dyZXNzLCBpblByb2dyZXNzTWVzc2FnZTogdGhpcy5zdGF0ZS5hY3Rpb25JblByb2dyZXNzTXNnIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IFwiXCIuY29uY2F0KElub3Z4TG9hZGVyLnQoXCJFbnRpdGxlbWVudDpmb3JtLm5hbWVcIikpLmNvbmNhdChzZWN1cml0eUdyb3VwLklzU3lzdGVtRGVmYXVsdCA/ICcnIDogJyonKSwgaW5wdXROYW1lOiAnTmFtZScgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5WYWxpZGF0aW9uSW5wdXQsIF9fYXNzaWduKHt9LCBuYW1lSW5wdXQsIHsgY2xhc3NOYW1lOiBcImZvcm0tY29udHJvbFwiLCBvbkNoYW5nZTogdGhpcy5fb25DaGFuZ2UsIHJlYWRPbmx5OiBzZWN1cml0eUdyb3VwLklzU3lzdGVtRGVmYXVsdCwgdmFsaWRhdGlvbjogdGhpcy5zdGF0ZS52YWxpZGF0aW9uWydOYW1lJ10gfSkpKSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcIkVudGl0bGVtZW50OmZvcm0uZGVzY3JpcHRpb25cIiksIGlucHV0TmFtZTogJ0Rlc2NyaXB0aW9uJyB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIF9fYXNzaWduKHt9LCBkZXNjcmlwdGlvbklucHV0LCB7IG9uQ2hhbmdlOiB0aGlzLl9vbkNoYW5nZSwgcmVhZE9ubHk6IHNlY3VyaXR5R3JvdXAuSXNTeXN0ZW1EZWZhdWx0IH0pKSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5UYWJDb250cm9sLCB7IHRhYnM6IFtJbm92eExvYWRlci50KFwiRW50aXRsZW1lbnQ6Zm9ybS5wZXJtaXNzaW9uc1wiKSwgSW5vdnhMb2FkZXIudChcIkVudGl0bGVtZW50OmZvcm0udXNlcnNcIildIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuQ29udGVudCwgbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImVudGl0bGVtZW50LXBlcm1pc3Npb25zXCIgfSwgdGhpcy5zdGF0ZS5hcHBsaWNhdGlvblBlcm1pc3Npb25zLm1hcChmdW5jdGlvbiAoYXBwbGljYXRpb25QZXJtaXNzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIExpc3RIZWxwZXIuc29ydChhcHBsaWNhdGlvblBlcm1pc3Npb24uUGVybWlzc2lvbnMsIFwiRGlzcGxheU5hbWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkV4cGFuZGVyLCB7IHRpdGxlOiBhcHBsaWNhdGlvblBlcm1pc3Npb24uQXBwbGljYXRpb25EaXNwbGF5TmFtZSwga2V5OiBhcHBsaWNhdGlvblBlcm1pc3Npb24uQXBwbGljYXRpb25EaXNwbGF5TmFtZSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ0Zy10YWJsZVwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ0Zy1ncmlkXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ0Zy1oZWFkZXItY29udGFpbmVyXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGctaGVhZGVyIHRnLXJvd1wiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ0Zy1jZWxsXCIsIHN0eWxlOiBncmlkV2lkdGhzLnBlcm1pc3Npb25OYW1lIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGctaGRyLWN0bnRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ0Zy10aXRsZVwiIH0sIElub3Z4TG9hZGVyLnQoJ0VudGl0bGVtZW50OnBlcm1pc3Npb24ubmFtZScpKSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGctY2VsbFwiLCBzdHlsZTogZ3JpZFdpZHRocy5lbmFibGVkIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGctaGRyLWN0bnRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ0Zy10aXRsZVwiIH0sIElub3Z4TG9hZGVyLnQoJ0VudGl0bGVtZW50OnBlcm1pc3Npb24uZW5hYmxlZCcpKSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGctY2VsbFwiLCBzdHlsZTogZ3JpZFdpZHRocy5kZXNjcmlwdGlvbiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInRnLWhkci1jdG50XCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGctdGl0bGVcIiB9LCBJbm92eExvYWRlci50KCdFbnRpdGxlbWVudDpwZXJtaXNzaW9uLmRlc2NyaXB0aW9uJykpKSkpKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ0Zy1jb250ZW50LWNvbnRhaW5lclwiLCBzdHlsZTogeyBvdmVyZmxvdzogJ2luaXRpYWwnIH0gfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogJ3RnLWNvbnRlbnQnIH0sIGFwcGxpY2F0aW9uUGVybWlzc2lvbi5QZXJtaXNzaW9ucy5tYXAoZnVuY3Rpb24gKHBlcm1pc3Npb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogJ3RnLXJvdycsIFwiZGF0YS11aWRcIjogcGVybWlzc2lvbi5JRCwga2V5OiBwZXJtaXNzaW9uLklEIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IHN0eWxlOiBncmlkV2lkdGhzLnBlcm1pc3Npb25OYW1lLCBjbGFzc05hbWU6ICd0Zy1jZWxsJyB9LCBwZXJtaXNzaW9uLkRpc3BsYXlOYW1lKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgc3R5bGU6IGdyaWRXaWR0aHMuZW5hYmxlZCwgY2xhc3NOYW1lOiAndGctY2VsbCcgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCIgXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiLCB7IHR5cGU6IFwiY2hlY2tib3hcIiwgb25DaGFuZ2U6IGZ1bmN0aW9uIChldmVudCkgeyByZXR1cm4gX3RoaXMuX3VwZGF0ZVBlcm1pc3Npb25zKHBlcm1pc3Npb24uSUQsIGV2ZW50KTsgfSwgZGlzYWJsZWQ6IHNlY3VyaXR5R3JvdXAuSXNTeXN0ZW1EZWZhdWx0LCBjaGVja2VkOiBwZXJtaXNzaW9uLkFzc2lnbmVkLCBjbGFzc05hbWU6IFwiY2hlY2tib3hcIiB9KSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IHN0eWxlOiBncmlkV2lkdGhzLmRlc2NyaXB0aW9uLCBjbGFzc05hbWU6ICd0Zy1jZWxsJyB9LCBwZXJtaXNzaW9uLkRlc2NyaXB0aW9uKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pKSksXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuQ29udGVudCwgeyBjbGFzczogJ2ZjLW1hcmdpbicgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBJbm92eExvYWRlci50KFwiRW50aXRsZW1lbnQ6Zm9ybS5hc3NpZ25Vc2Vyc1wiKSwgaW5wdXROYW1lOiAnQXNzaWduVXNlcnMnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5NdWx0aVNlbGVjdCwgeyBtaW5MZW5ndGg6IDEsIGRpc3BsYXlQcm9wOiBcIlVzZXJOYW1lXCIsIHVybDogXCJcIi5jb25jYXQoVXJsVXRpbGl0aWVzLmdldEFwaVVybCgpLCBcIi9FbnRpdGxlbWVudEFwaS9hcGkvVXNlci9TZWFyY2hVc2Vyc1wiKSwgb25DbGljazogdGhpcy5fYWRkc2VjdXJpdHlHcm91cFVzZXIsIHBhcmFtZXRlcnM6IHsgbWF4TnVtYmVyT2ZSZXN1bHRzOiA1IH0sIG51bVBhcmFtZXRlcjogJ21heE51bWJlck9mUmVzdWx0cycsIHNlYXJjaFByb3BlcnR5OiAnc2VhcmNoU3RyaW5nJywgYnRuTGFiZWw6IElub3Z4TG9hZGVyLnQoXCJFbnRpdGxlbWVudDpmb3JtLmFkZFVzZXJOYW1lXCIpLCBrZXlQcm9wOiBcIlVzZXJJRFwiIH0pKSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5Db250cm9scy5HcmlkLCB7IGRhdGFTb3VyY2U6IHVzZXJEYXRhU291cmNlLCBjb21tYW5kczogdXNlckNvbW1hbmRzLCBjb2x1bW5zOiBjb2x1bW5zLCBkZWZhdWx0U29ydDogdXNlckRlZmF1bHRTb3J0LCBzb3J0OiB0cnVlIH0pKSkpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gRW50aXRsZW1lbnRGb3JtO1xyXG59KFJlYWN0LkNvbXBvbmVudCkpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IEVudGl0bGVtZW50Rm9ybTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RW50aXRsZW1lbnRGb3JtLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIga2V5bWlycm9yID0gcmVxdWlyZShcImZianMvbGliL2tleW1pcnJvclwiKTtcclxudmFyIEVudGl0bGVtZW50Q29uc3RhbnRzID0ga2V5bWlycm9yKHtcclxuICAgIEVOVElUTEVNRU5UX0FERF9GT1JNOiBudWxsLFxyXG4gICAgRU5USVRMRU1FTlRfRk9STV9JTlZBTElEX1NBVkU6IG51bGwsXHJcbiAgICBFTlRJVExFTUVOVF9SRUNJRVZFX0RBVEE6IG51bGwsXHJcbiAgICBFTlRJVExFTUVOVF9VUERBVEVfU0VDVVJJVFlfR1JPVVA6IG51bGwsXHJcbiAgICBFTlRJVExFTUVOVF9BRERfVVNFUjogbnVsbCxcclxuICAgIEVOVElUTEVNRU5UX0RFTEVURV9VU0VSOiBudWxsLFxyXG4gICAgRU5USVRMRU1FTlRfVVBEQVRFX1BFUk1JU1NJT05TOiBudWxsLFxyXG4gICAgRU5USVRMRU1FTlRfQkVHSU5fQUREOiBudWxsLFxyXG4gICAgRU5USVRMRU1FTlRfQUREOiBudWxsLFxyXG4gICAgRU5USVRMRU1FTlRfQkVHSU5fRURJVDogbnVsbCxcclxuICAgIEVOVElUTEVNRU5UX0VESVQ6IG51bGwsXHJcbiAgICBFTlRJVExFTUVOVF9GSU5JU0hfRURJVDogbnVsbCxcclxuICAgIEVOVElUTEVNRU5UX0RFTEVURTogbnVsbFxyXG59KTtcclxubW9kdWxlLmV4cG9ydHMgPSBFbnRpdGxlbWVudENvbnN0YW50cztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RW50aXRsZW1lbnRDb25zdGFudHMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBJbm92eCA9IHJlcXVpcmUoXCJzaGFyZWQud2ViLmNsaWVudFwiKTtcclxudmFyIGFzc2lnbiA9IHJlcXVpcmUoXCJvYmplY3QtYXNzaWduXCIpO1xyXG52YXIgVXJsVXRpbGl0aWVzID0gSW5vdnguU2hhcmVkLkNvbW1vbi5VcmxVdGlsaXRpZXM7XHJcbnZhciB1cmwgPSBcIlwiLmNvbmNhdChVcmxVdGlsaXRpZXMuZ2V0QXBpVXJsKCksIFwiL0VudGl0bGVtZW50QXBpL2FwaS9lbnRpdGxlbWVudGdyb3VwXCIpO1xyXG52YXIgRW50aXRsZW1lbnRTZXJ2aWNlcyA9IGFzc2lnbih7fSwgSW5vdnguU2hhcmVkLkZsdXguQmFzZVNlcnZpY2UsIHtcclxuICAgIGdldEFsbDogZnVuY3Rpb24gKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmdldCh1cmwsIG51bGwsIGZ1bmN0aW9uIChyZXREYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXREYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgaWYgKCFpZ25vcmVEZWZhdWx0RXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBnZXRBcHBsaWNhdGlvblBlcm1pc3Npb25zOiBmdW5jdGlvbiAoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmdldChcIlwiLmNvbmNhdCh1cmwsIFwiL0FwcGxpY2F0aW9uUGVybWlzc2lvbnNcIiksIG51bGwsIGZ1bmN0aW9uIChyZXREYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXREYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBnZXREZXRhaWw6IGZ1bmN0aW9uIChpZCwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmdldChcIlwiLmNvbmNhdCh1cmwsIFwiL1wiKS5jb25jYXQoaWQpLCB7fSwgZnVuY3Rpb24gKHJldERhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHJldERhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGNyZWF0ZTogZnVuY3Rpb24gKGVudGl0bGVtZW50R3JvdXAsIHBlcm1pc3Npb25JRHMsIGdyb3VwVXNlcklEcywgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLnBvc3QoXCJcIi5jb25jYXQodXJsLCBcIi9DcmVhdGVcIiksIHsgZW50aXRsZW1lbnRHcm91cDogZW50aXRsZW1lbnRHcm91cCwgcGVybWlzc2lvbklEczogcGVybWlzc2lvbklEcywgZ3JvdXBVc2VySURzOiBncm91cFVzZXJJRHMgfSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGRhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIHVwZGF0ZTogZnVuY3Rpb24gKGVudGl0bGVtZW50R3JvdXAsIHBlcm1pc3Npb25JRHMsIGdyb3VwVXNlcklEcywgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLnBvc3QoXCJcIi5jb25jYXQodXJsLCBcIi9VcGRhdGVcIiksIHsgZW50aXRsZW1lbnRHcm91cDogZW50aXRsZW1lbnRHcm91cCwgcGVybWlzc2lvbklEczogcGVybWlzc2lvbklEcywgZ3JvdXBVc2VySURzOiBncm91cFVzZXJJRHMgfSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGRhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGRlbGV0ZTogZnVuY3Rpb24gKGVudGl0bGVtZW50R3JvdXAsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvRGVsZXRlXCIpLCB7IElEOiBlbnRpdGxlbWVudEdyb3VwLklELCBWZXJzaW9uVG9rZW46IGVudGl0bGVtZW50R3JvdXAuVmVyc2lvblRva2VuIH0sIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjaygpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxufSk7XHJcbm1vZHVsZS5leHBvcnRzID0gRW50aXRsZW1lbnRTZXJ2aWNlcztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RW50aXRsZW1lbnRTZXJ2aWNlcy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIE5vZGVFdmVudHMgPSByZXF1aXJlKFwiZXZlbnRzXCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBhc3NpZ24gPSByZXF1aXJlKFwib2JqZWN0LWFzc2lnblwiKTtcclxudmFyIEVudGl0bGVtZW50Q29uc3RhbnRzID0gcmVxdWlyZShcIi4vLi4vY29uc3RhbnRzL0VudGl0bGVtZW50Q29uc3RhbnRzXCIpO1xyXG52YXIgRXZlbnRFbWl0dGVyID0gTm9kZUV2ZW50cy5FdmVudEVtaXR0ZXI7XHJcbnZhciBDb21tb25NZXNzYWdlcyA9IElub3Z4LlNoYXJlZC5Db21tb24uQ29tbW9uTWVzc2FnZXM7XHJcbnZhciBFTlRJVExFTUVOVF9DSEFOR0VfRVZFTlQgPSAnRW50aXRsZW1lbnQuY2hhbmdlJztcclxudmFyIF9zZWN1cml0eUdyb3VwcyA9IFtdLCBfc2VjdXJpdHlHcm91cCA9IGdldEJsYW5rU2VjdXJpdHlHcm91cCgpLCBfYXBwbGljYXRpb25QZXJtaXNzaW9ucyA9IFtdLCBfc2VjdXJpdHlHcm91cERldGFpbCA9IGdldEJsYW5rU2VjdXJpdHlHcm91cERldGFpbChfYXBwbGljYXRpb25QZXJtaXNzaW9ucyksIF91c2VyID0gZ2V0QmxhbmtVc2VyKCksIF9iZWdpbkFkZCA9IGZhbHNlLCBfYmVnaW5FZGl0ID0gZmFsc2UsIF9tb2RhbFZpc2libGUgPSBmYWxzZSwgX2hhc0NoYW5nZXMgPSBmYWxzZSwgX3ZhbGlkYXRpb24gPSB7fTtcclxuZnVuY3Rpb24gbG9hZEVudGl0bGVtZW50RGF0YShkYXRhKSB7XHJcbiAgICBfc2VjdXJpdHlHcm91cHMgPSBkYXRhO1xyXG59XHJcbmZ1bmN0aW9uIF91cGRhdGVTZWN1cml0eUdyb3VwKGNvbXAsIGtleSwgdmFsdWUpIHtcclxuICAgIHN3aXRjaCAoY29tcCkge1xyXG4gICAgICAgIGNhc2UgRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQUREX0ZPUk06XHJcbiAgICAgICAgICAgIF91cGRhdGVDaGFuZ2VzKGtleSwgdmFsdWUpO1xyXG4gICAgICAgICAgICBfaGFzQ2hhbmdlcyA9IHRydWU7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIF91cGRhdGVDaGFuZ2VzKG5hbWUsIHZhbHVlKSB7XHJcbiAgICBzd2l0Y2ggKG5hbWUpIHtcclxuICAgICAgICBjYXNlIFwiTmFtZVwiOlxyXG4gICAgICAgICAgICBfc2VjdXJpdHlHcm91cFtuYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkdXBOYW1lID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF9zZWN1cml0eUdyb3Vwcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfc2VjdXJpdHlHcm91cC5OYW1lLnRvVXBwZXJDYXNlKCkgPT09IF9zZWN1cml0eUdyb3Vwc1tpXS5OYW1lLnRvVXBwZXJDYXNlKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgJiYgX3NlY3VyaXR5R3JvdXAuSUQudG9VcHBlckNhc2UoKSAhPT0gX3NlY3VyaXR5R3JvdXBzW2ldLklELnRvVXBwZXJDYXNlKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHVwTmFtZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChkdXBOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25bRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQUREX0ZPUk1dW25hbWVdLmludmFsaWRWYWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25bRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQUREX0ZPUk1dW25hbWVdLmludmFsaWRWYWx1ZU1lc3NhZ2UgPSBJbm92eExvYWRlci50KFwiRW50aXRsZW1lbnQ6bWVzc2FnZS5pbnZhbGlkU2VjdXJpdHlHcm91cE5hbWVcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBfc2V0VmFsaWRWYWxpZGF0aW9uKEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERF9GT1JNLCBuYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW0VudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERF9GT1JNXVtuYW1lXS5pbnZhbGlkVmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25bRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQUREX0ZPUk1dW25hbWVdLmludmFsaWRWYWx1ZU1lc3NhZ2UgPSBDb21tb25NZXNzYWdlcy5WYWxpZGF0aW9uLlJlcXVpcmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIGlmIChuYW1lICE9ICdJRCcgJiYgbmFtZSAhPSAnVmVyc2lvblRva2VuJykge1xyXG4gICAgICAgICAgICAgICAgX3NlY3VyaXR5R3JvdXBbbmFtZV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfc2V0VmFsaWRWYWxpZGF0aW9uKEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERF9GT1JNLCBuYW1lKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gdXBkYXRlUGVybWlzc2lvbnModWlkLCB2YWx1ZSkge1xyXG4gICAgdmFyIGFwcGxpY2F0aW9uUGVybWlzc2lvbnMgPSBfc2VjdXJpdHlHcm91cERldGFpbC5BcHBsaWNhdGlvblBlcm1pc3Npb25zO1xyXG4gICAgZm9yICh2YXIgaW5kZXggaW4gYXBwbGljYXRpb25QZXJtaXNzaW9ucykge1xyXG4gICAgICAgIHZhciBhcHBsaWNhdGlvblBlcm1pc3Npb24gPSBhcHBsaWNhdGlvblBlcm1pc3Npb25zW2luZGV4XTtcclxuICAgICAgICBmb3IgKHZhciBzdWJJbmRleCBpbiBhcHBsaWNhdGlvblBlcm1pc3Npb24uUGVybWlzc2lvbnMpIHtcclxuICAgICAgICAgICAgdmFyIHBlcm1pc3Npb24gPSBhcHBsaWNhdGlvblBlcm1pc3Npb24uUGVybWlzc2lvbnNbc3ViSW5kZXhdO1xyXG4gICAgICAgICAgICBpZiAocGVybWlzc2lvbi5JRCA9PSB1aWQpIHtcclxuICAgICAgICAgICAgICAgIHBlcm1pc3Npb24uQXNzaWduZWQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIF9oYXNDaGFuZ2VzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGFkZFVzZXJzKHVzZXJzKSB7XHJcbiAgICBmb3IgKHZhciBpbmR4IGluIHVzZXJzKSB7XHJcbiAgICAgICAgdmFyIGV4aXN0cyA9IGZhbHNlO1xyXG4gICAgICAgIGZvciAodmFyIGdycEluZHggaW4gX3NlY3VyaXR5R3JvdXBEZXRhaWwuR3JvdXBVc2Vycykge1xyXG4gICAgICAgICAgICBpZiAodXNlcnNbaW5keF0uVXNlcklEID09PSBfc2VjdXJpdHlHcm91cERldGFpbC5Hcm91cFVzZXJzW2dycEluZHhdLlVzZXJJRCkge1xyXG4gICAgICAgICAgICAgICAgZXhpc3RzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghZXhpc3RzKSB7XHJcbiAgICAgICAgICAgIF9zZWN1cml0eUdyb3VwRGV0YWlsLkdyb3VwVXNlcnMucHVzaCh1c2Vyc1tpbmR4XSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgX2hhc0NoYW5nZXMgPSB0cnVlO1xyXG59XHJcbmZ1bmN0aW9uIGRlbGV0ZVVzZXIodXNlcikge1xyXG4gICAgZm9yICh2YXIgaW5kZXggaW4gX3NlY3VyaXR5R3JvdXBEZXRhaWwuR3JvdXBVc2Vycykge1xyXG4gICAgICAgIGlmIChfc2VjdXJpdHlHcm91cERldGFpbC5Hcm91cFVzZXJzW2luZGV4XS5Vc2VyTmFtZSA9PSB1c2VyLlVzZXJOYW1lKSB7XHJcbiAgICAgICAgICAgIF9zZWN1cml0eUdyb3VwRGV0YWlsLkdyb3VwVXNlcnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgX2hhc0NoYW5nZXMgPSB0cnVlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICA7XHJcbn1cclxuZnVuY3Rpb24gc2V0QWRkaW5nRW50aXRsZW1lbnQoYXBwbGljYXRpb25QZXJtaXNzaW9ucykge1xyXG4gICAgX2JlZ2luQWRkID0gX21vZGFsVmlzaWJsZSA9IHRydWU7XHJcbiAgICBfYmVnaW5FZGl0ID0gZmFsc2U7XHJcbiAgICBfc2VjdXJpdHlHcm91cCA9IGdldEJsYW5rU2VjdXJpdHlHcm91cCgpO1xyXG4gICAgX3NlY3VyaXR5R3JvdXBEZXRhaWwgPSBnZXRCbGFua1NlY3VyaXR5R3JvdXBEZXRhaWwoYXBwbGljYXRpb25QZXJtaXNzaW9ucyk7XHJcbiAgICBfdXNlciA9IGdldEJsYW5rVXNlcigpO1xyXG4gICAgX2hhc0NoYW5nZXMgPSBmYWxzZTtcclxuICAgIF9pbml0YWxpemVWYWxpZGF0aW9uKEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERF9GT1JNKTtcclxufVxyXG5mdW5jdGlvbiBzZXRFZGl0aW5nRW50aXRsZW1lbnQoc2VjdXJpdHlHcm91cCwgc2VjdXJpdHlHcm91cERldGFpbCkge1xyXG4gICAgX21vZGFsVmlzaWJsZSA9IF9iZWdpbkVkaXQgPSB0cnVlO1xyXG4gICAgX2JlZ2luQWRkID0gZmFsc2U7XHJcbiAgICBfc2VjdXJpdHlHcm91cCA9ICQuZXh0ZW5kKHt9LCBzZWN1cml0eUdyb3VwKTtcclxuICAgIF9zZWN1cml0eUdyb3VwRGV0YWlsID0gJC5leHRlbmQoe30sIHNlY3VyaXR5R3JvdXBEZXRhaWwpO1xyXG4gICAgX3VzZXIgPSBnZXRCbGFua1VzZXIoKTtcclxuICAgIF9oYXNDaGFuZ2VzID0gZmFsc2U7XHJcbiAgICBfaW5pdGFsaXplVmFsaWRhdGlvbihFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9BRERfRk9STSk7XHJcbn1cclxuZnVuY3Rpb24gX2luaXRhbGl6ZVZhbGlkYXRpb24oY29tcCkge1xyXG4gICAgc3dpdGNoIChjb21wKSB7XHJcbiAgICAgICAgY2FzZSBFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9BRERfRk9STTpcclxuICAgICAgICAgICAgdmFyIHZhbGlPYmogPSBfdmFsaWRhdGlvbltFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9BRERfRk9STV0gPSB7fTtcclxuICAgICAgICAgICAgZm9yICh2YXIgayBpbiBfc2VjdXJpdHlHcm91cCkge1xyXG4gICAgICAgICAgICAgICAgX3NldFZhbGlkVmFsaWRhdGlvbihFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9BRERfRk9STSwgayk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gX3NldFZhbGlkVmFsaWRhdGlvbihjb21wLCBuYW1lKSB7XHJcbiAgICBpZiAoX3ZhbGlkYXRpb25bY29tcF1bbmFtZV0pIHtcclxuICAgICAgICBfdmFsaWRhdGlvbltjb21wXVtuYW1lXS5pbnZhbGlkSW5wdXQgPSBmYWxzZTtcclxuICAgICAgICBfdmFsaWRhdGlvbltjb21wXVtuYW1lXS5pbnZhbGlkVmFsdWUgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIF92YWxpZGF0aW9uW2NvbXBdW25hbWVdID0gX2dldE5ld1ZhbGlkYXRpb25PYmplY3QoKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBfZ2V0TmV3VmFsaWRhdGlvbk9iamVjdCgpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaW52YWxpZElucHV0OiBmYWxzZSxcclxuICAgICAgICBpbnZhbGlkVmFsdWU6IGZhbHNlXHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIF92YWxpZGF0ZShjb21wKSB7XHJcbiAgICBzd2l0Y2ggKGNvbXApIHtcclxuICAgICAgICBjYXNlIEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERF9GT1JNOlxyXG4gICAgICAgICAgICByZXR1cm4gX3ZhbGlkYXRlT2JqZWN0KGNvbXAsIF9zZWN1cml0eUdyb3VwKTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxufVxyXG5mdW5jdGlvbiBfZW5zdXJlVmFsaWRPYmplY3QoY29tcCwgb2JqKSB7XHJcbiAgICBmb3IgKHZhciBrIGluIG9iaikge1xyXG4gICAgICAgIHN3aXRjaCAoY29tcCkge1xyXG4gICAgICAgICAgICBjYXNlIEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERF9GT1JNOlxyXG4gICAgICAgICAgICAgICAgdmFyIG9ialR5cGUgPSB0eXBlb2YgKG9ialtrXSk7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqVHlwZSAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmpba10gPT09IG51bGwgfHwgb2JqVHlwZSAhPT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3VwZGF0ZUNoYW5nZXMoaywgb2JqW2tdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAob2JqLmNvbnN0cnVjdG9yICE9PSBBcnJheSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfZW5zdXJlVmFsaWRPYmplY3QoY29tcCwgb2JqW2tdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIF92YWxpZGF0ZU9iamVjdChjb21wLCBvYmopIHtcclxuICAgIF9lbnN1cmVWYWxpZE9iamVjdChjb21wLCBvYmopO1xyXG4gICAgZm9yICh2YXIgayBpbiBfdmFsaWRhdGlvbltFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9BRERfRk9STV0pIHtcclxuICAgICAgICBpZiAoX3ZhbGlkYXRpb25bRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQUREX0ZPUk1dW2tdLmludmFsaWRWYWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuZnVuY3Rpb24gZmluaXNoZWRFZGl0aW5nKCkge1xyXG4gICAgX21vZGFsVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgX2hhc0NoYW5nZXMgPSBmYWxzZTtcclxufVxyXG5mdW5jdGlvbiBnZXRCbGFua1NlY3VyaXR5R3JvdXAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIElEOiAnJyxcclxuICAgICAgICBWZXJzaW9uVG9rZW46ICcnLFxyXG4gICAgICAgIE5hbWU6ICcnLFxyXG4gICAgICAgIERlc2NyaXB0aW9uOiAnJyxcclxuICAgICAgICBJc1N5c3RlbURlZmF1bHQ6IGZhbHNlLFxyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBnZXRCbGFua1NlY3VyaXR5R3JvdXBEZXRhaWwoYXBwbGljYXRpb25QZXJtaXNzaW9ucykge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBBcHBsaWNhdGlvblBlcm1pc3Npb25zOiBhcHBsaWNhdGlvblBlcm1pc3Npb25zLFxyXG4gICAgICAgIEdyb3VwVXNlcnM6IFtdXHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIGdldEJsYW5rQXBwbGljYXRpb25QZXJtaXNzaW9uKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBBcHBsaWNhdGlvbkRpc3BsYXlOYW1lOiBudWxsLFxyXG4gICAgICAgIFBlcm1pc3Npb25zOiBbXVxyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBnZXRCbGFua1VzZXIoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIFVzZXJJRDogbnVsbCxcclxuICAgICAgICBVc2VyTmFtZTogbnVsbCxcclxuICAgICAgICBVc2VyVmVyc2lvblRva2VuOiBudWxsLFxyXG4gICAgICAgIEZpcnN0TmFtZTogbnVsbCxcclxuICAgICAgICBMYXN0TmFtZTogbnVsbCxcclxuICAgICAgICBFbmFibGVkOiBudWxsLFxyXG4gICAgfTtcclxufVxyXG52YXIgRW50aXRsZW1lbnRTdG9yZSA9IGFzc2lnbih7fSwgRXZlbnRFbWl0dGVyLnByb3RvdHlwZSwge1xyXG4gICAgLy8gQWRkIHN0b3JlIGdldHRlcnMgaGVyZVxyXG4gICAgZ2V0QWxsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zZWN1cml0eUdyb3VwcztcclxuICAgIH0sXHJcbiAgICBnZXRTZWN1cml0eUdyb3VwOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zZWN1cml0eUdyb3VwO1xyXG4gICAgfSxcclxuICAgIGdldFNlY3VyaXR5R3JvdXBEZXRhaWw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX3NlY3VyaXR5R3JvdXBEZXRhaWw7XHJcbiAgICB9LFxyXG4gICAgZ2V0VXNlcjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfdXNlcjtcclxuICAgIH0sXHJcbiAgICBnZXRJc0FkZGluZzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfYmVnaW5BZGQ7XHJcbiAgICB9LFxyXG4gICAgZ2V0SXNFZGl0aW5nOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9iZWdpbkVkaXQ7XHJcbiAgICB9LFxyXG4gICAgZ2V0SGFzQ2hhbmdlczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfaGFzQ2hhbmdlcztcclxuICAgIH0sXHJcbiAgICBnZXRNb2RhbFZpc2libGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX21vZGFsVmlzaWJsZTtcclxuICAgIH0sXHJcbiAgICBnZXRWYWxpZGF0aW9uOiBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgcmV0dXJuIF92YWxpZGF0aW9uW2tleV07XHJcbiAgICB9LFxyXG4gICAgZ2V0SXNWYWxpZE9iamVjdDogZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHJldHVybiBfdmFsaWRhdGUoa2V5KTtcclxuICAgIH0sXHJcbiAgICBnZXRJc1ZhbGlkRWRpdE9iamVjdDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiAhKF9zZWN1cml0eUdyb3VwLklzU3lzdGVtRGVmYXVsdCAmJiBfc2VjdXJpdHlHcm91cC5OYW1lID09PSAnU3lzdGVtIEFkbWluaXN0cmF0b3InICYmIF9zZWN1cml0eUdyb3VwRGV0YWlsLkdyb3VwVXNlcnMubGVuZ3RoID09IDApO1xyXG4gICAgfSxcclxuICAgIGVtaXRDaGFuZ2U6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmVtaXQoRU5USVRMRU1FTlRfQ0hBTkdFX0VWRU5UKTtcclxuICAgIH0sXHJcbiAgICBhZGRDaGFuZ2VMaXN0ZW5lcjogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdGhpcy5vbihFTlRJVExFTUVOVF9DSEFOR0VfRVZFTlQsIGNhbGxiYWNrKTtcclxuICAgIH0sXHJcbiAgICByZW1vdmVDaGFuZ2VMaXN0ZW5lcjogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcihFTlRJVExFTUVOVF9DSEFOR0VfRVZFTlQsIGNhbGxiYWNrKTtcclxuICAgIH1cclxufSk7XHJcbklub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIucmVnaXN0ZXIoZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgIHN3aXRjaCAocGF5bG9hZC5hY3Rpb25UeXBlKSB7XHJcbiAgICAgICAgY2FzZSBFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9CRUdJTl9BREQ6XHJcbiAgICAgICAgICAgIHNldEFkZGluZ0VudGl0bGVtZW50KHBheWxvYWQuYXBwbGljYXRpb25QZXJtaXNzaW9ucyk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfQkVHSU5fRURJVDpcclxuICAgICAgICAgICAgc2V0RWRpdGluZ0VudGl0bGVtZW50KHBheWxvYWQuc2VjdXJpdHlHcm91cCwgcGF5bG9hZC5zZWN1cml0eUdyb3VwRGV0YWlsKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9GSU5JU0hfRURJVDpcclxuICAgICAgICAgICAgZmluaXNoZWRFZGl0aW5nKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfUkVDSUVWRV9EQVRBOlxyXG4gICAgICAgICAgICBsb2FkRW50aXRsZW1lbnREYXRhKHBheWxvYWQuZGF0YSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRW50aXRsZW1lbnRDb25zdGFudHMuRU5USVRMRU1FTlRfVVBEQVRFX1NFQ1VSSVRZX0dST1VQOlxyXG4gICAgICAgICAgICBfdXBkYXRlU2VjdXJpdHlHcm91cChwYXlsb2FkLmNvbXBvbmVudCwgcGF5bG9hZC5rZXksIHBheWxvYWQudmFsdWUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX1VQREFURV9QRVJNSVNTSU9OUzpcclxuICAgICAgICAgICAgdXBkYXRlUGVybWlzc2lvbnMocGF5bG9hZC51aWQsIHBheWxvYWQudmFsdWUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0FERF9VU0VSOlxyXG4gICAgICAgICAgICBhZGRVc2VycyhwYXlsb2FkLnVzZXJzKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBFbnRpdGxlbWVudENvbnN0YW50cy5FTlRJVExFTUVOVF9ERUxFVEVfVVNFUjpcclxuICAgICAgICAgICAgZGVsZXRlVXNlcihwYXlsb2FkLnVzZXIpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEVudGl0bGVtZW50Q29uc3RhbnRzLkVOVElUTEVNRU5UX0ZPUk1fSU5WQUxJRF9TQVZFOlxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OiByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIEVudGl0bGVtZW50U3RvcmUuZW1pdENoYW5nZSgpO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbn0pO1xyXG5tb2R1bGUuZXhwb3J0cyA9IEVudGl0bGVtZW50U3RvcmU7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUVudGl0bGVtZW50U3RvcmUuanMubWFwIiwiLy8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGFcbi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcbi8vIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZ1xuLy8gd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLFxuLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdFxuLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlXG4vLyBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZFxuLy8gaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTU1xuLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRlxuLy8gTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTlxuLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sXG4vLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1Jcbi8vIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEVcbi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG5cbnZhciBvYmplY3RDcmVhdGUgPSBPYmplY3QuY3JlYXRlIHx8IG9iamVjdENyZWF0ZVBvbHlmaWxsXG52YXIgb2JqZWN0S2V5cyA9IE9iamVjdC5rZXlzIHx8IG9iamVjdEtleXNQb2x5ZmlsbFxudmFyIGJpbmQgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZCB8fCBmdW5jdGlvbkJpbmRQb2x5ZmlsbFxuXG5mdW5jdGlvbiBFdmVudEVtaXR0ZXIoKSB7XG4gIGlmICghdGhpcy5fZXZlbnRzIHx8ICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodGhpcywgJ19ldmVudHMnKSkge1xuICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICB0aGlzLl9ldmVudHNDb3VudCA9IDA7XG4gIH1cblxuICB0aGlzLl9tYXhMaXN0ZW5lcnMgPSB0aGlzLl9tYXhMaXN0ZW5lcnMgfHwgdW5kZWZpbmVkO1xufVxubW9kdWxlLmV4cG9ydHMgPSBFdmVudEVtaXR0ZXI7XG5cbi8vIEJhY2t3YXJkcy1jb21wYXQgd2l0aCBub2RlIDAuMTAueFxuRXZlbnRFbWl0dGVyLkV2ZW50RW1pdHRlciA9IEV2ZW50RW1pdHRlcjtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fZXZlbnRzID0gdW5kZWZpbmVkO1xuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fbWF4TGlzdGVuZXJzID0gdW5kZWZpbmVkO1xuXG4vLyBCeSBkZWZhdWx0IEV2ZW50RW1pdHRlcnMgd2lsbCBwcmludCBhIHdhcm5pbmcgaWYgbW9yZSB0aGFuIDEwIGxpc3RlbmVycyBhcmVcbi8vIGFkZGVkIHRvIGl0LiBUaGlzIGlzIGEgdXNlZnVsIGRlZmF1bHQgd2hpY2ggaGVscHMgZmluZGluZyBtZW1vcnkgbGVha3MuXG52YXIgZGVmYXVsdE1heExpc3RlbmVycyA9IDEwO1xuXG52YXIgaGFzRGVmaW5lUHJvcGVydHk7XG50cnkge1xuICB2YXIgbyA9IHt9O1xuICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5KSBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgJ3gnLCB7IHZhbHVlOiAwIH0pO1xuICBoYXNEZWZpbmVQcm9wZXJ0eSA9IG8ueCA9PT0gMDtcbn0gY2F0Y2ggKGVycikgeyBoYXNEZWZpbmVQcm9wZXJ0eSA9IGZhbHNlIH1cbmlmIChoYXNEZWZpbmVQcm9wZXJ0eSkge1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoRXZlbnRFbWl0dGVyLCAnZGVmYXVsdE1heExpc3RlbmVycycsIHtcbiAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1heExpc3RlbmVycztcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24oYXJnKSB7XG4gICAgICAvLyBjaGVjayB3aGV0aGVyIHRoZSBpbnB1dCBpcyBhIHBvc2l0aXZlIG51bWJlciAod2hvc2UgdmFsdWUgaXMgemVybyBvclxuICAgICAgLy8gZ3JlYXRlciBhbmQgbm90IGEgTmFOKS5cbiAgICAgIGlmICh0eXBlb2YgYXJnICE9PSAnbnVtYmVyJyB8fCBhcmcgPCAwIHx8IGFyZyAhPT0gYXJnKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImRlZmF1bHRNYXhMaXN0ZW5lcnNcIiBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyJyk7XG4gICAgICBkZWZhdWx0TWF4TGlzdGVuZXJzID0gYXJnO1xuICAgIH1cbiAgfSk7XG59IGVsc2Uge1xuICBFdmVudEVtaXR0ZXIuZGVmYXVsdE1heExpc3RlbmVycyA9IGRlZmF1bHRNYXhMaXN0ZW5lcnM7XG59XG5cbi8vIE9idmlvdXNseSBub3QgYWxsIEVtaXR0ZXJzIHNob3VsZCBiZSBsaW1pdGVkIHRvIDEwLiBUaGlzIGZ1bmN0aW9uIGFsbG93c1xuLy8gdGhhdCB0byBiZSBpbmNyZWFzZWQuIFNldCB0byB6ZXJvIGZvciB1bmxpbWl0ZWQuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnNldE1heExpc3RlbmVycyA9IGZ1bmN0aW9uIHNldE1heExpc3RlbmVycyhuKSB7XG4gIGlmICh0eXBlb2YgbiAhPT0gJ251bWJlcicgfHwgbiA8IDAgfHwgaXNOYU4obikpXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJuXCIgYXJndW1lbnQgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlcicpO1xuICB0aGlzLl9tYXhMaXN0ZW5lcnMgPSBuO1xuICByZXR1cm4gdGhpcztcbn07XG5cbmZ1bmN0aW9uICRnZXRNYXhMaXN0ZW5lcnModGhhdCkge1xuICBpZiAodGhhdC5fbWF4TGlzdGVuZXJzID09PSB1bmRlZmluZWQpXG4gICAgcmV0dXJuIEV2ZW50RW1pdHRlci5kZWZhdWx0TWF4TGlzdGVuZXJzO1xuICByZXR1cm4gdGhhdC5fbWF4TGlzdGVuZXJzO1xufVxuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmdldE1heExpc3RlbmVycyA9IGZ1bmN0aW9uIGdldE1heExpc3RlbmVycygpIHtcbiAgcmV0dXJuICRnZXRNYXhMaXN0ZW5lcnModGhpcyk7XG59O1xuXG4vLyBUaGVzZSBzdGFuZGFsb25lIGVtaXQqIGZ1bmN0aW9ucyBhcmUgdXNlZCB0byBvcHRpbWl6ZSBjYWxsaW5nIG9mIGV2ZW50XG4vLyBoYW5kbGVycyBmb3IgZmFzdCBjYXNlcyBiZWNhdXNlIGVtaXQoKSBpdHNlbGYgb2Z0ZW4gaGFzIGEgdmFyaWFibGUgbnVtYmVyIG9mXG4vLyBhcmd1bWVudHMgYW5kIGNhbiBiZSBkZW9wdGltaXplZCBiZWNhdXNlIG9mIHRoYXQuIFRoZXNlIGZ1bmN0aW9ucyBhbHdheXMgaGF2ZVxuLy8gdGhlIHNhbWUgbnVtYmVyIG9mIGFyZ3VtZW50cyBhbmQgdGh1cyBkbyBub3QgZ2V0IGRlb3B0aW1pemVkLCBzbyB0aGUgY29kZVxuLy8gaW5zaWRlIHRoZW0gY2FuIGV4ZWN1dGUgZmFzdGVyLlxuZnVuY3Rpb24gZW1pdE5vbmUoaGFuZGxlciwgaXNGbiwgc2VsZikge1xuICBpZiAoaXNGbilcbiAgICBoYW5kbGVyLmNhbGwoc2VsZik7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uY2FsbChzZWxmKTtcbiAgfVxufVxuZnVuY3Rpb24gZW1pdE9uZShoYW5kbGVyLCBpc0ZuLCBzZWxmLCBhcmcxKSB7XG4gIGlmIChpc0ZuKVxuICAgIGhhbmRsZXIuY2FsbChzZWxmLCBhcmcxKTtcbiAgZWxzZSB7XG4gICAgdmFyIGxlbiA9IGhhbmRsZXIubGVuZ3RoO1xuICAgIHZhciBsaXN0ZW5lcnMgPSBhcnJheUNsb25lKGhhbmRsZXIsIGxlbik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSlcbiAgICAgIGxpc3RlbmVyc1tpXS5jYWxsKHNlbGYsIGFyZzEpO1xuICB9XG59XG5mdW5jdGlvbiBlbWl0VHdvKGhhbmRsZXIsIGlzRm4sIHNlbGYsIGFyZzEsIGFyZzIpIHtcbiAgaWYgKGlzRm4pXG4gICAgaGFuZGxlci5jYWxsKHNlbGYsIGFyZzEsIGFyZzIpO1xuICBlbHNlIHtcbiAgICB2YXIgbGVuID0gaGFuZGxlci5sZW5ndGg7XG4gICAgdmFyIGxpc3RlbmVycyA9IGFycmF5Q2xvbmUoaGFuZGxlciwgbGVuKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKVxuICAgICAgbGlzdGVuZXJzW2ldLmNhbGwoc2VsZiwgYXJnMSwgYXJnMik7XG4gIH1cbn1cbmZ1bmN0aW9uIGVtaXRUaHJlZShoYW5kbGVyLCBpc0ZuLCBzZWxmLCBhcmcxLCBhcmcyLCBhcmczKSB7XG4gIGlmIChpc0ZuKVxuICAgIGhhbmRsZXIuY2FsbChzZWxmLCBhcmcxLCBhcmcyLCBhcmczKTtcbiAgZWxzZSB7XG4gICAgdmFyIGxlbiA9IGhhbmRsZXIubGVuZ3RoO1xuICAgIHZhciBsaXN0ZW5lcnMgPSBhcnJheUNsb25lKGhhbmRsZXIsIGxlbik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSlcbiAgICAgIGxpc3RlbmVyc1tpXS5jYWxsKHNlbGYsIGFyZzEsIGFyZzIsIGFyZzMpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGVtaXRNYW55KGhhbmRsZXIsIGlzRm4sIHNlbGYsIGFyZ3MpIHtcbiAgaWYgKGlzRm4pXG4gICAgaGFuZGxlci5hcHBseShzZWxmLCBhcmdzKTtcbiAgZWxzZSB7XG4gICAgdmFyIGxlbiA9IGhhbmRsZXIubGVuZ3RoO1xuICAgIHZhciBsaXN0ZW5lcnMgPSBhcnJheUNsb25lKGhhbmRsZXIsIGxlbik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSlcbiAgICAgIGxpc3RlbmVyc1tpXS5hcHBseShzZWxmLCBhcmdzKTtcbiAgfVxufVxuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbiBlbWl0KHR5cGUpIHtcbiAgdmFyIGVyLCBoYW5kbGVyLCBsZW4sIGFyZ3MsIGksIGV2ZW50cztcbiAgdmFyIGRvRXJyb3IgPSAodHlwZSA9PT0gJ2Vycm9yJyk7XG5cbiAgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICBpZiAoZXZlbnRzKVxuICAgIGRvRXJyb3IgPSAoZG9FcnJvciAmJiBldmVudHMuZXJyb3IgPT0gbnVsbCk7XG4gIGVsc2UgaWYgKCFkb0Vycm9yKVxuICAgIHJldHVybiBmYWxzZTtcblxuICAvLyBJZiB0aGVyZSBpcyBubyAnZXJyb3InIGV2ZW50IGxpc3RlbmVyIHRoZW4gdGhyb3cuXG4gIGlmIChkb0Vycm9yKSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKVxuICAgICAgZXIgPSBhcmd1bWVudHNbMV07XG4gICAgaWYgKGVyIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgIHRocm93IGVyOyAvLyBVbmhhbmRsZWQgJ2Vycm9yJyBldmVudFxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBBdCBsZWFzdCBnaXZlIHNvbWUga2luZCBvZiBjb250ZXh0IHRvIHRoZSB1c2VyXG4gICAgICB2YXIgZXJyID0gbmV3IEVycm9yKCdVbmhhbmRsZWQgXCJlcnJvclwiIGV2ZW50LiAoJyArIGVyICsgJyknKTtcbiAgICAgIGVyci5jb250ZXh0ID0gZXI7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGhhbmRsZXIgPSBldmVudHNbdHlwZV07XG5cbiAgaWYgKCFoYW5kbGVyKVxuICAgIHJldHVybiBmYWxzZTtcblxuICB2YXIgaXNGbiA9IHR5cGVvZiBoYW5kbGVyID09PSAnZnVuY3Rpb24nO1xuICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICBzd2l0Y2ggKGxlbikge1xuICAgICAgLy8gZmFzdCBjYXNlc1xuICAgIGNhc2UgMTpcbiAgICAgIGVtaXROb25lKGhhbmRsZXIsIGlzRm4sIHRoaXMpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAyOlxuICAgICAgZW1pdE9uZShoYW5kbGVyLCBpc0ZuLCB0aGlzLCBhcmd1bWVudHNbMV0pO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAzOlxuICAgICAgZW1pdFR3byhoYW5kbGVyLCBpc0ZuLCB0aGlzLCBhcmd1bWVudHNbMV0sIGFyZ3VtZW50c1syXSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDQ6XG4gICAgICBlbWl0VGhyZWUoaGFuZGxlciwgaXNGbiwgdGhpcywgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0sIGFyZ3VtZW50c1szXSk7XG4gICAgICBicmVhaztcbiAgICAgIC8vIHNsb3dlclxuICAgIGRlZmF1bHQ6XG4gICAgICBhcmdzID0gbmV3IEFycmF5KGxlbiAtIDEpO1xuICAgICAgZm9yIChpID0gMTsgaSA8IGxlbjsgaSsrKVxuICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgIGVtaXRNYW55KGhhbmRsZXIsIGlzRm4sIHRoaXMsIGFyZ3MpO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5mdW5jdGlvbiBfYWRkTGlzdGVuZXIodGFyZ2V0LCB0eXBlLCBsaXN0ZW5lciwgcHJlcGVuZCkge1xuICB2YXIgbTtcbiAgdmFyIGV2ZW50cztcbiAgdmFyIGV4aXN0aW5nO1xuXG4gIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJsaXN0ZW5lclwiIGFyZ3VtZW50IG11c3QgYmUgYSBmdW5jdGlvbicpO1xuXG4gIGV2ZW50cyA9IHRhcmdldC5fZXZlbnRzO1xuICBpZiAoIWV2ZW50cykge1xuICAgIGV2ZW50cyA9IHRhcmdldC5fZXZlbnRzID0gb2JqZWN0Q3JlYXRlKG51bGwpO1xuICAgIHRhcmdldC5fZXZlbnRzQ291bnQgPSAwO1xuICB9IGVsc2Uge1xuICAgIC8vIFRvIGF2b2lkIHJlY3Vyc2lvbiBpbiB0aGUgY2FzZSB0aGF0IHR5cGUgPT09IFwibmV3TGlzdGVuZXJcIiEgQmVmb3JlXG4gICAgLy8gYWRkaW5nIGl0IHRvIHRoZSBsaXN0ZW5lcnMsIGZpcnN0IGVtaXQgXCJuZXdMaXN0ZW5lclwiLlxuICAgIGlmIChldmVudHMubmV3TGlzdGVuZXIpIHtcbiAgICAgIHRhcmdldC5lbWl0KCduZXdMaXN0ZW5lcicsIHR5cGUsXG4gICAgICAgICAgbGlzdGVuZXIubGlzdGVuZXIgPyBsaXN0ZW5lci5saXN0ZW5lciA6IGxpc3RlbmVyKTtcblxuICAgICAgLy8gUmUtYXNzaWduIGBldmVudHNgIGJlY2F1c2UgYSBuZXdMaXN0ZW5lciBoYW5kbGVyIGNvdWxkIGhhdmUgY2F1c2VkIHRoZVxuICAgICAgLy8gdGhpcy5fZXZlbnRzIHRvIGJlIGFzc2lnbmVkIHRvIGEgbmV3IG9iamVjdFxuICAgICAgZXZlbnRzID0gdGFyZ2V0Ll9ldmVudHM7XG4gICAgfVxuICAgIGV4aXN0aW5nID0gZXZlbnRzW3R5cGVdO1xuICB9XG5cbiAgaWYgKCFleGlzdGluZykge1xuICAgIC8vIE9wdGltaXplIHRoZSBjYXNlIG9mIG9uZSBsaXN0ZW5lci4gRG9uJ3QgbmVlZCB0aGUgZXh0cmEgYXJyYXkgb2JqZWN0LlxuICAgIGV4aXN0aW5nID0gZXZlbnRzW3R5cGVdID0gbGlzdGVuZXI7XG4gICAgKyt0YXJnZXQuX2V2ZW50c0NvdW50O1xuICB9IGVsc2Uge1xuICAgIGlmICh0eXBlb2YgZXhpc3RpbmcgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIC8vIEFkZGluZyB0aGUgc2Vjb25kIGVsZW1lbnQsIG5lZWQgdG8gY2hhbmdlIHRvIGFycmF5LlxuICAgICAgZXhpc3RpbmcgPSBldmVudHNbdHlwZV0gPVxuICAgICAgICAgIHByZXBlbmQgPyBbbGlzdGVuZXIsIGV4aXN0aW5nXSA6IFtleGlzdGluZywgbGlzdGVuZXJdO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IGdvdCBhbiBhcnJheSwganVzdCBhcHBlbmQuXG4gICAgICBpZiAocHJlcGVuZCkge1xuICAgICAgICBleGlzdGluZy51bnNoaWZ0KGxpc3RlbmVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGV4aXN0aW5nLnB1c2gobGlzdGVuZXIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBsaXN0ZW5lciBsZWFrXG4gICAgaWYgKCFleGlzdGluZy53YXJuZWQpIHtcbiAgICAgIG0gPSAkZ2V0TWF4TGlzdGVuZXJzKHRhcmdldCk7XG4gICAgICBpZiAobSAmJiBtID4gMCAmJiBleGlzdGluZy5sZW5ndGggPiBtKSB7XG4gICAgICAgIGV4aXN0aW5nLndhcm5lZCA9IHRydWU7XG4gICAgICAgIHZhciB3ID0gbmV3IEVycm9yKCdQb3NzaWJsZSBFdmVudEVtaXR0ZXIgbWVtb3J5IGxlYWsgZGV0ZWN0ZWQuICcgK1xuICAgICAgICAgICAgZXhpc3RpbmcubGVuZ3RoICsgJyBcIicgKyBTdHJpbmcodHlwZSkgKyAnXCIgbGlzdGVuZXJzICcgK1xuICAgICAgICAgICAgJ2FkZGVkLiBVc2UgZW1pdHRlci5zZXRNYXhMaXN0ZW5lcnMoKSB0byAnICtcbiAgICAgICAgICAgICdpbmNyZWFzZSBsaW1pdC4nKTtcbiAgICAgICAgdy5uYW1lID0gJ01heExpc3RlbmVyc0V4Y2VlZGVkV2FybmluZyc7XG4gICAgICAgIHcuZW1pdHRlciA9IHRhcmdldDtcbiAgICAgICAgdy50eXBlID0gdHlwZTtcbiAgICAgICAgdy5jb3VudCA9IGV4aXN0aW5nLmxlbmd0aDtcbiAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlID09PSAnb2JqZWN0JyAmJiBjb25zb2xlLndhcm4pIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJyVzOiAlcycsIHcubmFtZSwgdy5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0YXJnZXQ7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuYWRkTGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikge1xuICByZXR1cm4gX2FkZExpc3RlbmVyKHRoaXMsIHR5cGUsIGxpc3RlbmVyLCBmYWxzZSk7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLm9uID0gRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5hZGRMaXN0ZW5lcjtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5wcmVwZW5kTGlzdGVuZXIgPVxuICAgIGZ1bmN0aW9uIHByZXBlbmRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikge1xuICAgICAgcmV0dXJuIF9hZGRMaXN0ZW5lcih0aGlzLCB0eXBlLCBsaXN0ZW5lciwgdHJ1ZSk7XG4gICAgfTtcblxuZnVuY3Rpb24gb25jZVdyYXBwZXIoKSB7XG4gIGlmICghdGhpcy5maXJlZCkge1xuICAgIHRoaXMudGFyZ2V0LnJlbW92ZUxpc3RlbmVyKHRoaXMudHlwZSwgdGhpcy53cmFwRm4pO1xuICAgIHRoaXMuZmlyZWQgPSB0cnVlO1xuICAgIHN3aXRjaCAoYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgY2FzZSAwOlxuICAgICAgICByZXR1cm4gdGhpcy5saXN0ZW5lci5jYWxsKHRoaXMudGFyZ2V0KTtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCwgYXJndW1lbnRzWzBdKTtcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCwgYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0pO1xuICAgICAgY2FzZSAzOlxuICAgICAgICByZXR1cm4gdGhpcy5saXN0ZW5lci5jYWxsKHRoaXMudGFyZ2V0LCBhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSxcbiAgICAgICAgICAgIGFyZ3VtZW50c1syXSk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgKytpKVxuICAgICAgICAgIGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07XG4gICAgICAgIHRoaXMubGlzdGVuZXIuYXBwbHkodGhpcy50YXJnZXQsIGFyZ3MpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBfb25jZVdyYXAodGFyZ2V0LCB0eXBlLCBsaXN0ZW5lcikge1xuICB2YXIgc3RhdGUgPSB7IGZpcmVkOiBmYWxzZSwgd3JhcEZuOiB1bmRlZmluZWQsIHRhcmdldDogdGFyZ2V0LCB0eXBlOiB0eXBlLCBsaXN0ZW5lcjogbGlzdGVuZXIgfTtcbiAgdmFyIHdyYXBwZWQgPSBiaW5kLmNhbGwob25jZVdyYXBwZXIsIHN0YXRlKTtcbiAgd3JhcHBlZC5saXN0ZW5lciA9IGxpc3RlbmVyO1xuICBzdGF0ZS53cmFwRm4gPSB3cmFwcGVkO1xuICByZXR1cm4gd3JhcHBlZDtcbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbmNlID0gZnVuY3Rpb24gb25jZSh0eXBlLCBsaXN0ZW5lcikge1xuICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgdGhpcy5vbih0eXBlLCBfb25jZVdyYXAodGhpcywgdHlwZSwgbGlzdGVuZXIpKTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnByZXBlbmRPbmNlTGlzdGVuZXIgPVxuICAgIGZ1bmN0aW9uIHByZXBlbmRPbmNlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgICAgIHRoaXMucHJlcGVuZExpc3RlbmVyKHR5cGUsIF9vbmNlV3JhcCh0aGlzLCB0eXBlLCBsaXN0ZW5lcikpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuLy8gRW1pdHMgYSAncmVtb3ZlTGlzdGVuZXInIGV2ZW50IGlmIGFuZCBvbmx5IGlmIHRoZSBsaXN0ZW5lciB3YXMgcmVtb3ZlZC5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPVxuICAgIGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICB2YXIgbGlzdCwgZXZlbnRzLCBwb3NpdGlvbiwgaSwgb3JpZ2luYWxMaXN0ZW5lcjtcblxuICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJsaXN0ZW5lclwiIGFyZ3VtZW50IG11c3QgYmUgYSBmdW5jdGlvbicpO1xuXG4gICAgICBldmVudHMgPSB0aGlzLl9ldmVudHM7XG4gICAgICBpZiAoIWV2ZW50cylcbiAgICAgICAgcmV0dXJuIHRoaXM7XG5cbiAgICAgIGxpc3QgPSBldmVudHNbdHlwZV07XG4gICAgICBpZiAoIWxpc3QpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICBpZiAobGlzdCA9PT0gbGlzdGVuZXIgfHwgbGlzdC5saXN0ZW5lciA9PT0gbGlzdGVuZXIpIHtcbiAgICAgICAgaWYgKC0tdGhpcy5fZXZlbnRzQ291bnQgPT09IDApXG4gICAgICAgICAgdGhpcy5fZXZlbnRzID0gb2JqZWN0Q3JlYXRlKG51bGwpO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBkZWxldGUgZXZlbnRzW3R5cGVdO1xuICAgICAgICAgIGlmIChldmVudHMucmVtb3ZlTGlzdGVuZXIpXG4gICAgICAgICAgICB0aGlzLmVtaXQoJ3JlbW92ZUxpc3RlbmVyJywgdHlwZSwgbGlzdC5saXN0ZW5lciB8fCBsaXN0ZW5lcik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGxpc3QgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcG9zaXRpb24gPSAtMTtcblxuICAgICAgICBmb3IgKGkgPSBsaXN0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgaWYgKGxpc3RbaV0gPT09IGxpc3RlbmVyIHx8IGxpc3RbaV0ubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7XG4gICAgICAgICAgICBvcmlnaW5hbExpc3RlbmVyID0gbGlzdFtpXS5saXN0ZW5lcjtcbiAgICAgICAgICAgIHBvc2l0aW9uID0gaTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwb3NpdGlvbiA8IDApXG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG5cbiAgICAgICAgaWYgKHBvc2l0aW9uID09PSAwKVxuICAgICAgICAgIGxpc3Quc2hpZnQoKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHNwbGljZU9uZShsaXN0LCBwb3NpdGlvbik7XG5cbiAgICAgICAgaWYgKGxpc3QubGVuZ3RoID09PSAxKVxuICAgICAgICAgIGV2ZW50c1t0eXBlXSA9IGxpc3RbMF07XG5cbiAgICAgICAgaWYgKGV2ZW50cy5yZW1vdmVMaXN0ZW5lcilcbiAgICAgICAgICB0aGlzLmVtaXQoJ3JlbW92ZUxpc3RlbmVyJywgdHlwZSwgb3JpZ2luYWxMaXN0ZW5lciB8fCBsaXN0ZW5lcik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID1cbiAgICBmdW5jdGlvbiByZW1vdmVBbGxMaXN0ZW5lcnModHlwZSkge1xuICAgICAgdmFyIGxpc3RlbmVycywgZXZlbnRzLCBpO1xuXG4gICAgICBldmVudHMgPSB0aGlzLl9ldmVudHM7XG4gICAgICBpZiAoIWV2ZW50cylcbiAgICAgICAgcmV0dXJuIHRoaXM7XG5cbiAgICAgIC8vIG5vdCBsaXN0ZW5pbmcgZm9yIHJlbW92ZUxpc3RlbmVyLCBubyBuZWVkIHRvIGVtaXRcbiAgICAgIGlmICghZXZlbnRzLnJlbW92ZUxpc3RlbmVyKSB7XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdGhpcy5fZXZlbnRzID0gb2JqZWN0Q3JlYXRlKG51bGwpO1xuICAgICAgICAgIHRoaXMuX2V2ZW50c0NvdW50ID0gMDtcbiAgICAgICAgfSBlbHNlIGlmIChldmVudHNbdHlwZV0pIHtcbiAgICAgICAgICBpZiAoLS10aGlzLl9ldmVudHNDb3VudCA9PT0gMClcbiAgICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICBkZWxldGUgZXZlbnRzW3R5cGVdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuXG4gICAgICAvLyBlbWl0IHJlbW92ZUxpc3RlbmVyIGZvciBhbGwgbGlzdGVuZXJzIG9uIGFsbCBldmVudHNcbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHZhciBrZXlzID0gb2JqZWN0S2V5cyhldmVudHMpO1xuICAgICAgICB2YXIga2V5O1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgIGtleSA9IGtleXNbaV07XG4gICAgICAgICAgaWYgKGtleSA9PT0gJ3JlbW92ZUxpc3RlbmVyJykgY29udGludWU7XG4gICAgICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoa2V5KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygncmVtb3ZlTGlzdGVuZXInKTtcbiAgICAgICAgdGhpcy5fZXZlbnRzID0gb2JqZWN0Q3JlYXRlKG51bGwpO1xuICAgICAgICB0aGlzLl9ldmVudHNDb3VudCA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuXG4gICAgICBsaXN0ZW5lcnMgPSBldmVudHNbdHlwZV07XG5cbiAgICAgIGlmICh0eXBlb2YgbGlzdGVuZXJzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXJzKTtcbiAgICAgIH0gZWxzZSBpZiAobGlzdGVuZXJzKSB7XG4gICAgICAgIC8vIExJRk8gb3JkZXJcbiAgICAgICAgZm9yIChpID0gbGlzdGVuZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcnNbaV0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbmZ1bmN0aW9uIF9saXN0ZW5lcnModGFyZ2V0LCB0eXBlLCB1bndyYXApIHtcbiAgdmFyIGV2ZW50cyA9IHRhcmdldC5fZXZlbnRzO1xuXG4gIGlmICghZXZlbnRzKVxuICAgIHJldHVybiBbXTtcblxuICB2YXIgZXZsaXN0ZW5lciA9IGV2ZW50c1t0eXBlXTtcbiAgaWYgKCFldmxpc3RlbmVyKVxuICAgIHJldHVybiBbXTtcblxuICBpZiAodHlwZW9mIGV2bGlzdGVuZXIgPT09ICdmdW5jdGlvbicpXG4gICAgcmV0dXJuIHVud3JhcCA/IFtldmxpc3RlbmVyLmxpc3RlbmVyIHx8IGV2bGlzdGVuZXJdIDogW2V2bGlzdGVuZXJdO1xuXG4gIHJldHVybiB1bndyYXAgPyB1bndyYXBMaXN0ZW5lcnMoZXZsaXN0ZW5lcikgOiBhcnJheUNsb25lKGV2bGlzdGVuZXIsIGV2bGlzdGVuZXIubGVuZ3RoKTtcbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5saXN0ZW5lcnMgPSBmdW5jdGlvbiBsaXN0ZW5lcnModHlwZSkge1xuICByZXR1cm4gX2xpc3RlbmVycyh0aGlzLCB0eXBlLCB0cnVlKTtcbn07XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmF3TGlzdGVuZXJzID0gZnVuY3Rpb24gcmF3TGlzdGVuZXJzKHR5cGUpIHtcbiAgcmV0dXJuIF9saXN0ZW5lcnModGhpcywgdHlwZSwgZmFsc2UpO1xufTtcblxuRXZlbnRFbWl0dGVyLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbihlbWl0dGVyLCB0eXBlKSB7XG4gIGlmICh0eXBlb2YgZW1pdHRlci5saXN0ZW5lckNvdW50ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGVtaXR0ZXIubGlzdGVuZXJDb3VudCh0eXBlKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbGlzdGVuZXJDb3VudC5jYWxsKGVtaXR0ZXIsIHR5cGUpO1xuICB9XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmxpc3RlbmVyQ291bnQgPSBsaXN0ZW5lckNvdW50O1xuZnVuY3Rpb24gbGlzdGVuZXJDb3VudCh0eXBlKSB7XG4gIHZhciBldmVudHMgPSB0aGlzLl9ldmVudHM7XG5cbiAgaWYgKGV2ZW50cykge1xuICAgIHZhciBldmxpc3RlbmVyID0gZXZlbnRzW3R5cGVdO1xuXG4gICAgaWYgKHR5cGVvZiBldmxpc3RlbmVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gMTtcbiAgICB9IGVsc2UgaWYgKGV2bGlzdGVuZXIpIHtcbiAgICAgIHJldHVybiBldmxpc3RlbmVyLmxlbmd0aDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gMDtcbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5ldmVudE5hbWVzID0gZnVuY3Rpb24gZXZlbnROYW1lcygpIHtcbiAgcmV0dXJuIHRoaXMuX2V2ZW50c0NvdW50ID4gMCA/IFJlZmxlY3Qub3duS2V5cyh0aGlzLl9ldmVudHMpIDogW107XG59O1xuXG4vLyBBYm91dCAxLjV4IGZhc3RlciB0aGFuIHRoZSB0d28tYXJnIHZlcnNpb24gb2YgQXJyYXkjc3BsaWNlKCkuXG5mdW5jdGlvbiBzcGxpY2VPbmUobGlzdCwgaW5kZXgpIHtcbiAgZm9yICh2YXIgaSA9IGluZGV4LCBrID0gaSArIDEsIG4gPSBsaXN0Lmxlbmd0aDsgayA8IG47IGkgKz0gMSwgayArPSAxKVxuICAgIGxpc3RbaV0gPSBsaXN0W2tdO1xuICBsaXN0LnBvcCgpO1xufVxuXG5mdW5jdGlvbiBhcnJheUNsb25lKGFyciwgbikge1xuICB2YXIgY29weSA9IG5ldyBBcnJheShuKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyArK2kpXG4gICAgY29weVtpXSA9IGFycltpXTtcbiAgcmV0dXJuIGNvcHk7XG59XG5cbmZ1bmN0aW9uIHVud3JhcExpc3RlbmVycyhhcnIpIHtcbiAgdmFyIHJldCA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXQubGVuZ3RoOyArK2kpIHtcbiAgICByZXRbaV0gPSBhcnJbaV0ubGlzdGVuZXIgfHwgYXJyW2ldO1xuICB9XG4gIHJldHVybiByZXQ7XG59XG5cbmZ1bmN0aW9uIG9iamVjdENyZWF0ZVBvbHlmaWxsKHByb3RvKSB7XG4gIHZhciBGID0gZnVuY3Rpb24oKSB7fTtcbiAgRi5wcm90b3R5cGUgPSBwcm90bztcbiAgcmV0dXJuIG5ldyBGO1xufVxuZnVuY3Rpb24gb2JqZWN0S2V5c1BvbHlmaWxsKG9iaikge1xuICB2YXIga2V5cyA9IFtdO1xuICBmb3IgKHZhciBrIGluIG9iaikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGspKSB7XG4gICAga2V5cy5wdXNoKGspO1xuICB9XG4gIHJldHVybiBrO1xufVxuZnVuY3Rpb24gZnVuY3Rpb25CaW5kUG9seWZpbGwoY29udGV4dCkge1xuICB2YXIgZm4gPSB0aGlzO1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmbi5hcHBseShjb250ZXh0LCBhcmd1bWVudHMpO1xuICB9O1xufVxuIiwiLypcbm9iamVjdC1hc3NpZ25cbihjKSBTaW5kcmUgU29yaHVzXG5AbGljZW5zZSBNSVRcbiovXG5cbid1c2Ugc3RyaWN0Jztcbi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzICovXG52YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scztcbnZhciBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG52YXIgcHJvcElzRW51bWVyYWJsZSA9IE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGU7XG5cbmZ1bmN0aW9uIHRvT2JqZWN0KHZhbCkge1xuXHRpZiAodmFsID09PSBudWxsIHx8IHZhbCA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0dGhyb3cgbmV3IFR5cGVFcnJvcignT2JqZWN0LmFzc2lnbiBjYW5ub3QgYmUgY2FsbGVkIHdpdGggbnVsbCBvciB1bmRlZmluZWQnKTtcblx0fVxuXG5cdHJldHVybiBPYmplY3QodmFsKTtcbn1cblxuZnVuY3Rpb24gc2hvdWxkVXNlTmF0aXZlKCkge1xuXHR0cnkge1xuXHRcdGlmICghT2JqZWN0LmFzc2lnbikge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdC8vIERldGVjdCBidWdneSBwcm9wZXJ0eSBlbnVtZXJhdGlvbiBvcmRlciBpbiBvbGRlciBWOCB2ZXJzaW9ucy5cblxuXHRcdC8vIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTQxMThcblx0XHR2YXIgdGVzdDEgPSBuZXcgU3RyaW5nKCdhYmMnKTsgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tbmV3LXdyYXBwZXJzXG5cdFx0dGVzdDFbNV0gPSAnZGUnO1xuXHRcdGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0ZXN0MSlbMF0gPT09ICc1Jykge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdC8vIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTMwNTZcblx0XHR2YXIgdGVzdDIgPSB7fTtcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IDEwOyBpKyspIHtcblx0XHRcdHRlc3QyWydfJyArIFN0cmluZy5mcm9tQ2hhckNvZGUoaSldID0gaTtcblx0XHR9XG5cdFx0dmFyIG9yZGVyMiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRlc3QyKS5tYXAoZnVuY3Rpb24gKG4pIHtcblx0XHRcdHJldHVybiB0ZXN0MltuXTtcblx0XHR9KTtcblx0XHRpZiAob3JkZXIyLmpvaW4oJycpICE9PSAnMDEyMzQ1Njc4OScpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD0zMDU2XG5cdFx0dmFyIHRlc3QzID0ge307XG5cdFx0J2FiY2RlZmdoaWprbG1ub3BxcnN0Jy5zcGxpdCgnJykuZm9yRWFjaChmdW5jdGlvbiAobGV0dGVyKSB7XG5cdFx0XHR0ZXN0M1tsZXR0ZXJdID0gbGV0dGVyO1xuXHRcdH0pO1xuXHRcdGlmIChPYmplY3Qua2V5cyhPYmplY3QuYXNzaWduKHt9LCB0ZXN0MykpLmpvaW4oJycpICE9PVxuXHRcdFx0XHQnYWJjZGVmZ2hpamtsbW5vcHFyc3QnKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRydWU7XG5cdH0gY2F0Y2ggKGVycikge1xuXHRcdC8vIFdlIGRvbid0IGV4cGVjdCBhbnkgb2YgdGhlIGFib3ZlIHRvIHRocm93LCBidXQgYmV0dGVyIHRvIGJlIHNhZmUuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gc2hvdWxkVXNlTmF0aXZlKCkgPyBPYmplY3QuYXNzaWduIDogZnVuY3Rpb24gKHRhcmdldCwgc291cmNlKSB7XG5cdHZhciBmcm9tO1xuXHR2YXIgdG8gPSB0b09iamVjdCh0YXJnZXQpO1xuXHR2YXIgc3ltYm9scztcblxuXHRmb3IgKHZhciBzID0gMTsgcyA8IGFyZ3VtZW50cy5sZW5ndGg7IHMrKykge1xuXHRcdGZyb20gPSBPYmplY3QoYXJndW1lbnRzW3NdKTtcblxuXHRcdGZvciAodmFyIGtleSBpbiBmcm9tKSB7XG5cdFx0XHRpZiAoaGFzT3duUHJvcGVydHkuY2FsbChmcm9tLCBrZXkpKSB7XG5cdFx0XHRcdHRvW2tleV0gPSBmcm9tW2tleV07XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGdldE93blByb3BlcnR5U3ltYm9scykge1xuXHRcdFx0c3ltYm9scyA9IGdldE93blByb3BlcnR5U3ltYm9scyhmcm9tKTtcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc3ltYm9scy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRpZiAocHJvcElzRW51bWVyYWJsZS5jYWxsKGZyb20sIHN5bWJvbHNbaV0pKSB7XG5cdFx0XHRcdFx0dG9bc3ltYm9sc1tpXV0gPSBmcm9tW3N5bWJvbHNbaV1dO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHRvO1xufTtcbiJdfQ==
