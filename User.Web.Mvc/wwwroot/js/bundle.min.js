(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
// A ‘.tsx’ file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var ReactDOM = require("react-dom");
var UserApp = require("./components/UserApp");
try {
    InovxLoader.updateHelp('users');
}
catch (e) {
}
ReactDOM.render(React.createElement(UserApp, null), document.getElementById('userapp'));

},{"./components/UserApp":4,"react":"react","react-dom":"react-dom"}],2:[function(require,module,exports){
"use strict";
// A ‘.tsx’ file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var Inovx = require("shared.web.client");
var UserConstants = require('./../constants/UserConstants');
var UserServices = require('./../services/UserServices');
var SettingsService = require('./../services/SettingsService');
var UserStore = require('./../stores/UserStore');
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
function receiveData(data) {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: UserConstants.USER_RECIEVE_DATA,
        data: data
    });
}
function receiveHint(data, callback) {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: UserConstants.USER_RECIEVE_HINT,
        data: data,
        callback: callback
    });
}
function receiveCurrentUser(data, callback) {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: UserConstants.USER_RECIEVE_CURRENT,
        data: data,
        callback: callback
    });
}
function _finishEdit() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: UserConstants.FINISH_EDIT
    });
}
function _hideSettings() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: UserConstants.HIDE_SETTINGS_MENU
    });
}
function sendInvalidSave() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: UserConstants.USER_FORM_INVALID_SAVE
    });
}
function sendValidationError(comp, error) {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: UserConstants.USER_VALIDATION_ERROR,
        messageObj: error,
        component: comp
    });
}
function sendBeginEdit(user, roles, entitlement) {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: user ? UserConstants.BEGIN_EDIT_USER : UserConstants.BEGIN_USER_ADD,
        user: user,
        entitlement: entitlement,
        role: roles
    });
}
function getEntitlementList(cbFn, errorCbFn, ignoreDefault) {
    UserServices.getEntitlements(function (entitlement) {
        cbFn(entitlement);
    }, function (error) {
        errorCbFn(error);
    }, ignoreDefault);
}
function getRolesList(cbFn, errorCbFn, ignoreDefault) {
    UserServices.getRoles(function (roles) {
        cbFn(roles);
    }, function (error) {
        errorCbFn(error);
    }, ignoreDefault);
}
function getUserSystemSetting(cbFn, errorCbFn, ignoreDefault) {
    SettingsService.getSystemSettings(function (setting) {
        cbFn(setting);
    }, function (error) {
        errorCbFn(error);
    }, ignoreDefault);
}
var UserActions = {
    getAllUsers: function (callback, errorCallback, ignoreDefaultError) {
        UserServices.getAll(function (data) {
            if (callback !== 'undefined' && callback != null) {
                callback();
            }
            receiveData(data);
        }, function (error) {
            if (errorCallback) {
                errorCallback(error);
            }
        }, ignoreDefaultError);
    },
    create: function (callback) {
        if (UserStore.getIsValidObject(UserConstants.USER_ADD_FORM)) {
            if (!SystemStore.isActionInProgress(UserConstants.USER_ADD)) {
                SystemActions.beginAction(UserConstants.USER_ADD);
                UserServices.createUser(UserStore.getEditUser(), function () {
                    UserActions.refreshData();
                    if (callback !== undefined && callback != null) {
                        callback();
                    }
                    _finishEdit();
                    SystemActions.endAction(UserConstants.USER_ADD);
                }, function (error) {
                    if (error.messageObj.propertyName) {
                        sendValidationError(UserConstants.USER_ADD_FORM, error.messageObj);
                    }
                    SystemActions.endAction(UserConstants.USER_ADD);
                }, function (error) {
                    return error.messageObj.propertyName ? true : false;
                });
            }
        }
        else {
            sendInvalidSave();
        }
    },
    delete: function (user, callback) {
        if (!SystemStore.isActionInProgress(UserConstants.USER_DELETE)) {
            SystemActions.beginAction(UserConstants.USER_DELETE);
            UserServices.deleteUser(user, function () {
                UserActions.refreshData();
                if (callback !== undefined && callback != null) {
                    callback();
                }
                SystemActions.endAction(UserConstants.USER_DELETE);
            }, function (error) {
                SystemActions.endAction(UserConstants.USER_DELETE);
            });
        }
    },
    edit: function (callback) {
        if (UserStore.getIsValidObject(UserConstants.USER_ADD_FORM)) {
            if (!SystemStore.isActionInProgress(UserConstants.USER_EDIT)) {
                SystemActions.beginAction(UserConstants.USER_EDIT);
                UserServices.editUser(UserStore.getEditUser(), function () {
                    UserActions.refreshData();
                    if (callback !== undefined && callback != null) {
                        callback();
                    }
                    _finishEdit();
                    SystemActions.endAction(UserConstants.USER_EDIT);
                }, function (error) {
                    if (error.messageObj.propertyName) {
                        if (error.messageObj.propertyName == "UserName" && error.messageObj.reason == 'DuplicateDeletedUserName') {
                            var messageObject = {
                                message: InovxLoader.t("users:form.duplicateEmail"),
                                reason: error.messageObj.reason,
                                propertyName: "Email"
                            };
                            sendValidationError(UserConstants.USER_ADD_FORM, messageObject);
                        }
                        else
                            sendValidationError(UserConstants.USER_ADD_FORM, error.messageObj);
                    }
                    SystemActions.endAction(UserConstants.USER_EDIT);
                }, function (error) {
                    return error.messageObj.propertyName ? true : false;
                });
            }
        }
        else {
            sendInvalidSave();
        }
    },
    changePassword: function (user, password, callback, errorCallback) {
        if (!SystemStore.isActionInProgress(UserConstants.USER_CHANGE_PASSWORD)) {
            SystemActions.beginAction(UserConstants.USER_CHANGE_PASSWORD);
            UserServices.changePassword(user, password, function (updatedUser) {
                Inovx.Shared.Flux.AppDispatcher.dispatch({
                    actionType: UserConstants.USER_CHANGE_PASSWORD_SUCCESS,
                    user: updatedUser
                });
                callback();
                SystemActions.endAction(UserConstants.USER_CHANGE_PASSWORD);
            }, function (error) {
                errorCallback(error);
                SystemActions.endAction(UserConstants.USER_CHANGE_PASSWORD);
            }, function (error) {
                return error.messageObj.propertyName ? true : false;
            });
        }
    },
    resetPasswords: function (callback, errorCallback) {
        UserServices.resetPasswords(function () {
            if (callback) {
                callback();
            }
        }, function (error) {
            if (errorCallback) {
                errorCallback(error);
            }
        }, true);
    },
    beginAdd: function () {
        if (!SystemStore.isActionInProgress(UserConstants.BEGIN_USER_ADD)) {
            SystemActions.beginAction(UserConstants.BEGIN_USER_ADD);
            var entitlement_1 = [];
            var roles_1 = [];
            var getRolesCall_1 = function () {
                getRolesList(function (roleData) {
                    roles_1 = roleData;
                    sendBeginEdit(null, roles_1, entitlement_1);
                    SystemActions.endAction(UserConstants.BEGIN_USER_ADD);
                }, function (error) {
                    sendBeginEdit(null, roles_1, entitlement_1);
                    SystemActions.endAction(UserConstants.BEGIN_USER_ADD);
                }, true);
            };
            getEntitlementList(function (entitlementData) {
                entitlement_1 = entitlementData;
                getRolesCall_1();
            }, function (error) {
                getRolesCall_1();
            }, true);
        }
    },
    beginEdit: function (user) {
        if (!SystemStore.isActionInProgress(UserConstants.BEGIN_EDIT_USER)) {
            SystemActions.beginAction(UserConstants.BEGIN_EDIT_USER);
            UserServices.getDetail(user.UserID, function (data) {
                if (!data.EntitlementGroupIDs)
                    data.EntitlementGroupIDs = [];
                if (!data.RoleIDs)
                    data.RoleIDs = [];
                var entitlement = [];
                var roles = [];
                var getRolesCall = function () {
                    getRolesList(function (roleData) {
                        roles = roleData;
                        sendBeginEdit(data, roles, entitlement);
                        SystemActions.endAction(UserConstants.BEGIN_EDIT_USER);
                    }, function (error) {
                        sendBeginEdit(data, roles, entitlement);
                        SystemActions.endAction(UserConstants.BEGIN_EDIT_USER);
                    }, true);
                };
                getEntitlementList(function (entitlementData) {
                    entitlement = entitlementData;
                    getRolesCall();
                }, function (error) {
                    getRolesCall();
                }, true);
            }, function (error) {
                SystemActions.endAction(UserConstants.BEGIN_EDIT_USER);
            });
        }
    },
    selectHint: function (user) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: UserConstants.USER_SELECT_HINT,
            user: user
        });
    },
    finishEdit: function () {
        if (UserStore.getHasChanges()) {
            var callbackFunct = UserActions.create;
            if (UserStore.getIsEditing()) {
                callbackFunct = UserActions.edit;
            }
            SystemActions.displaySaveChangesDialog({
                message: InovxLoader.t("common:msgBox.saveChanges"),
                confirmCallback: callbackFunct,
                cancelCallback: _finishEdit
            });
        }
        else {
            _finishEdit();
        }
    },
    refreshData: function () {
        this.getAllUsers();
    },
    getHint: function (hint, callback) {
        if (!SystemStore.isActionInProgress(UserConstants.USER_CHECK_NAME)) {
            SystemActions.beginAction(UserConstants.USER_CHECK_NAME);
            UserServices.checkName(hint, function (data) {
                receiveHint(data, callback);
                SystemActions.endAction(UserConstants.USER_CHECK_NAME);
            }, function (error) {
                SystemActions.endAction(UserConstants.USER_CHECK_NAME);
            });
        }
    },
    getCurrentUser: function (callback) {
        if (!SystemStore.isActionInProgress(UserConstants.USER_CURRENT_GET)) {
            SystemActions.beginAction(UserConstants.USER_CURRENT_GET);
            UserServices.getCurrentUserDetail(function (data) {
                receiveCurrentUser(data, callback);
                SystemActions.endAction(UserConstants.USER_CURRENT_GET);
            }, function (error) {
                SystemActions.endAction(UserConstants.USER_CURRENT_GET);
            });
        }
    },
    resetLoginAttempts: function (user, callback) {
        if (!SystemStore.isActionInProgress(UserConstants.RESET_LOGIN_ATTEMPTS)) {
            SystemActions.beginAction(UserConstants.RESET_LOGIN_ATTEMPTS);
            UserServices.resetLoginAttempts(user, function () {
                UserServices.getDetail(user.UserID, function (data) {
                    Inovx.Shared.Flux.AppDispatcher.dispatch({
                        actionType: UserConstants.RESET_LOGIN_ATTEMPTS,
                        user: data
                    });
                    if (callback) {
                        callback();
                    }
                    SystemActions.endAction(UserConstants.RESET_LOGIN_ATTEMPTS);
                }, function (error) {
                    SystemActions.endAction(UserConstants.RESET_LOGIN_ATTEMPTS);
                });
            }, function (error) {
                SystemActions.endAction(UserConstants.RESET_LOGIN_ATTEMPTS);
            });
        }
    },
    editCurrentObject: function (comp, key, value) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: UserConstants.USER_UPDATE_OBJECT,
            component: comp,
            key: key,
            value: value
        });
    },
    editCurrentObjectAddToList: function (comp, key, value) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: UserConstants.USER_UPDATE_OBJECT_ADD_LIST,
            component: comp,
            key: key,
            value: value
        });
    },
    editCurrentObjectRemoveFromList: function (comp, key, value) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: UserConstants.USER_UPDATE_OBJECT_REMOVE_LIST,
            component: comp,
            key: key,
            value: value
        });
    },
    hideSettings: function () {
        if (UserStore.getHasChanges()) {
            SystemActions.displaySaveChangesDialog({
                message: InovxLoader.t("common:msgBox.saveChanges"),
                confirmCallback: UserActions.saveSettings,
                cancelCallback: _hideSettings
            });
        }
        else {
            _hideSettings();
        }
    },
    saveSettings: function (errorCallback, ignoreVSuiteLoginError) {
        if (UserStore.getIsValidObject(UserConstants.USER_SETTINGS_FORM)) {
            if (!SystemStore.isActionInProgress(UserConstants.SETTINGS_SAVE)) {
                SystemActions.beginAction(UserConstants.SETTINGS_SAVE);
                SettingsService.saveSettings(UserStore.getSaveFriendlyEditSettings(), function () {
                    _hideSettings();
                    Inovx.Shared.Flux.AppDispatcher.dispatch({
                        actionType: UserConstants.SETTINGS_GET,
                        data: $.extend({}, UserStore.getSaveFriendlyEditSettings()),
                        display: UserStore.getSettingsShown()
                    });
                    SystemActions.endAction(UserConstants.SETTINGS_SAVE);
                }, function (error) {
                    if (errorCallback) {
                        errorCallback(error);
                    }
                    SystemActions.endAction(UserConstants.SETTINGS_SAVE);
                }, ignoreVSuiteLoginError);
            }
        }
        else {
            sendInvalidSave();
        }
    },
    getSettings: function (displaySettings, callback, errorCallback) {
        if (!SystemStore.isActionInProgress(UserConstants.SETTINGS_GET)) {
            SystemActions.beginAction(UserConstants.SETTINGS_GET);
            SettingsService.getSettings(function (data) {
                Inovx.Shared.Flux.AppDispatcher.dispatch({
                    actionType: UserConstants.SETTINGS_GET,
                    data: data,
                    display: displaySettings
                });
                if (callback) {
                    callback();
                }
                SystemActions.endAction(UserConstants.SETTINGS_GET);
            }, function (error) {
                if (errorCallback) {
                    errorCallback(error);
                }
                SystemActions.endAction(UserConstants.SETTINGS_GET);
            });
        }
    },
    getUserSystemPreferences: function (callback, errorCallback) {
        var entitlement = [];
        var roles = [];
        var defaultSetting;
        if (!SystemStore.isActionInProgress(UserConstants.SYSTEM_SETTINGS_GET)) {
            SystemActions.beginAction(UserConstants.SYSTEM_SETTINGS_GET);
            getUserSystemSetting(function (settingData) {
                defaultSetting = settingData;
                getRolesList(function (roleData) {
                    roles = roleData;
                    getEntitlementList(function (entitlementData) {
                        entitlement = entitlementData;
                        var data = {
                            DefaultSytemSetting: defaultSetting,
                            AllGroups: entitlement,
                            AllRoles: roles
                        };
                        callback(data);
                        SystemActions.endAction(UserConstants.SYSTEM_SETTINGS_GET);
                    }, function (error) {
                        if (errorCallback) {
                            errorCallback(error);
                        }
                        SystemActions.endAction(UserConstants.SYSTEM_SETTINGS_GET);
                    }, true);
                }, function (error) {
                    if (errorCallback) {
                        errorCallback(error);
                    }
                    SystemActions.endAction(UserConstants.SYSTEM_SETTINGS_GET);
                }, true);
            }, function (error) {
                if (errorCallback) {
                    errorCallback(error);
                }
                SystemActions.endAction(UserConstants.SYSTEM_SETTINGS_GET);
            }, true);
        }
    },
    saveSystemSettings: function (systemSetting, callback, errorCallback) {
        if (!SystemStore.isActionInProgress(UserConstants.SYSTEM_SETTINGS_SAVE)) {
            SystemActions.beginAction(UserConstants.SYSTEM_SETTINGS_SAVE);
            SettingsService.saveSystemSettings(systemSetting, function () {
                if (callback !== undefined) {
                    callback();
                }
                SystemActions.endAction(UserConstants.SYSTEM_SETTINGS_SAVE);
            }, function (error) {
                if (errorCallback) {
                    errorCallback(error);
                }
                SystemActions.endAction(UserConstants.SYSTEM_SETTINGS_SAVE);
            });
        }
    }
};
module.exports = UserActions;

},{"./../constants/UserConstants":12,"./../services/SettingsService":14,"./../services/UserServices":15,"./../stores/UserStore":16,"shared.web.client":"shared.web.client"}],3:[function(require,module,exports){
"use strict";
// A ‘.tsx’ file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var React = require("react");
var Inovx = require("shared.web.client");
var UserActions = require("./../actions/UserActions");
var InovxControls = Inovx.Shared.Controls;
var ChangeUserPassword = /** @class */ (function (_super) {
    __extends(ChangeUserPassword, _super);
    function ChangeUserPassword(props, context) {
        var _this = _super.call(this, props, context) || this;
        _this._user = {};
        _this._changePassword = function () {
            var curState = _this._cloneState(_this.state);
            if (_this._validatePasswordState(curState)) {
                _this.setState(curState);
                var that = _this;
                UserActions.changePassword(_this.props.User, _this.state.newPassword, _this.props.onPasswordChanged, function (error) {
                    if (error.messageObj.propertyName) {
                        that.setState({
                            validation: {
                                invalidValue: true,
                                invalidValueMessage: error.messageObj.message,
                                invalidInput: false,
                                invalidInputMessage: ""
                            }
                        });
                    }
                });
            }
            else {
                _this.setState(curState);
            }
        };
        _this._validatePasswordState = function (state) {
            if (state.newPassword !== state.confirmPassword) {
                state.validation.invalidValueMessage = InovxLoader.t("users:form.passwordMustMatch");
                state.validation.invalidValue = true;
                return false;
            }
            else if (!state.newPassword) {
                state.validation.invalidValueMessage = Inovx.Shared.Common.CommonMessages.Validation.Required;
                state.validation.invalidValue = true;
                return false;
            }
            else {
                state.validation.invalidValue = false;
                return true;
            }
        };
        _this._onPasswordChanged = function (event) {
            var newState = _this._cloneState(_this.state);
            newState.newPassword = event.target.value;
            _this._validatePasswordState(newState);
            _this.setState(newState);
        };
        _this._onConfirmChanged = function (event) {
            var newState = _this._cloneState(_this.state);
            newState.confirmPassword = event.target.value;
            _this._validatePasswordState(newState);
            _this.setState(newState);
        };
        _this._cloneState = function (state) {
            return {
                newPassword: state.newPassword,
                confirmPassword: state.confirmPassword,
                validation: {
                    invalidInput: state.validation.invalidInput,
                    invalidValue: state.validation.invalidValue,
                    invalidInputMessage: state.validation.invalidInputMessage,
                    invalidValueMessage: state.validation.invalidValueMessage
                }
            };
        };
        _this.state = {
            validation: { invalidInput: false, invalidValue: false, invalidInputMessage: "", invalidValueMessage: "" },
            newPassword: "",
            confirmPassword: ""
        };
        return _this;
    }
    ChangeUserPassword.prototype.render = function () {
        var passwordInput = {
            className: 'form-control',
            type: 'password',
            name: 'Password'
        };
        return (React.createElement("div", { className: "panel panel-primary user-change-password" },
            React.createElement("div", { className: "panel-heading" }, InovxLoader.t('users:form.changePasswordHeader')),
            React.createElement("div", { className: "panel-body fc-margin" },
                (this.props.message != null) && React.createElement("p", null, this.props.message),
                React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("users:form.newPassword"), "*"), inputName: 'Password' },
                    React.createElement(InovxControls.ValidationInput, __assign({}, passwordInput, { id: "new-pw-input", value: this.state.newPassword, onChange: this._onPasswordChanged, validation: this.state.validation, autocomplete: "new-password" }))),
                React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("users:form.confirmPassword"), "*"), inputName: 'Password' },
                    React.createElement(InovxControls.ValidationInput, __assign({}, passwordInput, { id: "confirm-pw-input", value: this.state.confirmPassword, onChange: this._onConfirmChanged, validation: this.state.validation, autocomplete: "new-password" }))),
                React.createElement("div", { className: "btn-bar-b-sm" },
                    React.createElement("button", { id: "change-pw-ok-btn", type: "button", className: "btn btn-primary", onClick: this._changePassword }, InovxLoader.t('users:form.changePassword')),
                    React.createElement("button", { id: "change-pw-cancel-btn", type: "button", className: "btn btn-default", onClick: this.props.onCancel }, InovxLoader.t('users:form.cancel'))))));
    };
    return ChangeUserPassword;
}(React.Component));
module.exports = ChangeUserPassword;

},{"./../actions/UserActions":2,"react":"react","shared.web.client":"shared.web.client"}],4:[function(require,module,exports){
"use strict";
// A ‘.tsx’ file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var React = require("react");
var Inovx = require("shared.web.client");
var UserForm = require("./UserForm");
var UserView = require("./UserView");
var UserSettings = require("./UserSettings");
var UserStore = require("./../stores/UserStore");
var UserActions = require("./../actions/UserActions");
var UserConstants = require("./../constants/UserConstants");
var UserPermissionName = require("./../constants/UserPermissionNames");
var UserSystemPreferences = require("./UserSystemPreferences");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
var PermissionService = Inovx.Shared.Permission.PermissionService;
var PreferencesActions = Inovx.Shared.Preferences.Actions;
var PreferencesStore = Inovx.Shared.Preferences.Store;
function getActionInProgress() {
    return SystemStore.isActionInProgress(UserConstants.USER_DELETE) || SystemStore.isActionInProgress(UserConstants.SETTINGS_GET)
        || SystemStore.isActionInProgress(UserConstants.BEGIN_EDIT_USER) || SystemStore.isActionInProgress(UserConstants.BEGIN_USER_ADD);
}
function getUserState() {
    return {
        allUsers: UserStore.getAll(),
        modalVisible: UserStore.getModalVisible(),
        isActionInProgress: getActionInProgress(),
        authenticationMode: UserStore.getSettings().AuthenticationMode,
        settingsShown: UserStore.getSettingsShown()
    };
}
var UserApp = /** @class */ (function (_super) {
    __extends(UserApp, _super);
    function UserApp(props, context) {
        var _this = _super.call(this, 'users', props, context) || this;
        _this._onChange = function () {
            _this.setState(getUserState());
        };
        _this._onSystemChange = function () {
            _this.setState({
                isActionInProgress: getActionInProgress()
            });
        };
        _this._hideModal = function () {
            if (_this.state.settingsShown) {
                UserActions.hideSettings();
            }
            else {
                UserActions.finishEdit();
            }
        };
        _this._beginEditUser = function (e, user) {
            UserActions.beginEdit(user);
        };
        _this._deleteUser = function (e, user) {
            var messageObject = {
                message: InovxLoader.t('users:message.confirmDelete'),
                confirmCallback: function () {
                    UserActions.delete(user, null);
                }
            };
            SystemActions.displayConfirmationMessage(messageObject);
        };
        _this._showAddUser = function () {
            UserActions.beginAdd();
        };
        _this._showSettings = function () {
            UserActions.getSettings(true);
        };
        _this._initialize = function () {
            UserActions.getAllUsers(function () { return UserActions.getSettings(false, function () { return _this._appLoaded = true; }); }, function (error) { return _this._handlePermissionError(error); }, true);
            UserActions.getCurrentUser(function () { return _this._appLoaded = true; });
        };
        _this._createUserSystemPreferencesComponent = function (props) {
            return React.createElement(UserSystemPreferences, props);
        };
        _this._enableSystemPreferences = function () {
            var hasUserSettings = PermissionService.checkPermission(UserPermissionName.USER_SETTINGS);
            var hasEntitlementPermission = PermissionService.checkPermission(UserPermissionName.ENTITLEMENT_MANAGE);
            var hasRolePermission = PermissionService.checkPermission(UserPermissionName.ROLE_MANAGE);
            var hasUserViewPermission = PermissionService.checkPermission(UserPermissionName.USER_VIEW);
            var hasUserManagePermission = PermissionService.checkPermission(UserPermissionName.USER_MANAGE);
            if (hasUserSettings && hasRolePermission && hasEntitlementPermission && (hasUserViewPermission || hasUserManagePermission))
                PreferencesActions.registerCreateUserSystemPreferencesComponent(_this._createUserSystemPreferencesComponent);
        };
        _this.state = getUserState();
        return _this;
    }
    UserApp.prototype.componentWillMount = function () {
        this.componentWillMountBase();
    };
    UserApp.prototype.componentDidMount = function () {
        UserStore.addChangeListener(this._onChange);
        SystemStore.addChangeListener(this._onSystemChange);
        this._enableSystemPreferences();
    };
    UserApp.prototype.componentWillUnmount = function () {
        UserStore.removeChangeListener(this._onChange);
        SystemStore.removeChangeListener(this._onSystemChange);
        PreferencesActions.registerCreateUserSystemPreferencesComponent(null);
    };
    UserApp.prototype.render = function () {
        var hasUserManage = PermissionService.checkPermission(UserPermissionName.USER_MANAGE);
        var hasUserSettings = PermissionService.checkPermission(UserPermissionName.USER_SETTINGS);
        var columns = [{
                field: "Email",
                headerText: InovxLoader.t('users:common.email'),
                type: "string",
                width: "auto"
            }, {
                field: "FirstName",
                headerText: InovxLoader.t('users:common.firstname'),
                type: "string"
            }, {
                field: "LastName",
                headerText: InovxLoader.t('users:common.lastname'),
                type: "string"
            }, {
                field: "Enabled",
                headerText: InovxLoader.t('users:common.userStatus'),
                type: "boolean",
                width: "140px",
                values: [
                    { value: true, text: InovxLoader.t('users:common.enabled') },
                    { value: false, text: InovxLoader.t('users:common.disabled') }
                ]
            }];
        var commands = {
            command: [
                {
                    iconClassName: "glyphicon glyphicon-pencil",
                    className: "grid-button",
                    click: this._beginEditUser
                }
            ],
            width: "85px",
            headerText: InovxLoader.t('users:common.commands')
        };
        var manageUserCommand = {
            iconClassName: "glyphicon glyphicon-trash",
            className: "grid-button",
            click: this._deleteUser
        };
        if (hasUserManage) {
            commands.command.push(manageUserCommand);
        }
        var defaultSort = [{
                field: "Email",
                dir: "ascending"
            }];
        var btns = [];
        var iconHeaderProps = {
            iconUrl: "".concat(UrlUtilities.getBaseApplicationUrl(), "/images/Users.png"),
            iconAtt: { alt: "users" },
            title: InovxLoader.t('users:header.users'),
            rcClass: "cd-btn add-btn",
        };
        if (hasUserManage) {
            btns.push({
                onClick: this._showAddUser,
                btnUrl: "".concat(UrlUtilities.getBaseApplicationUrl(), "/images/adduser.png"),
                btnAtt: {
                    alt: InovxLoader.t("users:header.newUser"),
                    title: InovxLoader.t("users:header.newUser"),
                    id: 'userApp-addUser-btn'
                },
            });
        }
        if (hasUserSettings) {
            btns.push({
                onClick: this._showSettings,
                btnUrl: "".concat(UrlUtilities.getBaseApplicationUrl(), "/images/Authenticationsettings.png"),
                btnAtt: {
                    alt: InovxLoader.t("users:settingsForm.headerTitle"),
                    title: InovxLoader.t("users:settingsForm.headerTitle"),
                    id: 'userApp-authen-settings-btn'
                },
            });
        }
        iconHeaderProps.btnUrls = btns;
        return (React.createElement(Inovx.Shared.Core.ReactLoader, { appReady: this.isAppLoaded(), errorStatus: this._errorStatus },
            React.createElement("div", { className: "user-app-content" },
                React.createElement(Inovx.Shared.Controls.If, { condition: this.state.isActionInProgress, class: 'temp-modal-loader' },
                    React.createElement("div", { className: "action-in-progress-loader-lrg" })),
                React.createElement(Inovx.Shared.Layout.IconHeader, __assign({}, iconHeaderProps)),
                React.createElement(Inovx.Shared.Controls.Grid, { dataSource: this.state.allUsers, columns: columns, commands: commands, sort: true, filter: true, pageable: { pageCount: 5, pageSizes: [10, 20, 50], pageSize: 10 }, defaultSort: defaultSort })),
            React.createElement(Inovx.Shared.Controls.ModalSlider, { isOpen: this.state.modalVisible, onClose: this._hideModal }, this.state.settingsShown ?
                React.createElement(UserSettings, null) :
                hasUserManage ? React.createElement(UserForm, null) : React.createElement(UserView, null))));
    };
    return UserApp;
}(Inovx.Shared.ReactExt.BaseAppComponent));
module.exports = UserApp;

},{"./../actions/UserActions":2,"./../constants/UserConstants":12,"./../constants/UserPermissionNames":13,"./../stores/UserStore":16,"./UserForm":5,"./UserSettings":7,"./UserSystemPreferences":8,"./UserView":9,"react":"react","shared.web.client":"shared.web.client"}],5:[function(require,module,exports){
"use strict";
/// <reference path="changeuserpassword.tsx" />
// A ‘.tsx’ file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var React = require("react");
var UserStore = require("./../stores/UserStore");
var UserConstants = require("./../constants/UserConstants");
var UserActions = require("./../actions/UserActions");
var UserSelect = require("./../components/UserSelect");
var ChangeUserPassword = require("./../components/ChangeUserPassword");
var UserPermissionName = require("./../constants/UserPermissionNames");
var AuthenticationModeEnum = require("./../constants/AuthenticationModeEnum");
var ExternalProviderEnum = require("./../constants/ExternalProviderEnum");
var Inovx = require("shared.web.client");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
var InovxControls = Inovx.Shared.Controls;
var PermissionService = Inovx.Shared.Permission.PermissionService;
function getActionInProgress() {
    return SystemStore.isActionInProgress(UserConstants.USER_ADD) ||
        SystemStore.isActionInProgress(UserConstants.USER_EDIT) ||
        SystemStore.isActionInProgress(UserConstants.USER_CHECK_NAME);
}
var _isValidADUserID;
var _displaySelectUserState;
var _displayPasswordChange;
var _actionInProgressMsg;
var _useExternalAccount;
function getFormState() {
    var user = UserStore.getEditUser();
    return {
        editUser: user,
        isAdding: UserStore.getIsAdding(),
        isEditing: UserStore.getIsEditing(),
        displaySelectUser: _displaySelectUserState,
        displayPasswordChange: _displayPasswordChange,
        isActionInProgress: getActionInProgress(),
        actionInProgressMsg: _actionInProgressMsg,
        validation: UserStore.getValidation(UserConstants.USER_ADD_FORM),
        authenticationMode: UserStore.getSettings().AuthenticationMode,
        externalProviderName: UserStore.getSettings().ExternalProviderName,
        hasEntitlementPermission: PermissionService.checkPermission(UserPermissionName.ENTITLEMENT_MANAGE),
        hasRolePermission: PermissionService.checkPermission(UserPermissionName.ROLE_MANAGE),
        entitlement: UserStore.getValidEntitlements(),
        roles: UserStore.getValidRoles(),
        isValidADUserID: _isValidADUserID,
        useExternalAccount: _useExternalAccount
    };
}
var UserForm = /** @class */ (function (_super) {
    __extends(UserForm, _super);
    function UserForm(props) {
        var _this = _super.call(this, props) || this;
        _this._onChange = function (event) {
            UserActions.editCurrentObject(UserConstants.USER_ADD_FORM, event.target.name, event.target.value);
            if (event.target.name == "ExternalAccountUserName") {
                UserActions.editCurrentObject(UserConstants.USER_ADD_FORM, "ExternalAccountID", null);
                _isValidADUserID = false;
                _this.setState({ isValidADUserID: false });
            }
        };
        _this._onUseExternalAccountChange = function (event) {
            var value = false;
            if (event.target.checked) {
                value = true;
                _useExternalAccount = true;
            }
            else {
                UserActions.editCurrentObject(UserConstants.USER_ADD_FORM, "ExternalAccountID", "");
                UserActions.editCurrentObject(UserConstants.USER_ADD_FORM, "ExternalAccountUserName", "");
                _useExternalAccount = false;
            }
            _this.setState({ useExternalAccount: value });
        };
        _this._onRolesSelect = function (roleObj, selected) {
            _this._onSelect('RoleIDs', roleObj, selected);
        };
        _this._onEntitlementSelect = function (entitlementObj, selected) {
            _this._onSelect('EntitlementGroupIDs', entitlementObj, selected);
        };
        _this._onSelect = function (name, obj, selected) {
            if (selected) {
                UserActions.editCurrentObjectAddToList(UserConstants.USER_ADD_FORM, name, obj.ID);
            }
            else {
                UserActions.editCurrentObjectRemoveFromList(UserConstants.USER_ADD_FORM, name, obj.ID);
            }
        };
        _this._onCheckChange = function (event) {
            UserActions.editCurrentObject(UserConstants.USER_ADD_FORM, event.target.name, event.target.value === "true");
        };
        _this._loadState = function () {
            _this.setState(getFormState());
        };
        _this._systemChange = function () {
            _this.setState({
                isActionInProgress: getActionInProgress()
            });
        };
        _this._saveUser = function () {
            if (!_this.state.isValidADUserID && _this.state.authenticationMode != AuthenticationModeEnum.LocalOnly && _this.state.useExternalAccount) {
                var checkMessage = InovxLoader.t('users:message.checkAzureADUser');
                if (_this.state.externalProviderName == ExternalProviderEnum.ADFS) {
                    checkMessage = InovxLoader.t('users:message.checkAdfsUser');
                }
                var messageObject = {
                    message: checkMessage
                };
                SystemActions.displayWarningMessage(messageObject);
            }
            else {
                if (_this.state.isAdding) {
                    UserActions.create();
                }
                else {
                    UserActions.edit();
                }
                _this.setState({ actionInProgressMsg: InovxLoader.t('users:form.saving') });
            }
        };
        _this._cancel = function () {
            UserActions.finishEdit();
        };
        _this._checkName = function () {
            _this.setState({ displaySelectUser: true });
        };
        _this._closeSelectUser = function () {
            _displaySelectUserState = false;
            _this.setState({
                userHints: [],
                displaySelectUser: _displaySelectUserState
            });
        };
        _this._closeChangePassword = function () {
            _displayPasswordChange = false;
            _this.setState({
                displayPasswordChange: _displayPasswordChange
            });
        };
        _this._onChangePassword = function () {
            _displayPasswordChange = true;
            _this.setState({
                displayPasswordChange: _displayPasswordChange
            });
        };
        _this._onResetLoginAttempts = function () {
            UserActions.resetLoginAttempts(_this.state.editUser);
        };
        _this._fillUser = function (user) {
            if (user && user.UserID) {
                _displaySelectUserState = false;
                if (_this.state.isEditing) {
                    UserActions.editCurrentObject(UserConstants.USER_ADD_FORM, "ExternalAccountUserName", user.UserName);
                    UserActions.editCurrentObject(UserConstants.USER_ADD_FORM, "ExternalAccountID", user.UserID);
                }
                else {
                    UserActions.selectHint(user);
                    UserActions.editCurrentObject(UserConstants.USER_ADD_FORM, "ExternalAccountID", user.UserID);
                }
                _isValidADUserID = true;
                _this.setState({ isValidADUserID: true });
            }
        };
        _this._checkForUnsavedChanges = function (event) {
            if (UserStore.getHasChanges()) {
                event.returnValue = InovxLoader.t('common:msgBox.browserSaveChanges');
            }
            ;
        };
        _displaySelectUserState = false;
        _displayPasswordChange = false;
        _useExternalAccount = true;
        _isValidADUserID = UserStore.getIsEditing();
        _this.state = getFormState();
        return _this;
    }
    UserForm.prototype.componentDidMount = function () {
        UserStore.addChangeListener(this._loadState);
        SystemStore.addChangeListener(this._systemChange);
        window.addEventListener('beforeunload', this._checkForUnsavedChanges);
        if (this.state.isEditing) {
            if (this.state.authenticationMode == AuthenticationModeEnum.Mixed && this.state.editUser && !this.state.editUser.ExternalAccountID)
                _useExternalAccount = false;
            else if (this.state.authenticationMode == AuthenticationModeEnum.LocalOnly) {
                _useExternalAccount = false;
            }
            this.setState({ useExternalAccount: _useExternalAccount });
        }
    };
    UserForm.prototype.componentWillUnmount = function () {
        UserStore.removeChangeListener(this._loadState);
        SystemStore.removeChangeListener(this._systemChange);
        window.removeEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    UserForm.prototype.render = function () {
        var isNativeLoginMode;
        var isAzureADLoginMode;
        var isMixedMode = false;
        if (this.state.authenticationMode == AuthenticationModeEnum.Mixed) {
            isNativeLoginMode = true;
            isAzureADLoginMode = true;
            isMixedMode = true;
        }
        else if (this.state.authenticationMode == AuthenticationModeEnum.ExternalOnly) {
            isNativeLoginMode = false;
            isAzureADLoginMode = true;
        }
        else if (this.state.authenticationMode == AuthenticationModeEnum.LocalOnly) {
            isNativeLoginMode = true;
            isAzureADLoginMode = false;
        }
        var inputObj = {
            className: 'form-control',
            type: 'text'
        };
        var user = this.state.editUser;
        var passwordInput = {
            id: 'userApp-password-input',
            className: 'form-control',
            type: 'password',
            name: 'VPass',
            value: user.Password
        };
        var firstNameInput = jQuery.extend({
            id: 'userApp-firstName-input',
            name: 'FirstName',
            value: (user.FirstName != null) ? user.FirstName : ""
        }, inputObj);
        var lastNameInput = jQuery.extend({
            id: 'userApp-lastName-input',
            name: 'LastName',
            value: (user.LastName != null) ? user.LastName : ""
        }, inputObj);
        var adUserInput = jQuery.extend({
            id: 'userApp-adUserName-input',
            name: 'ExternalAccountUserName',
            value: user.ExternalAccountUserName
        }, inputObj);
        var emailInput = jQuery.extend({
            id: 'userApp-email-input',
            name: 'Email',
            value: (user.Email != null) ? user.Email : ""
        }, inputObj);
        var header = this.state.isAdding ? InovxLoader.t('users:header.newUser') : InovxLoader.t('users:header.editUser');
        var passwordSettings = InovxLoader.t('users:form.vsuitePasswordTooltip');
        var settings = UserStore.getEditSettings();
        passwordSettings = passwordSettings.concat(InovxLoader.t("users:form.pwdSettingsPart1").replace("{0}", settings.PasswordCharacters));
        passwordSettings = passwordSettings.concat(InovxLoader.t("users:form.pwdSettingsPart2").replace("{0}", settings.PasswordSymbols));
        passwordSettings = passwordSettings.concat(InovxLoader.t("users:form.pwdSettingsPart3").replace("{0}", settings.PasswordNumbers));
        var usernameLabel = InovxLoader.t("users:common.username");
        var usernameToolTip = InovxLoader.t("users:common.usernameTooltip");
        var checkboxLabel = InovxLoader.t("users:form.azureADAuthentication");
        var userExternalAccount = this.state.useExternalAccount;
        if (this.state.externalProviderName == ExternalProviderEnum.ADFS) {
            usernameLabel = InovxLoader.t("users:form.adfsUsername");
            usernameToolTip = InovxLoader.t("users:form.adfsUsernameTooltip");
            checkboxLabel = InovxLoader.t("users:form.adfsAuthentication");
        }
        else if (this.state.externalProviderName == ExternalProviderEnum.AzureAD) {
            usernameLabel = InovxLoader.t("users:form.azureUsername");
            usernameToolTip = InovxLoader.t("users:form.azureUsernameTooltip");
            checkboxLabel = InovxLoader.t("users:form.azureADAuthentication");
        }
        return (React.createElement(InovxControls.StaticHeaderForm, { title: header, saveOnClick: this._saveUser, saveBtnId: "userApp-save-btn", cancelOnClick: this._cancel, cancelBtnId: "userApp-cancel-btn", isActionInProgress: this.state.isActionInProgress, inProgressMessage: this.state.actionInProgressMsg },
            React.createElement("div", { className: 'user-form' },
                React.createElement(InovxControls.If, { condition: isAzureADLoginMode, class: 'fc-margin' },
                    isNativeLoginMode && this.state.isAdding &&
                        React.createElement("div", { className: "form-field" },
                            React.createElement("label", { className: "control-label" },
                                React.createElement("input", { type: "checkbox", onChange: this._onUseExternalAccountChange, checked: userExternalAccount }),
                                " " + checkboxLabel)),
                    userExternalAccount &&
                        React.createElement(InovxControls.FormField, { title: "".concat(usernameLabel, "*"), tooltip: usernameToolTip, inputName: 'ExternalAccountUserName' },
                            React.createElement(InovxControls.ValidationInput, __assign({}, adUserInput, { className: "form-control", onChange: this._onChange, validation: this.state.validation['ExternalAccountUserName'], readOnly: true })),
                            React.createElement("a", { id: "userApp-checkName-btn", className: "btn btn-info", onClick: this._checkName },
                                InovxLoader.t("users:form.searchDirectory"),
                                " "))),
                (this.state.isValidADUserID || (!this.state.useExternalAccount && isMixedMode) || (!isMixedMode && isNativeLoginMode)) &&
                    React.createElement("div", null,
                        React.createElement("div", { className: "row" },
                            React.createElement("div", { className: "col-md-6 field-col" },
                                React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("users:form.email"), "*"), inputName: 'Email' },
                                    React.createElement(InovxControls.ValidationInput, __assign({}, emailInput, { className: "form-control", onChange: this._onChange, validation: this.state.validation['Email'], readOnly: false, autocomplete: "email" })))),
                            isNativeLoginMode &&
                                React.createElement("div", { className: "col-md-6 field-col" },
                                    React.createElement(InovxControls.If, { condition: this.state.isEditing, class: 'form-field' },
                                        React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("users:form.vsuitePassword")), tooltip: passwordSettings, inputName: 'VPass' },
                                            React.createElement("a", { id: "userApp-password-reset-btn", className: "btn btn-info", onClick: this._onChangePassword }, InovxLoader.t("users:form.resetPassword")),
                                            React.createElement(InovxControls.If, { condition: user.PasswordExpired },
                                                React.createElement("h5", { style: { color: 'red' } }, InovxLoader.t("users:form.passwordExpired"))))),
                                    React.createElement(InovxControls.If, { condition: this.state.isAdding, class: 'form-field' },
                                        React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("users:form.vsuitePassword"), "*"), tooltip: passwordSettings, inputName: 'VPassword' },
                                            React.createElement(InovxControls.ValidationInput, __assign({}, passwordInput, { className: "form-control", onChange: this._onChange, validation: this.state.validation['Password'], readOnly: false, autocomplete: "new-password" })))))),
                        React.createElement(InovxControls.If, { condition: this.state.hasEntitlementPermission, class: 'fc-margin' },
                            React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:form.securityGroups"), inputName: 'Entitlement' },
                                React.createElement(InovxControls.MultiSelect, { displayProp: "Name", minLength: 0, onSelect: this._onEntitlementSelect, datasource: this.state.entitlement, keyProp: "ID", valueProp: "ID", values: this.state.editUser.EntitlementGroupIDs }))),
                        React.createElement(InovxControls.If, { condition: this.state.hasRolePermission, class: 'fc-margin' },
                            React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:form.roles"), inputName: 'Role' },
                                React.createElement(InovxControls.MultiSelect, { displayProp: "Name", minLength: 0, onSelect: this._onRolesSelect, datasource: this.state.roles, keyProp: "ID", valueProp: "ID", values: this.state.editUser.RoleIDs }))),
                        React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("users:form.userStatus"), ": "), inputName: '' },
                            React.createElement("label", { className: "radio-inline" },
                                React.createElement("input", { type: "radio", value: "true", name: "Enabled", onChange: this._onCheckChange, checked: user.Enabled }),
                                InovxLoader.t("users:common.enabled")),
                            React.createElement("label", { className: "radio-inline" },
                                React.createElement("input", { type: "radio", value: "false", name: "Enabled", onChange: this._onCheckChange, checked: !user.Enabled }),
                                InovxLoader.t("users:common.disabled"))),
                        React.createElement(InovxControls.GroupBox, { title: InovxLoader.t('users:form.userProfile'), class: "gb-password-complexity" },
                            React.createElement("div", { className: "row" },
                                React.createElement("div", { className: "col-md-6 field-col" },
                                    React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:common.firstname"), inputName: 'FirstName' },
                                        React.createElement(InovxControls.ValidationInput, __assign({}, firstNameInput, { className: "form-control", onChange: this._onChange, validation: this.state.validation['FirstName'], readOnly: false })))),
                                React.createElement("div", { className: "col-md-6 field-col" },
                                    React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:common.lastname"), inputName: 'LastName' },
                                        React.createElement(InovxControls.ValidationInput, __assign({}, lastNameInput, { className: "form-control", onChange: this._onChange, validation: this.state.validation['LastName'], readOnly: false })))))),
                        React.createElement(InovxControls.If, { condition: this.state.editUser.MaxLoginAttempts, class: 'fc-margin' },
                            React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("users:form.resetLoginAttempts"), ": "), inputName: '' },
                                React.createElement("a", { className: "btn btn-info", onClick: this._onResetLoginAttempts }, InovxLoader.t("users:form.resetLoginAttemptsBtn"))))),
                React.createElement(InovxControls.ModalPopUp, { isOpen: this.state.displaySelectUser },
                    React.createElement(UserSelect, { onSelect: this._fillUser, onCancel: this._closeSelectUser })),
                React.createElement(InovxControls.ModalPopUp, { isOpen: this.state.displayPasswordChange },
                    React.createElement(ChangeUserPassword, { User: this.state.editUser, onPasswordChanged: this._closeChangePassword, onCancel: this._closeChangePassword })))));
    };
    return UserForm;
}(React.Component));
module.exports = UserForm;

},{"./../actions/UserActions":2,"./../components/ChangeUserPassword":3,"./../components/UserSelect":6,"./../constants/AuthenticationModeEnum":10,"./../constants/ExternalProviderEnum":11,"./../constants/UserConstants":12,"./../constants/UserPermissionNames":13,"./../stores/UserStore":16,"react":"react","shared.web.client":"shared.web.client"}],6:[function(require,module,exports){
"use strict";
// A ‘.tsx’ file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var React = require("react");
var Inovx = require("shared.web.client");
var UserStore = require("./../stores/UserStore");
var UserActions = require("./../actions/UserActions");
var UserConstants = require("./../constants/UserConstants");
var InovxControls = Inovx.Shared.Controls;
var CommonMessages = Inovx.Shared.Common.CommonMessages;
function getBlankValidation() {
    return { invalidInput: false, invalidValue: false, invalidInputMessage: "", invalidValueMessage: "" };
}
function getState() {
    return {
        validation: {
            "SearchString": getBlankValidation()
        },
        Users: [],
        searchString: "",
        selectedUser: null,
        showValidationWarning: false
    };
}
var UserSelect = /** @class */ (function (_super) {
    __extends(UserSelect, _super);
    function UserSelect(props, context) {
        var _this = _super.call(this, props, context) || this;
        _this._onRowSelect = function (e, user) {
            _this.setState(function (state) { return ({
                selectedUser: user,
                showValidationWarning: (state.showValidationWarning && user) ? false : state.showValidationWarning
            }); });
        };
        _this._onOKClick = function () {
            if (_this.state.selectedUser) {
                _this.props.onSelect(_this.state.selectedUser);
            }
            else {
                _this.setState({
                    showValidationWarning: true
                });
            }
        };
        _this._onSearch = function () {
            if (_this.state.searchString && !_this.state.validation["SearchString"].invalidValue) {
                UserActions.getHint(_this.state.searchString, function () {
                    var users = UserStore.checkUser();
                    _this.setState({ Users: users });
                });
            }
        };
        _this._onSearchChange = function (event) {
            _this.setState({ searchString: event.target.value });
            _this.setState(function (state) {
                _this._validateSearchString(state);
                return state;
            });
        };
        _this._validateSearchString = function (state) {
            if (!state.searchString) {
                state.validation["SearchString"].invalidValueMessage = CommonMessages.Validation.Required;
                state.validation["SearchString"].invalidValue = true;
                return false;
            }
            else {
                if (state.searchString.length < 3) {
                    state.validation["SearchString"].invalidValueMessage = InovxLoader.t('users:form.searchStringTooShort');
                    state.validation["SearchString"].invalidValue = true;
                    return false;
                }
                else {
                    state.validation["SearchString"].invalidValue = false;
                    return true;
                }
            }
        };
        _this.state = getState();
        return _this;
    }
    UserSelect.prototype.render = function () {
        var pagesize = 7;
        var columns = [{
                field: "UserName",
                headerText: InovxLoader.t('users:common.username')
            }, {
                field: "FirstName",
                headerText: InovxLoader.t('users:common.firstname')
            }, {
                field: "LastName",
                headerText: InovxLoader.t('users:common.lastname')
            }];
        var dataSource = this.state.Users;
        var defaultSort = [{
                field: "UserName",
                dir: "ascending"
            }];
        var searchInput = {
            className: 'form-control',
            type: 'text',
            name: 'SearchString'
        };
        return (React.createElement("div", { className: "panel panel-primary user-select" },
            React.createElement("div", { className: "panel-heading" }, InovxLoader.t('users:form.selectAccount')),
            React.createElement("div", { className: "panel-body" },
                React.createElement("div", { className: 'user-form' },
                    React.createElement(Inovx.Shared.Controls.ActionInProgressLoader, { actionKey: [UserConstants.USER_CHECK_NAME], class: 'temp-modal-loader' },
                        React.createElement("div", { className: "action-in-progress-loader-sm" })),
                    React.createElement(InovxControls.FormField, { title: "", tooltip: "", inputName: 'SearchString' },
                        React.createElement(InovxControls.ValidationInput, __assign({}, searchInput, { value: this.state.searchString, className: "form-control", onChange: this._onSearchChange, validation: this.state.validation["SearchString"], readOnly: false, autofocus: true })),
                        React.createElement("button", { id: "User_Search_btn", onClick: this._onSearch, className: 'glyphicon glyphicon-search user-search-button' })),
                    React.createElement(Inovx.Shared.Controls.Grid, { dataSource: dataSource, selectRow: this._onRowSelect, reset: true, defaultSort: defaultSort, columns: columns, sort: true, filter: false, scrollHeight: 31 * pagesize, allowScrolling: true, autoSelectSingleRow: true }),
                    React.createElement("div", { className: "text-danger", style: { paddingTop: "10px", display: (this.state.showValidationWarning) ? "" : "none" } }, InovxLoader.t('users:form.selectAccountWarning')),
                    React.createElement("div", { className: "btn-bar-b-sm" },
                        React.createElement("button", { type: "button", className: "btn btn-primary", onClick: this._onOKClick }, InovxLoader.t('users:form.ok')),
                        React.createElement("button", { type: "button", className: "btn btn-default", onClick: this.props.onCancel }, InovxLoader.t('users:form.cancel')))))));
    };
    return UserSelect;
}(React.Component));
module.exports = UserSelect;

},{"./../actions/UserActions":2,"./../constants/UserConstants":12,"./../stores/UserStore":16,"react":"react","shared.web.client":"shared.web.client"}],7:[function(require,module,exports){
"use strict";
// A ‘.tsx’ file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var React = require("react");
var UserStore = require("./../stores/UserStore");
var UserConstants = require("./../constants/UserConstants");
var UserActions = require("./../actions/UserActions");
var ChangeUserPassword = require("./../components/ChangeUserPassword");
var Inovx = require("shared.web.client");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
var InovxControls = Inovx.Shared.Controls;
function getActionInProgress() {
    return SystemStore.isActionInProgress(UserConstants.SETTINGS_SAVE);
}
var _actionInProgressMsg;
function getFormState() {
    return {
        isActionInProgress: getActionInProgress(),
        actionInProgressMsg: _actionInProgressMsg,
        validation: UserStore.getValidation(UserConstants.USER_SETTINGS_FORM),
        settings: UserStore.getEditSettings(),
        displayPasswordChange: false,
        currentUserHasPassword: false,
        currentUser: UserStore.getCurrentUser()
    };
}
var UserSettings = /** @class */ (function (_super) {
    __extends(UserSettings, _super);
    function UserSettings(props) {
        var _this = _super.call(this, props) || this;
        _this._passwordComplexityChanged = false;
        _this._displayPasswordChange = false;
        _this._onChange = function (event) {
            UserActions.editCurrentObject(UserConstants.USER_SETTINGS_FORM, event.target.name, event.target.value);
        };
        _this._onPasswordComplexityChange = function (event) {
            _this._passwordComplexityChanged = true;
            UserActions.editCurrentObject(UserConstants.USER_SETTINGS_FORM, event.target.name, event.target.value);
        };
        _this._onCheckChange = function (event) {
            UserActions.editCurrentObject(UserConstants.USER_SETTINGS_FORM, event.target.name, event.target.value === "true");
        };
        _this._loadState = function () {
            _this.setState(getFormState());
        };
        _this._systemChange = function () {
            _this.setState({
                isActionInProgress: getActionInProgress()
            });
        };
        _this._saveChangePassword = function () {
            _this.setState({
                displayPasswordChange: false
            });
            _this._save();
        };
        _this._cancelChangePassword = function () {
            _this.setState({
                displayPasswordChange: false
            });
        };
        _this._saveSettings = function () {
            UserActions.saveSettings(function (error) {
                _this.setState({
                    displayPasswordChange: true,
                });
            }, true);
            _this.setState({ actionInProgressMsg: InovxLoader.t('users:form.saving') });
        };
        _this._save = function () {
            var that = _this;
            if (UserStore.getIsValidObject(UserConstants.USER_SETTINGS_FORM)) {
                if (that._passwordComplexityChanged) {
                    SystemActions.displayYesNoMessage({
                        confirmCallback: function () {
                            UserActions.resetPasswords();
                            that._saveSettings();
                        },
                        cancelCallback: function () {
                            that._saveSettings();
                        },
                        message: InovxLoader.t('users:settingsForm.resetPasswords')
                    });
                    that._passwordComplexityChanged = false;
                }
                else {
                    that._saveSettings();
                }
            }
            else {
                _this.setState({});
            }
        };
        _this._cancel = function () {
            UserActions.hideSettings();
        };
        _this._isEmptyOrNull = function (value) {
            return !value || value.length <= 0;
        };
        _this._checkForUnsavedChanges = function (event) {
            if (UserStore.getHasChanges()) {
                event.returnValue = InovxLoader.t('common:msgBox.browserSaveChanges');
            }
        };
        _this.state = getFormState();
        return _this;
    }
    UserSettings.prototype.componentDidMount = function () {
        UserStore.addChangeListener(this._loadState);
        SystemStore.addChangeListener(this._systemChange);
        window.addEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    UserSettings.prototype.componentWillUnmount = function () {
        UserStore.removeChangeListener(this._loadState);
        SystemStore.removeChangeListener(this._systemChange);
        window.removeEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    UserSettings.prototype.render = function () {
        var inputObj = {
            className: 'form-control',
            type: 'text'
        };
        var settings = this.state.settings;
        var passwordMinCharacters = jQuery.extend({
            name: 'PasswordCharacters',
            value: settings.PasswordCharacters.toString()
        }, inputObj);
        var requiredSymbols = jQuery.extend({
            name: 'PasswordSymbols',
            value: settings.PasswordSymbols.toString()
        }, inputObj);
        var requireNumbers = jQuery.extend({
            name: 'PasswordNumbers',
            value: settings.PasswordNumbers.toString()
        }, inputObj);
        var passwordExpiration = jQuery.extend({
            name: 'PasswordExpiration',
            value: settings.PasswordExpiration.toString()
        }, inputObj);
        var failedAttempts = jQuery.extend({
            name: 'AllowedAttempts',
            value: settings.AllowedAttempts.toString()
        }, inputObj);
        return (React.createElement(InovxControls.StaticHeaderForm, { title: InovxLoader.t('users:settingsForm.headerTitle'), saveOnClick: this._save, cancelOnClick: this._cancel, isActionInProgress: this.state.isActionInProgress, inProgressMessage: this.state.actionInProgressMsg },
            React.createElement("div", { className: 'user-form' },
                true ? null :
                    React.createElement(InovxControls.GroupBox, { title: InovxLoader.t('users:settingsForm.rememberMe'), class: "gb-remember-me" },
                        React.createElement("div", { className: "form-field" },
                            React.createElement("div", { className: "fr-margin" },
                                React.createElement("label", { className: "radio-inline" },
                                    React.createElement("input", { type: "radio", value: "true", name: "RememberMe", onChange: this._onCheckChange, checked: settings.RememberMe }),
                                    InovxLoader.t("users:settingsForm.enabled")),
                                React.createElement("label", { className: "radio-inline" },
                                    React.createElement("input", { type: "radio", value: "false", name: "RememberMe", onChange: this._onCheckChange, checked: !settings.RememberMe }),
                                    InovxLoader.t("users:settingsForm.disabled"))))),
                React.createElement(InovxControls.GroupBox, { title: InovxLoader.t('users:settingsForm.passwordSettings'), class: "gb-password-settings" },
                    React.createElement("div", { className: "form-field" },
                        React.createElement("div", { className: "fr-margin" },
                            React.createElement("label", { className: "radio-inline" },
                                React.createElement("input", { type: "radio", value: "false", name: "PasswordExpires", onChange: this._onCheckChange, checked: !settings.PasswordExpires }),
                                InovxLoader.t("users:settingsForm.passwordNotExpires")),
                            React.createElement("label", { className: "radio-inline" },
                                React.createElement("input", { type: "radio", value: "true", name: "PasswordExpires", onChange: this._onCheckChange, checked: settings.PasswordExpires }),
                                InovxLoader.t("users:settingsForm.passwordExpires")))),
                    React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:settingsForm.passwordExpiration"), tooltip: InovxLoader.t("users:settingsForm.passwordExpirationToolTip"), inputName: 'PasswordExpiration' },
                        React.createElement(InovxControls.ValidationInput, __assign({}, passwordExpiration, { className: "form-control", onChange: this._onChange, validation: this.state.validation['PasswordExpiration'], readOnly: !settings.PasswordExpires }))),
                    React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:settingsForm.failedAttempts"), tooltip: InovxLoader.t("users:settingsForm.failedAttemptsToolTip"), inputName: 'AllowedAttempts' },
                        React.createElement(InovxControls.ValidationInput, __assign({}, failedAttempts, { className: "form-control", onChange: this._onChange, validation: this.state.validation['AllowedAttempts'] })))),
                React.createElement(InovxControls.GroupBox, { title: InovxLoader.t('users:settingsForm.passwordComplexityTitle'), class: "gb-password-complexity" },
                    React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:settingsForm.passwordMinCharacters"), tooltip: InovxLoader.t("users:settingsForm.passwordMinCharactersToolTip"), inputName: 'MinCharacters' },
                        React.createElement(InovxControls.ValidationInput, __assign({}, passwordMinCharacters, { className: "form-control", onChange: this._onPasswordComplexityChange, validation: this.state.validation['PasswordCharacters'] }))),
                    React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:settingsForm.requiredSymbols"), tooltip: InovxLoader.t("users:settingsForm.requiredSymbolsToolTip"), inputName: 'RequiredSymbols' },
                        React.createElement(InovxControls.ValidationInput, __assign({}, requiredSymbols, { className: "form-control", onChange: this._onPasswordComplexityChange, validation: this.state.validation['PasswordSymbols'] }))),
                    React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:settingsForm.requireNumbers"), tooltip: InovxLoader.t("users:settingsForm.requireNumbersToolTip"), inputName: 'UserName' },
                        React.createElement(InovxControls.ValidationInput, __assign({}, requireNumbers, { className: "form-control", onChange: this._onPasswordComplexityChange, validation: this.state.validation['PasswordNumbers'] })))),
                React.createElement(InovxControls.ModalPopUp, { isOpen: this.state.displayPasswordChange },
                    React.createElement(ChangeUserPassword, { User: this.state.currentUser, onPasswordChanged: this._saveChangePassword, onCancel: this._cancelChangePassword, message: InovxLoader.t('users:settingsForm.setPasswordInfo') })))));
    };
    return UserSettings;
}(React.Component));
module.exports = UserSettings;

},{"./../actions/UserActions":2,"./../components/ChangeUserPassword":3,"./../constants/UserConstants":12,"./../stores/UserStore":16,"react":"react","shared.web.client":"shared.web.client"}],8:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var React = require("react");
var Inovx = require("shared.web.client");
var InovxControls = Inovx.Shared.Controls;
var SystemActions = Inovx.Shared.System.Actions;
var UserActions = require("./../actions/UserActions");
var UserConstants = require("./../constants/UserConstants");
var SystemStore = Inovx.Shared.System.Store;
function getDefaultState() {
    return {
        isActionInProgress: false,
        dirty: false,
        entitlement: [],
        roles: [],
        preferences: {
            DefaultSytemSetting: {
                DefaultGroupIDs: [],
                DefaultRoleIDs: []
            },
            AllGroups: [],
            AllRoles: []
        }
    };
}
function getActionInProgress() {
    return SystemStore.isActionInProgress(UserConstants.SYSTEM_SETTINGS_GET);
}
var UserSystemPreferences = /** @class */ (function (_super) {
    __extends(UserSystemPreferences, _super);
    function UserSystemPreferences(props, context) {
        var _this = _super.call(this, "System Preferences", props, context) || this;
        _this._onSave = function (e) {
            if (e && e.stopPropagation)
                e.stopPropagation();
            _this._save();
        };
        _this._save = function () {
            var data = _this.state.preferences.DefaultSytemSetting;
            UserActions.saveSystemSettings(data, function () {
                _this.props.onClose();
            }, null);
        };
        _this._onCancel = function (e) {
            if (_this.state.dirty) {
                SystemActions.displaySaveChangesDialog({
                    message: InovxLoader.t("common:msgBox.saveChanges"),
                    confirmCallback: function () {
                        _this._save();
                    },
                    cancelCallback: function () {
                        _this.props.onClose();
                    }
                });
            }
            else {
                _this.props.onClose();
            }
        };
        _this._onReset = function (e) {
            _this.setState({
                dirty: true,
                preferences: {
                    DefaultSytemSetting: {
                        DefaultGroupIDs: _this._preferences.DefaultSytemSetting.DefaultGroupIDs.slice(0),
                        DefaultRoleIDs: _this._preferences.DefaultSytemSetting.DefaultRoleIDs.slice(0)
                    },
                    AllGroups: _this._preferences.AllGroups.slice(0),
                    AllRoles: _this._preferences.AllRoles.slice(0)
                }
            });
        };
        _this._checkForUnsavedChangesWindow = function (e) {
            if (_this.state.dirty) {
                e.returnValue = InovxLoader.t('users:message.unsavedPreferences');
            }
        };
        _this._onRolesSelect = function (roleObj, selected) {
            _this._onSelect('RoleIDs', roleObj, selected);
        };
        _this._onEntitlementSelect = function (entitlementObj, selected) {
            _this._onSelect('EntitlementGroupIDs', entitlementObj, selected);
        };
        _this._onSelect = function (name, obj, selected) {
            if (selected) {
                //Add
                if (name === "EntitlementGroupIDs") {
                    _this.state.preferences.DefaultSytemSetting.DefaultGroupIDs.push(obj.ID);
                }
                else {
                    _this.state.preferences.DefaultSytemSetting.DefaultRoleIDs.push(obj.ID);
                }
            }
            else {
                //Remove
                if (name === "EntitlementGroupIDs") {
                    var index = _this.state.preferences.DefaultSytemSetting.DefaultGroupIDs.indexOf(obj.ID);
                    if (index > -1)
                        _this.state.preferences.DefaultSytemSetting.DefaultGroupIDs.splice(index, 1);
                }
                else {
                    var index = _this.state.preferences.DefaultSytemSetting.DefaultRoleIDs.indexOf(obj.ID);
                    if (index > -1)
                        _this.state.preferences.DefaultSytemSetting.DefaultRoleIDs.splice(index, 1);
                }
            }
            _this.setState({
                dirty: true
            });
        };
        _this._onSystemChange = function () {
            _this.setState({
                isActionInProgress: getActionInProgress()
            });
        };
        _this.state = getDefaultState();
        _this._initialize = _this._initialize.bind(_this);
        return _this;
    }
    UserSystemPreferences.prototype._initialize = function () {
        var _this = this;
        UserActions.getUserSystemPreferences(function (preferences) {
            _this._appLoaded = true;
            _this.setState({
                dirty: false,
                preferences: preferences
            });
            _this._preferences = {
                DefaultSytemSetting: {
                    DefaultGroupIDs: preferences.AllGroups.filter(function (item) { return item.Name == "User"; }).map(function (item) { return item.ID; }),
                    DefaultRoleIDs: []
                },
                AllGroups: preferences.AllGroups.slice(0),
                AllRoles: preferences.AllRoles.slice(0)
            };
        }, null);
    };
    UserSystemPreferences.prototype.componentWillMount = function () {
        this.componentWillMountBase();
        SystemStore.addChangeListener(this._onSystemChange);
    };
    UserSystemPreferences.prototype.componentWillUnmount = function () {
        window.removeEventListener('beforeunload', this._checkForUnsavedChangesWindow);
        SystemStore.addChangeListener(this._onSystemChange);
    };
    UserSystemPreferences.prototype.componentDidMount = function () {
        window.addEventListener('beforeunload', this._checkForUnsavedChangesWindow);
    };
    UserSystemPreferences.prototype.render = function () {
        return (React.createElement(Inovx.Shared.Core.ReactLoader, { appReady: this.isAppLoaded(), errorStatus: this._errorStatus },
            React.createElement("div", { className: "user-preferences-popup no-print", id: "user-preferences-popup" },
                React.createElement(Inovx.Shared.Controls.If, { condition: this.state.isActionInProgress, class: 'temp-modal-loader' },
                    React.createElement("div", { className: "action-in-progress-loader-lrg" })),
                React.createElement("div", { className: "panel panel-primary user-preferences-app-content" },
                    React.createElement("div", { className: "panel-heading" },
                        InovxLoader.t("users:preferences.title"),
                        React.createElement("a", { href: "#", onClick: this._onCancel },
                            React.createElement("span", { className: "pull-right glyphicon glyphicon glyphicon-remove" }))),
                    React.createElement("div", { className: "panel-body" },
                        React.createElement("div", { className: "user-form" },
                            React.createElement(InovxControls.If, { condition: true, class: 'fc-margin' },
                                React.createElement(InovxControls.GroupBox, { title: InovxLoader.t('users:preferences.entitlement'), class: "gb-user-entitlement" },
                                    React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:common.entitlement"), inputName: 'Entitlement' },
                                        React.createElement(InovxControls.MultiSelect, { displayProp: "Name", minLength: 0, onSelect: this._onEntitlementSelect, datasource: this.state.preferences.AllGroups, keyProp: "ID", valueProp: "ID", values: this.state.preferences.DefaultSytemSetting.DefaultGroupIDs })))),
                            React.createElement(InovxControls.If, { condition: true, class: 'fc-margin' },
                                React.createElement(InovxControls.GroupBox, { title: InovxLoader.t('users:preferences.roles'), class: "gb-user-roles" },
                                    React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:common.roles"), inputName: 'Role' },
                                        React.createElement(InovxControls.MultiSelect, { displayProp: "Name", minLength: 0, onSelect: this._onRolesSelect, datasource: this.state.preferences.AllRoles, keyProp: "ID", valueProp: "ID", values: this.state.preferences.DefaultSytemSetting.DefaultRoleIDs })))))),
                    React.createElement("div", { className: "panel-footer clearfix" },
                        React.createElement("div", { className: "row" },
                            React.createElement("div", { className: "pull-left" },
                                React.createElement("button", { type: "button", id: "preferences.btn.reset", className: "btn btn-info btn-left", onClick: this._onReset }, InovxLoader.t("users:preferences.resetButton"))),
                            React.createElement("div", { className: "pull-right" },
                                React.createElement("button", { type: "button", id: "preferences.btn.save", className: "btn btn-primary btn-space", onClick: this._onSave }, InovxLoader.t("users:preferences.saveButton")),
                                React.createElement("button", { type: "button", id: "preferences.btn.cancel", className: "btn btn-primary btn-right", onClick: this._onCancel }, InovxLoader.t("users:preferences.cancelButton")))))))));
    };
    return UserSystemPreferences;
}(Inovx.Shared.ReactExt.BaseAppComponent));
module.exports = UserSystemPreferences;

},{"./../actions/UserActions":2,"./../constants/UserConstants":12,"react":"react","shared.web.client":"shared.web.client"}],9:[function(require,module,exports){
"use strict";
// A '.tsx' file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var React = require("react");
var UserStore = require("./../stores/UserStore");
var Inovx = require("shared.web.client");
var InovxControls = Inovx.Shared.Controls;
var UserView = /** @class */ (function (_super) {
    __extends(UserView, _super);
    function UserView(props) {
        var _this = _super.call(this, props) || this;
        _this.state = {
            user: UserStore.getEditUser()
        };
        return _this;
    }
    UserView.prototype.render = function () {
        return (React.createElement(InovxControls.StaticHeaderForm, { title: InovxLoader.t("users:form.viewUser") },
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:common.username"), inputName: '' },
                React.createElement("span", { className: "user-field-viewonly" }, this.state.user.UserName)),
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:common.firstname"), inputName: 'FirstName' },
                React.createElement("span", { className: "user-field-viewonly" }, this.state.user.FirstName)),
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:common.lastname"), inputName: 'LastName' },
                React.createElement("span", { className: "user-field-viewonly" }, this.state.user.LastName)),
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("users:form.userStatus"), inputName: '' },
                React.createElement("span", { className: "user-field-viewonly" }, this.state.user.Enabled ? InovxLoader.t("users:common.enabled") : InovxLoader.t("users:common.disabled")))));
    };
    return UserView;
}(React.Component));
module.exports = UserView;

},{"./../stores/UserStore":16,"react":"react","shared.web.client":"shared.web.client"}],10:[function(require,module,exports){
"use strict";
var AuthenticationModeEnum;
(function (AuthenticationModeEnum) {
    AuthenticationModeEnum["LocalOnly"] = "LocalOnly";
    AuthenticationModeEnum["ExternalOnly"] = "ExternalOnly";
    AuthenticationModeEnum["Mixed"] = "Mixed";
})(AuthenticationModeEnum || (AuthenticationModeEnum = {}));
;
module.exports = AuthenticationModeEnum;

},{}],11:[function(require,module,exports){
"use strict";
var ExternalProviderEnum;
(function (ExternalProviderEnum) {
    ExternalProviderEnum["AzureAD"] = "aad";
    ExternalProviderEnum["ADFS"] = "adfs";
})(ExternalProviderEnum || (ExternalProviderEnum = {}));
;
module.exports = ExternalProviderEnum;

},{}],12:[function(require,module,exports){
"use strict";
var keymirror = require("fbjs/lib/keymirror");
var UserConstants = keymirror({
    USER_ADD_FORM: null,
    USER_SETTINGS_FORM: null,
    USER_FORM_INVALID_SAVE: null,
    USER_VALIDATION_ERROR: null,
    USER_ADD: null,
    USER_DELETE: null,
    USER_EDIT: null,
    USER_CHANGE_PASSWORD: null,
    USER_CHANGE_PASSWORD_SUCCESS: null,
    BEGIN_EDIT_USER: null,
    BEGIN_USER_ADD: null,
    FINISH_EDIT: null,
    UPDATE_MODAL_VISIBLE: null,
    USER_RECIEVE_DATA: null,
    USER_CHECK_NAME: null,
    USER_RECIEVE_HINT: null,
    USER_GET_ALL: null,
    USER_UPDATE_OBJECT: null,
    USER_UPDATE_OBJECT_ADD_LIST: null,
    USER_UPDATE_OBJECT_REMOVE_LIST: null,
    USER_SELECT_HINT: null,
    USER_CURRENT_GET: null,
    USER_CURRENT_RECIEVE: null,
    RESET_LOGIN_ATTEMPTS: null,
    SHOW_SETTINGS_MENU: null,
    HIDE_SETTINGS_MENU: null,
    SETTINGS_SAVE: null,
    SETTINGS_GET: null,
    SYSTEM_SETTING_GET: null,
    SYSTEM_SETTING_SAVE: null
});
module.exports = UserConstants;

},{"fbjs/lib/keymirror":"fbjs/lib/keymirror"}],13:[function(require,module,exports){
"use strict";
var UserPermissionNames = {
    USER_VIEW: "User.View",
    USER_MANAGE: "User.Manage",
    USER_SETTINGS: "User.Settings",
    ROLE_MANAGE: "Role.Manage",
    ENTITLEMENT_MANAGE: "Entitlement.Manage"
};
module.exports = UserPermissionNames;

},{}],14:[function(require,module,exports){
"use strict";
var Inovx = require("shared.web.client");
var assign = require("object-assign");
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
var url = "".concat(UrlUtilities.getApiUrl(), "/UserApi/api/settings");
var SettingsService = assign({}, Inovx.Shared.Flux.BaseService, {
    getSettings: function (successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.get("".concat(url, "/Authentication"), null, function (retData) {
            successCallback(retData);
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    saveSettings: function (settings, successCallback, errorCallback, ignoreVSuiteLoginError) {
        var _this = this;
        this.post("".concat(url, "/Authentication"), settings, function (data) {
            successCallback();
        }, function (error) {
            var errJson = JSON.parse(error.responseText);
            if (ignoreVSuiteLoginError) {
                if (errJson.Reason != "CurrentUserPasswordNotSet") {
                    _this.handleWebApiError(error);
                }
            }
            else {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    getSystemSettings: function (successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.get("".concat(url, "/System"), null, function (retData) {
            successCallback(retData);
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    saveSystemSettings: function (settings, successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.post("".concat(url, "/System"), settings, function (data) {
            successCallback();
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    }
});
module.exports = SettingsService;

},{"object-assign":18,"shared.web.client":"shared.web.client"}],15:[function(require,module,exports){
"use strict";
var Inovx = require("shared.web.client");
var assign = require("object-assign");
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
var url = "".concat(UrlUtilities.getApiUrl(), "/UserApi/api/user");
var UserServices = assign({}, Inovx.Shared.Flux.BaseService, {
    getAll: function (successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.get(url, null, function (retData) {
            successCallback(retData);
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    createUser: function (user, successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.post("".concat(url, "/Create"), user, function (data) {
            successCallback();
        }, function (error) {
            if (!ignoreDefaultError(error)) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    deleteUser: function (user, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/Delete"), { id: user.UserID, versionToken: user.UserVersionToken }, function (data) {
            successCallback();
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    editUser: function (user, successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.post("".concat(url, "/Update"), user, function (data) {
            successCallback();
        }, function (error) {
            if (!ignoreDefaultError(error)) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    getDetail: function (userId, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/GetDetails"), { UserId: userId }, function (data) {
            successCallback(data);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    getCurrentUserDetail: function (successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.get("".concat(url, "/GetCurrentUserDetails"), null, function (data) {
            successCallback(data);
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    changePassword: function (user, password, successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.post("".concat(url, "/ChangePassword"), { UserId: user.UserID, UserVersionToken: user.UserVersionToken, Password: password }, function (data) {
            successCallback(data);
        }, function (error) {
            if (!ignoreDefaultError(error)) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    resetPasswords: function (successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.post("".concat(url, "/InvalidatePasswords"), null, function (data) {
            successCallback();
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    checkName: function (hint, successCallback, errorCallback) {
        var _this = this;
        this.get("".concat(url, "/QueryDirectory"), { nameHint: hint }, function (data) {
            successCallback(data);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    resetLoginAttempts: function (user, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/ResetLoginAttempts"), { id: user.UserID }, function (data) {
            successCallback();
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    getEntitlements: function (successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.get("".concat(url, "/EntitlementGroups"), null, function (data) {
            successCallback(data);
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    getRoles: function (successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.get("".concat(url, "/Roles"), null, function (data) {
            successCallback(data);
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    }
});
module.exports = UserServices;

},{"object-assign":18,"shared.web.client":"shared.web.client"}],16:[function(require,module,exports){
"use strict";
// A ‘.tsx’ file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var NodeEvents = require("events");
var Inovx = require("shared.web.client");
var UserConstants = require("./../constants/UserConstants");
var assign = require("object-assign");
var AuthenticationModeEnum = require("./../constants/AuthenticationModeEnum");
var EventEmitter = NodeEvents.EventEmitter;
var CommonMessages = Inovx.Shared.Common.CommonMessages;
var CHANGE_EVENT = 'user.change';
var _users = [], _hints = [], _editUser = getBlankUser(), _currentUser = null, _settings = getBlankUserAppSetting(), _editSettings = getBlankUserAppSetting(), _beginAdd = false, _beginEdit = false, _changesMade = false, _modalVisible = false, _settingsShown = false, _validation = {}, _entitlements = [], _roles = [];
function loadUserData(data) {
    _users = data;
}
function loadHints(data) {
    _hints = data;
}
function loadCurrentUser(data) {
    _currentUser = data;
}
function showUserSettings(show) {
    _settingsShown = _modalVisible = show;
    _changesMade = false;
    _initalizeValidation(UserConstants.USER_SETTINGS_FORM);
}
function setAddingUser() {
    _beginAdd = _modalVisible = true;
    _beginEdit = false;
    _changesMade = false;
    _editUser = getBlankUser();
    _initalizeValidation(UserConstants.USER_ADD_FORM);
}
function setEditingUser(user) {
    _modalVisible = _beginEdit = true;
    _beginAdd = false;
    _changesMade = false;
    _editUser = user;
    _initalizeValidation(UserConstants.USER_ADD_FORM);
}
function _updateObjectListProp(comp, key, value, add) {
    switch (comp) {
        case UserConstants.USER_ADD_FORM:
            _updateUserListChanges(key, value, add);
            _changesMade = true;
            break;
    }
}
function _updateUserListChanges(name, value, add) {
    switch (name) {
        default:
            if (Array.isArray(_editUser[name])) {
                if (add) {
                    _editUser[name].push(value);
                }
                else {
                    var indx = _editUser[name].indexOf(value);
                    if (indx > -1) {
                        _editUser[name].splice(indx, 1);
                    }
                }
            }
            _setValidValidation(UserConstants.USER_ADD_FORM, name);
            break;
    }
}
function _updateObject(comp, key, value, fromUI) {
    if (fromUI === void 0) { fromUI = true; }
    switch (comp) {
        case UserConstants.USER_ADD_FORM:
            _updateUserChanges(key, value, fromUI);
            _changesMade = true;
            break;
        case UserConstants.USER_SETTINGS_FORM:
            _updateSettingChanges(key, value);
            _changesMade = true;
            break;
    }
}
function _updateUserChanges(name, value, fromUI) {
    var isNativeLoginMode = true;
    var isAzureADLoginMode = true;
    if (_settings) {
        if (_settings.AuthenticationMode == AuthenticationModeEnum.Mixed) {
            isNativeLoginMode = true;
            isAzureADLoginMode = true;
        }
        else if (_settings.AuthenticationMode == AuthenticationModeEnum.ExternalOnly) {
            isNativeLoginMode = false;
            isAzureADLoginMode = true;
        }
        else if (_settings.AuthenticationMode == AuthenticationModeEnum.LocalOnly) {
            isNativeLoginMode = true;
            isAzureADLoginMode = false;
        }
    }
    switch (name) {
        case "Email":
            var Email = "Email";
            _editUser[Email] = value;
            if (value) {
                var re = /\S+@\S+\.\S+/;
                if (!re.test(value)) {
                    _validation[UserConstants.USER_ADD_FORM][Email].invalidValueMessage = InovxLoader.t("users:form.invalidEmail");
                    _validation[UserConstants.USER_ADD_FORM][Email].invalidValue = true;
                }
                else if (_users.filter(function (user) { return user.Email && user.Email.toLowerCase() === value.toLowerCase() && user.UserID !== _editUser.UserID; }).length > 0) {
                    _validation[UserConstants.USER_ADD_FORM][Email].invalidValueMessage = InovxLoader.t("users:form.duplicateEmail");
                    _validation[UserConstants.USER_ADD_FORM][Email].invalidValue = true;
                }
                else {
                    _setValidValidation(UserConstants.USER_ADD_FORM, Email);
                }
            }
            else {
                _validation[UserConstants.USER_ADD_FORM][Email].invalidValueMessage = CommonMessages.Validation.Required;
                _validation[UserConstants.USER_ADD_FORM][Email].invalidValue = true;
            }
            break;
        case "Password":
        case "VPass":
            var VPass = "Password";
            _editUser[VPass] = value;
            if (isNativeLoginMode) {
                if (_beginEdit || value) {
                    _setValidValidation(UserConstants.USER_ADD_FORM, VPass);
                }
                else {
                    _validation[UserConstants.USER_ADD_FORM][VPass].invalidValueMessage = CommonMessages.Validation.Required;
                    _validation[UserConstants.USER_ADD_FORM][VPass].invalidValue = true;
                }
            }
            else {
                _setValidValidation(UserConstants.USER_ADD_FORM, VPass);
            }
            break;
        //case "ExternalAccountID":
        //    _editUser[name] = value;
        //    if (isAzureADLoginMode && !isNativeLoginMode) {
        //        if (value)
        //            _setValidValidation(UserConstants.USER_ADD_FORM, name)
        //        else {
        //            var propName: string = name;
        //            if (!fromUI)
        //                propName = "ExternalAccountUserName";
        //            _validation[UserConstants.USER_ADD_FORM][propName].invalidValueMessage = InovxLoader.t("users:message.checkAdfsUser");
        //            _validation[UserConstants.USER_ADD_FORM][propName].invalidValue = true;
        //        }
        //    }
        //    else {
        //        _setValidValidation(UserConstants.USER_ADD_FORM, name);
        //    }
        //    break;
        case "ExternalAccountUserName":
            _editUser[name] = value;
            if (isAzureADLoginMode && !isNativeLoginMode) {
                if (value) {
                    if (value == null || value.length == 0) {
                        _validation[UserConstants.USER_ADD_FORM][name].invalidValueMessage = CommonMessages.Validation.Required;
                        _validation[UserConstants.USER_ADD_FORM][name].invalidValue = true;
                    }
                    else {
                        _setValidValidation(UserConstants.USER_ADD_FORM, name);
                    }
                }
                else {
                    _validation[UserConstants.USER_ADD_FORM][name].invalidValueMessage = CommonMessages.Validation.Required;
                    _validation[UserConstants.USER_ADD_FORM][name].invalidValue = true;
                }
            }
            else {
                _setValidValidation(UserConstants.USER_ADD_FORM, name);
            }
            break;
        default:
            if (name != 'UserID' && name != 'UserVersionToken') {
                _editUser[name] = value;
            }
            _setValidValidation(UserConstants.USER_ADD_FORM, name);
            break;
    }
}
function _updateSettingChanges(name, value) {
    _editSettings[name] = value;
    switch (name) {
        case "PasswordExpiration":
            if (_editSettings["PasswordExpires"] && !_isValidIntegerBetweenRange(value, 14, 730)) {
                _validation[UserConstants.USER_SETTINGS_FORM][name].invalidValue = true;
                _validation[UserConstants.USER_SETTINGS_FORM][name].invalidValueMessage = InovxLoader.t("users:settingsForm.numberValue", { min: 14, max: 730 });
            }
            else {
                _setValidValidation(UserConstants.USER_SETTINGS_FORM, name);
            }
            break;
        case "PasswordExpires":
            if (!value) {
                _editSettings[name] = false;
                _setValidValidation(UserConstants.USER_SETTINGS_FORM, "PasswordExpiration");
            }
            break;
        case "AllowedAttempts":
            if (!_isValidIntegerBetweenRange(value, 1, 5)) {
                _validation[UserConstants.USER_SETTINGS_FORM][name].invalidValue = true;
                _validation[UserConstants.USER_SETTINGS_FORM][name].invalidValueMessage = InovxLoader.t("users:settingsForm.numberValue", { min: 1, max: 5 });
            }
            else {
                _setValidValidation(UserConstants.USER_SETTINGS_FORM, name);
            }
            break;
        case "PasswordCharacters":
            if (!_isValidIntegerBetweenRange(value, 1, 32)) {
                _validation[UserConstants.USER_SETTINGS_FORM][name].invalidValue = true;
                _validation[UserConstants.USER_SETTINGS_FORM][name].invalidValueMessage = InovxLoader.t("users:settingsForm.numberValue", { min: 1, max: 32 });
            }
            else {
                _setValidValidation(UserConstants.USER_SETTINGS_FORM, name);
                _updateSettingChanges("PasswordNumbers", _editSettings["PasswordNumbers"]);
                _updateSettingChanges("PasswordSymbols", _editSettings["PasswordSymbols"]);
            }
            break;
        case "PasswordSymbols":
            var numberOfCharacters = _editSettings["PasswordCharacters"];
            var numberOfDigits = _editSettings["PasswordNumbers"];
            if (!_isValidIntegerBetweenRange(value, 0, numberOfCharacters - numberOfDigits)) {
                _validation[UserConstants.USER_SETTINGS_FORM][name].invalidValue = true;
                _validation[UserConstants.USER_SETTINGS_FORM][name].invalidValueMessage = InovxLoader.t("users:settingsForm.invalidDigitsOrSymbols");
            }
            else {
                _setValidValidation(UserConstants.USER_SETTINGS_FORM, name);
                _setValidValidation(UserConstants.USER_SETTINGS_FORM, "PasswordNumbers");
            }
            break;
        case "PasswordNumbers":
            var numberOfCharacters = _editSettings["PasswordCharacters"];
            var numberOfSymbols = _editSettings["PasswordSymbols"];
            if (!_isValidIntegerBetweenRange(value, 0, numberOfCharacters - numberOfSymbols)) {
                _validation[UserConstants.USER_SETTINGS_FORM][name].invalidValue = true;
                _validation[UserConstants.USER_SETTINGS_FORM][name].invalidValueMessage = InovxLoader.t("users:settingsForm.invalidDigitsOrSymbols");
            }
            else {
                _setValidValidation(UserConstants.USER_SETTINGS_FORM, name);
                _setValidValidation(UserConstants.USER_SETTINGS_FORM, "PasswordSymbols");
            }
            break;
        default:
            _setValidValidation(UserConstants.USER_SETTINGS_FORM, name);
            break;
    }
}
// Check for valid positive integer.
function _isValidIntegerBetweenRange(value, min, max) {
    var parsedValue = Number(value);
    if (!isNaN(parsedValue) && parsedValue % 1 === 0 && parsedValue >= min && parsedValue <= max) {
        return true;
    }
    return false;
}
function _setValidValidation(comp, name) {
    if (_validation[comp][name]) {
        _validation[comp][name].invalidInput = false;
        _validation[comp][name].invalidValue = false;
    }
    else {
        _validation[comp][name] = _getNewValidationObject();
    }
}
function _getNewValidationObject() {
    return {
        invalidInput: false,
        invalidValue: false
    };
}
function _validate(comp) {
    switch (comp) {
        case UserConstants.USER_ADD_FORM:
            _ensureValidObject(comp, _editUser);
            return _validateObject(UserConstants.USER_ADD_FORM);
        case UserConstants.USER_SETTINGS_FORM:
            _ensureValidObject(comp, _editSettings);
            return _validateObject(UserConstants.USER_SETTINGS_FORM);
    }
    return false;
}
function _ensureValidObject(comp, obj) {
    var updateChangesFunct = function (name, value, fromUI) { };
    var updateListChangesFunct = function (name, value) { };
    switch (comp) {
        case UserConstants.USER_ADD_FORM:
            updateChangesFunct = _updateUserChanges;
            break;
        case UserConstants.USER_SETTINGS_FORM:
            updateChangesFunct = _updateSettingChanges;
            break;
    }
    for (var k in obj) {
        var objType = typeof (obj[k]);
        if (objType !== 'function') {
            if (obj[k] === null || objType !== 'object' || Array.isArray(obj[k])) {
                updateChangesFunct(k, obj[k], false);
            }
            else {
                _ensureValidObject(comp, obj[k]);
            }
        }
    }
}
function _validateObject(comp) {
    var ret = true;
    for (var k in _validation[comp]) {
        if (_validation[comp][k].invalidValue) {
            return false;
        }
    }
    return ret;
}
function _initalizeValidation(comp) {
    switch (comp) {
        case UserConstants.USER_ADD_FORM:
            var valiObj = _validation[UserConstants.USER_ADD_FORM] = {};
            for (var k in _editUser) {
                _setValidValidation(UserConstants.USER_ADD_FORM, k);
            }
            break;
        case UserConstants.USER_SETTINGS_FORM:
            valiObj = _validation[UserConstants.USER_SETTINGS_FORM] = {};
            for (var k in _settings) {
                _setValidValidation(UserConstants.USER_SETTINGS_FORM, k);
                valiObj[k].invalidValueMessage = CommonMessages.Validation.PositiveInteger;
            }
            break;
    }
}
function validationError(comp, messageObj) {
    _validation[comp][messageObj.propertyName].invalidValueMessage = messageObj.message;
    _validation[comp][messageObj.propertyName].invalidValue = true;
}
function finishedEditing() {
    _modalVisible = false;
    _changesMade = false;
}
function selectHint(user) {
    _updateProfile(user);
    _updateUserChanges("ExternalAccountUserName", user.UserName, true);
    _updateUserChanges("Email", user.Email, true);
}
function _updateProfile(user) {
    _editUser["FirstName"] = user.FirstName;
    _editUser["LastName"] = user.LastName;
    _editUser["UserName"] = user.UserName;
    //_editUser["ADUserName"] = user.Email;
    _editUser["ExternalAccountUserName"] = user.UserName;
    _editUser["ExternalAccountID"] = user.UserID;
}
function getBlankUser() {
    return {
        UserID: "", UserVersionToken: null, Enabled: true, FirstName: "", LastName: "", UserName: "",
        Password: "", Email: "", ExternalAccountUserName: "", ExternalAccountID: "", PasswordExpired: false, MaxLoginAttempts: false,
        EntitlementGroupIDs: [], RoleIDs: []
    };
}
function getBlankUserAppSetting() {
    return { PasswordExpiration: 0, AllowedAttempts: 0, PasswordCharacters: 0, PasswordSymbols: 0, PasswordNumbers: 0, RememberMe: false, AuthenticationMode: "", ExternalProviderName: "" };
}
function sortINamedItem(a, b) {
    if (!a)
        return -1;
    if (!b)
        return 1;
    return (a.Name > b.Name) ? 1 : (b.Name > a.Name) ? -1 : 0;
}
var UserStore = assign({}, EventEmitter.prototype, {
    getAll: function () {
        return _users;
    },
    getEditUser: function () {
        return _editUser;
    },
    getCurrentUser: function () {
        return _currentUser;
    },
    getHasChanges: function () {
        return _changesMade;
    },
    getIsAdding: function () {
        return _beginAdd;
    },
    getIsEditing: function () {
        return _beginEdit;
    },
    getModalVisible: function () {
        return _modalVisible;
    },
    getSettingsShown: function () {
        return _settingsShown;
    },
    getSettings: function () {
        return _settings;
    },
    getEditSettings: function () {
        return _editSettings;
    },
    getSaveFriendlyEditSettings: function () {
        var edit = $.extend({}, _editSettings);
        edit.AllowedAttempts = parseInt(_editSettings.AllowedAttempts);
        edit.PasswordCharacters = parseInt(_editSettings.PasswordCharacters);
        edit.PasswordExpiration = parseInt(_editSettings.PasswordExpiration);
        edit.PasswordNumbers = parseInt(_editSettings.PasswordNumbers);
        edit.PasswordSymbols = parseInt(_editSettings.PasswordSymbols);
        return edit;
    },
    checkUser: function () {
        return _hints;
    },
    updateExternalAccountID: function (id) {
        _editUser.ExternalAccountID = id;
    },
    getValidation: function (key) {
        return _validation[key];
    },
    getIsValidObject: function (key) {
        return _validate(key);
    },
    getValidRoles: function () {
        return _roles;
    },
    getValidEntitlements: function () {
        return _entitlements;
    },
    emitChange: function () {
        return this.emit(CHANGE_EVENT);
    },
    addChangeListener: function (callback) {
        this.on(CHANGE_EVENT, callback);
    },
    removeChangeListener: function (callback) {
        this.removeListener(CHANGE_EVENT, callback);
    }
});
Inovx.Shared.Flux.AppDispatcher.register(function (payload) {
    switch (payload.actionType) {
        case UserConstants.BEGIN_USER_ADD:
            setAddingUser();
            _entitlements = payload.entitlement.sort(sortINamedItem);
            _roles = payload.role.sort(sortINamedItem);
            _editUser.EntitlementGroupIDs = _entitlements.filter(function (item) {
                return item.IsDefault;
            }).map(function (item) { return item.ID; });
            _editUser.RoleIDs = _roles.filter(function (item) {
                return item.IsDefault;
            }).map(function (item) { return item.ID; });
            break;
        case UserConstants.BEGIN_EDIT_USER:
            setEditingUser(payload.user);
            _entitlements = payload.entitlement.sort(sortINamedItem);
            _roles = payload.role.sort(sortINamedItem);
            _editUser.EntitlementGroupIDs.sort(function (a, b) {
                var itemA = null;
                var itemB = null;
                for (var indx in _entitlements) {
                    if (_entitlements[indx].ID === a) {
                        itemA = _entitlements[indx];
                    }
                    else if (_entitlements[indx].ID === b) {
                        itemB = _entitlements[indx];
                    }
                }
                return sortINamedItem(itemA, itemB);
            });
            _editUser.RoleIDs.sort(function (a, b) {
                var itemA = null;
                var itemB = null;
                for (var indx in _roles) {
                    if (_roles[indx].ID === a) {
                        itemA = _roles[indx];
                    }
                    else if (_roles[indx].ID === b) {
                        itemB = _roles[indx];
                    }
                }
                return sortINamedItem(itemA, itemB);
            });
            break;
        case UserConstants.FINISH_EDIT:
            finishedEditing();
            break;
        case UserConstants.USER_RECIEVE_DATA:
            loadUserData(payload.data);
            break;
        case UserConstants.USER_RECIEVE_HINT:
            loadHints(payload.data);
            payload.callback();
            return true;
        case UserConstants.USER_UPDATE_OBJECT:
            _updateObject(payload.component, payload.key, payload.value);
            break;
        case UserConstants.USER_UPDATE_OBJECT_ADD_LIST:
            _updateObjectListProp(payload.component, payload.key, payload.value, true);
            break;
        case UserConstants.USER_UPDATE_OBJECT_REMOVE_LIST:
            _updateObjectListProp(payload.component, payload.key, payload.value, false);
            break;
        case UserConstants.USER_SELECT_HINT:
            selectHint(payload.user);
            break;
        case UserConstants.USER_FORM_INVALID_SAVE:
            break;
        case UserConstants.HIDE_SETTINGS_MENU:
            showUserSettings(false);
            break;
        case UserConstants.SETTINGS_GET:
            _settings = payload.data;
            _editSettings = $.extend({}, _settings);
            _editSettings.PasswordExpires = _settings.PasswordExpiration > 0;
            showUserSettings(payload.display);
            break;
        case UserConstants.USER_RECIEVE_CURRENT:
            loadCurrentUser(payload.data);
            payload.callback();
            return true;
        case UserConstants.USER_VALIDATION_ERROR:
            validationError(payload.component, payload.messageObj);
            break;
        case UserConstants.USER_CHANGE_PASSWORD_SUCCESS:
            _editUser.PasswordExpired = false;
            _editUser.UserVersionToken = payload.user.UserVersionToken;
            break;
        case UserConstants.RESET_LOGIN_ATTEMPTS:
            _editUser.MaxLoginAttempts = payload.user.MaxLoginAttempts;
            _editUser.UserVersionToken = payload.user.UserVersionToken;
            break;
        default: return true;
    }
    UserStore.emitChange();
    return true;
});
module.exports = UserStore;

},{"./../constants/AuthenticationModeEnum":10,"./../constants/UserConstants":12,"events":17,"object-assign":18,"shared.web.client":"shared.web.client"}],17:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var objectCreate = Object.create || objectCreatePolyfill
var objectKeys = Object.keys || objectKeysPolyfill
var bind = Function.prototype.bind || functionBindPolyfill

function EventEmitter() {
  if (!this._events || !Object.prototype.hasOwnProperty.call(this, '_events')) {
    this._events = objectCreate(null);
    this._eventsCount = 0;
  }

  this._maxListeners = this._maxListeners || undefined;
}
module.exports = EventEmitter;

// Backwards-compat with node 0.10.x
EventEmitter.EventEmitter = EventEmitter;

EventEmitter.prototype._events = undefined;
EventEmitter.prototype._maxListeners = undefined;

// By default EventEmitters will print a warning if more than 10 listeners are
// added to it. This is a useful default which helps finding memory leaks.
var defaultMaxListeners = 10;

var hasDefineProperty;
try {
  var o = {};
  if (Object.defineProperty) Object.defineProperty(o, 'x', { value: 0 });
  hasDefineProperty = o.x === 0;
} catch (err) { hasDefineProperty = false }
if (hasDefineProperty) {
  Object.defineProperty(EventEmitter, 'defaultMaxListeners', {
    enumerable: true,
    get: function() {
      return defaultMaxListeners;
    },
    set: function(arg) {
      // check whether the input is a positive number (whose value is zero or
      // greater and not a NaN).
      if (typeof arg !== 'number' || arg < 0 || arg !== arg)
        throw new TypeError('"defaultMaxListeners" must be a positive number');
      defaultMaxListeners = arg;
    }
  });
} else {
  EventEmitter.defaultMaxListeners = defaultMaxListeners;
}

// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
EventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {
  if (typeof n !== 'number' || n < 0 || isNaN(n))
    throw new TypeError('"n" argument must be a positive number');
  this._maxListeners = n;
  return this;
};

function $getMaxListeners(that) {
  if (that._maxListeners === undefined)
    return EventEmitter.defaultMaxListeners;
  return that._maxListeners;
}

EventEmitter.prototype.getMaxListeners = function getMaxListeners() {
  return $getMaxListeners(this);
};

// These standalone emit* functions are used to optimize calling of event
// handlers for fast cases because emit() itself often has a variable number of
// arguments and can be deoptimized because of that. These functions always have
// the same number of arguments and thus do not get deoptimized, so the code
// inside them can execute faster.
function emitNone(handler, isFn, self) {
  if (isFn)
    handler.call(self);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self);
  }
}
function emitOne(handler, isFn, self, arg1) {
  if (isFn)
    handler.call(self, arg1);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1);
  }
}
function emitTwo(handler, isFn, self, arg1, arg2) {
  if (isFn)
    handler.call(self, arg1, arg2);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1, arg2);
  }
}
function emitThree(handler, isFn, self, arg1, arg2, arg3) {
  if (isFn)
    handler.call(self, arg1, arg2, arg3);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1, arg2, arg3);
  }
}

function emitMany(handler, isFn, self, args) {
  if (isFn)
    handler.apply(self, args);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].apply(self, args);
  }
}

EventEmitter.prototype.emit = function emit(type) {
  var er, handler, len, args, i, events;
  var doError = (type === 'error');

  events = this._events;
  if (events)
    doError = (doError && events.error == null);
  else if (!doError)
    return false;

  // If there is no 'error' event listener then throw.
  if (doError) {
    if (arguments.length > 1)
      er = arguments[1];
    if (er instanceof Error) {
      throw er; // Unhandled 'error' event
    } else {
      // At least give some kind of context to the user
      var err = new Error('Unhandled "error" event. (' + er + ')');
      err.context = er;
      throw err;
    }
    return false;
  }

  handler = events[type];

  if (!handler)
    return false;

  var isFn = typeof handler === 'function';
  len = arguments.length;
  switch (len) {
      // fast cases
    case 1:
      emitNone(handler, isFn, this);
      break;
    case 2:
      emitOne(handler, isFn, this, arguments[1]);
      break;
    case 3:
      emitTwo(handler, isFn, this, arguments[1], arguments[2]);
      break;
    case 4:
      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);
      break;
      // slower
    default:
      args = new Array(len - 1);
      for (i = 1; i < len; i++)
        args[i - 1] = arguments[i];
      emitMany(handler, isFn, this, args);
  }

  return true;
};

function _addListener(target, type, listener, prepend) {
  var m;
  var events;
  var existing;

  if (typeof listener !== 'function')
    throw new TypeError('"listener" argument must be a function');

  events = target._events;
  if (!events) {
    events = target._events = objectCreate(null);
    target._eventsCount = 0;
  } else {
    // To avoid recursion in the case that type === "newListener"! Before
    // adding it to the listeners, first emit "newListener".
    if (events.newListener) {
      target.emit('newListener', type,
          listener.listener ? listener.listener : listener);

      // Re-assign `events` because a newListener handler could have caused the
      // this._events to be assigned to a new object
      events = target._events;
    }
    existing = events[type];
  }

  if (!existing) {
    // Optimize the case of one listener. Don't need the extra array object.
    existing = events[type] = listener;
    ++target._eventsCount;
  } else {
    if (typeof existing === 'function') {
      // Adding the second element, need to change to array.
      existing = events[type] =
          prepend ? [listener, existing] : [existing, listener];
    } else {
      // If we've already got an array, just append.
      if (prepend) {
        existing.unshift(listener);
      } else {
        existing.push(listener);
      }
    }

    // Check for listener leak
    if (!existing.warned) {
      m = $getMaxListeners(target);
      if (m && m > 0 && existing.length > m) {
        existing.warned = true;
        var w = new Error('Possible EventEmitter memory leak detected. ' +
            existing.length + ' "' + String(type) + '" listeners ' +
            'added. Use emitter.setMaxListeners() to ' +
            'increase limit.');
        w.name = 'MaxListenersExceededWarning';
        w.emitter = target;
        w.type = type;
        w.count = existing.length;
        if (typeof console === 'object' && console.warn) {
          console.warn('%s: %s', w.name, w.message);
        }
      }
    }
  }

  return target;
}

EventEmitter.prototype.addListener = function addListener(type, listener) {
  return _addListener(this, type, listener, false);
};

EventEmitter.prototype.on = EventEmitter.prototype.addListener;

EventEmitter.prototype.prependListener =
    function prependListener(type, listener) {
      return _addListener(this, type, listener, true);
    };

function onceWrapper() {
  if (!this.fired) {
    this.target.removeListener(this.type, this.wrapFn);
    this.fired = true;
    switch (arguments.length) {
      case 0:
        return this.listener.call(this.target);
      case 1:
        return this.listener.call(this.target, arguments[0]);
      case 2:
        return this.listener.call(this.target, arguments[0], arguments[1]);
      case 3:
        return this.listener.call(this.target, arguments[0], arguments[1],
            arguments[2]);
      default:
        var args = new Array(arguments.length);
        for (var i = 0; i < args.length; ++i)
          args[i] = arguments[i];
        this.listener.apply(this.target, args);
    }
  }
}

function _onceWrap(target, type, listener) {
  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };
  var wrapped = bind.call(onceWrapper, state);
  wrapped.listener = listener;
  state.wrapFn = wrapped;
  return wrapped;
}

EventEmitter.prototype.once = function once(type, listener) {
  if (typeof listener !== 'function')
    throw new TypeError('"listener" argument must be a function');
  this.on(type, _onceWrap(this, type, listener));
  return this;
};

EventEmitter.prototype.prependOnceListener =
    function prependOnceListener(type, listener) {
      if (typeof listener !== 'function')
        throw new TypeError('"listener" argument must be a function');
      this.prependListener(type, _onceWrap(this, type, listener));
      return this;
    };

// Emits a 'removeListener' event if and only if the listener was removed.
EventEmitter.prototype.removeListener =
    function removeListener(type, listener) {
      var list, events, position, i, originalListener;

      if (typeof listener !== 'function')
        throw new TypeError('"listener" argument must be a function');

      events = this._events;
      if (!events)
        return this;

      list = events[type];
      if (!list)
        return this;

      if (list === listener || list.listener === listener) {
        if (--this._eventsCount === 0)
          this._events = objectCreate(null);
        else {
          delete events[type];
          if (events.removeListener)
            this.emit('removeListener', type, list.listener || listener);
        }
      } else if (typeof list !== 'function') {
        position = -1;

        for (i = list.length - 1; i >= 0; i--) {
          if (list[i] === listener || list[i].listener === listener) {
            originalListener = list[i].listener;
            position = i;
            break;
          }
        }

        if (position < 0)
          return this;

        if (position === 0)
          list.shift();
        else
          spliceOne(list, position);

        if (list.length === 1)
          events[type] = list[0];

        if (events.removeListener)
          this.emit('removeListener', type, originalListener || listener);
      }

      return this;
    };

EventEmitter.prototype.removeAllListeners =
    function removeAllListeners(type) {
      var listeners, events, i;

      events = this._events;
      if (!events)
        return this;

      // not listening for removeListener, no need to emit
      if (!events.removeListener) {
        if (arguments.length === 0) {
          this._events = objectCreate(null);
          this._eventsCount = 0;
        } else if (events[type]) {
          if (--this._eventsCount === 0)
            this._events = objectCreate(null);
          else
            delete events[type];
        }
        return this;
      }

      // emit removeListener for all listeners on all events
      if (arguments.length === 0) {
        var keys = objectKeys(events);
        var key;
        for (i = 0; i < keys.length; ++i) {
          key = keys[i];
          if (key === 'removeListener') continue;
          this.removeAllListeners(key);
        }
        this.removeAllListeners('removeListener');
        this._events = objectCreate(null);
        this._eventsCount = 0;
        return this;
      }

      listeners = events[type];

      if (typeof listeners === 'function') {
        this.removeListener(type, listeners);
      } else if (listeners) {
        // LIFO order
        for (i = listeners.length - 1; i >= 0; i--) {
          this.removeListener(type, listeners[i]);
        }
      }

      return this;
    };

function _listeners(target, type, unwrap) {
  var events = target._events;

  if (!events)
    return [];

  var evlistener = events[type];
  if (!evlistener)
    return [];

  if (typeof evlistener === 'function')
    return unwrap ? [evlistener.listener || evlistener] : [evlistener];

  return unwrap ? unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);
}

EventEmitter.prototype.listeners = function listeners(type) {
  return _listeners(this, type, true);
};

EventEmitter.prototype.rawListeners = function rawListeners(type) {
  return _listeners(this, type, false);
};

EventEmitter.listenerCount = function(emitter, type) {
  if (typeof emitter.listenerCount === 'function') {
    return emitter.listenerCount(type);
  } else {
    return listenerCount.call(emitter, type);
  }
};

EventEmitter.prototype.listenerCount = listenerCount;
function listenerCount(type) {
  var events = this._events;

  if (events) {
    var evlistener = events[type];

    if (typeof evlistener === 'function') {
      return 1;
    } else if (evlistener) {
      return evlistener.length;
    }
  }

  return 0;
}

EventEmitter.prototype.eventNames = function eventNames() {
  return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [];
};

// About 1.5x faster than the two-arg version of Array#splice().
function spliceOne(list, index) {
  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)
    list[i] = list[k];
  list.pop();
}

function arrayClone(arr, n) {
  var copy = new Array(n);
  for (var i = 0; i < n; ++i)
    copy[i] = arr[i];
  return copy;
}

function unwrapListeners(arr) {
  var ret = new Array(arr.length);
  for (var i = 0; i < ret.length; ++i) {
    ret[i] = arr[i].listener || arr[i];
  }
  return ret;
}

function objectCreatePolyfill(proto) {
  var F = function() {};
  F.prototype = proto;
  return new F;
}
function objectKeysPolyfill(obj) {
  var keys = [];
  for (var k in obj) if (Object.prototype.hasOwnProperty.call(obj, k)) {
    keys.push(k);
  }
  return k;
}
function functionBindPolyfill(context) {
  var fn = this;
  return function () {
    return fn.apply(context, arguments);
  };
}

},{}],18:[function(require,module,exports){
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/

'use strict';
/* eslint-disable no-unused-vars */
var getOwnPropertySymbols = Object.getOwnPropertySymbols;
var hasOwnProperty = Object.prototype.hasOwnProperty;
var propIsEnumerable = Object.prototype.propertyIsEnumerable;

function toObject(val) {
	if (val === null || val === undefined) {
		throw new TypeError('Object.assign cannot be called with null or undefined');
	}

	return Object(val);
}

function shouldUseNative() {
	try {
		if (!Object.assign) {
			return false;
		}

		// Detect buggy property enumeration order in older V8 versions.

		// https://bugs.chromium.org/p/v8/issues/detail?id=4118
		var test1 = new String('abc');  // eslint-disable-line no-new-wrappers
		test1[5] = 'de';
		if (Object.getOwnPropertyNames(test1)[0] === '5') {
			return false;
		}

		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
		var test2 = {};
		for (var i = 0; i < 10; i++) {
			test2['_' + String.fromCharCode(i)] = i;
		}
		var order2 = Object.getOwnPropertyNames(test2).map(function (n) {
			return test2[n];
		});
		if (order2.join('') !== '0123456789') {
			return false;
		}

		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
		var test3 = {};
		'abcdefghijklmnopqrst'.split('').forEach(function (letter) {
			test3[letter] = letter;
		});
		if (Object.keys(Object.assign({}, test3)).join('') !==
				'abcdefghijklmnopqrst') {
			return false;
		}

		return true;
	} catch (err) {
		// We don't expect any of the above to throw, but better to be safe.
		return false;
	}
}

module.exports = shouldUseNative() ? Object.assign : function (target, source) {
	var from;
	var to = toObject(target);
	var symbols;

	for (var s = 1; s < arguments.length; s++) {
		from = Object(arguments[s]);

		for (var key in from) {
			if (hasOwnProperty.call(from, key)) {
				to[key] = from[key];
			}
		}

		if (getOwnPropertySymbols) {
			symbols = getOwnPropertySymbols(from);
			for (var i = 0; i < symbols.length; i++) {
				if (propIsEnumerable.call(from, symbols[i])) {
					to[symbols[i]] = from[symbols[i]];
				}
			}
		}
	}

	return to;
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJiaW4vanMtb3V0L2FwcC9BcHAuanMiLCJiaW4vanMtb3V0L2FwcC9hY3Rpb25zL1VzZXJBY3Rpb25zLmpzIiwiYmluL2pzLW91dC9hcHAvY29tcG9uZW50cy9DaGFuZ2VVc2VyUGFzc3dvcmQuanMiLCJiaW4vanMtb3V0L2FwcC9jb21wb25lbnRzL1VzZXJBcHAuanMiLCJiaW4vanMtb3V0L2FwcC9jb21wb25lbnRzL1VzZXJGb3JtLmpzIiwiYmluL2pzLW91dC9hcHAvY29tcG9uZW50cy9Vc2VyU2VsZWN0LmpzIiwiYmluL2pzLW91dC9hcHAvY29tcG9uZW50cy9Vc2VyU2V0dGluZ3MuanMiLCJiaW4vanMtb3V0L2FwcC9jb21wb25lbnRzL1VzZXJTeXN0ZW1QcmVmZXJlbmNlcy5qcyIsImJpbi9qcy1vdXQvYXBwL2NvbXBvbmVudHMvVXNlclZpZXcuanMiLCJiaW4vanMtb3V0L2FwcC9jb25zdGFudHMvQXV0aGVudGljYXRpb25Nb2RlRW51bS5qcyIsImJpbi9qcy1vdXQvYXBwL2NvbnN0YW50cy9FeHRlcm5hbFByb3ZpZGVyRW51bS5qcyIsImJpbi9qcy1vdXQvYXBwL2NvbnN0YW50cy9Vc2VyQ29uc3RhbnRzLmpzIiwiYmluL2pzLW91dC9hcHAvY29uc3RhbnRzL1VzZXJQZXJtaXNzaW9uTmFtZXMuanMiLCJiaW4vanMtb3V0L2FwcC9zZXJ2aWNlcy9TZXR0aW5nc1NlcnZpY2UuanMiLCJiaW4vanMtb3V0L2FwcC9zZXJ2aWNlcy9Vc2VyU2VydmljZXMuanMiLCJiaW4vanMtb3V0L2FwcC9zdG9yZXMvVXNlclN0b3JlLmpzIiwibm9kZV9tb2R1bGVzL2V2ZW50cy9ldmVudHMuanMiLCJub2RlX21vZHVsZXMvb2JqZWN0LWFzc2lnbi9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDemhCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gQSDigJgudHN44oCZIGZpbGUgZW5hYmxlcyBKU1ggc3VwcG9ydCBpbiB0aGUgVHlwZVNjcmlwdCBjb21waWxlciwgXHJcbi8vIGZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSB0aGUgZm9sbG93aW5nIHBhZ2Ugb24gdGhlIFR5cGVTY3JpcHQgd2lraTpcclxuLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L3dpa2kvSlNYXHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xyXG52YXIgUmVhY3RET00gPSByZXF1aXJlKFwicmVhY3QtZG9tXCIpO1xyXG52YXIgVXNlckFwcCA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvVXNlckFwcFwiKTtcclxudHJ5IHtcclxuICAgIElub3Z4TG9hZGVyLnVwZGF0ZUhlbHAoJ3VzZXJzJyk7XHJcbn1cclxuY2F0Y2ggKGUpIHtcclxufVxyXG5SZWFjdERPTS5yZW5kZXIoUmVhY3QuY3JlYXRlRWxlbWVudChVc2VyQXBwLCBudWxsKSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJhcHAnKSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUFwcC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gQSDigJgudHN44oCZIGZpbGUgZW5hYmxlcyBKU1ggc3VwcG9ydCBpbiB0aGUgVHlwZVNjcmlwdCBjb21waWxlciwgXHJcbi8vIGZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSB0aGUgZm9sbG93aW5nIHBhZ2Ugb24gdGhlIFR5cGVTY3JpcHQgd2lraTpcclxuLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L3dpa2kvSlNYXHJcbnZhciBJbm92eCA9IHJlcXVpcmUoXCJzaGFyZWQud2ViLmNsaWVudFwiKTtcclxudmFyIFVzZXJDb25zdGFudHMgPSByZXF1aXJlKCcuLy4uL2NvbnN0YW50cy9Vc2VyQ29uc3RhbnRzJyk7XHJcbnZhciBVc2VyU2VydmljZXMgPSByZXF1aXJlKCcuLy4uL3NlcnZpY2VzL1VzZXJTZXJ2aWNlcycpO1xyXG52YXIgU2V0dGluZ3NTZXJ2aWNlID0gcmVxdWlyZSgnLi8uLi9zZXJ2aWNlcy9TZXR0aW5nc1NlcnZpY2UnKTtcclxudmFyIFVzZXJTdG9yZSA9IHJlcXVpcmUoJy4vLi4vc3RvcmVzL1VzZXJTdG9yZScpO1xyXG52YXIgU3lzdGVtQWN0aW9ucyA9IElub3Z4LlNoYXJlZC5TeXN0ZW0uQWN0aW9ucztcclxudmFyIFN5c3RlbVN0b3JlID0gSW5vdnguU2hhcmVkLlN5c3RlbS5TdG9yZTtcclxuZnVuY3Rpb24gcmVjZWl2ZURhdGEoZGF0YSkge1xyXG4gICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgYWN0aW9uVHlwZTogVXNlckNvbnN0YW50cy5VU0VSX1JFQ0lFVkVfREFUQSxcclxuICAgICAgICBkYXRhOiBkYXRhXHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiByZWNlaXZlSGludChkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgYWN0aW9uVHlwZTogVXNlckNvbnN0YW50cy5VU0VSX1JFQ0lFVkVfSElOVCxcclxuICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gcmVjZWl2ZUN1cnJlbnRVc2VyKGRhdGEsIGNhbGxiYWNrKSB7XHJcbiAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICBhY3Rpb25UeXBlOiBVc2VyQ29uc3RhbnRzLlVTRVJfUkVDSUVWRV9DVVJSRU5ULFxyXG4gICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrXHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBfZmluaXNoRWRpdCgpIHtcclxuICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgIGFjdGlvblR5cGU6IFVzZXJDb25zdGFudHMuRklOSVNIX0VESVRcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIF9oaWRlU2V0dGluZ3MoKSB7XHJcbiAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICBhY3Rpb25UeXBlOiBVc2VyQ29uc3RhbnRzLkhJREVfU0VUVElOR1NfTUVOVVxyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gc2VuZEludmFsaWRTYXZlKCkge1xyXG4gICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgYWN0aW9uVHlwZTogVXNlckNvbnN0YW50cy5VU0VSX0ZPUk1fSU5WQUxJRF9TQVZFXHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBzZW5kVmFsaWRhdGlvbkVycm9yKGNvbXAsIGVycm9yKSB7XHJcbiAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICBhY3Rpb25UeXBlOiBVc2VyQ29uc3RhbnRzLlVTRVJfVkFMSURBVElPTl9FUlJPUixcclxuICAgICAgICBtZXNzYWdlT2JqOiBlcnJvcixcclxuICAgICAgICBjb21wb25lbnQ6IGNvbXBcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIHNlbmRCZWdpbkVkaXQodXNlciwgcm9sZXMsIGVudGl0bGVtZW50KSB7XHJcbiAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICBhY3Rpb25UeXBlOiB1c2VyID8gVXNlckNvbnN0YW50cy5CRUdJTl9FRElUX1VTRVIgOiBVc2VyQ29uc3RhbnRzLkJFR0lOX1VTRVJfQURELFxyXG4gICAgICAgIHVzZXI6IHVzZXIsXHJcbiAgICAgICAgZW50aXRsZW1lbnQ6IGVudGl0bGVtZW50LFxyXG4gICAgICAgIHJvbGU6IHJvbGVzXHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBnZXRFbnRpdGxlbWVudExpc3QoY2JGbiwgZXJyb3JDYkZuLCBpZ25vcmVEZWZhdWx0KSB7XHJcbiAgICBVc2VyU2VydmljZXMuZ2V0RW50aXRsZW1lbnRzKGZ1bmN0aW9uIChlbnRpdGxlbWVudCkge1xyXG4gICAgICAgIGNiRm4oZW50aXRsZW1lbnQpO1xyXG4gICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgZXJyb3JDYkZuKGVycm9yKTtcclxuICAgIH0sIGlnbm9yZURlZmF1bHQpO1xyXG59XHJcbmZ1bmN0aW9uIGdldFJvbGVzTGlzdChjYkZuLCBlcnJvckNiRm4sIGlnbm9yZURlZmF1bHQpIHtcclxuICAgIFVzZXJTZXJ2aWNlcy5nZXRSb2xlcyhmdW5jdGlvbiAocm9sZXMpIHtcclxuICAgICAgICBjYkZuKHJvbGVzKTtcclxuICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgIGVycm9yQ2JGbihlcnJvcik7XHJcbiAgICB9LCBpZ25vcmVEZWZhdWx0KTtcclxufVxyXG5mdW5jdGlvbiBnZXRVc2VyU3lzdGVtU2V0dGluZyhjYkZuLCBlcnJvckNiRm4sIGlnbm9yZURlZmF1bHQpIHtcclxuICAgIFNldHRpbmdzU2VydmljZS5nZXRTeXN0ZW1TZXR0aW5ncyhmdW5jdGlvbiAoc2V0dGluZykge1xyXG4gICAgICAgIGNiRm4oc2V0dGluZyk7XHJcbiAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICBlcnJvckNiRm4oZXJyb3IpO1xyXG4gICAgfSwgaWdub3JlRGVmYXVsdCk7XHJcbn1cclxudmFyIFVzZXJBY3Rpb25zID0ge1xyXG4gICAgZ2V0QWxsVXNlcnM6IGZ1bmN0aW9uIChjYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgVXNlclNlcnZpY2VzLmdldEFsbChmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09ICd1bmRlZmluZWQnICYmIGNhbGxiYWNrICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVjZWl2ZURhdGEoZGF0YSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIGlnbm9yZURlZmF1bHRFcnJvcik7XHJcbiAgICB9LFxyXG4gICAgY3JlYXRlOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoVXNlclN0b3JlLmdldElzVmFsaWRPYmplY3QoVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNKSkge1xyXG4gICAgICAgICAgICBpZiAoIVN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhVc2VyQ29uc3RhbnRzLlVTRVJfQUREKSkge1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5iZWdpbkFjdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfQUREKTtcclxuICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlcy5jcmVhdGVVc2VyKFVzZXJTdG9yZS5nZXRFZGl0VXNlcigpLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXNlckFjdGlvbnMucmVmcmVzaERhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCAmJiBjYWxsYmFjayAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIF9maW5pc2hFZGl0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oVXNlckNvbnN0YW50cy5VU0VSX0FERCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IubWVzc2FnZU9iai5wcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VuZFZhbGlkYXRpb25FcnJvcihVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk0sIGVycm9yLm1lc3NhZ2VPYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfQUREKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5tZXNzYWdlT2JqLnByb3BlcnR5TmFtZSA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzZW5kSW52YWxpZFNhdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZGVsZXRlOiBmdW5jdGlvbiAodXNlciwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoIVN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhVc2VyQ29uc3RhbnRzLlVTRVJfREVMRVRFKSkge1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmJlZ2luQWN0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9ERUxFVEUpO1xyXG4gICAgICAgICAgICBVc2VyU2VydmljZXMuZGVsZXRlVXNlcih1c2VyLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBVc2VyQWN0aW9ucy5yZWZyZXNoRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfREVMRVRFKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfREVMRVRFKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGVkaXQ6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgIGlmIChVc2VyU3RvcmUuZ2V0SXNWYWxpZE9iamVjdChVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk0pKSB7XHJcbiAgICAgICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKFVzZXJDb25zdGFudHMuVVNFUl9FRElUKSkge1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5iZWdpbkFjdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfRURJVCk7XHJcbiAgICAgICAgICAgICAgICBVc2VyU2VydmljZXMuZWRpdFVzZXIoVXNlclN0b3JlLmdldEVkaXRVc2VyKCksIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBVc2VyQWN0aW9ucy5yZWZyZXNoRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkICYmIGNhbGxiYWNrICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgX2ZpbmlzaEVkaXQoKTtcclxuICAgICAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfRURJVCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IubWVzc2FnZU9iai5wcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLm1lc3NhZ2VPYmoucHJvcGVydHlOYW1lID09IFwiVXNlck5hbWVcIiAmJiBlcnJvci5tZXNzYWdlT2JqLnJlYXNvbiA9PSAnRHVwbGljYXRlRGVsZXRlZFVzZXJOYW1lJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VPYmplY3QgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogSW5vdnhMb2FkZXIudChcInVzZXJzOmZvcm0uZHVwbGljYXRlRW1haWxcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uOiBlcnJvci5tZXNzYWdlT2JqLnJlYXNvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWU6IFwiRW1haWxcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRWYWxpZGF0aW9uRXJyb3IoVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNLCBtZXNzYWdlT2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kVmFsaWRhdGlvbkVycm9yKFVzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STSwgZXJyb3IubWVzc2FnZU9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9FRElUKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5tZXNzYWdlT2JqLnByb3BlcnR5TmFtZSA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzZW5kSW52YWxpZFNhdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgY2hhbmdlUGFzc3dvcmQ6IGZ1bmN0aW9uICh1c2VyLCBwYXNzd29yZCwgY2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoIVN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhVc2VyQ29uc3RhbnRzLlVTRVJfQ0hBTkdFX1BBU1NXT1JEKSkge1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmJlZ2luQWN0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9DSEFOR0VfUEFTU1dPUkQpO1xyXG4gICAgICAgICAgICBVc2VyU2VydmljZXMuY2hhbmdlUGFzc3dvcmQodXNlciwgcGFzc3dvcmQsIGZ1bmN0aW9uICh1cGRhdGVkVXNlcikge1xyXG4gICAgICAgICAgICAgICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogVXNlckNvbnN0YW50cy5VU0VSX0NIQU5HRV9QQVNTV09SRF9TVUNDRVNTLFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHVwZGF0ZWRVc2VyXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfQ0hBTkdFX1BBU1NXT1JEKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9DSEFOR0VfUEFTU1dPUkQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5tZXNzYWdlT2JqLnByb3BlcnR5TmFtZSA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHJlc2V0UGFzc3dvcmRzOiBmdW5jdGlvbiAoY2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICBVc2VyU2VydmljZXMucmVzZXRQYXNzd29yZHMoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgaWYgKGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICB9LFxyXG4gICAgYmVnaW5BZGQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIVN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhVc2VyQ29uc3RhbnRzLkJFR0lOX1VTRVJfQUREKSkge1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmJlZ2luQWN0aW9uKFVzZXJDb25zdGFudHMuQkVHSU5fVVNFUl9BREQpO1xyXG4gICAgICAgICAgICB2YXIgZW50aXRsZW1lbnRfMSA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgcm9sZXNfMSA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgZ2V0Um9sZXNDYWxsXzEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBnZXRSb2xlc0xpc3QoZnVuY3Rpb24gKHJvbGVEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcm9sZXNfMSA9IHJvbGVEYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbmRCZWdpbkVkaXQobnVsbCwgcm9sZXNfMSwgZW50aXRsZW1lbnRfMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oVXNlckNvbnN0YW50cy5CRUdJTl9VU0VSX0FERCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZW5kQmVnaW5FZGl0KG51bGwsIHJvbGVzXzEsIGVudGl0bGVtZW50XzEpO1xyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFVzZXJDb25zdGFudHMuQkVHSU5fVVNFUl9BREQpO1xyXG4gICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGdldEVudGl0bGVtZW50TGlzdChmdW5jdGlvbiAoZW50aXRsZW1lbnREYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBlbnRpdGxlbWVudF8xID0gZW50aXRsZW1lbnREYXRhO1xyXG4gICAgICAgICAgICAgICAgZ2V0Um9sZXNDYWxsXzEoKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBnZXRSb2xlc0NhbGxfMSgpO1xyXG4gICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgYmVnaW5FZGl0OiBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKFVzZXJDb25zdGFudHMuQkVHSU5fRURJVF9VU0VSKSkge1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmJlZ2luQWN0aW9uKFVzZXJDb25zdGFudHMuQkVHSU5fRURJVF9VU0VSKTtcclxuICAgICAgICAgICAgVXNlclNlcnZpY2VzLmdldERldGFpbCh1c2VyLlVzZXJJRCwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmICghZGF0YS5FbnRpdGxlbWVudEdyb3VwSURzKVxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuRW50aXRsZW1lbnRHcm91cElEcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFkYXRhLlJvbGVJRHMpXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5Sb2xlSURzID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIgZW50aXRsZW1lbnQgPSBbXTtcclxuICAgICAgICAgICAgICAgIHZhciByb2xlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGdldFJvbGVzQ2FsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXRSb2xlc0xpc3QoZnVuY3Rpb24gKHJvbGVEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGVzID0gcm9sZURhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRCZWdpbkVkaXQoZGF0YSwgcm9sZXMsIGVudGl0bGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oVXNlckNvbnN0YW50cy5CRUdJTl9FRElUX1VTRVIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZW5kQmVnaW5FZGl0KGRhdGEsIHJvbGVzLCBlbnRpdGxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFVzZXJDb25zdGFudHMuQkVHSU5fRURJVF9VU0VSKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBnZXRFbnRpdGxlbWVudExpc3QoZnVuY3Rpb24gKGVudGl0bGVtZW50RGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVudGl0bGVtZW50ID0gZW50aXRsZW1lbnREYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIGdldFJvbGVzQ2FsbCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0Um9sZXNDYWxsKCk7XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLkJFR0lOX0VESVRfVVNFUik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzZWxlY3RIaW50OiBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgICAgICBhY3Rpb25UeXBlOiBVc2VyQ29uc3RhbnRzLlVTRVJfU0VMRUNUX0hJTlQsXHJcbiAgICAgICAgICAgIHVzZXI6IHVzZXJcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBmaW5pc2hFZGl0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKFVzZXJTdG9yZS5nZXRIYXNDaGFuZ2VzKCkpIHtcclxuICAgICAgICAgICAgdmFyIGNhbGxiYWNrRnVuY3QgPSBVc2VyQWN0aW9ucy5jcmVhdGU7XHJcbiAgICAgICAgICAgIGlmIChVc2VyU3RvcmUuZ2V0SXNFZGl0aW5nKCkpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuY3QgPSBVc2VyQWN0aW9ucy5lZGl0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZGlzcGxheVNhdmVDaGFuZ2VzRGlhbG9nKHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IElub3Z4TG9hZGVyLnQoXCJjb21tb246bXNnQm94LnNhdmVDaGFuZ2VzXCIpLFxyXG4gICAgICAgICAgICAgICAgY29uZmlybUNhbGxiYWNrOiBjYWxsYmFja0Z1bmN0LFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsQ2FsbGJhY2s6IF9maW5pc2hFZGl0XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgX2ZpbmlzaEVkaXQoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgcmVmcmVzaERhdGE6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmdldEFsbFVzZXJzKCk7XHJcbiAgICB9LFxyXG4gICAgZ2V0SGludDogZnVuY3Rpb24gKGhpbnQsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKCFTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoVXNlckNvbnN0YW50cy5VU0VSX0NIRUNLX05BTUUpKSB7XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuYmVnaW5BY3Rpb24oVXNlckNvbnN0YW50cy5VU0VSX0NIRUNLX05BTUUpO1xyXG4gICAgICAgICAgICBVc2VyU2VydmljZXMuY2hlY2tOYW1lKGhpbnQsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZWNlaXZlSGludChkYXRhLCBjYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfQ0hFQ0tfTkFNRSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oVXNlckNvbnN0YW50cy5VU0VSX0NIRUNLX05BTUUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZ2V0Q3VycmVudFVzZXI6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKFVzZXJDb25zdGFudHMuVVNFUl9DVVJSRU5UX0dFVCkpIHtcclxuICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5iZWdpbkFjdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfQ1VSUkVOVF9HRVQpO1xyXG4gICAgICAgICAgICBVc2VyU2VydmljZXMuZ2V0Q3VycmVudFVzZXJEZXRhaWwoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHJlY2VpdmVDdXJyZW50VXNlcihkYXRhLCBjYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfQ1VSUkVOVF9HRVQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9DVVJSRU5UX0dFVCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICByZXNldExvZ2luQXR0ZW1wdHM6IGZ1bmN0aW9uICh1c2VyLCBjYWxsYmFjaykge1xyXG4gICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKFVzZXJDb25zdGFudHMuUkVTRVRfTE9HSU5fQVRURU1QVFMpKSB7XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuYmVnaW5BY3Rpb24oVXNlckNvbnN0YW50cy5SRVNFVF9MT0dJTl9BVFRFTVBUUyk7XHJcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlcy5yZXNldExvZ2luQXR0ZW1wdHModXNlciwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgVXNlclNlcnZpY2VzLmdldERldGFpbCh1c2VyLlVzZXJJRCwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogVXNlckNvbnN0YW50cy5SRVNFVF9MT0dJTl9BVFRFTVBUUyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcjogZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLlJFU0VUX0xPR0lOX0FUVEVNUFRTKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFVzZXJDb25zdGFudHMuUkVTRVRfTE9HSU5fQVRURU1QVFMpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oVXNlckNvbnN0YW50cy5SRVNFVF9MT0dJTl9BVFRFTVBUUyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBlZGl0Q3VycmVudE9iamVjdDogZnVuY3Rpb24gKGNvbXAsIGtleSwgdmFsdWUpIHtcclxuICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgYWN0aW9uVHlwZTogVXNlckNvbnN0YW50cy5VU0VSX1VQREFURV9PQkpFQ1QsXHJcbiAgICAgICAgICAgIGNvbXBvbmVudDogY29tcCxcclxuICAgICAgICAgICAga2V5OiBrZXksXHJcbiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGVkaXRDdXJyZW50T2JqZWN0QWRkVG9MaXN0OiBmdW5jdGlvbiAoY29tcCwga2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgICAgICBhY3Rpb25UeXBlOiBVc2VyQ29uc3RhbnRzLlVTRVJfVVBEQVRFX09CSkVDVF9BRERfTElTVCxcclxuICAgICAgICAgICAgY29tcG9uZW50OiBjb21wLFxyXG4gICAgICAgICAgICBrZXk6IGtleSxcclxuICAgICAgICAgICAgdmFsdWU6IHZhbHVlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZWRpdEN1cnJlbnRPYmplY3RSZW1vdmVGcm9tTGlzdDogZnVuY3Rpb24gKGNvbXAsIGtleSwgdmFsdWUpIHtcclxuICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgYWN0aW9uVHlwZTogVXNlckNvbnN0YW50cy5VU0VSX1VQREFURV9PQkpFQ1RfUkVNT1ZFX0xJU1QsXHJcbiAgICAgICAgICAgIGNvbXBvbmVudDogY29tcCxcclxuICAgICAgICAgICAga2V5OiBrZXksXHJcbiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGhpZGVTZXR0aW5nczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChVc2VyU3RvcmUuZ2V0SGFzQ2hhbmdlcygpKSB7XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZGlzcGxheVNhdmVDaGFuZ2VzRGlhbG9nKHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IElub3Z4TG9hZGVyLnQoXCJjb21tb246bXNnQm94LnNhdmVDaGFuZ2VzXCIpLFxyXG4gICAgICAgICAgICAgICAgY29uZmlybUNhbGxiYWNrOiBVc2VyQWN0aW9ucy5zYXZlU2V0dGluZ3MsXHJcbiAgICAgICAgICAgICAgICBjYW5jZWxDYWxsYmFjazogX2hpZGVTZXR0aW5nc1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIF9oaWRlU2V0dGluZ3MoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgc2F2ZVNldHRpbmdzOiBmdW5jdGlvbiAoZXJyb3JDYWxsYmFjaywgaWdub3JlVlN1aXRlTG9naW5FcnJvcikge1xyXG4gICAgICAgIGlmIChVc2VyU3RvcmUuZ2V0SXNWYWxpZE9iamVjdChVc2VyQ29uc3RhbnRzLlVTRVJfU0VUVElOR1NfRk9STSkpIHtcclxuICAgICAgICAgICAgaWYgKCFTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoVXNlckNvbnN0YW50cy5TRVRUSU5HU19TQVZFKSkge1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5iZWdpbkFjdGlvbihVc2VyQ29uc3RhbnRzLlNFVFRJTkdTX1NBVkUpO1xyXG4gICAgICAgICAgICAgICAgU2V0dGluZ3NTZXJ2aWNlLnNhdmVTZXR0aW5ncyhVc2VyU3RvcmUuZ2V0U2F2ZUZyaWVuZGx5RWRpdFNldHRpbmdzKCksIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBfaGlkZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IFVzZXJDb25zdGFudHMuU0VUVElOR1NfR0VULFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiAkLmV4dGVuZCh7fSwgVXNlclN0b3JlLmdldFNhdmVGcmllbmRseUVkaXRTZXR0aW5ncygpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogVXNlclN0b3JlLmdldFNldHRpbmdzU2hvd24oKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFVzZXJDb25zdGFudHMuU0VUVElOR1NfU0FWRSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oVXNlckNvbnN0YW50cy5TRVRUSU5HU19TQVZFKTtcclxuICAgICAgICAgICAgICAgIH0sIGlnbm9yZVZTdWl0ZUxvZ2luRXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzZW5kSW52YWxpZFNhdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZ2V0U2V0dGluZ3M6IGZ1bmN0aW9uIChkaXNwbGF5U2V0dGluZ3MsIGNhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKCFTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoVXNlckNvbnN0YW50cy5TRVRUSU5HU19HRVQpKSB7XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuYmVnaW5BY3Rpb24oVXNlckNvbnN0YW50cy5TRVRUSU5HU19HRVQpO1xyXG4gICAgICAgICAgICBTZXR0aW5nc1NlcnZpY2UuZ2V0U2V0dGluZ3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IFVzZXJDb25zdGFudHMuU0VUVElOR1NfR0VULFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZGlzcGxheVNldHRpbmdzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLlNFVFRJTkdTX0dFVCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFVzZXJDb25zdGFudHMuU0VUVElOR1NfR0VUKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGdldFVzZXJTeXN0ZW1QcmVmZXJlbmNlczogZnVuY3Rpb24gKGNhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIGVudGl0bGVtZW50ID0gW107XHJcbiAgICAgICAgdmFyIHJvbGVzID0gW107XHJcbiAgICAgICAgdmFyIGRlZmF1bHRTZXR0aW5nO1xyXG4gICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKFVzZXJDb25zdGFudHMuU1lTVEVNX1NFVFRJTkdTX0dFVCkpIHtcclxuICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5iZWdpbkFjdGlvbihVc2VyQ29uc3RhbnRzLlNZU1RFTV9TRVRUSU5HU19HRVQpO1xyXG4gICAgICAgICAgICBnZXRVc2VyU3lzdGVtU2V0dGluZyhmdW5jdGlvbiAoc2V0dGluZ0RhdGEpIHtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHRTZXR0aW5nID0gc2V0dGluZ0RhdGE7XHJcbiAgICAgICAgICAgICAgICBnZXRSb2xlc0xpc3QoZnVuY3Rpb24gKHJvbGVEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcm9sZXMgPSByb2xlRGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBnZXRFbnRpdGxlbWVudExpc3QoZnVuY3Rpb24gKGVudGl0bGVtZW50RGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdGxlbWVudCA9IGVudGl0bGVtZW50RGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0U3l0ZW1TZXR0aW5nOiBkZWZhdWx0U2V0dGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbEdyb3VwczogZW50aXRsZW1lbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxSb2xlczogcm9sZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFVzZXJDb25zdGFudHMuU1lTVEVNX1NFVFRJTkdTX0dFVCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLlNZU1RFTV9TRVRUSU5HU19HRVQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFVzZXJDb25zdGFudHMuU1lTVEVNX1NFVFRJTkdTX0dFVCk7XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oVXNlckNvbnN0YW50cy5TWVNURU1fU0VUVElOR1NfR0VUKTtcclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHNhdmVTeXN0ZW1TZXR0aW5nczogZnVuY3Rpb24gKHN5c3RlbVNldHRpbmcsIGNhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKCFTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoVXNlckNvbnN0YW50cy5TWVNURU1fU0VUVElOR1NfU0FWRSkpIHtcclxuICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5iZWdpbkFjdGlvbihVc2VyQ29uc3RhbnRzLlNZU1RFTV9TRVRUSU5HU19TQVZFKTtcclxuICAgICAgICAgICAgU2V0dGluZ3NTZXJ2aWNlLnNhdmVTeXN0ZW1TZXR0aW5ncyhzeXN0ZW1TZXR0aW5nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihVc2VyQ29uc3RhbnRzLlNZU1RFTV9TRVRUSU5HU19TQVZFKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oVXNlckNvbnN0YW50cy5TWVNURU1fU0VUVElOR1NfU0FWRSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxubW9kdWxlLmV4cG9ydHMgPSBVc2VyQWN0aW9ucztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VXNlckFjdGlvbnMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIEEg4oCYLnRzeOKAmSBmaWxlIGVuYWJsZXMgSlNYIHN1cHBvcnQgaW4gdGhlIFR5cGVTY3JpcHQgY29tcGlsZXIsIFxyXG4vLyBmb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgdGhlIGZvbGxvd2luZyBwYWdlIG9uIHRoZSBUeXBlU2NyaXB0IHdpa2k6XHJcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC93aWtpL0pTWFxyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxudmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkge1xyXG4gICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHtcclxuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxyXG4gICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfTtcclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59O1xyXG52YXIgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XHJcbnZhciBJbm92eCA9IHJlcXVpcmUoXCJzaGFyZWQud2ViLmNsaWVudFwiKTtcclxudmFyIFVzZXJBY3Rpb25zID0gcmVxdWlyZShcIi4vLi4vYWN0aW9ucy9Vc2VyQWN0aW9uc1wiKTtcclxudmFyIElub3Z4Q29udHJvbHMgPSBJbm92eC5TaGFyZWQuQ29udHJvbHM7XHJcbnZhciBDaGFuZ2VVc2VyUGFzc3dvcmQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQ2hhbmdlVXNlclBhc3N3b3JkLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ2hhbmdlVXNlclBhc3N3b3JkKHByb3BzLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMsIGNvbnRleHQpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX3VzZXIgPSB7fTtcclxuICAgICAgICBfdGhpcy5fY2hhbmdlUGFzc3dvcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBjdXJTdGF0ZSA9IF90aGlzLl9jbG9uZVN0YXRlKF90aGlzLnN0YXRlKTtcclxuICAgICAgICAgICAgaWYgKF90aGlzLl92YWxpZGF0ZVBhc3N3b3JkU3RhdGUoY3VyU3RhdGUpKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZShjdXJTdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IF90aGlzO1xyXG4gICAgICAgICAgICAgICAgVXNlckFjdGlvbnMuY2hhbmdlUGFzc3dvcmQoX3RoaXMucHJvcHMuVXNlciwgX3RoaXMuc3RhdGUubmV3UGFzc3dvcmQsIF90aGlzLnByb3BzLm9uUGFzc3dvcmRDaGFuZ2VkLCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IubWVzc2FnZU9iai5wcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5zZXRTdGF0ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW52YWxpZFZhbHVlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludmFsaWRWYWx1ZU1lc3NhZ2U6IGVycm9yLm1lc3NhZ2VPYmoubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnZhbGlkSW5wdXQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludmFsaWRJbnB1dE1lc3NhZ2U6IFwiXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZShjdXJTdGF0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl92YWxpZGF0ZVBhc3N3b3JkU3RhdGUgPSBmdW5jdGlvbiAoc3RhdGUpIHtcclxuICAgICAgICAgICAgaWYgKHN0YXRlLm5ld1Bhc3N3b3JkICE9PSBzdGF0ZS5jb25maXJtUGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgICAgIHN0YXRlLnZhbGlkYXRpb24uaW52YWxpZFZhbHVlTWVzc2FnZSA9IElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLnBhc3N3b3JkTXVzdE1hdGNoXCIpO1xyXG4gICAgICAgICAgICAgICAgc3RhdGUudmFsaWRhdGlvbi5pbnZhbGlkVmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCFzdGF0ZS5uZXdQYXNzd29yZCkge1xyXG4gICAgICAgICAgICAgICAgc3RhdGUudmFsaWRhdGlvbi5pbnZhbGlkVmFsdWVNZXNzYWdlID0gSW5vdnguU2hhcmVkLkNvbW1vbi5Db21tb25NZXNzYWdlcy5WYWxpZGF0aW9uLlJlcXVpcmVkO1xyXG4gICAgICAgICAgICAgICAgc3RhdGUudmFsaWRhdGlvbi5pbnZhbGlkVmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc3RhdGUudmFsaWRhdGlvbi5pbnZhbGlkVmFsdWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fb25QYXNzd29yZENoYW5nZWQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgdmFyIG5ld1N0YXRlID0gX3RoaXMuX2Nsb25lU3RhdGUoX3RoaXMuc3RhdGUpO1xyXG4gICAgICAgICAgICBuZXdTdGF0ZS5uZXdQYXNzd29yZCA9IGV2ZW50LnRhcmdldC52YWx1ZTtcclxuICAgICAgICAgICAgX3RoaXMuX3ZhbGlkYXRlUGFzc3dvcmRTdGF0ZShuZXdTdGF0ZSk7XHJcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKG5ld1N0YXRlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vbkNvbmZpcm1DaGFuZ2VkID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBuZXdTdGF0ZSA9IF90aGlzLl9jbG9uZVN0YXRlKF90aGlzLnN0YXRlKTtcclxuICAgICAgICAgICAgbmV3U3RhdGUuY29uZmlybVBhc3N3b3JkID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xyXG4gICAgICAgICAgICBfdGhpcy5fdmFsaWRhdGVQYXNzd29yZFN0YXRlKG5ld1N0YXRlKTtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUobmV3U3RhdGUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2Nsb25lU3RhdGUgPSBmdW5jdGlvbiAoc3RhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIG5ld1Bhc3N3b3JkOiBzdGF0ZS5uZXdQYXNzd29yZCxcclxuICAgICAgICAgICAgICAgIGNvbmZpcm1QYXNzd29yZDogc3RhdGUuY29uZmlybVBhc3N3b3JkLFxyXG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRJbnB1dDogc3RhdGUudmFsaWRhdGlvbi5pbnZhbGlkSW5wdXQsXHJcbiAgICAgICAgICAgICAgICAgICAgaW52YWxpZFZhbHVlOiBzdGF0ZS52YWxpZGF0aW9uLmludmFsaWRWYWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICBpbnZhbGlkSW5wdXRNZXNzYWdlOiBzdGF0ZS52YWxpZGF0aW9uLmludmFsaWRJbnB1dE1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgaW52YWxpZFZhbHVlTWVzc2FnZTogc3RhdGUudmFsaWRhdGlvbi5pbnZhbGlkVmFsdWVNZXNzYWdlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5zdGF0ZSA9IHtcclxuICAgICAgICAgICAgdmFsaWRhdGlvbjogeyBpbnZhbGlkSW5wdXQ6IGZhbHNlLCBpbnZhbGlkVmFsdWU6IGZhbHNlLCBpbnZhbGlkSW5wdXRNZXNzYWdlOiBcIlwiLCBpbnZhbGlkVmFsdWVNZXNzYWdlOiBcIlwiIH0sXHJcbiAgICAgICAgICAgIG5ld1Bhc3N3b3JkOiBcIlwiLFxyXG4gICAgICAgICAgICBjb25maXJtUGFzc3dvcmQ6IFwiXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIENoYW5nZVVzZXJQYXNzd29yZC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBwYXNzd29yZElucHV0ID0ge1xyXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdmb3JtLWNvbnRyb2wnLFxyXG4gICAgICAgICAgICB0eXBlOiAncGFzc3dvcmQnLFxyXG4gICAgICAgICAgICBuYW1lOiAnUGFzc3dvcmQnXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicGFuZWwgcGFuZWwtcHJpbWFyeSB1c2VyLWNoYW5nZS1wYXNzd29yZFwiIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicGFuZWwtaGVhZGluZ1wiIH0sIElub3Z4TG9hZGVyLnQoJ3VzZXJzOmZvcm0uY2hhbmdlUGFzc3dvcmRIZWFkZXInKSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicGFuZWwtYm9keSBmYy1tYXJnaW5cIiB9LFxyXG4gICAgICAgICAgICAgICAgKHRoaXMucHJvcHMubWVzc2FnZSAhPSBudWxsKSAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFwicFwiLCBudWxsLCB0aGlzLnByb3BzLm1lc3NhZ2UpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogXCJcIi5jb25jYXQoSW5vdnhMb2FkZXIudChcInVzZXJzOmZvcm0ubmV3UGFzc3dvcmRcIiksIFwiKlwiKSwgaW5wdXROYW1lOiAnUGFzc3dvcmQnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLlZhbGlkYXRpb25JbnB1dCwgX19hc3NpZ24oe30sIHBhc3N3b3JkSW5wdXQsIHsgaWQ6IFwibmV3LXB3LWlucHV0XCIsIHZhbHVlOiB0aGlzLnN0YXRlLm5ld1Bhc3N3b3JkLCBvbkNoYW5nZTogdGhpcy5fb25QYXNzd29yZENoYW5nZWQsIHZhbGlkYXRpb246IHRoaXMuc3RhdGUudmFsaWRhdGlvbiwgYXV0b2NvbXBsZXRlOiBcIm5ldy1wYXNzd29yZFwiIH0pKSksXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBcIlwiLmNvbmNhdChJbm92eExvYWRlci50KFwidXNlcnM6Zm9ybS5jb25maXJtUGFzc3dvcmRcIiksIFwiKlwiKSwgaW5wdXROYW1lOiAnUGFzc3dvcmQnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLlZhbGlkYXRpb25JbnB1dCwgX19hc3NpZ24oe30sIHBhc3N3b3JkSW5wdXQsIHsgaWQ6IFwiY29uZmlybS1wdy1pbnB1dFwiLCB2YWx1ZTogdGhpcy5zdGF0ZS5jb25maXJtUGFzc3dvcmQsIG9uQ2hhbmdlOiB0aGlzLl9vbkNvbmZpcm1DaGFuZ2VkLCB2YWxpZGF0aW9uOiB0aGlzLnN0YXRlLnZhbGlkYXRpb24sIGF1dG9jb21wbGV0ZTogXCJuZXctcGFzc3dvcmRcIiB9KSkpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJidG4tYmFyLWItc21cIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIiwgeyBpZDogXCJjaGFuZ2UtcHctb2stYnRuXCIsIHR5cGU6IFwiYnV0dG9uXCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLXByaW1hcnlcIiwgb25DbGljazogdGhpcy5fY2hhbmdlUGFzc3dvcmQgfSwgSW5vdnhMb2FkZXIudCgndXNlcnM6Zm9ybS5jaGFuZ2VQYXNzd29yZCcpKSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIsIHsgaWQ6IFwiY2hhbmdlLXB3LWNhbmNlbC1idG5cIiwgdHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImJ0biBidG4tZGVmYXVsdFwiLCBvbkNsaWNrOiB0aGlzLnByb3BzLm9uQ2FuY2VsIH0sIElub3Z4TG9hZGVyLnQoJ3VzZXJzOmZvcm0uY2FuY2VsJykpKSkpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ2hhbmdlVXNlclBhc3N3b3JkO1xyXG59KFJlYWN0LkNvbXBvbmVudCkpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IENoYW5nZVVzZXJQYXNzd29yZDtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2hhbmdldXNlcnBhc3N3b3JkLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG4vLyBBIOKAmC50c3jigJkgZmlsZSBlbmFibGVzIEpTWCBzdXBwb3J0IGluIHRoZSBUeXBlU2NyaXB0IGNvbXBpbGVyLCBcclxuLy8gZm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIHRoZSBmb2xsb3dpbmcgcGFnZSBvbiB0aGUgVHlwZVNjcmlwdCB3aWtpOlxyXG4vLyBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQvd2lraS9KU1hcclxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSlcclxuICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufTtcclxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBVc2VyRm9ybSA9IHJlcXVpcmUoXCIuL1VzZXJGb3JtXCIpO1xyXG52YXIgVXNlclZpZXcgPSByZXF1aXJlKFwiLi9Vc2VyVmlld1wiKTtcclxudmFyIFVzZXJTZXR0aW5ncyA9IHJlcXVpcmUoXCIuL1VzZXJTZXR0aW5nc1wiKTtcclxudmFyIFVzZXJTdG9yZSA9IHJlcXVpcmUoXCIuLy4uL3N0b3Jlcy9Vc2VyU3RvcmVcIik7XHJcbnZhciBVc2VyQWN0aW9ucyA9IHJlcXVpcmUoXCIuLy4uL2FjdGlvbnMvVXNlckFjdGlvbnNcIik7XHJcbnZhciBVc2VyQ29uc3RhbnRzID0gcmVxdWlyZShcIi4vLi4vY29uc3RhbnRzL1VzZXJDb25zdGFudHNcIik7XHJcbnZhciBVc2VyUGVybWlzc2lvbk5hbWUgPSByZXF1aXJlKFwiLi8uLi9jb25zdGFudHMvVXNlclBlcm1pc3Npb25OYW1lc1wiKTtcclxudmFyIFVzZXJTeXN0ZW1QcmVmZXJlbmNlcyA9IHJlcXVpcmUoXCIuL1VzZXJTeXN0ZW1QcmVmZXJlbmNlc1wiKTtcclxudmFyIFN5c3RlbUFjdGlvbnMgPSBJbm92eC5TaGFyZWQuU3lzdGVtLkFjdGlvbnM7XHJcbnZhciBTeXN0ZW1TdG9yZSA9IElub3Z4LlNoYXJlZC5TeXN0ZW0uU3RvcmU7XHJcbnZhciBVcmxVdGlsaXRpZXMgPSBJbm92eC5TaGFyZWQuQ29tbW9uLlVybFV0aWxpdGllcztcclxudmFyIFBlcm1pc3Npb25TZXJ2aWNlID0gSW5vdnguU2hhcmVkLlBlcm1pc3Npb24uUGVybWlzc2lvblNlcnZpY2U7XHJcbnZhciBQcmVmZXJlbmNlc0FjdGlvbnMgPSBJbm92eC5TaGFyZWQuUHJlZmVyZW5jZXMuQWN0aW9ucztcclxudmFyIFByZWZlcmVuY2VzU3RvcmUgPSBJbm92eC5TaGFyZWQuUHJlZmVyZW5jZXMuU3RvcmU7XHJcbmZ1bmN0aW9uIGdldEFjdGlvbkluUHJvZ3Jlc3MoKSB7XHJcbiAgICByZXR1cm4gU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKFVzZXJDb25zdGFudHMuVVNFUl9ERUxFVEUpIHx8IFN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhVc2VyQ29uc3RhbnRzLlNFVFRJTkdTX0dFVClcclxuICAgICAgICB8fCBTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoVXNlckNvbnN0YW50cy5CRUdJTl9FRElUX1VTRVIpIHx8IFN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhVc2VyQ29uc3RhbnRzLkJFR0lOX1VTRVJfQUREKTtcclxufVxyXG5mdW5jdGlvbiBnZXRVc2VyU3RhdGUoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGFsbFVzZXJzOiBVc2VyU3RvcmUuZ2V0QWxsKCksXHJcbiAgICAgICAgbW9kYWxWaXNpYmxlOiBVc2VyU3RvcmUuZ2V0TW9kYWxWaXNpYmxlKCksXHJcbiAgICAgICAgaXNBY3Rpb25JblByb2dyZXNzOiBnZXRBY3Rpb25JblByb2dyZXNzKCksXHJcbiAgICAgICAgYXV0aGVudGljYXRpb25Nb2RlOiBVc2VyU3RvcmUuZ2V0U2V0dGluZ3MoKS5BdXRoZW50aWNhdGlvbk1vZGUsXHJcbiAgICAgICAgc2V0dGluZ3NTaG93bjogVXNlclN0b3JlLmdldFNldHRpbmdzU2hvd24oKVxyXG4gICAgfTtcclxufVxyXG52YXIgVXNlckFwcCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhVc2VyQXBwLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVXNlckFwcChwcm9wcywgY29udGV4dCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsICd1c2VycycsIHByb3BzLCBjb250ZXh0KSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9vbkNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoZ2V0VXNlclN0YXRlKCkpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX29uU3lzdGVtQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgICAgICAgICBpc0FjdGlvbkluUHJvZ3Jlc3M6IGdldEFjdGlvbkluUHJvZ3Jlc3MoKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9oaWRlTW9kYWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5zZXR0aW5nc1Nob3duKSB7XHJcbiAgICAgICAgICAgICAgICBVc2VyQWN0aW9ucy5oaWRlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIFVzZXJBY3Rpb25zLmZpbmlzaEVkaXQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2JlZ2luRWRpdFVzZXIgPSBmdW5jdGlvbiAoZSwgdXNlcikge1xyXG4gICAgICAgICAgICBVc2VyQWN0aW9ucy5iZWdpbkVkaXQodXNlcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fZGVsZXRlVXNlciA9IGZ1bmN0aW9uIChlLCB1c2VyKSB7XHJcbiAgICAgICAgICAgIHZhciBtZXNzYWdlT2JqZWN0ID0ge1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogSW5vdnhMb2FkZXIudCgndXNlcnM6bWVzc2FnZS5jb25maXJtRGVsZXRlJyksXHJcbiAgICAgICAgICAgICAgICBjb25maXJtQ2FsbGJhY2s6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBVc2VyQWN0aW9ucy5kZWxldGUodXNlciwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZGlzcGxheUNvbmZpcm1hdGlvbk1lc3NhZ2UobWVzc2FnZU9iamVjdCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fc2hvd0FkZFVzZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFVzZXJBY3Rpb25zLmJlZ2luQWRkKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fc2hvd1NldHRpbmdzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBVc2VyQWN0aW9ucy5nZXRTZXR0aW5ncyh0cnVlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBVc2VyQWN0aW9ucy5nZXRBbGxVc2VycyhmdW5jdGlvbiAoKSB7IHJldHVybiBVc2VyQWN0aW9ucy5nZXRTZXR0aW5ncyhmYWxzZSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2FwcExvYWRlZCA9IHRydWU7IH0pOyB9LCBmdW5jdGlvbiAoZXJyb3IpIHsgcmV0dXJuIF90aGlzLl9oYW5kbGVQZXJtaXNzaW9uRXJyb3IoZXJyb3IpOyB9LCB0cnVlKTtcclxuICAgICAgICAgICAgVXNlckFjdGlvbnMuZ2V0Q3VycmVudFVzZXIoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2FwcExvYWRlZCA9IHRydWU7IH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2NyZWF0ZVVzZXJTeXN0ZW1QcmVmZXJlbmNlc0NvbXBvbmVudCA9IGZ1bmN0aW9uIChwcm9wcykge1xyXG4gICAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChVc2VyU3lzdGVtUHJlZmVyZW5jZXMsIHByb3BzKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9lbmFibGVTeXN0ZW1QcmVmZXJlbmNlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGhhc1VzZXJTZXR0aW5ncyA9IFBlcm1pc3Npb25TZXJ2aWNlLmNoZWNrUGVybWlzc2lvbihVc2VyUGVybWlzc2lvbk5hbWUuVVNFUl9TRVRUSU5HUyk7XHJcbiAgICAgICAgICAgIHZhciBoYXNFbnRpdGxlbWVudFBlcm1pc3Npb24gPSBQZXJtaXNzaW9uU2VydmljZS5jaGVja1Blcm1pc3Npb24oVXNlclBlcm1pc3Npb25OYW1lLkVOVElUTEVNRU5UX01BTkFHRSk7XHJcbiAgICAgICAgICAgIHZhciBoYXNSb2xlUGVybWlzc2lvbiA9IFBlcm1pc3Npb25TZXJ2aWNlLmNoZWNrUGVybWlzc2lvbihVc2VyUGVybWlzc2lvbk5hbWUuUk9MRV9NQU5BR0UpO1xyXG4gICAgICAgICAgICB2YXIgaGFzVXNlclZpZXdQZXJtaXNzaW9uID0gUGVybWlzc2lvblNlcnZpY2UuY2hlY2tQZXJtaXNzaW9uKFVzZXJQZXJtaXNzaW9uTmFtZS5VU0VSX1ZJRVcpO1xyXG4gICAgICAgICAgICB2YXIgaGFzVXNlck1hbmFnZVBlcm1pc3Npb24gPSBQZXJtaXNzaW9uU2VydmljZS5jaGVja1Blcm1pc3Npb24oVXNlclBlcm1pc3Npb25OYW1lLlVTRVJfTUFOQUdFKTtcclxuICAgICAgICAgICAgaWYgKGhhc1VzZXJTZXR0aW5ncyAmJiBoYXNSb2xlUGVybWlzc2lvbiAmJiBoYXNFbnRpdGxlbWVudFBlcm1pc3Npb24gJiYgKGhhc1VzZXJWaWV3UGVybWlzc2lvbiB8fCBoYXNVc2VyTWFuYWdlUGVybWlzc2lvbikpXHJcbiAgICAgICAgICAgICAgICBQcmVmZXJlbmNlc0FjdGlvbnMucmVnaXN0ZXJDcmVhdGVVc2VyU3lzdGVtUHJlZmVyZW5jZXNDb21wb25lbnQoX3RoaXMuX2NyZWF0ZVVzZXJTeXN0ZW1QcmVmZXJlbmNlc0NvbXBvbmVudCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5zdGF0ZSA9IGdldFVzZXJTdGF0ZSgpO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFVzZXJBcHAucHJvdG90eXBlLmNvbXBvbmVudFdpbGxNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmNvbXBvbmVudFdpbGxNb3VudEJhc2UoKTtcclxuICAgIH07XHJcbiAgICBVc2VyQXBwLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBVc2VyU3RvcmUuYWRkQ2hhbmdlTGlzdGVuZXIodGhpcy5fb25DaGFuZ2UpO1xyXG4gICAgICAgIFN5c3RlbVN0b3JlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX29uU3lzdGVtQ2hhbmdlKTtcclxuICAgICAgICB0aGlzLl9lbmFibGVTeXN0ZW1QcmVmZXJlbmNlcygpO1xyXG4gICAgfTtcclxuICAgIFVzZXJBcHAucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIFVzZXJTdG9yZS5yZW1vdmVDaGFuZ2VMaXN0ZW5lcih0aGlzLl9vbkNoYW5nZSk7XHJcbiAgICAgICAgU3lzdGVtU3RvcmUucmVtb3ZlQ2hhbmdlTGlzdGVuZXIodGhpcy5fb25TeXN0ZW1DaGFuZ2UpO1xyXG4gICAgICAgIFByZWZlcmVuY2VzQWN0aW9ucy5yZWdpc3RlckNyZWF0ZVVzZXJTeXN0ZW1QcmVmZXJlbmNlc0NvbXBvbmVudChudWxsKTtcclxuICAgIH07XHJcbiAgICBVc2VyQXBwLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGhhc1VzZXJNYW5hZ2UgPSBQZXJtaXNzaW9uU2VydmljZS5jaGVja1Blcm1pc3Npb24oVXNlclBlcm1pc3Npb25OYW1lLlVTRVJfTUFOQUdFKTtcclxuICAgICAgICB2YXIgaGFzVXNlclNldHRpbmdzID0gUGVybWlzc2lvblNlcnZpY2UuY2hlY2tQZXJtaXNzaW9uKFVzZXJQZXJtaXNzaW9uTmFtZS5VU0VSX1NFVFRJTkdTKTtcclxuICAgICAgICB2YXIgY29sdW1ucyA9IFt7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJFbWFpbFwiLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyVGV4dDogSW5vdnhMb2FkZXIudCgndXNlcnM6Y29tbW9uLmVtYWlsJyksXHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxyXG4gICAgICAgICAgICAgICAgd2lkdGg6IFwiYXV0b1wiXHJcbiAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBcIkZpcnN0TmFtZVwiLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyVGV4dDogSW5vdnhMb2FkZXIudCgndXNlcnM6Y29tbW9uLmZpcnN0bmFtZScpLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxyXG4gICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJMYXN0TmFtZVwiLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyVGV4dDogSW5vdnhMb2FkZXIudCgndXNlcnM6Y29tbW9uLmxhc3RuYW1lJyksXHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXHJcbiAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBcIkVuYWJsZWRcIixcclxuICAgICAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoJ3VzZXJzOmNvbW1vbi51c2VyU3RhdHVzJyksXHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcclxuICAgICAgICAgICAgICAgIHdpZHRoOiBcIjE0MHB4XCIsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IFtcclxuICAgICAgICAgICAgICAgICAgICB7IHZhbHVlOiB0cnVlLCB0ZXh0OiBJbm92eExvYWRlci50KCd1c2Vyczpjb21tb24uZW5hYmxlZCcpIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogZmFsc2UsIHRleHQ6IElub3Z4TG9hZGVyLnQoJ3VzZXJzOmNvbW1vbi5kaXNhYmxlZCcpIH1cclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfV07XHJcbiAgICAgICAgdmFyIGNvbW1hbmRzID0ge1xyXG4gICAgICAgICAgICBjb21tYW5kOiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZTogXCJnbHlwaGljb24gZ2x5cGhpY29uLXBlbmNpbFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJncmlkLWJ1dHRvblwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrOiB0aGlzLl9iZWdpbkVkaXRVc2VyXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIHdpZHRoOiBcIjg1cHhcIixcclxuICAgICAgICAgICAgaGVhZGVyVGV4dDogSW5vdnhMb2FkZXIudCgndXNlcnM6Y29tbW9uLmNvbW1hbmRzJylcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBtYW5hZ2VVc2VyQ29tbWFuZCA9IHtcclxuICAgICAgICAgICAgaWNvbkNsYXNzTmFtZTogXCJnbHlwaGljb24gZ2x5cGhpY29uLXRyYXNoXCIsXHJcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJncmlkLWJ1dHRvblwiLFxyXG4gICAgICAgICAgICBjbGljazogdGhpcy5fZGVsZXRlVXNlclxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGhhc1VzZXJNYW5hZ2UpIHtcclxuICAgICAgICAgICAgY29tbWFuZHMuY29tbWFuZC5wdXNoKG1hbmFnZVVzZXJDb21tYW5kKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGRlZmF1bHRTb3J0ID0gW3tcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBcIkVtYWlsXCIsXHJcbiAgICAgICAgICAgICAgICBkaXI6IFwiYXNjZW5kaW5nXCJcclxuICAgICAgICAgICAgfV07XHJcbiAgICAgICAgdmFyIGJ0bnMgPSBbXTtcclxuICAgICAgICB2YXIgaWNvbkhlYWRlclByb3BzID0ge1xyXG4gICAgICAgICAgICBpY29uVXJsOiBcIlwiLmNvbmNhdChVcmxVdGlsaXRpZXMuZ2V0QmFzZUFwcGxpY2F0aW9uVXJsKCksIFwiL2ltYWdlcy9Vc2Vycy5wbmdcIiksXHJcbiAgICAgICAgICAgIGljb25BdHQ6IHsgYWx0OiBcInVzZXJzXCIgfSxcclxuICAgICAgICAgICAgdGl0bGU6IElub3Z4TG9hZGVyLnQoJ3VzZXJzOmhlYWRlci51c2VycycpLFxyXG4gICAgICAgICAgICByY0NsYXNzOiBcImNkLWJ0biBhZGQtYnRuXCIsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoaGFzVXNlck1hbmFnZSkge1xyXG4gICAgICAgICAgICBidG5zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5fc2hvd0FkZFVzZXIsXHJcbiAgICAgICAgICAgICAgICBidG5Vcmw6IFwiXCIuY29uY2F0KFVybFV0aWxpdGllcy5nZXRCYXNlQXBwbGljYXRpb25VcmwoKSwgXCIvaW1hZ2VzL2FkZHVzZXIucG5nXCIpLFxyXG4gICAgICAgICAgICAgICAgYnRuQXR0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWx0OiBJbm92eExvYWRlci50KFwidXNlcnM6aGVhZGVyLm5ld1VzZXJcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IElub3Z4TG9hZGVyLnQoXCJ1c2VyczpoZWFkZXIubmV3VXNlclwiKSxcclxuICAgICAgICAgICAgICAgICAgICBpZDogJ3VzZXJBcHAtYWRkVXNlci1idG4nXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGhhc1VzZXJTZXR0aW5ncykge1xyXG4gICAgICAgICAgICBidG5zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5fc2hvd1NldHRpbmdzLFxyXG4gICAgICAgICAgICAgICAgYnRuVXJsOiBcIlwiLmNvbmNhdChVcmxVdGlsaXRpZXMuZ2V0QmFzZUFwcGxpY2F0aW9uVXJsKCksIFwiL2ltYWdlcy9BdXRoZW50aWNhdGlvbnNldHRpbmdzLnBuZ1wiKSxcclxuICAgICAgICAgICAgICAgIGJ0bkF0dDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsdDogSW5vdnhMb2FkZXIudChcInVzZXJzOnNldHRpbmdzRm9ybS5oZWFkZXJUaXRsZVwiKSxcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogSW5vdnhMb2FkZXIudChcInVzZXJzOnNldHRpbmdzRm9ybS5oZWFkZXJUaXRsZVwiKSxcclxuICAgICAgICAgICAgICAgICAgICBpZDogJ3VzZXJBcHAtYXV0aGVuLXNldHRpbmdzLWJ0bidcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpY29uSGVhZGVyUHJvcHMuYnRuVXJscyA9IGJ0bnM7XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5Db3JlLlJlYWN0TG9hZGVyLCB7IGFwcFJlYWR5OiB0aGlzLmlzQXBwTG9hZGVkKCksIGVycm9yU3RhdHVzOiB0aGlzLl9lcnJvclN0YXR1cyB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInVzZXItYXBwLWNvbnRlbnRcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuQ29udHJvbHMuSWYsIHsgY29uZGl0aW9uOiB0aGlzLnN0YXRlLmlzQWN0aW9uSW5Qcm9ncmVzcywgY2xhc3M6ICd0ZW1wLW1vZGFsLWxvYWRlcicgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImFjdGlvbi1pbi1wcm9ncmVzcy1sb2FkZXItbHJnXCIgfSkpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuTGF5b3V0Lkljb25IZWFkZXIsIF9fYXNzaWduKHt9LCBpY29uSGVhZGVyUHJvcHMpKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnguU2hhcmVkLkNvbnRyb2xzLkdyaWQsIHsgZGF0YVNvdXJjZTogdGhpcy5zdGF0ZS5hbGxVc2VycywgY29sdW1uczogY29sdW1ucywgY29tbWFuZHM6IGNvbW1hbmRzLCBzb3J0OiB0cnVlLCBmaWx0ZXI6IHRydWUsIHBhZ2VhYmxlOiB7IHBhZ2VDb3VudDogNSwgcGFnZVNpemVzOiBbMTAsIDIwLCA1MF0sIHBhZ2VTaXplOiAxMCB9LCBkZWZhdWx0U29ydDogZGVmYXVsdFNvcnQgfSkpLFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5Db250cm9scy5Nb2RhbFNsaWRlciwgeyBpc09wZW46IHRoaXMuc3RhdGUubW9kYWxWaXNpYmxlLCBvbkNsb3NlOiB0aGlzLl9oaWRlTW9kYWwgfSwgdGhpcy5zdGF0ZS5zZXR0aW5nc1Nob3duID9cclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVXNlclNldHRpbmdzLCBudWxsKSA6XHJcbiAgICAgICAgICAgICAgICBoYXNVc2VyTWFuYWdlID8gUmVhY3QuY3JlYXRlRWxlbWVudChVc2VyRm9ybSwgbnVsbCkgOiBSZWFjdC5jcmVhdGVFbGVtZW50KFVzZXJWaWV3LCBudWxsKSkpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVXNlckFwcDtcclxufShJbm92eC5TaGFyZWQuUmVhY3RFeHQuQmFzZUFwcENvbXBvbmVudCkpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IFVzZXJBcHA7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVVzZXJBcHAuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJjaGFuZ2V1c2VycGFzc3dvcmQudHN4XCIgLz5cclxuLy8gQSDigJgudHN44oCZIGZpbGUgZW5hYmxlcyBKU1ggc3VwcG9ydCBpbiB0aGUgVHlwZVNjcmlwdCBjb21waWxlciwgXHJcbi8vIGZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSB0aGUgZm9sbG93aW5nIHBhZ2Ugb24gdGhlIFR5cGVTY3JpcHQgd2lraTpcclxuLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L3dpa2kvSlNYXHJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBmdW5jdGlvbiAoKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXHJcbiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn07XHJcbnZhciBSZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcclxudmFyIFVzZXJTdG9yZSA9IHJlcXVpcmUoXCIuLy4uL3N0b3Jlcy9Vc2VyU3RvcmVcIik7XHJcbnZhciBVc2VyQ29uc3RhbnRzID0gcmVxdWlyZShcIi4vLi4vY29uc3RhbnRzL1VzZXJDb25zdGFudHNcIik7XHJcbnZhciBVc2VyQWN0aW9ucyA9IHJlcXVpcmUoXCIuLy4uL2FjdGlvbnMvVXNlckFjdGlvbnNcIik7XHJcbnZhciBVc2VyU2VsZWN0ID0gcmVxdWlyZShcIi4vLi4vY29tcG9uZW50cy9Vc2VyU2VsZWN0XCIpO1xyXG52YXIgQ2hhbmdlVXNlclBhc3N3b3JkID0gcmVxdWlyZShcIi4vLi4vY29tcG9uZW50cy9DaGFuZ2VVc2VyUGFzc3dvcmRcIik7XHJcbnZhciBVc2VyUGVybWlzc2lvbk5hbWUgPSByZXF1aXJlKFwiLi8uLi9jb25zdGFudHMvVXNlclBlcm1pc3Npb25OYW1lc1wiKTtcclxudmFyIEF1dGhlbnRpY2F0aW9uTW9kZUVudW0gPSByZXF1aXJlKFwiLi8uLi9jb25zdGFudHMvQXV0aGVudGljYXRpb25Nb2RlRW51bVwiKTtcclxudmFyIEV4dGVybmFsUHJvdmlkZXJFbnVtID0gcmVxdWlyZShcIi4vLi4vY29uc3RhbnRzL0V4dGVybmFsUHJvdmlkZXJFbnVtXCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBTeXN0ZW1BY3Rpb25zID0gSW5vdnguU2hhcmVkLlN5c3RlbS5BY3Rpb25zO1xyXG52YXIgU3lzdGVtU3RvcmUgPSBJbm92eC5TaGFyZWQuU3lzdGVtLlN0b3JlO1xyXG52YXIgSW5vdnhDb250cm9scyA9IElub3Z4LlNoYXJlZC5Db250cm9scztcclxudmFyIFBlcm1pc3Npb25TZXJ2aWNlID0gSW5vdnguU2hhcmVkLlBlcm1pc3Npb24uUGVybWlzc2lvblNlcnZpY2U7XHJcbmZ1bmN0aW9uIGdldEFjdGlvbkluUHJvZ3Jlc3MoKSB7XHJcbiAgICByZXR1cm4gU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKFVzZXJDb25zdGFudHMuVVNFUl9BREQpIHx8XHJcbiAgICAgICAgU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKFVzZXJDb25zdGFudHMuVVNFUl9FRElUKSB8fFxyXG4gICAgICAgIFN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhVc2VyQ29uc3RhbnRzLlVTRVJfQ0hFQ0tfTkFNRSk7XHJcbn1cclxudmFyIF9pc1ZhbGlkQURVc2VySUQ7XHJcbnZhciBfZGlzcGxheVNlbGVjdFVzZXJTdGF0ZTtcclxudmFyIF9kaXNwbGF5UGFzc3dvcmRDaGFuZ2U7XHJcbnZhciBfYWN0aW9uSW5Qcm9ncmVzc01zZztcclxudmFyIF91c2VFeHRlcm5hbEFjY291bnQ7XHJcbmZ1bmN0aW9uIGdldEZvcm1TdGF0ZSgpIHtcclxuICAgIHZhciB1c2VyID0gVXNlclN0b3JlLmdldEVkaXRVc2VyKCk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGVkaXRVc2VyOiB1c2VyLFxyXG4gICAgICAgIGlzQWRkaW5nOiBVc2VyU3RvcmUuZ2V0SXNBZGRpbmcoKSxcclxuICAgICAgICBpc0VkaXRpbmc6IFVzZXJTdG9yZS5nZXRJc0VkaXRpbmcoKSxcclxuICAgICAgICBkaXNwbGF5U2VsZWN0VXNlcjogX2Rpc3BsYXlTZWxlY3RVc2VyU3RhdGUsXHJcbiAgICAgICAgZGlzcGxheVBhc3N3b3JkQ2hhbmdlOiBfZGlzcGxheVBhc3N3b3JkQ2hhbmdlLFxyXG4gICAgICAgIGlzQWN0aW9uSW5Qcm9ncmVzczogZ2V0QWN0aW9uSW5Qcm9ncmVzcygpLFxyXG4gICAgICAgIGFjdGlvbkluUHJvZ3Jlc3NNc2c6IF9hY3Rpb25JblByb2dyZXNzTXNnLFxyXG4gICAgICAgIHZhbGlkYXRpb246IFVzZXJTdG9yZS5nZXRWYWxpZGF0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STSksXHJcbiAgICAgICAgYXV0aGVudGljYXRpb25Nb2RlOiBVc2VyU3RvcmUuZ2V0U2V0dGluZ3MoKS5BdXRoZW50aWNhdGlvbk1vZGUsXHJcbiAgICAgICAgZXh0ZXJuYWxQcm92aWRlck5hbWU6IFVzZXJTdG9yZS5nZXRTZXR0aW5ncygpLkV4dGVybmFsUHJvdmlkZXJOYW1lLFxyXG4gICAgICAgIGhhc0VudGl0bGVtZW50UGVybWlzc2lvbjogUGVybWlzc2lvblNlcnZpY2UuY2hlY2tQZXJtaXNzaW9uKFVzZXJQZXJtaXNzaW9uTmFtZS5FTlRJVExFTUVOVF9NQU5BR0UpLFxyXG4gICAgICAgIGhhc1JvbGVQZXJtaXNzaW9uOiBQZXJtaXNzaW9uU2VydmljZS5jaGVja1Blcm1pc3Npb24oVXNlclBlcm1pc3Npb25OYW1lLlJPTEVfTUFOQUdFKSxcclxuICAgICAgICBlbnRpdGxlbWVudDogVXNlclN0b3JlLmdldFZhbGlkRW50aXRsZW1lbnRzKCksXHJcbiAgICAgICAgcm9sZXM6IFVzZXJTdG9yZS5nZXRWYWxpZFJvbGVzKCksXHJcbiAgICAgICAgaXNWYWxpZEFEVXNlcklEOiBfaXNWYWxpZEFEVXNlcklELFxyXG4gICAgICAgIHVzZUV4dGVybmFsQWNjb3VudDogX3VzZUV4dGVybmFsQWNjb3VudFxyXG4gICAgfTtcclxufVxyXG52YXIgVXNlckZvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVXNlckZvcm0sIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBVc2VyRm9ybShwcm9wcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9vbkNoYW5nZSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBVc2VyQWN0aW9ucy5lZGl0Q3VycmVudE9iamVjdChVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk0sIGV2ZW50LnRhcmdldC5uYW1lLCBldmVudC50YXJnZXQudmFsdWUpO1xyXG4gICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0Lm5hbWUgPT0gXCJFeHRlcm5hbEFjY291bnRVc2VyTmFtZVwiKSB7XHJcbiAgICAgICAgICAgICAgICBVc2VyQWN0aW9ucy5lZGl0Q3VycmVudE9iamVjdChVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk0sIFwiRXh0ZXJuYWxBY2NvdW50SURcIiwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICBfaXNWYWxpZEFEVXNlcklEID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGlzVmFsaWRBRFVzZXJJRDogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vblVzZUV4dGVybmFsQWNjb3VudENoYW5nZSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkKSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBfdXNlRXh0ZXJuYWxBY2NvdW50ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIFVzZXJBY3Rpb25zLmVkaXRDdXJyZW50T2JqZWN0KFVzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STSwgXCJFeHRlcm5hbEFjY291bnRJRFwiLCBcIlwiKTtcclxuICAgICAgICAgICAgICAgIFVzZXJBY3Rpb25zLmVkaXRDdXJyZW50T2JqZWN0KFVzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STSwgXCJFeHRlcm5hbEFjY291bnRVc2VyTmFtZVwiLCBcIlwiKTtcclxuICAgICAgICAgICAgICAgIF91c2VFeHRlcm5hbEFjY291bnQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHVzZUV4dGVybmFsQWNjb3VudDogdmFsdWUgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fb25Sb2xlc1NlbGVjdCA9IGZ1bmN0aW9uIChyb2xlT2JqLCBzZWxlY3RlZCkge1xyXG4gICAgICAgICAgICBfdGhpcy5fb25TZWxlY3QoJ1JvbGVJRHMnLCByb2xlT2JqLCBzZWxlY3RlZCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fb25FbnRpdGxlbWVudFNlbGVjdCA9IGZ1bmN0aW9uIChlbnRpdGxlbWVudE9iaiwgc2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgX3RoaXMuX29uU2VsZWN0KCdFbnRpdGxlbWVudEdyb3VwSURzJywgZW50aXRsZW1lbnRPYmosIHNlbGVjdGVkKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vblNlbGVjdCA9IGZ1bmN0aW9uIChuYW1lLCBvYmosIHNlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZCkge1xyXG4gICAgICAgICAgICAgICAgVXNlckFjdGlvbnMuZWRpdEN1cnJlbnRPYmplY3RBZGRUb0xpc3QoVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNLCBuYW1lLCBvYmouSUQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgVXNlckFjdGlvbnMuZWRpdEN1cnJlbnRPYmplY3RSZW1vdmVGcm9tTGlzdChVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk0sIG5hbWUsIG9iai5JRCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vbkNoZWNrQ2hhbmdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIFVzZXJBY3Rpb25zLmVkaXRDdXJyZW50T2JqZWN0KFVzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STSwgZXZlbnQudGFyZ2V0Lm5hbWUsIGV2ZW50LnRhcmdldC52YWx1ZSA9PT0gXCJ0cnVlXCIpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2xvYWRTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoZ2V0Rm9ybVN0YXRlKCkpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX3N5c3RlbUNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICAgICAgaXNBY3Rpb25JblByb2dyZXNzOiBnZXRBY3Rpb25JblByb2dyZXNzKClcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fc2F2ZVVzZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICghX3RoaXMuc3RhdGUuaXNWYWxpZEFEVXNlcklEICYmIF90aGlzLnN0YXRlLmF1dGhlbnRpY2F0aW9uTW9kZSAhPSBBdXRoZW50aWNhdGlvbk1vZGVFbnVtLkxvY2FsT25seSAmJiBfdGhpcy5zdGF0ZS51c2VFeHRlcm5hbEFjY291bnQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjaGVja01lc3NhZ2UgPSBJbm92eExvYWRlci50KCd1c2VyczptZXNzYWdlLmNoZWNrQXp1cmVBRFVzZXInKTtcclxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5leHRlcm5hbFByb3ZpZGVyTmFtZSA9PSBFeHRlcm5hbFByb3ZpZGVyRW51bS5BREZTKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tNZXNzYWdlID0gSW5vdnhMb2FkZXIudCgndXNlcnM6bWVzc2FnZS5jaGVja0FkZnNVc2VyJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZU9iamVjdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBjaGVja01lc3NhZ2VcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmRpc3BsYXlXYXJuaW5nTWVzc2FnZShtZXNzYWdlT2JqZWN0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5pc0FkZGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgIFVzZXJBY3Rpb25zLmNyZWF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXNlckFjdGlvbnMuZWRpdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBhY3Rpb25JblByb2dyZXNzTXNnOiBJbm92eExvYWRlci50KCd1c2Vyczpmb3JtLnNhdmluZycpIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBVc2VyQWN0aW9ucy5maW5pc2hFZGl0KCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2hlY2tOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGRpc3BsYXlTZWxlY3RVc2VyOiB0cnVlIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2Nsb3NlU2VsZWN0VXNlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX2Rpc3BsYXlTZWxlY3RVc2VyU3RhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICAgICAgdXNlckhpbnRzOiBbXSxcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlTZWxlY3RVc2VyOiBfZGlzcGxheVNlbGVjdFVzZXJTdGF0ZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9jbG9zZUNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfZGlzcGxheVBhc3N3b3JkQ2hhbmdlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHtcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlQYXNzd29yZENoYW5nZTogX2Rpc3BsYXlQYXNzd29yZENoYW5nZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vbkNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfZGlzcGxheVBhc3N3b3JkQ2hhbmdlID0gdHJ1ZTtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICAgICAgZGlzcGxheVBhc3N3b3JkQ2hhbmdlOiBfZGlzcGxheVBhc3N3b3JkQ2hhbmdlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX29uUmVzZXRMb2dpbkF0dGVtcHRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBVc2VyQWN0aW9ucy5yZXNldExvZ2luQXR0ZW1wdHMoX3RoaXMuc3RhdGUuZWRpdFVzZXIpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2ZpbGxVc2VyID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgICAgaWYgKHVzZXIgJiYgdXNlci5Vc2VySUQpIHtcclxuICAgICAgICAgICAgICAgIF9kaXNwbGF5U2VsZWN0VXNlclN0YXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuc3RhdGUuaXNFZGl0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXNlckFjdGlvbnMuZWRpdEN1cnJlbnRPYmplY3QoVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNLCBcIkV4dGVybmFsQWNjb3VudFVzZXJOYW1lXCIsIHVzZXIuVXNlck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIFVzZXJBY3Rpb25zLmVkaXRDdXJyZW50T2JqZWN0KFVzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STSwgXCJFeHRlcm5hbEFjY291bnRJRFwiLCB1c2VyLlVzZXJJRCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBVc2VyQWN0aW9ucy5zZWxlY3RIaW50KHVzZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIFVzZXJBY3Rpb25zLmVkaXRDdXJyZW50T2JqZWN0KFVzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STSwgXCJFeHRlcm5hbEFjY291bnRJRFwiLCB1c2VyLlVzZXJJRCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBfaXNWYWxpZEFEVXNlcklEID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgaXNWYWxpZEFEVXNlcklEOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlcyA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBpZiAoVXNlclN0b3JlLmdldEhhc0NoYW5nZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSBJbm92eExvYWRlci50KCdjb21tb246bXNnQm94LmJyb3dzZXJTYXZlQ2hhbmdlcycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF9kaXNwbGF5U2VsZWN0VXNlclN0YXRlID0gZmFsc2U7XHJcbiAgICAgICAgX2Rpc3BsYXlQYXNzd29yZENoYW5nZSA9IGZhbHNlO1xyXG4gICAgICAgIF91c2VFeHRlcm5hbEFjY291bnQgPSB0cnVlO1xyXG4gICAgICAgIF9pc1ZhbGlkQURVc2VySUQgPSBVc2VyU3RvcmUuZ2V0SXNFZGl0aW5nKCk7XHJcbiAgICAgICAgX3RoaXMuc3RhdGUgPSBnZXRGb3JtU3RhdGUoKTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBVc2VyRm9ybS5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgVXNlclN0b3JlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX2xvYWRTdGF0ZSk7XHJcbiAgICAgICAgU3lzdGVtU3RvcmUuYWRkQ2hhbmdlTGlzdGVuZXIodGhpcy5fc3lzdGVtQ2hhbmdlKTtcclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlcyk7XHJcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNFZGl0aW5nKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmF1dGhlbnRpY2F0aW9uTW9kZSA9PSBBdXRoZW50aWNhdGlvbk1vZGVFbnVtLk1peGVkICYmIHRoaXMuc3RhdGUuZWRpdFVzZXIgJiYgIXRoaXMuc3RhdGUuZWRpdFVzZXIuRXh0ZXJuYWxBY2NvdW50SUQpXHJcbiAgICAgICAgICAgICAgICBfdXNlRXh0ZXJuYWxBY2NvdW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdGUuYXV0aGVudGljYXRpb25Nb2RlID09IEF1dGhlbnRpY2F0aW9uTW9kZUVudW0uTG9jYWxPbmx5KSB7XHJcbiAgICAgICAgICAgICAgICBfdXNlRXh0ZXJuYWxBY2NvdW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHVzZUV4dGVybmFsQWNjb3VudDogX3VzZUV4dGVybmFsQWNjb3VudCB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVXNlckZvcm0ucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIFVzZXJTdG9yZS5yZW1vdmVDaGFuZ2VMaXN0ZW5lcih0aGlzLl9sb2FkU3RhdGUpO1xyXG4gICAgICAgIFN5c3RlbVN0b3JlLnJlbW92ZUNoYW5nZUxpc3RlbmVyKHRoaXMuX3N5c3RlbUNoYW5nZSk7XHJcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIHRoaXMuX2NoZWNrRm9yVW5zYXZlZENoYW5nZXMpO1xyXG4gICAgfTtcclxuICAgIFVzZXJGb3JtLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGlzTmF0aXZlTG9naW5Nb2RlO1xyXG4gICAgICAgIHZhciBpc0F6dXJlQURMb2dpbk1vZGU7XHJcbiAgICAgICAgdmFyIGlzTWl4ZWRNb2RlID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuYXV0aGVudGljYXRpb25Nb2RlID09IEF1dGhlbnRpY2F0aW9uTW9kZUVudW0uTWl4ZWQpIHtcclxuICAgICAgICAgICAgaXNOYXRpdmVMb2dpbk1vZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBpc0F6dXJlQURMb2dpbk1vZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBpc01peGVkTW9kZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdGUuYXV0aGVudGljYXRpb25Nb2RlID09IEF1dGhlbnRpY2F0aW9uTW9kZUVudW0uRXh0ZXJuYWxPbmx5KSB7XHJcbiAgICAgICAgICAgIGlzTmF0aXZlTG9naW5Nb2RlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlzQXp1cmVBRExvZ2luTW9kZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdGUuYXV0aGVudGljYXRpb25Nb2RlID09IEF1dGhlbnRpY2F0aW9uTW9kZUVudW0uTG9jYWxPbmx5KSB7XHJcbiAgICAgICAgICAgIGlzTmF0aXZlTG9naW5Nb2RlID0gdHJ1ZTtcclxuICAgICAgICAgICAgaXNBenVyZUFETG9naW5Nb2RlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBpbnB1dE9iaiA9IHtcclxuICAgICAgICAgICAgY2xhc3NOYW1lOiAnZm9ybS1jb250cm9sJyxcclxuICAgICAgICAgICAgdHlwZTogJ3RleHQnXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgdXNlciA9IHRoaXMuc3RhdGUuZWRpdFVzZXI7XHJcbiAgICAgICAgdmFyIHBhc3N3b3JkSW5wdXQgPSB7XHJcbiAgICAgICAgICAgIGlkOiAndXNlckFwcC1wYXNzd29yZC1pbnB1dCcsXHJcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2Zvcm0tY29udHJvbCcsXHJcbiAgICAgICAgICAgIHR5cGU6ICdwYXNzd29yZCcsXHJcbiAgICAgICAgICAgIG5hbWU6ICdWUGFzcycsXHJcbiAgICAgICAgICAgIHZhbHVlOiB1c2VyLlBhc3N3b3JkXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgZmlyc3ROYW1lSW5wdXQgPSBqUXVlcnkuZXh0ZW5kKHtcclxuICAgICAgICAgICAgaWQ6ICd1c2VyQXBwLWZpcnN0TmFtZS1pbnB1dCcsXHJcbiAgICAgICAgICAgIG5hbWU6ICdGaXJzdE5hbWUnLFxyXG4gICAgICAgICAgICB2YWx1ZTogKHVzZXIuRmlyc3ROYW1lICE9IG51bGwpID8gdXNlci5GaXJzdE5hbWUgOiBcIlwiXHJcbiAgICAgICAgfSwgaW5wdXRPYmopO1xyXG4gICAgICAgIHZhciBsYXN0TmFtZUlucHV0ID0galF1ZXJ5LmV4dGVuZCh7XHJcbiAgICAgICAgICAgIGlkOiAndXNlckFwcC1sYXN0TmFtZS1pbnB1dCcsXHJcbiAgICAgICAgICAgIG5hbWU6ICdMYXN0TmFtZScsXHJcbiAgICAgICAgICAgIHZhbHVlOiAodXNlci5MYXN0TmFtZSAhPSBudWxsKSA/IHVzZXIuTGFzdE5hbWUgOiBcIlwiXHJcbiAgICAgICAgfSwgaW5wdXRPYmopO1xyXG4gICAgICAgIHZhciBhZFVzZXJJbnB1dCA9IGpRdWVyeS5leHRlbmQoe1xyXG4gICAgICAgICAgICBpZDogJ3VzZXJBcHAtYWRVc2VyTmFtZS1pbnB1dCcsXHJcbiAgICAgICAgICAgIG5hbWU6ICdFeHRlcm5hbEFjY291bnRVc2VyTmFtZScsXHJcbiAgICAgICAgICAgIHZhbHVlOiB1c2VyLkV4dGVybmFsQWNjb3VudFVzZXJOYW1lXHJcbiAgICAgICAgfSwgaW5wdXRPYmopO1xyXG4gICAgICAgIHZhciBlbWFpbElucHV0ID0galF1ZXJ5LmV4dGVuZCh7XHJcbiAgICAgICAgICAgIGlkOiAndXNlckFwcC1lbWFpbC1pbnB1dCcsXHJcbiAgICAgICAgICAgIG5hbWU6ICdFbWFpbCcsXHJcbiAgICAgICAgICAgIHZhbHVlOiAodXNlci5FbWFpbCAhPSBudWxsKSA/IHVzZXIuRW1haWwgOiBcIlwiXHJcbiAgICAgICAgfSwgaW5wdXRPYmopO1xyXG4gICAgICAgIHZhciBoZWFkZXIgPSB0aGlzLnN0YXRlLmlzQWRkaW5nID8gSW5vdnhMb2FkZXIudCgndXNlcnM6aGVhZGVyLm5ld1VzZXInKSA6IElub3Z4TG9hZGVyLnQoJ3VzZXJzOmhlYWRlci5lZGl0VXNlcicpO1xyXG4gICAgICAgIHZhciBwYXNzd29yZFNldHRpbmdzID0gSW5vdnhMb2FkZXIudCgndXNlcnM6Zm9ybS52c3VpdGVQYXNzd29yZFRvb2x0aXAnKTtcclxuICAgICAgICB2YXIgc2V0dGluZ3MgPSBVc2VyU3RvcmUuZ2V0RWRpdFNldHRpbmdzKCk7XHJcbiAgICAgICAgcGFzc3dvcmRTZXR0aW5ncyA9IHBhc3N3b3JkU2V0dGluZ3MuY29uY2F0KElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLnB3ZFNldHRpbmdzUGFydDFcIikucmVwbGFjZShcInswfVwiLCBzZXR0aW5ncy5QYXNzd29yZENoYXJhY3RlcnMpKTtcclxuICAgICAgICBwYXNzd29yZFNldHRpbmdzID0gcGFzc3dvcmRTZXR0aW5ncy5jb25jYXQoSW5vdnhMb2FkZXIudChcInVzZXJzOmZvcm0ucHdkU2V0dGluZ3NQYXJ0MlwiKS5yZXBsYWNlKFwiezB9XCIsIHNldHRpbmdzLlBhc3N3b3JkU3ltYm9scykpO1xyXG4gICAgICAgIHBhc3N3b3JkU2V0dGluZ3MgPSBwYXNzd29yZFNldHRpbmdzLmNvbmNhdChJbm92eExvYWRlci50KFwidXNlcnM6Zm9ybS5wd2RTZXR0aW5nc1BhcnQzXCIpLnJlcGxhY2UoXCJ7MH1cIiwgc2V0dGluZ3MuUGFzc3dvcmROdW1iZXJzKSk7XHJcbiAgICAgICAgdmFyIHVzZXJuYW1lTGFiZWwgPSBJbm92eExvYWRlci50KFwidXNlcnM6Y29tbW9uLnVzZXJuYW1lXCIpO1xyXG4gICAgICAgIHZhciB1c2VybmFtZVRvb2xUaXAgPSBJbm92eExvYWRlci50KFwidXNlcnM6Y29tbW9uLnVzZXJuYW1lVG9vbHRpcFwiKTtcclxuICAgICAgICB2YXIgY2hlY2tib3hMYWJlbCA9IElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLmF6dXJlQURBdXRoZW50aWNhdGlvblwiKTtcclxuICAgICAgICB2YXIgdXNlckV4dGVybmFsQWNjb3VudCA9IHRoaXMuc3RhdGUudXNlRXh0ZXJuYWxBY2NvdW50O1xyXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmV4dGVybmFsUHJvdmlkZXJOYW1lID09IEV4dGVybmFsUHJvdmlkZXJFbnVtLkFERlMpIHtcclxuICAgICAgICAgICAgdXNlcm5hbWVMYWJlbCA9IElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLmFkZnNVc2VybmFtZVwiKTtcclxuICAgICAgICAgICAgdXNlcm5hbWVUb29sVGlwID0gSW5vdnhMb2FkZXIudChcInVzZXJzOmZvcm0uYWRmc1VzZXJuYW1lVG9vbHRpcFwiKTtcclxuICAgICAgICAgICAgY2hlY2tib3hMYWJlbCA9IElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLmFkZnNBdXRoZW50aWNhdGlvblwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5zdGF0ZS5leHRlcm5hbFByb3ZpZGVyTmFtZSA9PSBFeHRlcm5hbFByb3ZpZGVyRW51bS5BenVyZUFEKSB7XHJcbiAgICAgICAgICAgIHVzZXJuYW1lTGFiZWwgPSBJbm92eExvYWRlci50KFwidXNlcnM6Zm9ybS5henVyZVVzZXJuYW1lXCIpO1xyXG4gICAgICAgICAgICB1c2VybmFtZVRvb2xUaXAgPSBJbm92eExvYWRlci50KFwidXNlcnM6Zm9ybS5henVyZVVzZXJuYW1lVG9vbHRpcFwiKTtcclxuICAgICAgICAgICAgY2hlY2tib3hMYWJlbCA9IElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLmF6dXJlQURBdXRoZW50aWNhdGlvblwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuU3RhdGljSGVhZGVyRm9ybSwgeyB0aXRsZTogaGVhZGVyLCBzYXZlT25DbGljazogdGhpcy5fc2F2ZVVzZXIsIHNhdmVCdG5JZDogXCJ1c2VyQXBwLXNhdmUtYnRuXCIsIGNhbmNlbE9uQ2xpY2s6IHRoaXMuX2NhbmNlbCwgY2FuY2VsQnRuSWQ6IFwidXNlckFwcC1jYW5jZWwtYnRuXCIsIGlzQWN0aW9uSW5Qcm9ncmVzczogdGhpcy5zdGF0ZS5pc0FjdGlvbkluUHJvZ3Jlc3MsIGluUHJvZ3Jlc3NNZXNzYWdlOiB0aGlzLnN0YXRlLmFjdGlvbkluUHJvZ3Jlc3NNc2cgfSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogJ3VzZXItZm9ybScgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5JZiwgeyBjb25kaXRpb246IGlzQXp1cmVBRExvZ2luTW9kZSwgY2xhc3M6ICdmYy1tYXJnaW4nIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgaXNOYXRpdmVMb2dpbk1vZGUgJiYgdGhpcy5zdGF0ZS5pc0FkZGluZyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImZvcm0tZmllbGRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImxhYmVsXCIsIHsgY2xhc3NOYW1lOiBcImNvbnRyb2wtbGFiZWxcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiLCB7IHR5cGU6IFwiY2hlY2tib3hcIiwgb25DaGFuZ2U6IHRoaXMuX29uVXNlRXh0ZXJuYWxBY2NvdW50Q2hhbmdlLCBjaGVja2VkOiB1c2VyRXh0ZXJuYWxBY2NvdW50IH0pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiIFwiICsgY2hlY2tib3hMYWJlbCkpLFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJFeHRlcm5hbEFjY291bnQgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogXCJcIi5jb25jYXQodXNlcm5hbWVMYWJlbCwgXCIqXCIpLCB0b29sdGlwOiB1c2VybmFtZVRvb2xUaXAsIGlucHV0TmFtZTogJ0V4dGVybmFsQWNjb3VudFVzZXJOYW1lJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLlZhbGlkYXRpb25JbnB1dCwgX19hc3NpZ24oe30sIGFkVXNlcklucHV0LCB7IGNsYXNzTmFtZTogXCJmb3JtLWNvbnRyb2xcIiwgb25DaGFuZ2U6IHRoaXMuX29uQ2hhbmdlLCB2YWxpZGF0aW9uOiB0aGlzLnN0YXRlLnZhbGlkYXRpb25bJ0V4dGVybmFsQWNjb3VudFVzZXJOYW1lJ10sIHJlYWRPbmx5OiB0cnVlIH0pKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJhXCIsIHsgaWQ6IFwidXNlckFwcC1jaGVja05hbWUtYnRuXCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLWluZm9cIiwgb25DbGljazogdGhpcy5fY2hlY2tOYW1lIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5vdnhMb2FkZXIudChcInVzZXJzOmZvcm0uc2VhcmNoRGlyZWN0b3J5XCIpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiIFwiKSkpLFxyXG4gICAgICAgICAgICAgICAgKHRoaXMuc3RhdGUuaXNWYWxpZEFEVXNlcklEIHx8ICghdGhpcy5zdGF0ZS51c2VFeHRlcm5hbEFjY291bnQgJiYgaXNNaXhlZE1vZGUpIHx8ICghaXNNaXhlZE1vZGUgJiYgaXNOYXRpdmVMb2dpbk1vZGUpKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJyb3dcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJjb2wtbWQtNiBmaWVsZC1jb2xcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IFwiXCIuY29uY2F0KElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLmVtYWlsXCIpLCBcIipcIiksIGlucHV0TmFtZTogJ0VtYWlsJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuVmFsaWRhdGlvbklucHV0LCBfX2Fzc2lnbih7fSwgZW1haWxJbnB1dCwgeyBjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sXCIsIG9uQ2hhbmdlOiB0aGlzLl9vbkNoYW5nZSwgdmFsaWRhdGlvbjogdGhpcy5zdGF0ZS52YWxpZGF0aW9uWydFbWFpbCddLCByZWFkT25seTogZmFsc2UsIGF1dG9jb21wbGV0ZTogXCJlbWFpbFwiIH0pKSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNOYXRpdmVMb2dpbk1vZGUgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImNvbC1tZC02IGZpZWxkLWNvbFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5JZiwgeyBjb25kaXRpb246IHRoaXMuc3RhdGUuaXNFZGl0aW5nLCBjbGFzczogJ2Zvcm0tZmllbGQnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBcIlwiLmNvbmNhdChJbm92eExvYWRlci50KFwidXNlcnM6Zm9ybS52c3VpdGVQYXNzd29yZFwiKSksIHRvb2x0aXA6IHBhc3N3b3JkU2V0dGluZ3MsIGlucHV0TmFtZTogJ1ZQYXNzJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJhXCIsIHsgaWQ6IFwidXNlckFwcC1wYXNzd29yZC1yZXNldC1idG5cIiwgY2xhc3NOYW1lOiBcImJ0biBidG4taW5mb1wiLCBvbkNsaWNrOiB0aGlzLl9vbkNoYW5nZVBhc3N3b3JkIH0sIElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLnJlc2V0UGFzc3dvcmRcIikpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5JZiwgeyBjb25kaXRpb246IHVzZXIuUGFzc3dvcmRFeHBpcmVkIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJoNVwiLCB7IHN0eWxlOiB7IGNvbG9yOiAncmVkJyB9IH0sIElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLnBhc3N3b3JkRXhwaXJlZFwiKSkpKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5JZiwgeyBjb25kaXRpb246IHRoaXMuc3RhdGUuaXNBZGRpbmcsIGNsYXNzOiAnZm9ybS1maWVsZCcgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IFwiXCIuY29uY2F0KElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLnZzdWl0ZVBhc3N3b3JkXCIpLCBcIipcIiksIHRvb2x0aXA6IHBhc3N3b3JkU2V0dGluZ3MsIGlucHV0TmFtZTogJ1ZQYXNzd29yZCcgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuVmFsaWRhdGlvbklucHV0LCBfX2Fzc2lnbih7fSwgcGFzc3dvcmRJbnB1dCwgeyBjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sXCIsIG9uQ2hhbmdlOiB0aGlzLl9vbkNoYW5nZSwgdmFsaWRhdGlvbjogdGhpcy5zdGF0ZS52YWxpZGF0aW9uWydQYXNzd29yZCddLCByZWFkT25seTogZmFsc2UsIGF1dG9jb21wbGV0ZTogXCJuZXctcGFzc3dvcmRcIiB9KSkpKSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuSWYsIHsgY29uZGl0aW9uOiB0aGlzLnN0YXRlLmhhc0VudGl0bGVtZW50UGVybWlzc2lvbiwgY2xhc3M6ICdmYy1tYXJnaW4nIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBJbm92eExvYWRlci50KFwidXNlcnM6Zm9ybS5zZWN1cml0eUdyb3Vwc1wiKSwgaW5wdXROYW1lOiAnRW50aXRsZW1lbnQnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLk11bHRpU2VsZWN0LCB7IGRpc3BsYXlQcm9wOiBcIk5hbWVcIiwgbWluTGVuZ3RoOiAwLCBvblNlbGVjdDogdGhpcy5fb25FbnRpdGxlbWVudFNlbGVjdCwgZGF0YXNvdXJjZTogdGhpcy5zdGF0ZS5lbnRpdGxlbWVudCwga2V5UHJvcDogXCJJRFwiLCB2YWx1ZVByb3A6IFwiSURcIiwgdmFsdWVzOiB0aGlzLnN0YXRlLmVkaXRVc2VyLkVudGl0bGVtZW50R3JvdXBJRHMgfSkpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLklmLCB7IGNvbmRpdGlvbjogdGhpcy5zdGF0ZS5oYXNSb2xlUGVybWlzc2lvbiwgY2xhc3M6ICdmYy1tYXJnaW4nIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBJbm92eExvYWRlci50KFwidXNlcnM6Zm9ybS5yb2xlc1wiKSwgaW5wdXROYW1lOiAnUm9sZScgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuTXVsdGlTZWxlY3QsIHsgZGlzcGxheVByb3A6IFwiTmFtZVwiLCBtaW5MZW5ndGg6IDAsIG9uU2VsZWN0OiB0aGlzLl9vblJvbGVzU2VsZWN0LCBkYXRhc291cmNlOiB0aGlzLnN0YXRlLnJvbGVzLCBrZXlQcm9wOiBcIklEXCIsIHZhbHVlUHJvcDogXCJJRFwiLCB2YWx1ZXM6IHRoaXMuc3RhdGUuZWRpdFVzZXIuUm9sZUlEcyB9KSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBcIlwiLmNvbmNhdChJbm92eExvYWRlci50KFwidXNlcnM6Zm9ybS51c2VyU3RhdHVzXCIpLCBcIjogXCIpLCBpbnB1dE5hbWU6ICcnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwibGFiZWxcIiwgeyBjbGFzc05hbWU6IFwicmFkaW8taW5saW5lXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgeyB0eXBlOiBcInJhZGlvXCIsIHZhbHVlOiBcInRydWVcIiwgbmFtZTogXCJFbmFibGVkXCIsIG9uQ2hhbmdlOiB0aGlzLl9vbkNoZWNrQ2hhbmdlLCBjaGVja2VkOiB1c2VyLkVuYWJsZWQgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5vdnhMb2FkZXIudChcInVzZXJzOmNvbW1vbi5lbmFibGVkXCIpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiLCB7IGNsYXNzTmFtZTogXCJyYWRpby1pbmxpbmVcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiLCB7IHR5cGU6IFwicmFkaW9cIiwgdmFsdWU6IFwiZmFsc2VcIiwgbmFtZTogXCJFbmFibGVkXCIsIG9uQ2hhbmdlOiB0aGlzLl9vbkNoZWNrQ2hhbmdlLCBjaGVja2VkOiAhdXNlci5FbmFibGVkIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpjb21tb24uZGlzYWJsZWRcIikpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkdyb3VwQm94LCB7IHRpdGxlOiBJbm92eExvYWRlci50KCd1c2Vyczpmb3JtLnVzZXJQcm9maWxlJyksIGNsYXNzOiBcImdiLXBhc3N3b3JkLWNvbXBsZXhpdHlcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJyb3dcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiY29sLW1kLTYgZmllbGQtY29sXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcInVzZXJzOmNvbW1vbi5maXJzdG5hbWVcIiksIGlucHV0TmFtZTogJ0ZpcnN0TmFtZScgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5WYWxpZGF0aW9uSW5wdXQsIF9fYXNzaWduKHt9LCBmaXJzdE5hbWVJbnB1dCwgeyBjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sXCIsIG9uQ2hhbmdlOiB0aGlzLl9vbkNoYW5nZSwgdmFsaWRhdGlvbjogdGhpcy5zdGF0ZS52YWxpZGF0aW9uWydGaXJzdE5hbWUnXSwgcmVhZE9ubHk6IGZhbHNlIH0pKSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiY29sLW1kLTYgZmllbGQtY29sXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcInVzZXJzOmNvbW1vbi5sYXN0bmFtZVwiKSwgaW5wdXROYW1lOiAnTGFzdE5hbWUnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuVmFsaWRhdGlvbklucHV0LCBfX2Fzc2lnbih7fSwgbGFzdE5hbWVJbnB1dCwgeyBjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sXCIsIG9uQ2hhbmdlOiB0aGlzLl9vbkNoYW5nZSwgdmFsaWRhdGlvbjogdGhpcy5zdGF0ZS52YWxpZGF0aW9uWydMYXN0TmFtZSddLCByZWFkT25seTogZmFsc2UgfSkpKSkpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLklmLCB7IGNvbmRpdGlvbjogdGhpcy5zdGF0ZS5lZGl0VXNlci5NYXhMb2dpbkF0dGVtcHRzLCBjbGFzczogJ2ZjLW1hcmdpbicgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IFwiXCIuY29uY2F0KElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLnJlc2V0TG9naW5BdHRlbXB0c1wiKSwgXCI6IFwiKSwgaW5wdXROYW1lOiAnJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJhXCIsIHsgY2xhc3NOYW1lOiBcImJ0biBidG4taW5mb1wiLCBvbkNsaWNrOiB0aGlzLl9vblJlc2V0TG9naW5BdHRlbXB0cyB9LCBJbm92eExvYWRlci50KFwidXNlcnM6Zm9ybS5yZXNldExvZ2luQXR0ZW1wdHNCdG5cIikpKSkpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLk1vZGFsUG9wVXAsIHsgaXNPcGVuOiB0aGlzLnN0YXRlLmRpc3BsYXlTZWxlY3RVc2VyIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChVc2VyU2VsZWN0LCB7IG9uU2VsZWN0OiB0aGlzLl9maWxsVXNlciwgb25DYW5jZWw6IHRoaXMuX2Nsb3NlU2VsZWN0VXNlciB9KSksXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuTW9kYWxQb3BVcCwgeyBpc09wZW46IHRoaXMuc3RhdGUuZGlzcGxheVBhc3N3b3JkQ2hhbmdlIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChDaGFuZ2VVc2VyUGFzc3dvcmQsIHsgVXNlcjogdGhpcy5zdGF0ZS5lZGl0VXNlciwgb25QYXNzd29yZENoYW5nZWQ6IHRoaXMuX2Nsb3NlQ2hhbmdlUGFzc3dvcmQsIG9uQ2FuY2VsOiB0aGlzLl9jbG9zZUNoYW5nZVBhc3N3b3JkIH0pKSkpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVXNlckZvcm07XHJcbn0oUmVhY3QuQ29tcG9uZW50KSk7XHJcbm1vZHVsZS5leHBvcnRzID0gVXNlckZvcm07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVVzZXJGb3JtLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG4vLyBBIOKAmC50c3jigJkgZmlsZSBlbmFibGVzIEpTWCBzdXBwb3J0IGluIHRoZSBUeXBlU2NyaXB0IGNvbXBpbGVyLCBcclxuLy8gZm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIHRoZSBmb2xsb3dpbmcgcGFnZSBvbiB0aGUgVHlwZVNjcmlwdCB3aWtpOlxyXG4vLyBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQvd2lraS9KU1hcclxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSlcclxuICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufTtcclxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBVc2VyU3RvcmUgPSByZXF1aXJlKFwiLi8uLi9zdG9yZXMvVXNlclN0b3JlXCIpO1xyXG52YXIgVXNlckFjdGlvbnMgPSByZXF1aXJlKFwiLi8uLi9hY3Rpb25zL1VzZXJBY3Rpb25zXCIpO1xyXG52YXIgVXNlckNvbnN0YW50cyA9IHJlcXVpcmUoXCIuLy4uL2NvbnN0YW50cy9Vc2VyQ29uc3RhbnRzXCIpO1xyXG52YXIgSW5vdnhDb250cm9scyA9IElub3Z4LlNoYXJlZC5Db250cm9scztcclxudmFyIENvbW1vbk1lc3NhZ2VzID0gSW5vdnguU2hhcmVkLkNvbW1vbi5Db21tb25NZXNzYWdlcztcclxuZnVuY3Rpb24gZ2V0QmxhbmtWYWxpZGF0aW9uKCkge1xyXG4gICAgcmV0dXJuIHsgaW52YWxpZElucHV0OiBmYWxzZSwgaW52YWxpZFZhbHVlOiBmYWxzZSwgaW52YWxpZElucHV0TWVzc2FnZTogXCJcIiwgaW52YWxpZFZhbHVlTWVzc2FnZTogXCJcIiB9O1xyXG59XHJcbmZ1bmN0aW9uIGdldFN0YXRlKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB2YWxpZGF0aW9uOiB7XHJcbiAgICAgICAgICAgIFwiU2VhcmNoU3RyaW5nXCI6IGdldEJsYW5rVmFsaWRhdGlvbigpXHJcbiAgICAgICAgfSxcclxuICAgICAgICBVc2VyczogW10sXHJcbiAgICAgICAgc2VhcmNoU3RyaW5nOiBcIlwiLFxyXG4gICAgICAgIHNlbGVjdGVkVXNlcjogbnVsbCxcclxuICAgICAgICBzaG93VmFsaWRhdGlvbldhcm5pbmc6IGZhbHNlXHJcbiAgICB9O1xyXG59XHJcbnZhciBVc2VyU2VsZWN0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFVzZXJTZWxlY3QsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBVc2VyU2VsZWN0KHByb3BzLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMsIGNvbnRleHQpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX29uUm93U2VsZWN0ID0gZnVuY3Rpb24gKGUsIHVzZXIpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKHN0YXRlKSB7IHJldHVybiAoe1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRVc2VyOiB1c2VyLFxyXG4gICAgICAgICAgICAgICAgc2hvd1ZhbGlkYXRpb25XYXJuaW5nOiAoc3RhdGUuc2hvd1ZhbGlkYXRpb25XYXJuaW5nICYmIHVzZXIpID8gZmFsc2UgOiBzdGF0ZS5zaG93VmFsaWRhdGlvbldhcm5pbmdcclxuICAgICAgICAgICAgfSk7IH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX29uT0tDbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKF90aGlzLnN0YXRlLnNlbGVjdGVkVXNlcikge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMucHJvcHMub25TZWxlY3QoX3RoaXMuc3RhdGUuc2VsZWN0ZWRVc2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93VmFsaWRhdGlvbldhcm5pbmc6IHRydWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fb25TZWFyY2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5zZWFyY2hTdHJpbmcgJiYgIV90aGlzLnN0YXRlLnZhbGlkYXRpb25bXCJTZWFyY2hTdHJpbmdcIl0uaW52YWxpZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBVc2VyQWN0aW9ucy5nZXRIaW50KF90aGlzLnN0YXRlLnNlYXJjaFN0cmluZywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1c2VycyA9IFVzZXJTdG9yZS5jaGVja1VzZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IFVzZXJzOiB1c2VycyB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fb25TZWFyY2hDaGFuZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBzZWFyY2hTdHJpbmc6IGV2ZW50LnRhcmdldC52YWx1ZSB9KTtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKHN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5fdmFsaWRhdGVTZWFyY2hTdHJpbmcoc3RhdGUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl92YWxpZGF0ZVNlYXJjaFN0cmluZyA9IGZ1bmN0aW9uIChzdGF0ZSkge1xyXG4gICAgICAgICAgICBpZiAoIXN0YXRlLnNlYXJjaFN0cmluZykge1xyXG4gICAgICAgICAgICAgICAgc3RhdGUudmFsaWRhdGlvbltcIlNlYXJjaFN0cmluZ1wiXS5pbnZhbGlkVmFsdWVNZXNzYWdlID0gQ29tbW9uTWVzc2FnZXMuVmFsaWRhdGlvbi5SZXF1aXJlZDtcclxuICAgICAgICAgICAgICAgIHN0YXRlLnZhbGlkYXRpb25bXCJTZWFyY2hTdHJpbmdcIl0uaW52YWxpZFZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5zZWFyY2hTdHJpbmcubGVuZ3RoIDwgMykge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLnZhbGlkYXRpb25bXCJTZWFyY2hTdHJpbmdcIl0uaW52YWxpZFZhbHVlTWVzc2FnZSA9IElub3Z4TG9hZGVyLnQoJ3VzZXJzOmZvcm0uc2VhcmNoU3RyaW5nVG9vU2hvcnQnKTtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0ZS52YWxpZGF0aW9uW1wiU2VhcmNoU3RyaW5nXCJdLmludmFsaWRWYWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUudmFsaWRhdGlvbltcIlNlYXJjaFN0cmluZ1wiXS5pbnZhbGlkVmFsdWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuc3RhdGUgPSBnZXRTdGF0ZSgpO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFVzZXJTZWxlY3QucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcGFnZXNpemUgPSA3O1xyXG4gICAgICAgIHZhciBjb2x1bW5zID0gW3tcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBcIlVzZXJOYW1lXCIsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJUZXh0OiBJbm92eExvYWRlci50KCd1c2Vyczpjb21tb24udXNlcm5hbWUnKVxyXG4gICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJGaXJzdE5hbWVcIixcclxuICAgICAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoJ3VzZXJzOmNvbW1vbi5maXJzdG5hbWUnKVxyXG4gICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJMYXN0TmFtZVwiLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyVGV4dDogSW5vdnhMb2FkZXIudCgndXNlcnM6Y29tbW9uLmxhc3RuYW1lJylcclxuICAgICAgICAgICAgfV07XHJcbiAgICAgICAgdmFyIGRhdGFTb3VyY2UgPSB0aGlzLnN0YXRlLlVzZXJzO1xyXG4gICAgICAgIHZhciBkZWZhdWx0U29ydCA9IFt7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJVc2VyTmFtZVwiLFxyXG4gICAgICAgICAgICAgICAgZGlyOiBcImFzY2VuZGluZ1wiXHJcbiAgICAgICAgICAgIH1dO1xyXG4gICAgICAgIHZhciBzZWFyY2hJbnB1dCA9IHtcclxuICAgICAgICAgICAgY2xhc3NOYW1lOiAnZm9ybS1jb250cm9sJyxcclxuICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICBuYW1lOiAnU2VhcmNoU3RyaW5nJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInBhbmVsIHBhbmVsLXByaW1hcnkgdXNlci1zZWxlY3RcIiB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInBhbmVsLWhlYWRpbmdcIiB9LCBJbm92eExvYWRlci50KCd1c2Vyczpmb3JtLnNlbGVjdEFjY291bnQnKSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicGFuZWwtYm9keVwiIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiAndXNlci1mb3JtJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnguU2hhcmVkLkNvbnRyb2xzLkFjdGlvbkluUHJvZ3Jlc3NMb2FkZXIsIHsgYWN0aW9uS2V5OiBbVXNlckNvbnN0YW50cy5VU0VSX0NIRUNLX05BTUVdLCBjbGFzczogJ3RlbXAtbW9kYWwtbG9hZGVyJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImFjdGlvbi1pbi1wcm9ncmVzcy1sb2FkZXItc21cIiB9KSksXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogXCJcIiwgdG9vbHRpcDogXCJcIiwgaW5wdXROYW1lOiAnU2VhcmNoU3RyaW5nJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuVmFsaWRhdGlvbklucHV0LCBfX2Fzc2lnbih7fSwgc2VhcmNoSW5wdXQsIHsgdmFsdWU6IHRoaXMuc3RhdGUuc2VhcmNoU3RyaW5nLCBjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sXCIsIG9uQ2hhbmdlOiB0aGlzLl9vblNlYXJjaENoYW5nZSwgdmFsaWRhdGlvbjogdGhpcy5zdGF0ZS52YWxpZGF0aW9uW1wiU2VhcmNoU3RyaW5nXCJdLCByZWFkT25seTogZmFsc2UsIGF1dG9mb2N1czogdHJ1ZSB9KSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIiwgeyBpZDogXCJVc2VyX1NlYXJjaF9idG5cIiwgb25DbGljazogdGhpcy5fb25TZWFyY2gsIGNsYXNzTmFtZTogJ2dseXBoaWNvbiBnbHlwaGljb24tc2VhcmNoIHVzZXItc2VhcmNoLWJ1dHRvbicgfSkpLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnguU2hhcmVkLkNvbnRyb2xzLkdyaWQsIHsgZGF0YVNvdXJjZTogZGF0YVNvdXJjZSwgc2VsZWN0Um93OiB0aGlzLl9vblJvd1NlbGVjdCwgcmVzZXQ6IHRydWUsIGRlZmF1bHRTb3J0OiBkZWZhdWx0U29ydCwgY29sdW1uczogY29sdW1ucywgc29ydDogdHJ1ZSwgZmlsdGVyOiBmYWxzZSwgc2Nyb2xsSGVpZ2h0OiAzMSAqIHBhZ2VzaXplLCBhbGxvd1Njcm9sbGluZzogdHJ1ZSwgYXV0b1NlbGVjdFNpbmdsZVJvdzogdHJ1ZSB9KSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInRleHQtZGFuZ2VyXCIsIHN0eWxlOiB7IHBhZGRpbmdUb3A6IFwiMTBweFwiLCBkaXNwbGF5OiAodGhpcy5zdGF0ZS5zaG93VmFsaWRhdGlvbldhcm5pbmcpID8gXCJcIiA6IFwibm9uZVwiIH0gfSwgSW5vdnhMb2FkZXIudCgndXNlcnM6Zm9ybS5zZWxlY3RBY2NvdW50V2FybmluZycpKSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImJ0bi1iYXItYi1zbVwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIiwgeyB0eXBlOiBcImJ1dHRvblwiLCBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5XCIsIG9uQ2xpY2s6IHRoaXMuX29uT0tDbGljayB9LCBJbm92eExvYWRlci50KCd1c2Vyczpmb3JtLm9rJykpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIsIHsgdHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImJ0biBidG4tZGVmYXVsdFwiLCBvbkNsaWNrOiB0aGlzLnByb3BzLm9uQ2FuY2VsIH0sIElub3Z4TG9hZGVyLnQoJ3VzZXJzOmZvcm0uY2FuY2VsJykpKSkpKSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFVzZXJTZWxlY3Q7XHJcbn0oUmVhY3QuQ29tcG9uZW50KSk7XHJcbm1vZHVsZS5leHBvcnRzID0gVXNlclNlbGVjdDtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VXNlclNlbGVjdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gQSDigJgudHN44oCZIGZpbGUgZW5hYmxlcyBKU1ggc3VwcG9ydCBpbiB0aGUgVHlwZVNjcmlwdCBjb21waWxlciwgXHJcbi8vIGZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSB0aGUgZm9sbG93aW5nIHBhZ2Ugb24gdGhlIFR5cGVTY3JpcHQgd2lraTpcclxuLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L3dpa2kvSlNYXHJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBmdW5jdGlvbiAoKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXHJcbiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn07XHJcbnZhciBSZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcclxudmFyIFVzZXJTdG9yZSA9IHJlcXVpcmUoXCIuLy4uL3N0b3Jlcy9Vc2VyU3RvcmVcIik7XHJcbnZhciBVc2VyQ29uc3RhbnRzID0gcmVxdWlyZShcIi4vLi4vY29uc3RhbnRzL1VzZXJDb25zdGFudHNcIik7XHJcbnZhciBVc2VyQWN0aW9ucyA9IHJlcXVpcmUoXCIuLy4uL2FjdGlvbnMvVXNlckFjdGlvbnNcIik7XHJcbnZhciBDaGFuZ2VVc2VyUGFzc3dvcmQgPSByZXF1aXJlKFwiLi8uLi9jb21wb25lbnRzL0NoYW5nZVVzZXJQYXNzd29yZFwiKTtcclxudmFyIElub3Z4ID0gcmVxdWlyZShcInNoYXJlZC53ZWIuY2xpZW50XCIpO1xyXG52YXIgU3lzdGVtQWN0aW9ucyA9IElub3Z4LlNoYXJlZC5TeXN0ZW0uQWN0aW9ucztcclxudmFyIFN5c3RlbVN0b3JlID0gSW5vdnguU2hhcmVkLlN5c3RlbS5TdG9yZTtcclxudmFyIElub3Z4Q29udHJvbHMgPSBJbm92eC5TaGFyZWQuQ29udHJvbHM7XHJcbmZ1bmN0aW9uIGdldEFjdGlvbkluUHJvZ3Jlc3MoKSB7XHJcbiAgICByZXR1cm4gU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKFVzZXJDb25zdGFudHMuU0VUVElOR1NfU0FWRSk7XHJcbn1cclxudmFyIF9hY3Rpb25JblByb2dyZXNzTXNnO1xyXG5mdW5jdGlvbiBnZXRGb3JtU3RhdGUoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGlzQWN0aW9uSW5Qcm9ncmVzczogZ2V0QWN0aW9uSW5Qcm9ncmVzcygpLFxyXG4gICAgICAgIGFjdGlvbkluUHJvZ3Jlc3NNc2c6IF9hY3Rpb25JblByb2dyZXNzTXNnLFxyXG4gICAgICAgIHZhbGlkYXRpb246IFVzZXJTdG9yZS5nZXRWYWxpZGF0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNKSxcclxuICAgICAgICBzZXR0aW5nczogVXNlclN0b3JlLmdldEVkaXRTZXR0aW5ncygpLFxyXG4gICAgICAgIGRpc3BsYXlQYXNzd29yZENoYW5nZTogZmFsc2UsXHJcbiAgICAgICAgY3VycmVudFVzZXJIYXNQYXNzd29yZDogZmFsc2UsXHJcbiAgICAgICAgY3VycmVudFVzZXI6IFVzZXJTdG9yZS5nZXRDdXJyZW50VXNlcigpXHJcbiAgICB9O1xyXG59XHJcbnZhciBVc2VyU2V0dGluZ3MgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVXNlclNldHRpbmdzLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVXNlclNldHRpbmdzKHByb3BzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX3Bhc3N3b3JkQ29tcGxleGl0eUNoYW5nZWQgPSBmYWxzZTtcclxuICAgICAgICBfdGhpcy5fZGlzcGxheVBhc3N3b3JkQ2hhbmdlID0gZmFsc2U7XHJcbiAgICAgICAgX3RoaXMuX29uQ2hhbmdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIFVzZXJBY3Rpb25zLmVkaXRDdXJyZW50T2JqZWN0KFVzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNLCBldmVudC50YXJnZXQubmFtZSwgZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vblBhc3N3b3JkQ29tcGxleGl0eUNoYW5nZSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBfdGhpcy5fcGFzc3dvcmRDb21wbGV4aXR5Q2hhbmdlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIFVzZXJBY3Rpb25zLmVkaXRDdXJyZW50T2JqZWN0KFVzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNLCBldmVudC50YXJnZXQubmFtZSwgZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vbkNoZWNrQ2hhbmdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIFVzZXJBY3Rpb25zLmVkaXRDdXJyZW50T2JqZWN0KFVzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNLCBldmVudC50YXJnZXQubmFtZSwgZXZlbnQudGFyZ2V0LnZhbHVlID09PSBcInRydWVcIik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fbG9hZFN0YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZShnZXRGb3JtU3RhdGUoKSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fc3lzdGVtQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgICAgICAgICBpc0FjdGlvbkluUHJvZ3Jlc3M6IGdldEFjdGlvbkluUHJvZ3Jlc3MoKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9zYXZlQ2hhbmdlUGFzc3dvcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHtcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlQYXNzd29yZENoYW5nZTogZmFsc2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIF90aGlzLl9zYXZlKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2FuY2VsQ2hhbmdlUGFzc3dvcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHtcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlQYXNzd29yZENoYW5nZTogZmFsc2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fc2F2ZVNldHRpbmdzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBVc2VyQWN0aW9ucy5zYXZlU2V0dGluZ3MoZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheVBhc3N3b3JkQ2hhbmdlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGFjdGlvbkluUHJvZ3Jlc3NNc2c6IElub3Z4TG9hZGVyLnQoJ3VzZXJzOmZvcm0uc2F2aW5nJykgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fc2F2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHRoYXQgPSBfdGhpcztcclxuICAgICAgICAgICAgaWYgKFVzZXJTdG9yZS5nZXRJc1ZhbGlkT2JqZWN0KFVzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuX3Bhc3N3b3JkQ29tcGxleGl0eUNoYW5nZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmRpc3BsYXlZZXNOb01lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtQ2FsbGJhY2s6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJBY3Rpb25zLnJlc2V0UGFzc3dvcmRzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQ2FsbGJhY2s6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX3NhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBJbm92eExvYWRlci50KCd1c2VyczpzZXR0aW5nc0Zvcm0ucmVzZXRQYXNzd29yZHMnKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3Bhc3N3b3JkQ29tcGxleGl0eUNoYW5nZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3NhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe30pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBVc2VyQWN0aW9ucy5oaWRlU2V0dGluZ3MoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9pc0VtcHR5T3JOdWxsID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhdmFsdWUgfHwgdmFsdWUubGVuZ3RoIDw9IDA7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlcyA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBpZiAoVXNlclN0b3JlLmdldEhhc0NoYW5nZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSBJbm92eExvYWRlci50KCdjb21tb246bXNnQm94LmJyb3dzZXJTYXZlQ2hhbmdlcycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5zdGF0ZSA9IGdldEZvcm1TdGF0ZSgpO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFVzZXJTZXR0aW5ncy5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgVXNlclN0b3JlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX2xvYWRTdGF0ZSk7XHJcbiAgICAgICAgU3lzdGVtU3RvcmUuYWRkQ2hhbmdlTGlzdGVuZXIodGhpcy5fc3lzdGVtQ2hhbmdlKTtcclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlcyk7XHJcbiAgICB9O1xyXG4gICAgVXNlclNldHRpbmdzLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBVc2VyU3RvcmUucmVtb3ZlQ2hhbmdlTGlzdGVuZXIodGhpcy5fbG9hZFN0YXRlKTtcclxuICAgICAgICBTeXN0ZW1TdG9yZS5yZW1vdmVDaGFuZ2VMaXN0ZW5lcih0aGlzLl9zeXN0ZW1DaGFuZ2UpO1xyXG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLl9jaGVja0ZvclVuc2F2ZWRDaGFuZ2VzKTtcclxuICAgIH07XHJcbiAgICBVc2VyU2V0dGluZ3MucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaW5wdXRPYmogPSB7XHJcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2Zvcm0tY29udHJvbCcsXHJcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0J1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIHNldHRpbmdzID0gdGhpcy5zdGF0ZS5zZXR0aW5ncztcclxuICAgICAgICB2YXIgcGFzc3dvcmRNaW5DaGFyYWN0ZXJzID0galF1ZXJ5LmV4dGVuZCh7XHJcbiAgICAgICAgICAgIG5hbWU6ICdQYXNzd29yZENoYXJhY3RlcnMnLFxyXG4gICAgICAgICAgICB2YWx1ZTogc2V0dGluZ3MuUGFzc3dvcmRDaGFyYWN0ZXJzLnRvU3RyaW5nKClcclxuICAgICAgICB9LCBpbnB1dE9iaik7XHJcbiAgICAgICAgdmFyIHJlcXVpcmVkU3ltYm9scyA9IGpRdWVyeS5leHRlbmQoe1xyXG4gICAgICAgICAgICBuYW1lOiAnUGFzc3dvcmRTeW1ib2xzJyxcclxuICAgICAgICAgICAgdmFsdWU6IHNldHRpbmdzLlBhc3N3b3JkU3ltYm9scy50b1N0cmluZygpXHJcbiAgICAgICAgfSwgaW5wdXRPYmopO1xyXG4gICAgICAgIHZhciByZXF1aXJlTnVtYmVycyA9IGpRdWVyeS5leHRlbmQoe1xyXG4gICAgICAgICAgICBuYW1lOiAnUGFzc3dvcmROdW1iZXJzJyxcclxuICAgICAgICAgICAgdmFsdWU6IHNldHRpbmdzLlBhc3N3b3JkTnVtYmVycy50b1N0cmluZygpXHJcbiAgICAgICAgfSwgaW5wdXRPYmopO1xyXG4gICAgICAgIHZhciBwYXNzd29yZEV4cGlyYXRpb24gPSBqUXVlcnkuZXh0ZW5kKHtcclxuICAgICAgICAgICAgbmFtZTogJ1Bhc3N3b3JkRXhwaXJhdGlvbicsXHJcbiAgICAgICAgICAgIHZhbHVlOiBzZXR0aW5ncy5QYXNzd29yZEV4cGlyYXRpb24udG9TdHJpbmcoKVxyXG4gICAgICAgIH0sIGlucHV0T2JqKTtcclxuICAgICAgICB2YXIgZmFpbGVkQXR0ZW1wdHMgPSBqUXVlcnkuZXh0ZW5kKHtcclxuICAgICAgICAgICAgbmFtZTogJ0FsbG93ZWRBdHRlbXB0cycsXHJcbiAgICAgICAgICAgIHZhbHVlOiBzZXR0aW5ncy5BbGxvd2VkQXR0ZW1wdHMudG9TdHJpbmcoKVxyXG4gICAgICAgIH0sIGlucHV0T2JqKTtcclxuICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5TdGF0aWNIZWFkZXJGb3JtLCB7IHRpdGxlOiBJbm92eExvYWRlci50KCd1c2VyczpzZXR0aW5nc0Zvcm0uaGVhZGVyVGl0bGUnKSwgc2F2ZU9uQ2xpY2s6IHRoaXMuX3NhdmUsIGNhbmNlbE9uQ2xpY2s6IHRoaXMuX2NhbmNlbCwgaXNBY3Rpb25JblByb2dyZXNzOiB0aGlzLnN0YXRlLmlzQWN0aW9uSW5Qcm9ncmVzcywgaW5Qcm9ncmVzc01lc3NhZ2U6IHRoaXMuc3RhdGUuYWN0aW9uSW5Qcm9ncmVzc01zZyB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiAndXNlci1mb3JtJyB9LFxyXG4gICAgICAgICAgICAgICAgdHJ1ZSA/IG51bGwgOlxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Hcm91cEJveCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudCgndXNlcnM6c2V0dGluZ3NGb3JtLnJlbWVtYmVyTWUnKSwgY2xhc3M6IFwiZ2ItcmVtZW1iZXItbWVcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImZvcm0tZmllbGRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJmci1tYXJnaW5cIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiLCB7IGNsYXNzTmFtZTogXCJyYWRpby1pbmxpbmVcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgeyB0eXBlOiBcInJhZGlvXCIsIHZhbHVlOiBcInRydWVcIiwgbmFtZTogXCJSZW1lbWJlck1lXCIsIG9uQ2hhbmdlOiB0aGlzLl9vbkNoZWNrQ2hhbmdlLCBjaGVja2VkOiBzZXR0aW5ncy5SZW1lbWJlck1lIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbm92eExvYWRlci50KFwidXNlcnM6c2V0dGluZ3NGb3JtLmVuYWJsZWRcIikpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiLCB7IGNsYXNzTmFtZTogXCJyYWRpby1pbmxpbmVcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgeyB0eXBlOiBcInJhZGlvXCIsIHZhbHVlOiBcImZhbHNlXCIsIG5hbWU6IFwiUmVtZW1iZXJNZVwiLCBvbkNoYW5nZTogdGhpcy5fb25DaGVja0NoYW5nZSwgY2hlY2tlZDogIXNldHRpbmdzLlJlbWVtYmVyTWUgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElub3Z4TG9hZGVyLnQoXCJ1c2VyczpzZXR0aW5nc0Zvcm0uZGlzYWJsZWRcIikpKSkpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkdyb3VwQm94LCB7IHRpdGxlOiBJbm92eExvYWRlci50KCd1c2VyczpzZXR0aW5nc0Zvcm0ucGFzc3dvcmRTZXR0aW5ncycpLCBjbGFzczogXCJnYi1wYXNzd29yZC1zZXR0aW5nc1wiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJmb3JtLWZpZWxkXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJmci1tYXJnaW5cIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImxhYmVsXCIsIHsgY2xhc3NOYW1lOiBcInJhZGlvLWlubGluZVwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIHsgdHlwZTogXCJyYWRpb1wiLCB2YWx1ZTogXCJmYWxzZVwiLCBuYW1lOiBcIlBhc3N3b3JkRXhwaXJlc1wiLCBvbkNoYW5nZTogdGhpcy5fb25DaGVja0NoYW5nZSwgY2hlY2tlZDogIXNldHRpbmdzLlBhc3N3b3JkRXhwaXJlcyB9KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbm92eExvYWRlci50KFwidXNlcnM6c2V0dGluZ3NGb3JtLnBhc3N3b3JkTm90RXhwaXJlc1wiKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwibGFiZWxcIiwgeyBjbGFzc05hbWU6IFwicmFkaW8taW5saW5lXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgeyB0eXBlOiBcInJhZGlvXCIsIHZhbHVlOiBcInRydWVcIiwgbmFtZTogXCJQYXNzd29yZEV4cGlyZXNcIiwgb25DaGFuZ2U6IHRoaXMuX29uQ2hlY2tDaGFuZ2UsIGNoZWNrZWQ6IHNldHRpbmdzLlBhc3N3b3JkRXhwaXJlcyB9KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbm92eExvYWRlci50KFwidXNlcnM6c2V0dGluZ3NGb3JtLnBhc3N3b3JkRXhwaXJlc1wiKSkpKSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBJbm92eExvYWRlci50KFwidXNlcnM6c2V0dGluZ3NGb3JtLnBhc3N3b3JkRXhwaXJhdGlvblwiKSwgdG9vbHRpcDogSW5vdnhMb2FkZXIudChcInVzZXJzOnNldHRpbmdzRm9ybS5wYXNzd29yZEV4cGlyYXRpb25Ub29sVGlwXCIpLCBpbnB1dE5hbWU6ICdQYXNzd29yZEV4cGlyYXRpb24nIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5WYWxpZGF0aW9uSW5wdXQsIF9fYXNzaWduKHt9LCBwYXNzd29yZEV4cGlyYXRpb24sIHsgY2xhc3NOYW1lOiBcImZvcm0tY29udHJvbFwiLCBvbkNoYW5nZTogdGhpcy5fb25DaGFuZ2UsIHZhbGlkYXRpb246IHRoaXMuc3RhdGUudmFsaWRhdGlvblsnUGFzc3dvcmRFeHBpcmF0aW9uJ10sIHJlYWRPbmx5OiAhc2V0dGluZ3MuUGFzc3dvcmRFeHBpcmVzIH0pKSksXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcInVzZXJzOnNldHRpbmdzRm9ybS5mYWlsZWRBdHRlbXB0c1wiKSwgdG9vbHRpcDogSW5vdnhMb2FkZXIudChcInVzZXJzOnNldHRpbmdzRm9ybS5mYWlsZWRBdHRlbXB0c1Rvb2xUaXBcIiksIGlucHV0TmFtZTogJ0FsbG93ZWRBdHRlbXB0cycgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLlZhbGlkYXRpb25JbnB1dCwgX19hc3NpZ24oe30sIGZhaWxlZEF0dGVtcHRzLCB7IGNsYXNzTmFtZTogXCJmb3JtLWNvbnRyb2xcIiwgb25DaGFuZ2U6IHRoaXMuX29uQ2hhbmdlLCB2YWxpZGF0aW9uOiB0aGlzLnN0YXRlLnZhbGlkYXRpb25bJ0FsbG93ZWRBdHRlbXB0cyddIH0pKSkpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkdyb3VwQm94LCB7IHRpdGxlOiBJbm92eExvYWRlci50KCd1c2VyczpzZXR0aW5nc0Zvcm0ucGFzc3dvcmRDb21wbGV4aXR5VGl0bGUnKSwgY2xhc3M6IFwiZ2ItcGFzc3dvcmQtY29tcGxleGl0eVwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcInVzZXJzOnNldHRpbmdzRm9ybS5wYXNzd29yZE1pbkNoYXJhY3RlcnNcIiksIHRvb2x0aXA6IElub3Z4TG9hZGVyLnQoXCJ1c2VyczpzZXR0aW5nc0Zvcm0ucGFzc3dvcmRNaW5DaGFyYWN0ZXJzVG9vbFRpcFwiKSwgaW5wdXROYW1lOiAnTWluQ2hhcmFjdGVycycgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLlZhbGlkYXRpb25JbnB1dCwgX19hc3NpZ24oe30sIHBhc3N3b3JkTWluQ2hhcmFjdGVycywgeyBjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sXCIsIG9uQ2hhbmdlOiB0aGlzLl9vblBhc3N3b3JkQ29tcGxleGl0eUNoYW5nZSwgdmFsaWRhdGlvbjogdGhpcy5zdGF0ZS52YWxpZGF0aW9uWydQYXNzd29yZENoYXJhY3RlcnMnXSB9KSkpLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IElub3Z4TG9hZGVyLnQoXCJ1c2VyczpzZXR0aW5nc0Zvcm0ucmVxdWlyZWRTeW1ib2xzXCIpLCB0b29sdGlwOiBJbm92eExvYWRlci50KFwidXNlcnM6c2V0dGluZ3NGb3JtLnJlcXVpcmVkU3ltYm9sc1Rvb2xUaXBcIiksIGlucHV0TmFtZTogJ1JlcXVpcmVkU3ltYm9scycgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLlZhbGlkYXRpb25JbnB1dCwgX19hc3NpZ24oe30sIHJlcXVpcmVkU3ltYm9scywgeyBjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sXCIsIG9uQ2hhbmdlOiB0aGlzLl9vblBhc3N3b3JkQ29tcGxleGl0eUNoYW5nZSwgdmFsaWRhdGlvbjogdGhpcy5zdGF0ZS52YWxpZGF0aW9uWydQYXNzd29yZFN5bWJvbHMnXSB9KSkpLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IElub3Z4TG9hZGVyLnQoXCJ1c2VyczpzZXR0aW5nc0Zvcm0ucmVxdWlyZU51bWJlcnNcIiksIHRvb2x0aXA6IElub3Z4TG9hZGVyLnQoXCJ1c2VyczpzZXR0aW5nc0Zvcm0ucmVxdWlyZU51bWJlcnNUb29sVGlwXCIpLCBpbnB1dE5hbWU6ICdVc2VyTmFtZScgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLlZhbGlkYXRpb25JbnB1dCwgX19hc3NpZ24oe30sIHJlcXVpcmVOdW1iZXJzLCB7IGNsYXNzTmFtZTogXCJmb3JtLWNvbnRyb2xcIiwgb25DaGFuZ2U6IHRoaXMuX29uUGFzc3dvcmRDb21wbGV4aXR5Q2hhbmdlLCB2YWxpZGF0aW9uOiB0aGlzLnN0YXRlLnZhbGlkYXRpb25bJ1Bhc3N3b3JkTnVtYmVycyddIH0pKSkpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLk1vZGFsUG9wVXAsIHsgaXNPcGVuOiB0aGlzLnN0YXRlLmRpc3BsYXlQYXNzd29yZENoYW5nZSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hhbmdlVXNlclBhc3N3b3JkLCB7IFVzZXI6IHRoaXMuc3RhdGUuY3VycmVudFVzZXIsIG9uUGFzc3dvcmRDaGFuZ2VkOiB0aGlzLl9zYXZlQ2hhbmdlUGFzc3dvcmQsIG9uQ2FuY2VsOiB0aGlzLl9jYW5jZWxDaGFuZ2VQYXNzd29yZCwgbWVzc2FnZTogSW5vdnhMb2FkZXIudCgndXNlcnM6c2V0dGluZ3NGb3JtLnNldFBhc3N3b3JkSW5mbycpIH0pKSkpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVXNlclNldHRpbmdzO1xyXG59KFJlYWN0LkNvbXBvbmVudCkpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IFVzZXJTZXR0aW5ncztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VXNlclNldHRpbmdzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBJbm92eENvbnRyb2xzID0gSW5vdnguU2hhcmVkLkNvbnRyb2xzO1xyXG52YXIgU3lzdGVtQWN0aW9ucyA9IElub3Z4LlNoYXJlZC5TeXN0ZW0uQWN0aW9ucztcclxudmFyIFVzZXJBY3Rpb25zID0gcmVxdWlyZShcIi4vLi4vYWN0aW9ucy9Vc2VyQWN0aW9uc1wiKTtcclxudmFyIFVzZXJDb25zdGFudHMgPSByZXF1aXJlKFwiLi8uLi9jb25zdGFudHMvVXNlckNvbnN0YW50c1wiKTtcclxudmFyIFN5c3RlbVN0b3JlID0gSW5vdnguU2hhcmVkLlN5c3RlbS5TdG9yZTtcclxuZnVuY3Rpb24gZ2V0RGVmYXVsdFN0YXRlKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpc0FjdGlvbkluUHJvZ3Jlc3M6IGZhbHNlLFxyXG4gICAgICAgIGRpcnR5OiBmYWxzZSxcclxuICAgICAgICBlbnRpdGxlbWVudDogW10sXHJcbiAgICAgICAgcm9sZXM6IFtdLFxyXG4gICAgICAgIHByZWZlcmVuY2VzOiB7XHJcbiAgICAgICAgICAgIERlZmF1bHRTeXRlbVNldHRpbmc6IHtcclxuICAgICAgICAgICAgICAgIERlZmF1bHRHcm91cElEczogW10sXHJcbiAgICAgICAgICAgICAgICBEZWZhdWx0Um9sZUlEczogW11cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgQWxsR3JvdXBzOiBbXSxcclxuICAgICAgICAgICAgQWxsUm9sZXM6IFtdXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBnZXRBY3Rpb25JblByb2dyZXNzKCkge1xyXG4gICAgcmV0dXJuIFN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhVc2VyQ29uc3RhbnRzLlNZU1RFTV9TRVRUSU5HU19HRVQpO1xyXG59XHJcbnZhciBVc2VyU3lzdGVtUHJlZmVyZW5jZXMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVXNlclN5c3RlbVByZWZlcmVuY2VzLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVXNlclN5c3RlbVByZWZlcmVuY2VzKHByb3BzLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgXCJTeXN0ZW0gUHJlZmVyZW5jZXNcIiwgcHJvcHMsIGNvbnRleHQpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX29uU2F2ZSA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGlmIChlICYmIGUuc3RvcFByb3BhZ2F0aW9uKVxyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgX3RoaXMuX3NhdmUoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IF90aGlzLnN0YXRlLnByZWZlcmVuY2VzLkRlZmF1bHRTeXRlbVNldHRpbmc7XHJcbiAgICAgICAgICAgIFVzZXJBY3Rpb25zLnNhdmVTeXN0ZW1TZXR0aW5ncyhkYXRhLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5vbkNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0sIG51bGwpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX29uQ2FuY2VsID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKF90aGlzLnN0YXRlLmRpcnR5KSB7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmRpc3BsYXlTYXZlQ2hhbmdlc0RpYWxvZyh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogSW5vdnhMb2FkZXIudChcImNvbW1vbjptc2dCb3guc2F2ZUNoYW5nZXNcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybUNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBjYW5jZWxDYWxsYmFjazogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5vbkNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5vbkNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vblJlc2V0ID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICAgICAgZGlydHk6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBwcmVmZXJlbmNlczoge1xyXG4gICAgICAgICAgICAgICAgICAgIERlZmF1bHRTeXRlbVNldHRpbmc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdEdyb3VwSURzOiBfdGhpcy5fcHJlZmVyZW5jZXMuRGVmYXVsdFN5dGVtU2V0dGluZy5EZWZhdWx0R3JvdXBJRHMuc2xpY2UoMCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHRSb2xlSURzOiBfdGhpcy5fcHJlZmVyZW5jZXMuRGVmYXVsdFN5dGVtU2V0dGluZy5EZWZhdWx0Um9sZUlEcy5zbGljZSgwKVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgQWxsR3JvdXBzOiBfdGhpcy5fcHJlZmVyZW5jZXMuQWxsR3JvdXBzLnNsaWNlKDApLFxyXG4gICAgICAgICAgICAgICAgICAgIEFsbFJvbGVzOiBfdGhpcy5fcHJlZmVyZW5jZXMuQWxsUm9sZXMuc2xpY2UoMClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlc1dpbmRvdyA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5kaXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgZS5yZXR1cm5WYWx1ZSA9IElub3Z4TG9hZGVyLnQoJ3VzZXJzOm1lc3NhZ2UudW5zYXZlZFByZWZlcmVuY2VzJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vblJvbGVzU2VsZWN0ID0gZnVuY3Rpb24gKHJvbGVPYmosIHNlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9vblNlbGVjdCgnUm9sZUlEcycsIHJvbGVPYmosIHNlbGVjdGVkKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vbkVudGl0bGVtZW50U2VsZWN0ID0gZnVuY3Rpb24gKGVudGl0bGVtZW50T2JqLCBzZWxlY3RlZCkge1xyXG4gICAgICAgICAgICBfdGhpcy5fb25TZWxlY3QoJ0VudGl0bGVtZW50R3JvdXBJRHMnLCBlbnRpdGxlbWVudE9iaiwgc2VsZWN0ZWQpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX29uU2VsZWN0ID0gZnVuY3Rpb24gKG5hbWUsIG9iaiwgc2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgaWYgKHNlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAvL0FkZFxyXG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09IFwiRW50aXRsZW1lbnRHcm91cElEc1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3RhdGUucHJlZmVyZW5jZXMuRGVmYXVsdFN5dGVtU2V0dGluZy5EZWZhdWx0R3JvdXBJRHMucHVzaChvYmouSUQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3RhdGUucHJlZmVyZW5jZXMuRGVmYXVsdFN5dGVtU2V0dGluZy5EZWZhdWx0Um9sZUlEcy5wdXNoKG9iai5JRCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL1JlbW92ZVxyXG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09IFwiRW50aXRsZW1lbnRHcm91cElEc1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gX3RoaXMuc3RhdGUucHJlZmVyZW5jZXMuRGVmYXVsdFN5dGVtU2V0dGluZy5EZWZhdWx0R3JvdXBJRHMuaW5kZXhPZihvYmouSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zdGF0ZS5wcmVmZXJlbmNlcy5EZWZhdWx0U3l0ZW1TZXR0aW5nLkRlZmF1bHRHcm91cElEcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gX3RoaXMuc3RhdGUucHJlZmVyZW5jZXMuRGVmYXVsdFN5dGVtU2V0dGluZy5EZWZhdWx0Um9sZUlEcy5pbmRleE9mKG9iai5JRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnN0YXRlLnByZWZlcmVuY2VzLkRlZmF1bHRTeXRlbVNldHRpbmcuRGVmYXVsdFJvbGVJRHMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgICAgICAgICBkaXJ0eTogdHJ1ZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vblN5c3RlbUNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICAgICAgaXNBY3Rpb25JblByb2dyZXNzOiBnZXRBY3Rpb25JblByb2dyZXNzKClcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5zdGF0ZSA9IGdldERlZmF1bHRTdGF0ZSgpO1xyXG4gICAgICAgIF90aGlzLl9pbml0aWFsaXplID0gX3RoaXMuX2luaXRpYWxpemUuYmluZChfdGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgVXNlclN5c3RlbVByZWZlcmVuY2VzLnByb3RvdHlwZS5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIFVzZXJBY3Rpb25zLmdldFVzZXJTeXN0ZW1QcmVmZXJlbmNlcyhmdW5jdGlvbiAocHJlZmVyZW5jZXMpIHtcclxuICAgICAgICAgICAgX3RoaXMuX2FwcExvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHtcclxuICAgICAgICAgICAgICAgIGRpcnR5OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHByZWZlcmVuY2VzOiBwcmVmZXJlbmNlc1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgX3RoaXMuX3ByZWZlcmVuY2VzID0ge1xyXG4gICAgICAgICAgICAgICAgRGVmYXVsdFN5dGVtU2V0dGluZzoge1xyXG4gICAgICAgICAgICAgICAgICAgIERlZmF1bHRHcm91cElEczogcHJlZmVyZW5jZXMuQWxsR3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgeyByZXR1cm4gaXRlbS5OYW1lID09IFwiVXNlclwiOyB9KS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsgcmV0dXJuIGl0ZW0uSUQ7IH0pLFxyXG4gICAgICAgICAgICAgICAgICAgIERlZmF1bHRSb2xlSURzOiBbXVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIEFsbEdyb3VwczogcHJlZmVyZW5jZXMuQWxsR3JvdXBzLnNsaWNlKDApLFxyXG4gICAgICAgICAgICAgICAgQWxsUm9sZXM6IHByZWZlcmVuY2VzLkFsbFJvbGVzLnNsaWNlKDApXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSwgbnVsbCk7XHJcbiAgICB9O1xyXG4gICAgVXNlclN5c3RlbVByZWZlcmVuY2VzLnByb3RvdHlwZS5jb21wb25lbnRXaWxsTW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5jb21wb25lbnRXaWxsTW91bnRCYXNlKCk7XHJcbiAgICAgICAgU3lzdGVtU3RvcmUuYWRkQ2hhbmdlTGlzdGVuZXIodGhpcy5fb25TeXN0ZW1DaGFuZ2UpO1xyXG4gICAgfTtcclxuICAgIFVzZXJTeXN0ZW1QcmVmZXJlbmNlcy5wcm90b3R5cGUuY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIHRoaXMuX2NoZWNrRm9yVW5zYXZlZENoYW5nZXNXaW5kb3cpO1xyXG4gICAgICAgIFN5c3RlbVN0b3JlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX29uU3lzdGVtQ2hhbmdlKTtcclxuICAgIH07XHJcbiAgICBVc2VyU3lzdGVtUHJlZmVyZW5jZXMucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLl9jaGVja0ZvclVuc2F2ZWRDaGFuZ2VzV2luZG93KTtcclxuICAgIH07XHJcbiAgICBVc2VyU3lzdGVtUHJlZmVyZW5jZXMucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnguU2hhcmVkLkNvcmUuUmVhY3RMb2FkZXIsIHsgYXBwUmVhZHk6IHRoaXMuaXNBcHBMb2FkZWQoKSwgZXJyb3JTdGF0dXM6IHRoaXMuX2Vycm9yU3RhdHVzIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidXNlci1wcmVmZXJlbmNlcy1wb3B1cCBuby1wcmludFwiLCBpZDogXCJ1c2VyLXByZWZlcmVuY2VzLXBvcHVwXCIgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnguU2hhcmVkLkNvbnRyb2xzLklmLCB7IGNvbmRpdGlvbjogdGhpcy5zdGF0ZS5pc0FjdGlvbkluUHJvZ3Jlc3MsIGNsYXNzOiAndGVtcC1tb2RhbC1sb2FkZXInIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJhY3Rpb24taW4tcHJvZ3Jlc3MtbG9hZGVyLWxyZ1wiIH0pKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicGFuZWwgcGFuZWwtcHJpbWFyeSB1c2VyLXByZWZlcmVuY2VzLWFwcC1jb250ZW50XCIgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInBhbmVsLWhlYWRpbmdcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBJbm92eExvYWRlci50KFwidXNlcnM6cHJlZmVyZW5jZXMudGl0bGVcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJhXCIsIHsgaHJlZjogXCIjXCIsIG9uQ2xpY2s6IHRoaXMuX29uQ2FuY2VsIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJwdWxsLXJpZ2h0IGdseXBoaWNvbiBnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZVwiIH0pKSksXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJwYW5lbC1ib2R5XCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ1c2VyLWZvcm1cIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLklmLCB7IGNvbmRpdGlvbjogdHJ1ZSwgY2xhc3M6ICdmYy1tYXJnaW4nIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkdyb3VwQm94LCB7IHRpdGxlOiBJbm92eExvYWRlci50KCd1c2VyczpwcmVmZXJlbmNlcy5lbnRpdGxlbWVudCcpLCBjbGFzczogXCJnYi11c2VyLWVudGl0bGVtZW50XCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcInVzZXJzOmNvbW1vbi5lbnRpdGxlbWVudFwiKSwgaW5wdXROYW1lOiAnRW50aXRsZW1lbnQnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuTXVsdGlTZWxlY3QsIHsgZGlzcGxheVByb3A6IFwiTmFtZVwiLCBtaW5MZW5ndGg6IDAsIG9uU2VsZWN0OiB0aGlzLl9vbkVudGl0bGVtZW50U2VsZWN0LCBkYXRhc291cmNlOiB0aGlzLnN0YXRlLnByZWZlcmVuY2VzLkFsbEdyb3Vwcywga2V5UHJvcDogXCJJRFwiLCB2YWx1ZVByb3A6IFwiSURcIiwgdmFsdWVzOiB0aGlzLnN0YXRlLnByZWZlcmVuY2VzLkRlZmF1bHRTeXRlbVNldHRpbmcuRGVmYXVsdEdyb3VwSURzIH0pKSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLklmLCB7IGNvbmRpdGlvbjogdHJ1ZSwgY2xhc3M6ICdmYy1tYXJnaW4nIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkdyb3VwQm94LCB7IHRpdGxlOiBJbm92eExvYWRlci50KCd1c2VyczpwcmVmZXJlbmNlcy5yb2xlcycpLCBjbGFzczogXCJnYi11c2VyLXJvbGVzXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcInVzZXJzOmNvbW1vbi5yb2xlc1wiKSwgaW5wdXROYW1lOiAnUm9sZScgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5NdWx0aVNlbGVjdCwgeyBkaXNwbGF5UHJvcDogXCJOYW1lXCIsIG1pbkxlbmd0aDogMCwgb25TZWxlY3Q6IHRoaXMuX29uUm9sZXNTZWxlY3QsIGRhdGFzb3VyY2U6IHRoaXMuc3RhdGUucHJlZmVyZW5jZXMuQWxsUm9sZXMsIGtleVByb3A6IFwiSURcIiwgdmFsdWVQcm9wOiBcIklEXCIsIHZhbHVlczogdGhpcy5zdGF0ZS5wcmVmZXJlbmNlcy5EZWZhdWx0U3l0ZW1TZXR0aW5nLkRlZmF1bHRSb2xlSURzIH0pKSkpKSksXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJwYW5lbC1mb290ZXIgY2xlYXJmaXhcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInJvd1wiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInB1bGwtbGVmdFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiLCB7IHR5cGU6IFwiYnV0dG9uXCIsIGlkOiBcInByZWZlcmVuY2VzLmJ0bi5yZXNldFwiLCBjbGFzc05hbWU6IFwiYnRuIGJ0bi1pbmZvIGJ0bi1sZWZ0XCIsIG9uQ2xpY2s6IHRoaXMuX29uUmVzZXQgfSwgSW5vdnhMb2FkZXIudChcInVzZXJzOnByZWZlcmVuY2VzLnJlc2V0QnV0dG9uXCIpKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInB1bGwtcmlnaHRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIiwgeyB0eXBlOiBcImJ1dHRvblwiLCBpZDogXCJwcmVmZXJlbmNlcy5idG4uc2F2ZVwiLCBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi1zcGFjZVwiLCBvbkNsaWNrOiB0aGlzLl9vblNhdmUgfSwgSW5vdnhMb2FkZXIudChcInVzZXJzOnByZWZlcmVuY2VzLnNhdmVCdXR0b25cIikpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIiwgeyB0eXBlOiBcImJ1dHRvblwiLCBpZDogXCJwcmVmZXJlbmNlcy5idG4uY2FuY2VsXCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLXByaW1hcnkgYnRuLXJpZ2h0XCIsIG9uQ2xpY2s6IHRoaXMuX29uQ2FuY2VsIH0sIElub3Z4TG9hZGVyLnQoXCJ1c2VyczpwcmVmZXJlbmNlcy5jYW5jZWxCdXR0b25cIikpKSkpKSkpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVXNlclN5c3RlbVByZWZlcmVuY2VzO1xyXG59KElub3Z4LlNoYXJlZC5SZWFjdEV4dC5CYXNlQXBwQ29tcG9uZW50KSk7XHJcbm1vZHVsZS5leHBvcnRzID0gVXNlclN5c3RlbVByZWZlcmVuY2VzO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Vc2VyU3lzdGVtUHJlZmVyZW5jZXMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIEEgJy50c3gnIGZpbGUgZW5hYmxlcyBKU1ggc3VwcG9ydCBpbiB0aGUgVHlwZVNjcmlwdCBjb21waWxlciwgXHJcbi8vIGZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSB0aGUgZm9sbG93aW5nIHBhZ2Ugb24gdGhlIFR5cGVTY3JpcHQgd2lraTpcclxuLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L3dpa2kvSlNYXHJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG52YXIgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XHJcbnZhciBVc2VyU3RvcmUgPSByZXF1aXJlKFwiLi8uLi9zdG9yZXMvVXNlclN0b3JlXCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBJbm92eENvbnRyb2xzID0gSW5vdnguU2hhcmVkLkNvbnRyb2xzO1xyXG52YXIgVXNlclZpZXcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVXNlclZpZXcsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBVc2VyVmlldyhwcm9wcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnN0YXRlID0ge1xyXG4gICAgICAgICAgICB1c2VyOiBVc2VyU3RvcmUuZ2V0RWRpdFVzZXIoKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgVXNlclZpZXcucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5TdGF0aWNIZWFkZXJGb3JtLCB7IHRpdGxlOiBJbm92eExvYWRlci50KFwidXNlcnM6Zm9ybS52aWV3VXNlclwiKSB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBJbm92eExvYWRlci50KFwidXNlcnM6Y29tbW9uLnVzZXJuYW1lXCIpLCBpbnB1dE5hbWU6ICcnIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJ1c2VyLWZpZWxkLXZpZXdvbmx5XCIgfSwgdGhpcy5zdGF0ZS51c2VyLlVzZXJOYW1lKSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpjb21tb24uZmlyc3RuYW1lXCIpLCBpbnB1dE5hbWU6ICdGaXJzdE5hbWUnIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJ1c2VyLWZpZWxkLXZpZXdvbmx5XCIgfSwgdGhpcy5zdGF0ZS51c2VyLkZpcnN0TmFtZSkpLFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBJbm92eExvYWRlci50KFwidXNlcnM6Y29tbW9uLmxhc3RuYW1lXCIpLCBpbnB1dE5hbWU6ICdMYXN0TmFtZScgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcInVzZXItZmllbGQtdmlld29ubHlcIiB9LCB0aGlzLnN0YXRlLnVzZXIuTGFzdE5hbWUpKSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcInVzZXJzOmZvcm0udXNlclN0YXR1c1wiKSwgaW5wdXROYW1lOiAnJyB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwidXNlci1maWVsZC12aWV3b25seVwiIH0sIHRoaXMuc3RhdGUudXNlci5FbmFibGVkID8gSW5vdnhMb2FkZXIudChcInVzZXJzOmNvbW1vbi5lbmFibGVkXCIpIDogSW5vdnhMb2FkZXIudChcInVzZXJzOmNvbW1vbi5kaXNhYmxlZFwiKSkpKSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFVzZXJWaWV3O1xyXG59KFJlYWN0LkNvbXBvbmVudCkpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IFVzZXJWaWV3O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Vc2VyVmlldy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIEF1dGhlbnRpY2F0aW9uTW9kZUVudW07XHJcbihmdW5jdGlvbiAoQXV0aGVudGljYXRpb25Nb2RlRW51bSkge1xyXG4gICAgQXV0aGVudGljYXRpb25Nb2RlRW51bVtcIkxvY2FsT25seVwiXSA9IFwiTG9jYWxPbmx5XCI7XHJcbiAgICBBdXRoZW50aWNhdGlvbk1vZGVFbnVtW1wiRXh0ZXJuYWxPbmx5XCJdID0gXCJFeHRlcm5hbE9ubHlcIjtcclxuICAgIEF1dGhlbnRpY2F0aW9uTW9kZUVudW1bXCJNaXhlZFwiXSA9IFwiTWl4ZWRcIjtcclxufSkoQXV0aGVudGljYXRpb25Nb2RlRW51bSB8fCAoQXV0aGVudGljYXRpb25Nb2RlRW51bSA9IHt9KSk7XHJcbjtcclxubW9kdWxlLmV4cG9ydHMgPSBBdXRoZW50aWNhdGlvbk1vZGVFbnVtO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1BdXRoZW50aWNhdGlvbk1vZGVFbnVtLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgRXh0ZXJuYWxQcm92aWRlckVudW07XHJcbihmdW5jdGlvbiAoRXh0ZXJuYWxQcm92aWRlckVudW0pIHtcclxuICAgIEV4dGVybmFsUHJvdmlkZXJFbnVtW1wiQXp1cmVBRFwiXSA9IFwiYWFkXCI7XHJcbiAgICBFeHRlcm5hbFByb3ZpZGVyRW51bVtcIkFERlNcIl0gPSBcImFkZnNcIjtcclxufSkoRXh0ZXJuYWxQcm92aWRlckVudW0gfHwgKEV4dGVybmFsUHJvdmlkZXJFbnVtID0ge30pKTtcclxuO1xyXG5tb2R1bGUuZXhwb3J0cyA9IEV4dGVybmFsUHJvdmlkZXJFbnVtO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1FeHRlcm5hbFByb3ZpZGVyRW51bS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIGtleW1pcnJvciA9IHJlcXVpcmUoXCJmYmpzL2xpYi9rZXltaXJyb3JcIik7XHJcbnZhciBVc2VyQ29uc3RhbnRzID0ga2V5bWlycm9yKHtcclxuICAgIFVTRVJfQUREX0ZPUk06IG51bGwsXHJcbiAgICBVU0VSX1NFVFRJTkdTX0ZPUk06IG51bGwsXHJcbiAgICBVU0VSX0ZPUk1fSU5WQUxJRF9TQVZFOiBudWxsLFxyXG4gICAgVVNFUl9WQUxJREFUSU9OX0VSUk9SOiBudWxsLFxyXG4gICAgVVNFUl9BREQ6IG51bGwsXHJcbiAgICBVU0VSX0RFTEVURTogbnVsbCxcclxuICAgIFVTRVJfRURJVDogbnVsbCxcclxuICAgIFVTRVJfQ0hBTkdFX1BBU1NXT1JEOiBudWxsLFxyXG4gICAgVVNFUl9DSEFOR0VfUEFTU1dPUkRfU1VDQ0VTUzogbnVsbCxcclxuICAgIEJFR0lOX0VESVRfVVNFUjogbnVsbCxcclxuICAgIEJFR0lOX1VTRVJfQUREOiBudWxsLFxyXG4gICAgRklOSVNIX0VESVQ6IG51bGwsXHJcbiAgICBVUERBVEVfTU9EQUxfVklTSUJMRTogbnVsbCxcclxuICAgIFVTRVJfUkVDSUVWRV9EQVRBOiBudWxsLFxyXG4gICAgVVNFUl9DSEVDS19OQU1FOiBudWxsLFxyXG4gICAgVVNFUl9SRUNJRVZFX0hJTlQ6IG51bGwsXHJcbiAgICBVU0VSX0dFVF9BTEw6IG51bGwsXHJcbiAgICBVU0VSX1VQREFURV9PQkpFQ1Q6IG51bGwsXHJcbiAgICBVU0VSX1VQREFURV9PQkpFQ1RfQUREX0xJU1Q6IG51bGwsXHJcbiAgICBVU0VSX1VQREFURV9PQkpFQ1RfUkVNT1ZFX0xJU1Q6IG51bGwsXHJcbiAgICBVU0VSX1NFTEVDVF9ISU5UOiBudWxsLFxyXG4gICAgVVNFUl9DVVJSRU5UX0dFVDogbnVsbCxcclxuICAgIFVTRVJfQ1VSUkVOVF9SRUNJRVZFOiBudWxsLFxyXG4gICAgUkVTRVRfTE9HSU5fQVRURU1QVFM6IG51bGwsXHJcbiAgICBTSE9XX1NFVFRJTkdTX01FTlU6IG51bGwsXHJcbiAgICBISURFX1NFVFRJTkdTX01FTlU6IG51bGwsXHJcbiAgICBTRVRUSU5HU19TQVZFOiBudWxsLFxyXG4gICAgU0VUVElOR1NfR0VUOiBudWxsLFxyXG4gICAgU1lTVEVNX1NFVFRJTkdfR0VUOiBudWxsLFxyXG4gICAgU1lTVEVNX1NFVFRJTkdfU0FWRTogbnVsbFxyXG59KTtcclxubW9kdWxlLmV4cG9ydHMgPSBVc2VyQ29uc3RhbnRzO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Vc2VyQ29uc3RhbnRzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgVXNlclBlcm1pc3Npb25OYW1lcyA9IHtcclxuICAgIFVTRVJfVklFVzogXCJVc2VyLlZpZXdcIixcclxuICAgIFVTRVJfTUFOQUdFOiBcIlVzZXIuTWFuYWdlXCIsXHJcbiAgICBVU0VSX1NFVFRJTkdTOiBcIlVzZXIuU2V0dGluZ3NcIixcclxuICAgIFJPTEVfTUFOQUdFOiBcIlJvbGUuTWFuYWdlXCIsXHJcbiAgICBFTlRJVExFTUVOVF9NQU5BR0U6IFwiRW50aXRsZW1lbnQuTWFuYWdlXCJcclxufTtcclxubW9kdWxlLmV4cG9ydHMgPSBVc2VyUGVybWlzc2lvbk5hbWVzO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Vc2VyUGVybWlzc2lvbk5hbWVzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBhc3NpZ24gPSByZXF1aXJlKFwib2JqZWN0LWFzc2lnblwiKTtcclxudmFyIFVybFV0aWxpdGllcyA9IElub3Z4LlNoYXJlZC5Db21tb24uVXJsVXRpbGl0aWVzO1xyXG52YXIgdXJsID0gXCJcIi5jb25jYXQoVXJsVXRpbGl0aWVzLmdldEFwaVVybCgpLCBcIi9Vc2VyQXBpL2FwaS9zZXR0aW5nc1wiKTtcclxudmFyIFNldHRpbmdzU2VydmljZSA9IGFzc2lnbih7fSwgSW5vdnguU2hhcmVkLkZsdXguQmFzZVNlcnZpY2UsIHtcclxuICAgIGdldFNldHRpbmdzOiBmdW5jdGlvbiAoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBpZ25vcmVEZWZhdWx0RXJyb3IpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuZ2V0KFwiXCIuY29uY2F0KHVybCwgXCIvQXV0aGVudGljYXRpb25cIiksIG51bGwsIGZ1bmN0aW9uIChyZXREYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXREYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgaWYgKCFpZ25vcmVEZWZhdWx0RXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBzYXZlU2V0dGluZ3M6IGZ1bmN0aW9uIChzZXR0aW5ncywgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBpZ25vcmVWU3VpdGVMb2dpbkVycm9yKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLnBvc3QoXCJcIi5jb25jYXQodXJsLCBcIi9BdXRoZW50aWNhdGlvblwiKSwgc2V0dGluZ3MsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjaygpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICB2YXIgZXJySnNvbiA9IEpTT04ucGFyc2UoZXJyb3IucmVzcG9uc2VUZXh0KTtcclxuICAgICAgICAgICAgaWYgKGlnbm9yZVZTdWl0ZUxvZ2luRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlcnJKc29uLlJlYXNvbiAhPSBcIkN1cnJlbnRVc2VyUGFzc3dvcmROb3RTZXRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBnZXRTeXN0ZW1TZXR0aW5nczogZnVuY3Rpb24gKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmdldChcIlwiLmNvbmNhdCh1cmwsIFwiL1N5c3RlbVwiKSwgbnVsbCwgZnVuY3Rpb24gKHJldERhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHJldERhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBpZiAoIWlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIHNhdmVTeXN0ZW1TZXR0aW5nczogZnVuY3Rpb24gKHNldHRpbmdzLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIGlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvU3lzdGVtXCIpLCBzZXR0aW5ncywgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKCk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGlmICghaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5tb2R1bGUuZXhwb3J0cyA9IFNldHRpbmdzU2VydmljZTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U2V0dGluZ3NTZXJ2aWNlLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBhc3NpZ24gPSByZXF1aXJlKFwib2JqZWN0LWFzc2lnblwiKTtcclxudmFyIFVybFV0aWxpdGllcyA9IElub3Z4LlNoYXJlZC5Db21tb24uVXJsVXRpbGl0aWVzO1xyXG52YXIgdXJsID0gXCJcIi5jb25jYXQoVXJsVXRpbGl0aWVzLmdldEFwaVVybCgpLCBcIi9Vc2VyQXBpL2FwaS91c2VyXCIpO1xyXG52YXIgVXNlclNlcnZpY2VzID0gYXNzaWduKHt9LCBJbm92eC5TaGFyZWQuRmx1eC5CYXNlU2VydmljZSwge1xyXG4gICAgZ2V0QWxsOiBmdW5jdGlvbiAoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBpZ25vcmVEZWZhdWx0RXJyb3IpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuZ2V0KHVybCwgbnVsbCwgZnVuY3Rpb24gKHJldERhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHJldERhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBpZiAoIWlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGNyZWF0ZVVzZXI6IGZ1bmN0aW9uICh1c2VyLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIGlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvQ3JlYXRlXCIpLCB1c2VyLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgaWYgKCFpZ25vcmVEZWZhdWx0RXJyb3IoZXJyb3IpKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZGVsZXRlVXNlcjogZnVuY3Rpb24gKHVzZXIsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvRGVsZXRlXCIpLCB7IGlkOiB1c2VyLlVzZXJJRCwgdmVyc2lvblRva2VuOiB1c2VyLlVzZXJWZXJzaW9uVG9rZW4gfSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKCk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZWRpdFVzZXI6IGZ1bmN0aW9uICh1c2VyLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIGlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvVXBkYXRlXCIpLCB1c2VyLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgaWYgKCFpZ25vcmVEZWZhdWx0RXJyb3IoZXJyb3IpKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZ2V0RGV0YWlsOiBmdW5jdGlvbiAodXNlcklkLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucG9zdChcIlwiLmNvbmNhdCh1cmwsIFwiL0dldERldGFpbHNcIiksIHsgVXNlcklkOiB1c2VySWQgfSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGRhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGdldEN1cnJlbnRVc2VyRGV0YWlsOiBmdW5jdGlvbiAoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBpZ25vcmVEZWZhdWx0RXJyb3IpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuZ2V0KFwiXCIuY29uY2F0KHVybCwgXCIvR2V0Q3VycmVudFVzZXJEZXRhaWxzXCIpLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGlmICghaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgY2hhbmdlUGFzc3dvcmQ6IGZ1bmN0aW9uICh1c2VyLCBwYXNzd29yZCwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBpZ25vcmVEZWZhdWx0RXJyb3IpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucG9zdChcIlwiLmNvbmNhdCh1cmwsIFwiL0NoYW5nZVBhc3N3b3JkXCIpLCB7IFVzZXJJZDogdXNlci5Vc2VySUQsIFVzZXJWZXJzaW9uVG9rZW46IHVzZXIuVXNlclZlcnNpb25Ub2tlbiwgUGFzc3dvcmQ6IHBhc3N3b3JkIH0sIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhkYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgaWYgKCFpZ25vcmVEZWZhdWx0RXJyb3IoZXJyb3IpKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgcmVzZXRQYXNzd29yZHM6IGZ1bmN0aW9uIChzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIGlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvSW52YWxpZGF0ZVBhc3N3b3Jkc1wiKSwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKCk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGlmICghaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgY2hlY2tOYW1lOiBmdW5jdGlvbiAoaGludCwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmdldChcIlwiLmNvbmNhdCh1cmwsIFwiL1F1ZXJ5RGlyZWN0b3J5XCIpLCB7IG5hbWVIaW50OiBoaW50IH0sIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhkYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICByZXNldExvZ2luQXR0ZW1wdHM6IGZ1bmN0aW9uICh1c2VyLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucG9zdChcIlwiLmNvbmNhdCh1cmwsIFwiL1Jlc2V0TG9naW5BdHRlbXB0c1wiKSwgeyBpZDogdXNlci5Vc2VySUQgfSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKCk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZ2V0RW50aXRsZW1lbnRzOiBmdW5jdGlvbiAoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBpZ25vcmVEZWZhdWx0RXJyb3IpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuZ2V0KFwiXCIuY29uY2F0KHVybCwgXCIvRW50aXRsZW1lbnRHcm91cHNcIiksIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhkYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgaWYgKCFpZ25vcmVEZWZhdWx0RXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBnZXRSb2xlczogZnVuY3Rpb24gKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmdldChcIlwiLmNvbmNhdCh1cmwsIFwiL1JvbGVzXCIpLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGlmICghaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5tb2R1bGUuZXhwb3J0cyA9IFVzZXJTZXJ2aWNlcztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VXNlclNlcnZpY2VzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG4vLyBBIOKAmC50c3jigJkgZmlsZSBlbmFibGVzIEpTWCBzdXBwb3J0IGluIHRoZSBUeXBlU2NyaXB0IGNvbXBpbGVyLCBcclxuLy8gZm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIHRoZSBmb2xsb3dpbmcgcGFnZSBvbiB0aGUgVHlwZVNjcmlwdCB3aWtpOlxyXG4vLyBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQvd2lraS9KU1hcclxudmFyIE5vZGVFdmVudHMgPSByZXF1aXJlKFwiZXZlbnRzXCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBVc2VyQ29uc3RhbnRzID0gcmVxdWlyZShcIi4vLi4vY29uc3RhbnRzL1VzZXJDb25zdGFudHNcIik7XHJcbnZhciBhc3NpZ24gPSByZXF1aXJlKFwib2JqZWN0LWFzc2lnblwiKTtcclxudmFyIEF1dGhlbnRpY2F0aW9uTW9kZUVudW0gPSByZXF1aXJlKFwiLi8uLi9jb25zdGFudHMvQXV0aGVudGljYXRpb25Nb2RlRW51bVwiKTtcclxudmFyIEV2ZW50RW1pdHRlciA9IE5vZGVFdmVudHMuRXZlbnRFbWl0dGVyO1xyXG52YXIgQ29tbW9uTWVzc2FnZXMgPSBJbm92eC5TaGFyZWQuQ29tbW9uLkNvbW1vbk1lc3NhZ2VzO1xyXG52YXIgQ0hBTkdFX0VWRU5UID0gJ3VzZXIuY2hhbmdlJztcclxudmFyIF91c2VycyA9IFtdLCBfaGludHMgPSBbXSwgX2VkaXRVc2VyID0gZ2V0QmxhbmtVc2VyKCksIF9jdXJyZW50VXNlciA9IG51bGwsIF9zZXR0aW5ncyA9IGdldEJsYW5rVXNlckFwcFNldHRpbmcoKSwgX2VkaXRTZXR0aW5ncyA9IGdldEJsYW5rVXNlckFwcFNldHRpbmcoKSwgX2JlZ2luQWRkID0gZmFsc2UsIF9iZWdpbkVkaXQgPSBmYWxzZSwgX2NoYW5nZXNNYWRlID0gZmFsc2UsIF9tb2RhbFZpc2libGUgPSBmYWxzZSwgX3NldHRpbmdzU2hvd24gPSBmYWxzZSwgX3ZhbGlkYXRpb24gPSB7fSwgX2VudGl0bGVtZW50cyA9IFtdLCBfcm9sZXMgPSBbXTtcclxuZnVuY3Rpb24gbG9hZFVzZXJEYXRhKGRhdGEpIHtcclxuICAgIF91c2VycyA9IGRhdGE7XHJcbn1cclxuZnVuY3Rpb24gbG9hZEhpbnRzKGRhdGEpIHtcclxuICAgIF9oaW50cyA9IGRhdGE7XHJcbn1cclxuZnVuY3Rpb24gbG9hZEN1cnJlbnRVc2VyKGRhdGEpIHtcclxuICAgIF9jdXJyZW50VXNlciA9IGRhdGE7XHJcbn1cclxuZnVuY3Rpb24gc2hvd1VzZXJTZXR0aW5ncyhzaG93KSB7XHJcbiAgICBfc2V0dGluZ3NTaG93biA9IF9tb2RhbFZpc2libGUgPSBzaG93O1xyXG4gICAgX2NoYW5nZXNNYWRlID0gZmFsc2U7XHJcbiAgICBfaW5pdGFsaXplVmFsaWRhdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfU0VUVElOR1NfRk9STSk7XHJcbn1cclxuZnVuY3Rpb24gc2V0QWRkaW5nVXNlcigpIHtcclxuICAgIF9iZWdpbkFkZCA9IF9tb2RhbFZpc2libGUgPSB0cnVlO1xyXG4gICAgX2JlZ2luRWRpdCA9IGZhbHNlO1xyXG4gICAgX2NoYW5nZXNNYWRlID0gZmFsc2U7XHJcbiAgICBfZWRpdFVzZXIgPSBnZXRCbGFua1VzZXIoKTtcclxuICAgIF9pbml0YWxpemVWYWxpZGF0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STSk7XHJcbn1cclxuZnVuY3Rpb24gc2V0RWRpdGluZ1VzZXIodXNlcikge1xyXG4gICAgX21vZGFsVmlzaWJsZSA9IF9iZWdpbkVkaXQgPSB0cnVlO1xyXG4gICAgX2JlZ2luQWRkID0gZmFsc2U7XHJcbiAgICBfY2hhbmdlc01hZGUgPSBmYWxzZTtcclxuICAgIF9lZGl0VXNlciA9IHVzZXI7XHJcbiAgICBfaW5pdGFsaXplVmFsaWRhdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk0pO1xyXG59XHJcbmZ1bmN0aW9uIF91cGRhdGVPYmplY3RMaXN0UHJvcChjb21wLCBrZXksIHZhbHVlLCBhZGQpIHtcclxuICAgIHN3aXRjaCAoY29tcCkge1xyXG4gICAgICAgIGNhc2UgVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNOlxyXG4gICAgICAgICAgICBfdXBkYXRlVXNlckxpc3RDaGFuZ2VzKGtleSwgdmFsdWUsIGFkZCk7XHJcbiAgICAgICAgICAgIF9jaGFuZ2VzTWFkZSA9IHRydWU7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIF91cGRhdGVVc2VyTGlzdENoYW5nZXMobmFtZSwgdmFsdWUsIGFkZCkge1xyXG4gICAgc3dpdGNoIChuYW1lKSB7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoX2VkaXRVc2VyW25hbWVdKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFkZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9lZGl0VXNlcltuYW1lXS5wdXNoKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmR4ID0gX2VkaXRVc2VyW25hbWVdLmluZGV4T2YodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmR4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2VkaXRVc2VyW25hbWVdLnNwbGljZShpbmR4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3NldFZhbGlkVmFsaWRhdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk0sIG5hbWUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBfdXBkYXRlT2JqZWN0KGNvbXAsIGtleSwgdmFsdWUsIGZyb21VSSkge1xyXG4gICAgaWYgKGZyb21VSSA9PT0gdm9pZCAwKSB7IGZyb21VSSA9IHRydWU7IH1cclxuICAgIHN3aXRjaCAoY29tcCkge1xyXG4gICAgICAgIGNhc2UgVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNOlxyXG4gICAgICAgICAgICBfdXBkYXRlVXNlckNoYW5nZXMoa2V5LCB2YWx1ZSwgZnJvbVVJKTtcclxuICAgICAgICAgICAgX2NoYW5nZXNNYWRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBVc2VyQ29uc3RhbnRzLlVTRVJfU0VUVElOR1NfRk9STTpcclxuICAgICAgICAgICAgX3VwZGF0ZVNldHRpbmdDaGFuZ2VzKGtleSwgdmFsdWUpO1xyXG4gICAgICAgICAgICBfY2hhbmdlc01hZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBfdXBkYXRlVXNlckNoYW5nZXMobmFtZSwgdmFsdWUsIGZyb21VSSkge1xyXG4gICAgdmFyIGlzTmF0aXZlTG9naW5Nb2RlID0gdHJ1ZTtcclxuICAgIHZhciBpc0F6dXJlQURMb2dpbk1vZGUgPSB0cnVlO1xyXG4gICAgaWYgKF9zZXR0aW5ncykge1xyXG4gICAgICAgIGlmIChfc2V0dGluZ3MuQXV0aGVudGljYXRpb25Nb2RlID09IEF1dGhlbnRpY2F0aW9uTW9kZUVudW0uTWl4ZWQpIHtcclxuICAgICAgICAgICAgaXNOYXRpdmVMb2dpbk1vZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBpc0F6dXJlQURMb2dpbk1vZGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChfc2V0dGluZ3MuQXV0aGVudGljYXRpb25Nb2RlID09IEF1dGhlbnRpY2F0aW9uTW9kZUVudW0uRXh0ZXJuYWxPbmx5KSB7XHJcbiAgICAgICAgICAgIGlzTmF0aXZlTG9naW5Nb2RlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlzQXp1cmVBRExvZ2luTW9kZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKF9zZXR0aW5ncy5BdXRoZW50aWNhdGlvbk1vZGUgPT0gQXV0aGVudGljYXRpb25Nb2RlRW51bS5Mb2NhbE9ubHkpIHtcclxuICAgICAgICAgICAgaXNOYXRpdmVMb2dpbk1vZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBpc0F6dXJlQURMb2dpbk1vZGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzd2l0Y2ggKG5hbWUpIHtcclxuICAgICAgICBjYXNlIFwiRW1haWxcIjpcclxuICAgICAgICAgICAgdmFyIEVtYWlsID0gXCJFbWFpbFwiO1xyXG4gICAgICAgICAgICBfZWRpdFVzZXJbRW1haWxdID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlID0gL1xcUytAXFxTK1xcLlxcUysvO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZS50ZXN0KHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW1VzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STV1bRW1haWxdLmludmFsaWRWYWx1ZU1lc3NhZ2UgPSBJbm92eExvYWRlci50KFwidXNlcnM6Zm9ybS5pbnZhbGlkRW1haWxcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25bVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNXVtFbWFpbF0uaW52YWxpZFZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKF91c2Vycy5maWx0ZXIoZnVuY3Rpb24gKHVzZXIpIHsgcmV0dXJuIHVzZXIuRW1haWwgJiYgdXNlci5FbWFpbC50b0xvd2VyQ2FzZSgpID09PSB2YWx1ZS50b0xvd2VyQ2FzZSgpICYmIHVzZXIuVXNlcklEICE9PSBfZWRpdFVzZXIuVXNlcklEOyB9KS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25bVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNXVtFbWFpbF0uaW52YWxpZFZhbHVlTWVzc2FnZSA9IElub3Z4TG9hZGVyLnQoXCJ1c2Vyczpmb3JtLmR1cGxpY2F0ZUVtYWlsXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW1VzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STV1bRW1haWxdLmludmFsaWRWYWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBfc2V0VmFsaWRWYWxpZGF0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STSwgRW1haWwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25bVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNXVtFbWFpbF0uaW52YWxpZFZhbHVlTWVzc2FnZSA9IENvbW1vbk1lc3NhZ2VzLlZhbGlkYXRpb24uUmVxdWlyZWQ7XHJcbiAgICAgICAgICAgICAgICBfdmFsaWRhdGlvbltVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk1dW0VtYWlsXS5pbnZhbGlkVmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgXCJQYXNzd29yZFwiOlxyXG4gICAgICAgIGNhc2UgXCJWUGFzc1wiOlxyXG4gICAgICAgICAgICB2YXIgVlBhc3MgPSBcIlBhc3N3b3JkXCI7XHJcbiAgICAgICAgICAgIF9lZGl0VXNlcltWUGFzc10gPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYgKGlzTmF0aXZlTG9naW5Nb2RlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2JlZ2luRWRpdCB8fCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNLCBWUGFzcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBfdmFsaWRhdGlvbltVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk1dW1ZQYXNzXS5pbnZhbGlkVmFsdWVNZXNzYWdlID0gQ29tbW9uTWVzc2FnZXMuVmFsaWRhdGlvbi5SZXF1aXJlZDtcclxuICAgICAgICAgICAgICAgICAgICBfdmFsaWRhdGlvbltVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk1dW1ZQYXNzXS5pbnZhbGlkVmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX3NldFZhbGlkVmFsaWRhdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk0sIFZQYXNzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAvL2Nhc2UgXCJFeHRlcm5hbEFjY291bnRJRFwiOlxyXG4gICAgICAgIC8vICAgIF9lZGl0VXNlcltuYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgIC8vICAgIGlmIChpc0F6dXJlQURMb2dpbk1vZGUgJiYgIWlzTmF0aXZlTG9naW5Nb2RlKSB7XHJcbiAgICAgICAgLy8gICAgICAgIGlmICh2YWx1ZSlcclxuICAgICAgICAvLyAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNLCBuYW1lKVxyXG4gICAgICAgIC8vICAgICAgICBlbHNlIHtcclxuICAgICAgICAvLyAgICAgICAgICAgIHZhciBwcm9wTmFtZTogc3RyaW5nID0gbmFtZTtcclxuICAgICAgICAvLyAgICAgICAgICAgIGlmICghZnJvbVVJKVxyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgIHByb3BOYW1lID0gXCJFeHRlcm5hbEFjY291bnRVc2VyTmFtZVwiO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgX3ZhbGlkYXRpb25bVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNXVtwcm9wTmFtZV0uaW52YWxpZFZhbHVlTWVzc2FnZSA9IElub3Z4TG9hZGVyLnQoXCJ1c2VyczptZXNzYWdlLmNoZWNrQWRmc1VzZXJcIik7XHJcbiAgICAgICAgLy8gICAgICAgICAgICBfdmFsaWRhdGlvbltVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk1dW3Byb3BOYW1lXS5pbnZhbGlkVmFsdWUgPSB0cnVlO1xyXG4gICAgICAgIC8vICAgICAgICB9XHJcbiAgICAgICAgLy8gICAgfVxyXG4gICAgICAgIC8vICAgIGVsc2Uge1xyXG4gICAgICAgIC8vICAgICAgICBfc2V0VmFsaWRWYWxpZGF0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STSwgbmFtZSk7XHJcbiAgICAgICAgLy8gICAgfVxyXG4gICAgICAgIC8vICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgXCJFeHRlcm5hbEFjY291bnRVc2VyTmFtZVwiOlxyXG4gICAgICAgICAgICBfZWRpdFVzZXJbbmFtZV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYgKGlzQXp1cmVBRExvZ2luTW9kZSAmJiAhaXNOYXRpdmVMb2dpbk1vZGUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IHZhbHVlLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW1VzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STV1bbmFtZV0uaW52YWxpZFZhbHVlTWVzc2FnZSA9IENvbW1vbk1lc3NhZ2VzLlZhbGlkYXRpb24uUmVxdWlyZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW1VzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STV1bbmFtZV0uaW52YWxpZFZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNLCBuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBfdmFsaWRhdGlvbltVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk1dW25hbWVdLmludmFsaWRWYWx1ZU1lc3NhZ2UgPSBDb21tb25NZXNzYWdlcy5WYWxpZGF0aW9uLlJlcXVpcmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW1VzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STV1bbmFtZV0uaW52YWxpZFZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNLCBuYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBpZiAobmFtZSAhPSAnVXNlcklEJyAmJiBuYW1lICE9ICdVc2VyVmVyc2lvblRva2VuJykge1xyXG4gICAgICAgICAgICAgICAgX2VkaXRVc2VyW25hbWVdID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3NldFZhbGlkVmFsaWRhdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk0sIG5hbWUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBfdXBkYXRlU2V0dGluZ0NoYW5nZXMobmFtZSwgdmFsdWUpIHtcclxuICAgIF9lZGl0U2V0dGluZ3NbbmFtZV0gPSB2YWx1ZTtcclxuICAgIHN3aXRjaCAobmFtZSkge1xyXG4gICAgICAgIGNhc2UgXCJQYXNzd29yZEV4cGlyYXRpb25cIjpcclxuICAgICAgICAgICAgaWYgKF9lZGl0U2V0dGluZ3NbXCJQYXNzd29yZEV4cGlyZXNcIl0gJiYgIV9pc1ZhbGlkSW50ZWdlckJldHdlZW5SYW5nZSh2YWx1ZSwgMTQsIDczMCkpIHtcclxuICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW1VzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNXVtuYW1lXS5pbnZhbGlkVmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25bVXNlckNvbnN0YW50cy5VU0VSX1NFVFRJTkdTX0ZPUk1dW25hbWVdLmludmFsaWRWYWx1ZU1lc3NhZ2UgPSBJbm92eExvYWRlci50KFwidXNlcnM6c2V0dGluZ3NGb3JtLm51bWJlclZhbHVlXCIsIHsgbWluOiAxNCwgbWF4OiA3MzAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBfc2V0VmFsaWRWYWxpZGF0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNLCBuYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwiUGFzc3dvcmRFeHBpcmVzXCI6XHJcbiAgICAgICAgICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIF9lZGl0U2V0dGluZ3NbbmFtZV0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oVXNlckNvbnN0YW50cy5VU0VSX1NFVFRJTkdTX0ZPUk0sIFwiUGFzc3dvcmRFeHBpcmF0aW9uXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgXCJBbGxvd2VkQXR0ZW1wdHNcIjpcclxuICAgICAgICAgICAgaWYgKCFfaXNWYWxpZEludGVnZXJCZXR3ZWVuUmFuZ2UodmFsdWUsIDEsIDUpKSB7XHJcbiAgICAgICAgICAgICAgICBfdmFsaWRhdGlvbltVc2VyQ29uc3RhbnRzLlVTRVJfU0VUVElOR1NfRk9STV1bbmFtZV0uaW52YWxpZFZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW1VzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNXVtuYW1lXS5pbnZhbGlkVmFsdWVNZXNzYWdlID0gSW5vdnhMb2FkZXIudChcInVzZXJzOnNldHRpbmdzRm9ybS5udW1iZXJWYWx1ZVwiLCB7IG1pbjogMSwgbWF4OiA1IH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX3NldFZhbGlkVmFsaWRhdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfU0VUVElOR1NfRk9STSwgbmFtZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBcIlBhc3N3b3JkQ2hhcmFjdGVyc1wiOlxyXG4gICAgICAgICAgICBpZiAoIV9pc1ZhbGlkSW50ZWdlckJldHdlZW5SYW5nZSh2YWx1ZSwgMSwgMzIpKSB7XHJcbiAgICAgICAgICAgICAgICBfdmFsaWRhdGlvbltVc2VyQ29uc3RhbnRzLlVTRVJfU0VUVElOR1NfRk9STV1bbmFtZV0uaW52YWxpZFZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW1VzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNXVtuYW1lXS5pbnZhbGlkVmFsdWVNZXNzYWdlID0gSW5vdnhMb2FkZXIudChcInVzZXJzOnNldHRpbmdzRm9ybS5udW1iZXJWYWx1ZVwiLCB7IG1pbjogMSwgbWF4OiAzMiB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oVXNlckNvbnN0YW50cy5VU0VSX1NFVFRJTkdTX0ZPUk0sIG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgX3VwZGF0ZVNldHRpbmdDaGFuZ2VzKFwiUGFzc3dvcmROdW1iZXJzXCIsIF9lZGl0U2V0dGluZ3NbXCJQYXNzd29yZE51bWJlcnNcIl0pO1xyXG4gICAgICAgICAgICAgICAgX3VwZGF0ZVNldHRpbmdDaGFuZ2VzKFwiUGFzc3dvcmRTeW1ib2xzXCIsIF9lZGl0U2V0dGluZ3NbXCJQYXNzd29yZFN5bWJvbHNcIl0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgXCJQYXNzd29yZFN5bWJvbHNcIjpcclxuICAgICAgICAgICAgdmFyIG51bWJlck9mQ2hhcmFjdGVycyA9IF9lZGl0U2V0dGluZ3NbXCJQYXNzd29yZENoYXJhY3RlcnNcIl07XHJcbiAgICAgICAgICAgIHZhciBudW1iZXJPZkRpZ2l0cyA9IF9lZGl0U2V0dGluZ3NbXCJQYXNzd29yZE51bWJlcnNcIl07XHJcbiAgICAgICAgICAgIGlmICghX2lzVmFsaWRJbnRlZ2VyQmV0d2VlblJhbmdlKHZhbHVlLCAwLCBudW1iZXJPZkNoYXJhY3RlcnMgLSBudW1iZXJPZkRpZ2l0cykpIHtcclxuICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW1VzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNXVtuYW1lXS5pbnZhbGlkVmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25bVXNlckNvbnN0YW50cy5VU0VSX1NFVFRJTkdTX0ZPUk1dW25hbWVdLmludmFsaWRWYWx1ZU1lc3NhZ2UgPSBJbm92eExvYWRlci50KFwidXNlcnM6c2V0dGluZ3NGb3JtLmludmFsaWREaWdpdHNPclN5bWJvbHNcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBfc2V0VmFsaWRWYWxpZGF0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNLCBuYW1lKTtcclxuICAgICAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oVXNlckNvbnN0YW50cy5VU0VSX1NFVFRJTkdTX0ZPUk0sIFwiUGFzc3dvcmROdW1iZXJzXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgXCJQYXNzd29yZE51bWJlcnNcIjpcclxuICAgICAgICAgICAgdmFyIG51bWJlck9mQ2hhcmFjdGVycyA9IF9lZGl0U2V0dGluZ3NbXCJQYXNzd29yZENoYXJhY3RlcnNcIl07XHJcbiAgICAgICAgICAgIHZhciBudW1iZXJPZlN5bWJvbHMgPSBfZWRpdFNldHRpbmdzW1wiUGFzc3dvcmRTeW1ib2xzXCJdO1xyXG4gICAgICAgICAgICBpZiAoIV9pc1ZhbGlkSW50ZWdlckJldHdlZW5SYW5nZSh2YWx1ZSwgMCwgbnVtYmVyT2ZDaGFyYWN0ZXJzIC0gbnVtYmVyT2ZTeW1ib2xzKSkge1xyXG4gICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25bVXNlckNvbnN0YW50cy5VU0VSX1NFVFRJTkdTX0ZPUk1dW25hbWVdLmludmFsaWRWYWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBfdmFsaWRhdGlvbltVc2VyQ29uc3RhbnRzLlVTRVJfU0VUVElOR1NfRk9STV1bbmFtZV0uaW52YWxpZFZhbHVlTWVzc2FnZSA9IElub3Z4TG9hZGVyLnQoXCJ1c2VyczpzZXR0aW5nc0Zvcm0uaW52YWxpZERpZ2l0c09yU3ltYm9sc1wiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oVXNlckNvbnN0YW50cy5VU0VSX1NFVFRJTkdTX0ZPUk0sIG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgX3NldFZhbGlkVmFsaWRhdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfU0VUVElOR1NfRk9STSwgXCJQYXNzd29yZFN5bWJvbHNcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgX3NldFZhbGlkVmFsaWRhdGlvbihVc2VyQ29uc3RhbnRzLlVTRVJfU0VUVElOR1NfRk9STSwgbmFtZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG59XHJcbi8vIENoZWNrIGZvciB2YWxpZCBwb3NpdGl2ZSBpbnRlZ2VyLlxyXG5mdW5jdGlvbiBfaXNWYWxpZEludGVnZXJCZXR3ZWVuUmFuZ2UodmFsdWUsIG1pbiwgbWF4KSB7XHJcbiAgICB2YXIgcGFyc2VkVmFsdWUgPSBOdW1iZXIodmFsdWUpO1xyXG4gICAgaWYgKCFpc05hTihwYXJzZWRWYWx1ZSkgJiYgcGFyc2VkVmFsdWUgJSAxID09PSAwICYmIHBhcnNlZFZhbHVlID49IG1pbiAmJiBwYXJzZWRWYWx1ZSA8PSBtYXgpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxufVxyXG5mdW5jdGlvbiBfc2V0VmFsaWRWYWxpZGF0aW9uKGNvbXAsIG5hbWUpIHtcclxuICAgIGlmIChfdmFsaWRhdGlvbltjb21wXVtuYW1lXSkge1xyXG4gICAgICAgIF92YWxpZGF0aW9uW2NvbXBdW25hbWVdLmludmFsaWRJbnB1dCA9IGZhbHNlO1xyXG4gICAgICAgIF92YWxpZGF0aW9uW2NvbXBdW25hbWVdLmludmFsaWRWYWx1ZSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgX3ZhbGlkYXRpb25bY29tcF1bbmFtZV0gPSBfZ2V0TmV3VmFsaWRhdGlvbk9iamVjdCgpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIF9nZXROZXdWYWxpZGF0aW9uT2JqZWN0KCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpbnZhbGlkSW5wdXQ6IGZhbHNlLFxyXG4gICAgICAgIGludmFsaWRWYWx1ZTogZmFsc2VcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gX3ZhbGlkYXRlKGNvbXApIHtcclxuICAgIHN3aXRjaCAoY29tcCkge1xyXG4gICAgICAgIGNhc2UgVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNOlxyXG4gICAgICAgICAgICBfZW5zdXJlVmFsaWRPYmplY3QoY29tcCwgX2VkaXRVc2VyKTtcclxuICAgICAgICAgICAgcmV0dXJuIF92YWxpZGF0ZU9iamVjdChVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk0pO1xyXG4gICAgICAgIGNhc2UgVXNlckNvbnN0YW50cy5VU0VSX1NFVFRJTkdTX0ZPUk06XHJcbiAgICAgICAgICAgIF9lbnN1cmVWYWxpZE9iamVjdChjb21wLCBfZWRpdFNldHRpbmdzKTtcclxuICAgICAgICAgICAgcmV0dXJuIF92YWxpZGF0ZU9iamVjdChVc2VyQ29uc3RhbnRzLlVTRVJfU0VUVElOR1NfRk9STSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cclxuZnVuY3Rpb24gX2Vuc3VyZVZhbGlkT2JqZWN0KGNvbXAsIG9iaikge1xyXG4gICAgdmFyIHVwZGF0ZUNoYW5nZXNGdW5jdCA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSwgZnJvbVVJKSB7IH07XHJcbiAgICB2YXIgdXBkYXRlTGlzdENoYW5nZXNGdW5jdCA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgeyB9O1xyXG4gICAgc3dpdGNoIChjb21wKSB7XHJcbiAgICAgICAgY2FzZSBVc2VyQ29uc3RhbnRzLlVTRVJfQUREX0ZPUk06XHJcbiAgICAgICAgICAgIHVwZGF0ZUNoYW5nZXNGdW5jdCA9IF91cGRhdGVVc2VyQ2hhbmdlcztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBVc2VyQ29uc3RhbnRzLlVTRVJfU0VUVElOR1NfRk9STTpcclxuICAgICAgICAgICAgdXBkYXRlQ2hhbmdlc0Z1bmN0ID0gX3VwZGF0ZVNldHRpbmdDaGFuZ2VzO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIGZvciAodmFyIGsgaW4gb2JqKSB7XHJcbiAgICAgICAgdmFyIG9ialR5cGUgPSB0eXBlb2YgKG9ialtrXSk7XHJcbiAgICAgICAgaWYgKG9ialR5cGUgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgaWYgKG9ialtrXSA9PT0gbnVsbCB8fCBvYmpUeXBlICE9PSAnb2JqZWN0JyB8fCBBcnJheS5pc0FycmF5KG9ialtrXSkpIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZUNoYW5nZXNGdW5jdChrLCBvYmpba10sIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9lbnN1cmVWYWxpZE9iamVjdChjb21wLCBvYmpba10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIF92YWxpZGF0ZU9iamVjdChjb21wKSB7XHJcbiAgICB2YXIgcmV0ID0gdHJ1ZTtcclxuICAgIGZvciAodmFyIGsgaW4gX3ZhbGlkYXRpb25bY29tcF0pIHtcclxuICAgICAgICBpZiAoX3ZhbGlkYXRpb25bY29tcF1ba10uaW52YWxpZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmV0O1xyXG59XHJcbmZ1bmN0aW9uIF9pbml0YWxpemVWYWxpZGF0aW9uKGNvbXApIHtcclxuICAgIHN3aXRjaCAoY29tcCkge1xyXG4gICAgICAgIGNhc2UgVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNOlxyXG4gICAgICAgICAgICB2YXIgdmFsaU9iaiA9IF92YWxpZGF0aW9uW1VzZXJDb25zdGFudHMuVVNFUl9BRERfRk9STV0gPSB7fTtcclxuICAgICAgICAgICAgZm9yICh2YXIgayBpbiBfZWRpdFVzZXIpIHtcclxuICAgICAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oVXNlckNvbnN0YW50cy5VU0VSX0FERF9GT1JNLCBrKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFVzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNOlxyXG4gICAgICAgICAgICB2YWxpT2JqID0gX3ZhbGlkYXRpb25bVXNlckNvbnN0YW50cy5VU0VSX1NFVFRJTkdTX0ZPUk1dID0ge307XHJcbiAgICAgICAgICAgIGZvciAodmFyIGsgaW4gX3NldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICBfc2V0VmFsaWRWYWxpZGF0aW9uKFVzZXJDb25zdGFudHMuVVNFUl9TRVRUSU5HU19GT1JNLCBrKTtcclxuICAgICAgICAgICAgICAgIHZhbGlPYmpba10uaW52YWxpZFZhbHVlTWVzc2FnZSA9IENvbW1vbk1lc3NhZ2VzLlZhbGlkYXRpb24uUG9zaXRpdmVJbnRlZ2VyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHZhbGlkYXRpb25FcnJvcihjb21wLCBtZXNzYWdlT2JqKSB7XHJcbiAgICBfdmFsaWRhdGlvbltjb21wXVttZXNzYWdlT2JqLnByb3BlcnR5TmFtZV0uaW52YWxpZFZhbHVlTWVzc2FnZSA9IG1lc3NhZ2VPYmoubWVzc2FnZTtcclxuICAgIF92YWxpZGF0aW9uW2NvbXBdW21lc3NhZ2VPYmoucHJvcGVydHlOYW1lXS5pbnZhbGlkVmFsdWUgPSB0cnVlO1xyXG59XHJcbmZ1bmN0aW9uIGZpbmlzaGVkRWRpdGluZygpIHtcclxuICAgIF9tb2RhbFZpc2libGUgPSBmYWxzZTtcclxuICAgIF9jaGFuZ2VzTWFkZSA9IGZhbHNlO1xyXG59XHJcbmZ1bmN0aW9uIHNlbGVjdEhpbnQodXNlcikge1xyXG4gICAgX3VwZGF0ZVByb2ZpbGUodXNlcik7XHJcbiAgICBfdXBkYXRlVXNlckNoYW5nZXMoXCJFeHRlcm5hbEFjY291bnRVc2VyTmFtZVwiLCB1c2VyLlVzZXJOYW1lLCB0cnVlKTtcclxuICAgIF91cGRhdGVVc2VyQ2hhbmdlcyhcIkVtYWlsXCIsIHVzZXIuRW1haWwsIHRydWUpO1xyXG59XHJcbmZ1bmN0aW9uIF91cGRhdGVQcm9maWxlKHVzZXIpIHtcclxuICAgIF9lZGl0VXNlcltcIkZpcnN0TmFtZVwiXSA9IHVzZXIuRmlyc3ROYW1lO1xyXG4gICAgX2VkaXRVc2VyW1wiTGFzdE5hbWVcIl0gPSB1c2VyLkxhc3ROYW1lO1xyXG4gICAgX2VkaXRVc2VyW1wiVXNlck5hbWVcIl0gPSB1c2VyLlVzZXJOYW1lO1xyXG4gICAgLy9fZWRpdFVzZXJbXCJBRFVzZXJOYW1lXCJdID0gdXNlci5FbWFpbDtcclxuICAgIF9lZGl0VXNlcltcIkV4dGVybmFsQWNjb3VudFVzZXJOYW1lXCJdID0gdXNlci5Vc2VyTmFtZTtcclxuICAgIF9lZGl0VXNlcltcIkV4dGVybmFsQWNjb3VudElEXCJdID0gdXNlci5Vc2VySUQ7XHJcbn1cclxuZnVuY3Rpb24gZ2V0QmxhbmtVc2VyKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBVc2VySUQ6IFwiXCIsIFVzZXJWZXJzaW9uVG9rZW46IG51bGwsIEVuYWJsZWQ6IHRydWUsIEZpcnN0TmFtZTogXCJcIiwgTGFzdE5hbWU6IFwiXCIsIFVzZXJOYW1lOiBcIlwiLFxyXG4gICAgICAgIFBhc3N3b3JkOiBcIlwiLCBFbWFpbDogXCJcIiwgRXh0ZXJuYWxBY2NvdW50VXNlck5hbWU6IFwiXCIsIEV4dGVybmFsQWNjb3VudElEOiBcIlwiLCBQYXNzd29yZEV4cGlyZWQ6IGZhbHNlLCBNYXhMb2dpbkF0dGVtcHRzOiBmYWxzZSxcclxuICAgICAgICBFbnRpdGxlbWVudEdyb3VwSURzOiBbXSwgUm9sZUlEczogW11cclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gZ2V0QmxhbmtVc2VyQXBwU2V0dGluZygpIHtcclxuICAgIHJldHVybiB7IFBhc3N3b3JkRXhwaXJhdGlvbjogMCwgQWxsb3dlZEF0dGVtcHRzOiAwLCBQYXNzd29yZENoYXJhY3RlcnM6IDAsIFBhc3N3b3JkU3ltYm9sczogMCwgUGFzc3dvcmROdW1iZXJzOiAwLCBSZW1lbWJlck1lOiBmYWxzZSwgQXV0aGVudGljYXRpb25Nb2RlOiBcIlwiLCBFeHRlcm5hbFByb3ZpZGVyTmFtZTogXCJcIiB9O1xyXG59XHJcbmZ1bmN0aW9uIHNvcnRJTmFtZWRJdGVtKGEsIGIpIHtcclxuICAgIGlmICghYSlcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICBpZiAoIWIpXHJcbiAgICAgICAgcmV0dXJuIDE7XHJcbiAgICByZXR1cm4gKGEuTmFtZSA+IGIuTmFtZSkgPyAxIDogKGIuTmFtZSA+IGEuTmFtZSkgPyAtMSA6IDA7XHJcbn1cclxudmFyIFVzZXJTdG9yZSA9IGFzc2lnbih7fSwgRXZlbnRFbWl0dGVyLnByb3RvdHlwZSwge1xyXG4gICAgZ2V0QWxsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF91c2VycztcclxuICAgIH0sXHJcbiAgICBnZXRFZGl0VXNlcjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfZWRpdFVzZXI7XHJcbiAgICB9LFxyXG4gICAgZ2V0Q3VycmVudFVzZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2N1cnJlbnRVc2VyO1xyXG4gICAgfSxcclxuICAgIGdldEhhc0NoYW5nZXM6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2NoYW5nZXNNYWRlO1xyXG4gICAgfSxcclxuICAgIGdldElzQWRkaW5nOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9iZWdpbkFkZDtcclxuICAgIH0sXHJcbiAgICBnZXRJc0VkaXRpbmc6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2JlZ2luRWRpdDtcclxuICAgIH0sXHJcbiAgICBnZXRNb2RhbFZpc2libGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX21vZGFsVmlzaWJsZTtcclxuICAgIH0sXHJcbiAgICBnZXRTZXR0aW5nc1Nob3duOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zZXR0aW5nc1Nob3duO1xyXG4gICAgfSxcclxuICAgIGdldFNldHRpbmdzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zZXR0aW5ncztcclxuICAgIH0sXHJcbiAgICBnZXRFZGl0U2V0dGluZ3M6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2VkaXRTZXR0aW5ncztcclxuICAgIH0sXHJcbiAgICBnZXRTYXZlRnJpZW5kbHlFZGl0U2V0dGluZ3M6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZWRpdCA9ICQuZXh0ZW5kKHt9LCBfZWRpdFNldHRpbmdzKTtcclxuICAgICAgICBlZGl0LkFsbG93ZWRBdHRlbXB0cyA9IHBhcnNlSW50KF9lZGl0U2V0dGluZ3MuQWxsb3dlZEF0dGVtcHRzKTtcclxuICAgICAgICBlZGl0LlBhc3N3b3JkQ2hhcmFjdGVycyA9IHBhcnNlSW50KF9lZGl0U2V0dGluZ3MuUGFzc3dvcmRDaGFyYWN0ZXJzKTtcclxuICAgICAgICBlZGl0LlBhc3N3b3JkRXhwaXJhdGlvbiA9IHBhcnNlSW50KF9lZGl0U2V0dGluZ3MuUGFzc3dvcmRFeHBpcmF0aW9uKTtcclxuICAgICAgICBlZGl0LlBhc3N3b3JkTnVtYmVycyA9IHBhcnNlSW50KF9lZGl0U2V0dGluZ3MuUGFzc3dvcmROdW1iZXJzKTtcclxuICAgICAgICBlZGl0LlBhc3N3b3JkU3ltYm9scyA9IHBhcnNlSW50KF9lZGl0U2V0dGluZ3MuUGFzc3dvcmRTeW1ib2xzKTtcclxuICAgICAgICByZXR1cm4gZWRpdDtcclxuICAgIH0sXHJcbiAgICBjaGVja1VzZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2hpbnRzO1xyXG4gICAgfSxcclxuICAgIHVwZGF0ZUV4dGVybmFsQWNjb3VudElEOiBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICBfZWRpdFVzZXIuRXh0ZXJuYWxBY2NvdW50SUQgPSBpZDtcclxuICAgIH0sXHJcbiAgICBnZXRWYWxpZGF0aW9uOiBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgcmV0dXJuIF92YWxpZGF0aW9uW2tleV07XHJcbiAgICB9LFxyXG4gICAgZ2V0SXNWYWxpZE9iamVjdDogZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHJldHVybiBfdmFsaWRhdGUoa2V5KTtcclxuICAgIH0sXHJcbiAgICBnZXRWYWxpZFJvbGVzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9yb2xlcztcclxuICAgIH0sXHJcbiAgICBnZXRWYWxpZEVudGl0bGVtZW50czogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfZW50aXRsZW1lbnRzO1xyXG4gICAgfSxcclxuICAgIGVtaXRDaGFuZ2U6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbWl0KENIQU5HRV9FVkVOVCk7XHJcbiAgICB9LFxyXG4gICAgYWRkQ2hhbmdlTGlzdGVuZXI6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgIHRoaXMub24oQ0hBTkdFX0VWRU5ULCBjYWxsYmFjayk7XHJcbiAgICB9LFxyXG4gICAgcmVtb3ZlQ2hhbmdlTGlzdGVuZXI6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIoQ0hBTkdFX0VWRU5ULCBjYWxsYmFjayk7XHJcbiAgICB9XHJcbn0pO1xyXG5Jbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLnJlZ2lzdGVyKGZ1bmN0aW9uIChwYXlsb2FkKSB7XHJcbiAgICBzd2l0Y2ggKHBheWxvYWQuYWN0aW9uVHlwZSkge1xyXG4gICAgICAgIGNhc2UgVXNlckNvbnN0YW50cy5CRUdJTl9VU0VSX0FERDpcclxuICAgICAgICAgICAgc2V0QWRkaW5nVXNlcigpO1xyXG4gICAgICAgICAgICBfZW50aXRsZW1lbnRzID0gcGF5bG9hZC5lbnRpdGxlbWVudC5zb3J0KHNvcnRJTmFtZWRJdGVtKTtcclxuICAgICAgICAgICAgX3JvbGVzID0gcGF5bG9hZC5yb2xlLnNvcnQoc29ydElOYW1lZEl0ZW0pO1xyXG4gICAgICAgICAgICBfZWRpdFVzZXIuRW50aXRsZW1lbnRHcm91cElEcyA9IF9lbnRpdGxlbWVudHMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5Jc0RlZmF1bHQ7XHJcbiAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoaXRlbSkgeyByZXR1cm4gaXRlbS5JRDsgfSk7XHJcbiAgICAgICAgICAgIF9lZGl0VXNlci5Sb2xlSURzID0gX3JvbGVzLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uSXNEZWZhdWx0O1xyXG4gICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsgcmV0dXJuIGl0ZW0uSUQ7IH0pO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFVzZXJDb25zdGFudHMuQkVHSU5fRURJVF9VU0VSOlxyXG4gICAgICAgICAgICBzZXRFZGl0aW5nVXNlcihwYXlsb2FkLnVzZXIpO1xyXG4gICAgICAgICAgICBfZW50aXRsZW1lbnRzID0gcGF5bG9hZC5lbnRpdGxlbWVudC5zb3J0KHNvcnRJTmFtZWRJdGVtKTtcclxuICAgICAgICAgICAgX3JvbGVzID0gcGF5bG9hZC5yb2xlLnNvcnQoc29ydElOYW1lZEl0ZW0pO1xyXG4gICAgICAgICAgICBfZWRpdFVzZXIuRW50aXRsZW1lbnRHcm91cElEcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbUEgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1CID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGluZHggaW4gX2VudGl0bGVtZW50cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfZW50aXRsZW1lbnRzW2luZHhdLklEID09PSBhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1BID0gX2VudGl0bGVtZW50c1tpbmR4XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoX2VudGl0bGVtZW50c1tpbmR4XS5JRCA9PT0gYikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtQiA9IF9lbnRpdGxlbWVudHNbaW5keF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNvcnRJTmFtZWRJdGVtKGl0ZW1BLCBpdGVtQik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBfZWRpdFVzZXIuUm9sZUlEcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbUEgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1CID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGluZHggaW4gX3JvbGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9yb2xlc1tpbmR4XS5JRCA9PT0gYSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtQSA9IF9yb2xlc1tpbmR4XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoX3JvbGVzW2luZHhdLklEID09PSBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1CID0gX3JvbGVzW2luZHhdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBzb3J0SU5hbWVkSXRlbShpdGVtQSwgaXRlbUIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBVc2VyQ29uc3RhbnRzLkZJTklTSF9FRElUOlxyXG4gICAgICAgICAgICBmaW5pc2hlZEVkaXRpbmcoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBVc2VyQ29uc3RhbnRzLlVTRVJfUkVDSUVWRV9EQVRBOlxyXG4gICAgICAgICAgICBsb2FkVXNlckRhdGEocGF5bG9hZC5kYXRhKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBVc2VyQ29uc3RhbnRzLlVTRVJfUkVDSUVWRV9ISU5UOlxyXG4gICAgICAgICAgICBsb2FkSGludHMocGF5bG9hZC5kYXRhKTtcclxuICAgICAgICAgICAgcGF5bG9hZC5jYWxsYmFjaygpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICBjYXNlIFVzZXJDb25zdGFudHMuVVNFUl9VUERBVEVfT0JKRUNUOlxyXG4gICAgICAgICAgICBfdXBkYXRlT2JqZWN0KHBheWxvYWQuY29tcG9uZW50LCBwYXlsb2FkLmtleSwgcGF5bG9hZC52YWx1ZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgVXNlckNvbnN0YW50cy5VU0VSX1VQREFURV9PQkpFQ1RfQUREX0xJU1Q6XHJcbiAgICAgICAgICAgIF91cGRhdGVPYmplY3RMaXN0UHJvcChwYXlsb2FkLmNvbXBvbmVudCwgcGF5bG9hZC5rZXksIHBheWxvYWQudmFsdWUsIHRydWUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFVzZXJDb25zdGFudHMuVVNFUl9VUERBVEVfT0JKRUNUX1JFTU9WRV9MSVNUOlxyXG4gICAgICAgICAgICBfdXBkYXRlT2JqZWN0TGlzdFByb3AocGF5bG9hZC5jb21wb25lbnQsIHBheWxvYWQua2V5LCBwYXlsb2FkLnZhbHVlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgVXNlckNvbnN0YW50cy5VU0VSX1NFTEVDVF9ISU5UOlxyXG4gICAgICAgICAgICBzZWxlY3RIaW50KHBheWxvYWQudXNlcik7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgVXNlckNvbnN0YW50cy5VU0VSX0ZPUk1fSU5WQUxJRF9TQVZFOlxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFVzZXJDb25zdGFudHMuSElERV9TRVRUSU5HU19NRU5VOlxyXG4gICAgICAgICAgICBzaG93VXNlclNldHRpbmdzKGZhbHNlKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBVc2VyQ29uc3RhbnRzLlNFVFRJTkdTX0dFVDpcclxuICAgICAgICAgICAgX3NldHRpbmdzID0gcGF5bG9hZC5kYXRhO1xyXG4gICAgICAgICAgICBfZWRpdFNldHRpbmdzID0gJC5leHRlbmQoe30sIF9zZXR0aW5ncyk7XHJcbiAgICAgICAgICAgIF9lZGl0U2V0dGluZ3MuUGFzc3dvcmRFeHBpcmVzID0gX3NldHRpbmdzLlBhc3N3b3JkRXhwaXJhdGlvbiA+IDA7XHJcbiAgICAgICAgICAgIHNob3dVc2VyU2V0dGluZ3MocGF5bG9hZC5kaXNwbGF5KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBVc2VyQ29uc3RhbnRzLlVTRVJfUkVDSUVWRV9DVVJSRU5UOlxyXG4gICAgICAgICAgICBsb2FkQ3VycmVudFVzZXIocGF5bG9hZC5kYXRhKTtcclxuICAgICAgICAgICAgcGF5bG9hZC5jYWxsYmFjaygpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICBjYXNlIFVzZXJDb25zdGFudHMuVVNFUl9WQUxJREFUSU9OX0VSUk9SOlxyXG4gICAgICAgICAgICB2YWxpZGF0aW9uRXJyb3IocGF5bG9hZC5jb21wb25lbnQsIHBheWxvYWQubWVzc2FnZU9iaik7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgVXNlckNvbnN0YW50cy5VU0VSX0NIQU5HRV9QQVNTV09SRF9TVUNDRVNTOlxyXG4gICAgICAgICAgICBfZWRpdFVzZXIuUGFzc3dvcmRFeHBpcmVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIF9lZGl0VXNlci5Vc2VyVmVyc2lvblRva2VuID0gcGF5bG9hZC51c2VyLlVzZXJWZXJzaW9uVG9rZW47XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgVXNlckNvbnN0YW50cy5SRVNFVF9MT0dJTl9BVFRFTVBUUzpcclxuICAgICAgICAgICAgX2VkaXRVc2VyLk1heExvZ2luQXR0ZW1wdHMgPSBwYXlsb2FkLnVzZXIuTWF4TG9naW5BdHRlbXB0cztcclxuICAgICAgICAgICAgX2VkaXRVc2VyLlVzZXJWZXJzaW9uVG9rZW4gPSBwYXlsb2FkLnVzZXIuVXNlclZlcnNpb25Ub2tlbjtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDogcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBVc2VyU3RvcmUuZW1pdENoYW5nZSgpO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbn0pO1xyXG5tb2R1bGUuZXhwb3J0cyA9IFVzZXJTdG9yZTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VXNlclN0b3JlLmpzLm1hcCIsIi8vIENvcHlyaWdodCBKb3llbnQsIEluYy4gYW5kIG90aGVyIE5vZGUgY29udHJpYnV0b3JzLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhXG4vLyBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlXG4vLyBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmdcbi8vIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCxcbi8vIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXRcbi8vIHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZVxuLy8gZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWRcbi8vIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1Ncbi8vIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0Zcbi8vIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU5cbi8vIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLFxuLy8gREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SXG4vLyBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFXG4vLyBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG52YXIgb2JqZWN0Q3JlYXRlID0gT2JqZWN0LmNyZWF0ZSB8fCBvYmplY3RDcmVhdGVQb2x5ZmlsbFxudmFyIG9iamVjdEtleXMgPSBPYmplY3Qua2V5cyB8fCBvYmplY3RLZXlzUG9seWZpbGxcbnZhciBiaW5kID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgfHwgZnVuY3Rpb25CaW5kUG9seWZpbGxcblxuZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkge1xuICBpZiAoIXRoaXMuX2V2ZW50cyB8fCAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMsICdfZXZlbnRzJykpIHtcbiAgICB0aGlzLl9ldmVudHMgPSBvYmplY3RDcmVhdGUobnVsbCk7XG4gICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwO1xuICB9XG5cbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gdGhpcy5fbWF4TGlzdGVuZXJzIHx8IHVuZGVmaW5lZDtcbn1cbm1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyO1xuXG4vLyBCYWNrd2FyZHMtY29tcGF0IHdpdGggbm9kZSAwLjEwLnhcbkV2ZW50RW1pdHRlci5FdmVudEVtaXR0ZXIgPSBFdmVudEVtaXR0ZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX2V2ZW50cyA9IHVuZGVmaW5lZDtcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX21heExpc3RlbmVycyA9IHVuZGVmaW5lZDtcblxuLy8gQnkgZGVmYXVsdCBFdmVudEVtaXR0ZXJzIHdpbGwgcHJpbnQgYSB3YXJuaW5nIGlmIG1vcmUgdGhhbiAxMCBsaXN0ZW5lcnMgYXJlXG4vLyBhZGRlZCB0byBpdC4gVGhpcyBpcyBhIHVzZWZ1bCBkZWZhdWx0IHdoaWNoIGhlbHBzIGZpbmRpbmcgbWVtb3J5IGxlYWtzLlxudmFyIGRlZmF1bHRNYXhMaXN0ZW5lcnMgPSAxMDtcblxudmFyIGhhc0RlZmluZVByb3BlcnR5O1xudHJ5IHtcbiAgdmFyIG8gPSB7fTtcbiAgaWYgKE9iamVjdC5kZWZpbmVQcm9wZXJ0eSkgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sICd4JywgeyB2YWx1ZTogMCB9KTtcbiAgaGFzRGVmaW5lUHJvcGVydHkgPSBvLnggPT09IDA7XG59IGNhdGNoIChlcnIpIHsgaGFzRGVmaW5lUHJvcGVydHkgPSBmYWxzZSB9XG5pZiAoaGFzRGVmaW5lUHJvcGVydHkpIHtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEV2ZW50RW1pdHRlciwgJ2RlZmF1bHRNYXhMaXN0ZW5lcnMnLCB7XG4gICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRNYXhMaXN0ZW5lcnM7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uKGFyZykge1xuICAgICAgLy8gY2hlY2sgd2hldGhlciB0aGUgaW5wdXQgaXMgYSBwb3NpdGl2ZSBudW1iZXIgKHdob3NlIHZhbHVlIGlzIHplcm8gb3JcbiAgICAgIC8vIGdyZWF0ZXIgYW5kIG5vdCBhIE5hTikuXG4gICAgICBpZiAodHlwZW9mIGFyZyAhPT0gJ251bWJlcicgfHwgYXJnIDwgMCB8fCBhcmcgIT09IGFyZylcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJkZWZhdWx0TWF4TGlzdGVuZXJzXCIgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlcicpO1xuICAgICAgZGVmYXVsdE1heExpc3RlbmVycyA9IGFyZztcbiAgICB9XG4gIH0pO1xufSBlbHNlIHtcbiAgRXZlbnRFbWl0dGVyLmRlZmF1bHRNYXhMaXN0ZW5lcnMgPSBkZWZhdWx0TWF4TGlzdGVuZXJzO1xufVxuXG4vLyBPYnZpb3VzbHkgbm90IGFsbCBFbWl0dGVycyBzaG91bGQgYmUgbGltaXRlZCB0byAxMC4gVGhpcyBmdW5jdGlvbiBhbGxvd3Ncbi8vIHRoYXQgdG8gYmUgaW5jcmVhc2VkLiBTZXQgdG8gemVybyBmb3IgdW5saW1pdGVkLlxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5zZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbiBzZXRNYXhMaXN0ZW5lcnMobikge1xuICBpZiAodHlwZW9mIG4gIT09ICdudW1iZXInIHx8IG4gPCAwIHx8IGlzTmFOKG4pKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wiblwiIGFyZ3VtZW50IG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtcbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gbjtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5mdW5jdGlvbiAkZ2V0TWF4TGlzdGVuZXJzKHRoYXQpIHtcbiAgaWYgKHRoYXQuX21heExpc3RlbmVycyA9PT0gdW5kZWZpbmVkKVxuICAgIHJldHVybiBFdmVudEVtaXR0ZXIuZGVmYXVsdE1heExpc3RlbmVycztcbiAgcmV0dXJuIHRoYXQuX21heExpc3RlbmVycztcbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5nZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbiBnZXRNYXhMaXN0ZW5lcnMoKSB7XG4gIHJldHVybiAkZ2V0TWF4TGlzdGVuZXJzKHRoaXMpO1xufTtcblxuLy8gVGhlc2Ugc3RhbmRhbG9uZSBlbWl0KiBmdW5jdGlvbnMgYXJlIHVzZWQgdG8gb3B0aW1pemUgY2FsbGluZyBvZiBldmVudFxuLy8gaGFuZGxlcnMgZm9yIGZhc3QgY2FzZXMgYmVjYXVzZSBlbWl0KCkgaXRzZWxmIG9mdGVuIGhhcyBhIHZhcmlhYmxlIG51bWJlciBvZlxuLy8gYXJndW1lbnRzIGFuZCBjYW4gYmUgZGVvcHRpbWl6ZWQgYmVjYXVzZSBvZiB0aGF0LiBUaGVzZSBmdW5jdGlvbnMgYWx3YXlzIGhhdmVcbi8vIHRoZSBzYW1lIG51bWJlciBvZiBhcmd1bWVudHMgYW5kIHRodXMgZG8gbm90IGdldCBkZW9wdGltaXplZCwgc28gdGhlIGNvZGVcbi8vIGluc2lkZSB0aGVtIGNhbiBleGVjdXRlIGZhc3Rlci5cbmZ1bmN0aW9uIGVtaXROb25lKGhhbmRsZXIsIGlzRm4sIHNlbGYpIHtcbiAgaWYgKGlzRm4pXG4gICAgaGFuZGxlci5jYWxsKHNlbGYpO1xuICBlbHNlIHtcbiAgICB2YXIgbGVuID0gaGFuZGxlci5sZW5ndGg7XG4gICAgdmFyIGxpc3RlbmVycyA9IGFycmF5Q2xvbmUoaGFuZGxlciwgbGVuKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKVxuICAgICAgbGlzdGVuZXJzW2ldLmNhbGwoc2VsZik7XG4gIH1cbn1cbmZ1bmN0aW9uIGVtaXRPbmUoaGFuZGxlciwgaXNGbiwgc2VsZiwgYXJnMSkge1xuICBpZiAoaXNGbilcbiAgICBoYW5kbGVyLmNhbGwoc2VsZiwgYXJnMSk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uY2FsbChzZWxmLCBhcmcxKTtcbiAgfVxufVxuZnVuY3Rpb24gZW1pdFR3byhoYW5kbGVyLCBpc0ZuLCBzZWxmLCBhcmcxLCBhcmcyKSB7XG4gIGlmIChpc0ZuKVxuICAgIGhhbmRsZXIuY2FsbChzZWxmLCBhcmcxLCBhcmcyKTtcbiAgZWxzZSB7XG4gICAgdmFyIGxlbiA9IGhhbmRsZXIubGVuZ3RoO1xuICAgIHZhciBsaXN0ZW5lcnMgPSBhcnJheUNsb25lKGhhbmRsZXIsIGxlbik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSlcbiAgICAgIGxpc3RlbmVyc1tpXS5jYWxsKHNlbGYsIGFyZzEsIGFyZzIpO1xuICB9XG59XG5mdW5jdGlvbiBlbWl0VGhyZWUoaGFuZGxlciwgaXNGbiwgc2VsZiwgYXJnMSwgYXJnMiwgYXJnMykge1xuICBpZiAoaXNGbilcbiAgICBoYW5kbGVyLmNhbGwoc2VsZiwgYXJnMSwgYXJnMiwgYXJnMyk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uY2FsbChzZWxmLCBhcmcxLCBhcmcyLCBhcmczKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBlbWl0TWFueShoYW5kbGVyLCBpc0ZuLCBzZWxmLCBhcmdzKSB7XG4gIGlmIChpc0ZuKVxuICAgIGhhbmRsZXIuYXBwbHkoc2VsZiwgYXJncyk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uYXBwbHkoc2VsZiwgYXJncyk7XG4gIH1cbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gZW1pdCh0eXBlKSB7XG4gIHZhciBlciwgaGFuZGxlciwgbGVuLCBhcmdzLCBpLCBldmVudHM7XG4gIHZhciBkb0Vycm9yID0gKHR5cGUgPT09ICdlcnJvcicpO1xuXG4gIGV2ZW50cyA9IHRoaXMuX2V2ZW50cztcbiAgaWYgKGV2ZW50cylcbiAgICBkb0Vycm9yID0gKGRvRXJyb3IgJiYgZXZlbnRzLmVycm9yID09IG51bGwpO1xuICBlbHNlIGlmICghZG9FcnJvcilcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgLy8gSWYgdGhlcmUgaXMgbm8gJ2Vycm9yJyBldmVudCBsaXN0ZW5lciB0aGVuIHRocm93LlxuICBpZiAoZG9FcnJvcikge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSlcbiAgICAgIGVyID0gYXJndW1lbnRzWzFdO1xuICAgIGlmIChlciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICB0aHJvdyBlcjsgLy8gVW5oYW5kbGVkICdlcnJvcicgZXZlbnRcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQXQgbGVhc3QgZ2l2ZSBzb21lIGtpbmQgb2YgY29udGV4dCB0byB0aGUgdXNlclxuICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcignVW5oYW5kbGVkIFwiZXJyb3JcIiBldmVudC4gKCcgKyBlciArICcpJyk7XG4gICAgICBlcnIuY29udGV4dCA9IGVyO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBoYW5kbGVyID0gZXZlbnRzW3R5cGVdO1xuXG4gIGlmICghaGFuZGxlcilcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgdmFyIGlzRm4gPSB0eXBlb2YgaGFuZGxlciA9PT0gJ2Z1bmN0aW9uJztcbiAgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgc3dpdGNoIChsZW4pIHtcbiAgICAgIC8vIGZhc3QgY2FzZXNcbiAgICBjYXNlIDE6XG4gICAgICBlbWl0Tm9uZShoYW5kbGVyLCBpc0ZuLCB0aGlzKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMjpcbiAgICAgIGVtaXRPbmUoaGFuZGxlciwgaXNGbiwgdGhpcywgYXJndW1lbnRzWzFdKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMzpcbiAgICAgIGVtaXRUd28oaGFuZGxlciwgaXNGbiwgdGhpcywgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0pO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSA0OlxuICAgICAgZW1pdFRocmVlKGhhbmRsZXIsIGlzRm4sIHRoaXMsIGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdLCBhcmd1bWVudHNbM10pO1xuICAgICAgYnJlYWs7XG4gICAgICAvLyBzbG93ZXJcbiAgICBkZWZhdWx0OlxuICAgICAgYXJncyA9IG5ldyBBcnJheShsZW4gLSAxKTtcbiAgICAgIGZvciAoaSA9IDE7IGkgPCBsZW47IGkrKylcbiAgICAgICAgYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07XG4gICAgICBlbWl0TWFueShoYW5kbGVyLCBpc0ZuLCB0aGlzLCBhcmdzKTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuZnVuY3Rpb24gX2FkZExpc3RlbmVyKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIsIHByZXBlbmQpIHtcbiAgdmFyIG07XG4gIHZhciBldmVudHM7XG4gIHZhciBleGlzdGluZztcblxuICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICBldmVudHMgPSB0YXJnZXQuX2V2ZW50cztcbiAgaWYgKCFldmVudHMpIHtcbiAgICBldmVudHMgPSB0YXJnZXQuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICB0YXJnZXQuX2V2ZW50c0NvdW50ID0gMDtcbiAgfSBlbHNlIHtcbiAgICAvLyBUbyBhdm9pZCByZWN1cnNpb24gaW4gdGhlIGNhc2UgdGhhdCB0eXBlID09PSBcIm5ld0xpc3RlbmVyXCIhIEJlZm9yZVxuICAgIC8vIGFkZGluZyBpdCB0byB0aGUgbGlzdGVuZXJzLCBmaXJzdCBlbWl0IFwibmV3TGlzdGVuZXJcIi5cbiAgICBpZiAoZXZlbnRzLm5ld0xpc3RlbmVyKSB7XG4gICAgICB0YXJnZXQuZW1pdCgnbmV3TGlzdGVuZXInLCB0eXBlLFxuICAgICAgICAgIGxpc3RlbmVyLmxpc3RlbmVyID8gbGlzdGVuZXIubGlzdGVuZXIgOiBsaXN0ZW5lcik7XG5cbiAgICAgIC8vIFJlLWFzc2lnbiBgZXZlbnRzYCBiZWNhdXNlIGEgbmV3TGlzdGVuZXIgaGFuZGxlciBjb3VsZCBoYXZlIGNhdXNlZCB0aGVcbiAgICAgIC8vIHRoaXMuX2V2ZW50cyB0byBiZSBhc3NpZ25lZCB0byBhIG5ldyBvYmplY3RcbiAgICAgIGV2ZW50cyA9IHRhcmdldC5fZXZlbnRzO1xuICAgIH1cbiAgICBleGlzdGluZyA9IGV2ZW50c1t0eXBlXTtcbiAgfVxuXG4gIGlmICghZXhpc3RpbmcpIHtcbiAgICAvLyBPcHRpbWl6ZSB0aGUgY2FzZSBvZiBvbmUgbGlzdGVuZXIuIERvbid0IG5lZWQgdGhlIGV4dHJhIGFycmF5IG9iamVjdC5cbiAgICBleGlzdGluZyA9IGV2ZW50c1t0eXBlXSA9IGxpc3RlbmVyO1xuICAgICsrdGFyZ2V0Ll9ldmVudHNDb3VudDtcbiAgfSBlbHNlIHtcbiAgICBpZiAodHlwZW9mIGV4aXN0aW5nID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAvLyBBZGRpbmcgdGhlIHNlY29uZCBlbGVtZW50LCBuZWVkIHRvIGNoYW5nZSB0byBhcnJheS5cbiAgICAgIGV4aXN0aW5nID0gZXZlbnRzW3R5cGVdID1cbiAgICAgICAgICBwcmVwZW5kID8gW2xpc3RlbmVyLCBleGlzdGluZ10gOiBbZXhpc3RpbmcsIGxpc3RlbmVyXTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgd2UndmUgYWxyZWFkeSBnb3QgYW4gYXJyYXksIGp1c3QgYXBwZW5kLlxuICAgICAgaWYgKHByZXBlbmQpIHtcbiAgICAgICAgZXhpc3RpbmcudW5zaGlmdChsaXN0ZW5lcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBleGlzdGluZy5wdXNoKGxpc3RlbmVyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgbGlzdGVuZXIgbGVha1xuICAgIGlmICghZXhpc3Rpbmcud2FybmVkKSB7XG4gICAgICBtID0gJGdldE1heExpc3RlbmVycyh0YXJnZXQpO1xuICAgICAgaWYgKG0gJiYgbSA+IDAgJiYgZXhpc3RpbmcubGVuZ3RoID4gbSkge1xuICAgICAgICBleGlzdGluZy53YXJuZWQgPSB0cnVlO1xuICAgICAgICB2YXIgdyA9IG5ldyBFcnJvcignUG9zc2libGUgRXZlbnRFbWl0dGVyIG1lbW9yeSBsZWFrIGRldGVjdGVkLiAnICtcbiAgICAgICAgICAgIGV4aXN0aW5nLmxlbmd0aCArICcgXCInICsgU3RyaW5nKHR5cGUpICsgJ1wiIGxpc3RlbmVycyAnICtcbiAgICAgICAgICAgICdhZGRlZC4gVXNlIGVtaXR0ZXIuc2V0TWF4TGlzdGVuZXJzKCkgdG8gJyArXG4gICAgICAgICAgICAnaW5jcmVhc2UgbGltaXQuJyk7XG4gICAgICAgIHcubmFtZSA9ICdNYXhMaXN0ZW5lcnNFeGNlZWRlZFdhcm5pbmcnO1xuICAgICAgICB3LmVtaXR0ZXIgPSB0YXJnZXQ7XG4gICAgICAgIHcudHlwZSA9IHR5cGU7XG4gICAgICAgIHcuY291bnQgPSBleGlzdGluZy5sZW5ndGg7XG4gICAgICAgIGlmICh0eXBlb2YgY29uc29sZSA9PT0gJ29iamVjdCcgJiYgY29uc29sZS53YXJuKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCclczogJXMnLCB3Lm5hbWUsIHcubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGFyZ2V0O1xufVxuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZExpc3RlbmVyID0gZnVuY3Rpb24gYWRkTGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHtcbiAgcmV0dXJuIF9hZGRMaXN0ZW5lcih0aGlzLCB0eXBlLCBsaXN0ZW5lciwgZmFsc2UpO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbiA9IEV2ZW50RW1pdHRlci5wcm90b3R5cGUuYWRkTGlzdGVuZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucHJlcGVuZExpc3RlbmVyID1cbiAgICBmdW5jdGlvbiBwcmVwZW5kTGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgIHJldHVybiBfYWRkTGlzdGVuZXIodGhpcywgdHlwZSwgbGlzdGVuZXIsIHRydWUpO1xuICAgIH07XG5cbmZ1bmN0aW9uIG9uY2VXcmFwcGVyKCkge1xuICBpZiAoIXRoaXMuZmlyZWQpIHtcbiAgICB0aGlzLnRhcmdldC5yZW1vdmVMaXN0ZW5lcih0aGlzLnR5cGUsIHRoaXMud3JhcEZuKTtcbiAgICB0aGlzLmZpcmVkID0gdHJ1ZTtcbiAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCk7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLmNhbGwodGhpcy50YXJnZXQsIGFyZ3VtZW50c1swXSk7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLmNhbGwodGhpcy50YXJnZXQsIGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdKTtcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCwgYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0sXG4gICAgICAgICAgICBhcmd1bWVudHNbMl0pO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7ICsraSlcbiAgICAgICAgICBhcmdzW2ldID0gYXJndW1lbnRzW2ldO1xuICAgICAgICB0aGlzLmxpc3RlbmVyLmFwcGx5KHRoaXMudGFyZ2V0LCBhcmdzKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gX29uY2VXcmFwKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIpIHtcbiAgdmFyIHN0YXRlID0geyBmaXJlZDogZmFsc2UsIHdyYXBGbjogdW5kZWZpbmVkLCB0YXJnZXQ6IHRhcmdldCwgdHlwZTogdHlwZSwgbGlzdGVuZXI6IGxpc3RlbmVyIH07XG4gIHZhciB3cmFwcGVkID0gYmluZC5jYWxsKG9uY2VXcmFwcGVyLCBzdGF0ZSk7XG4gIHdyYXBwZWQubGlzdGVuZXIgPSBsaXN0ZW5lcjtcbiAgc3RhdGUud3JhcEZuID0gd3JhcHBlZDtcbiAgcmV0dXJuIHdyYXBwZWQ7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uIG9uY2UodHlwZSwgbGlzdGVuZXIpIHtcbiAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gJ2Z1bmN0aW9uJylcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gIHRoaXMub24odHlwZSwgX29uY2VXcmFwKHRoaXMsIHR5cGUsIGxpc3RlbmVyKSk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5wcmVwZW5kT25jZUxpc3RlbmVyID1cbiAgICBmdW5jdGlvbiBwcmVwZW5kT25jZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgICB0aGlzLnByZXBlbmRMaXN0ZW5lcih0eXBlLCBfb25jZVdyYXAodGhpcywgdHlwZSwgbGlzdGVuZXIpKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbi8vIEVtaXRzIGEgJ3JlbW92ZUxpc3RlbmVyJyBldmVudCBpZiBhbmQgb25seSBpZiB0aGUgbGlzdGVuZXIgd2FzIHJlbW92ZWQuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyID1cbiAgICBmdW5jdGlvbiByZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikge1xuICAgICAgdmFyIGxpc3QsIGV2ZW50cywgcG9zaXRpb24sIGksIG9yaWdpbmFsTGlzdGVuZXI7XG5cbiAgICAgIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICAgICAgaWYgKCFldmVudHMpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICBsaXN0ID0gZXZlbnRzW3R5cGVdO1xuICAgICAgaWYgKCFsaXN0KVxuICAgICAgICByZXR1cm4gdGhpcztcblxuICAgICAgaWYgKGxpc3QgPT09IGxpc3RlbmVyIHx8IGxpc3QubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7XG4gICAgICAgIGlmICgtLXRoaXMuX2V2ZW50c0NvdW50ID09PSAwKVxuICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgZGVsZXRlIGV2ZW50c1t0eXBlXTtcbiAgICAgICAgICBpZiAoZXZlbnRzLnJlbW92ZUxpc3RlbmVyKVxuICAgICAgICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIGxpc3QubGlzdGVuZXIgfHwgbGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBsaXN0ICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHBvc2l0aW9uID0gLTE7XG5cbiAgICAgICAgZm9yIChpID0gbGlzdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIGlmIChsaXN0W2ldID09PSBsaXN0ZW5lciB8fCBsaXN0W2ldLmxpc3RlbmVyID09PSBsaXN0ZW5lcikge1xuICAgICAgICAgICAgb3JpZ2luYWxMaXN0ZW5lciA9IGxpc3RbaV0ubGlzdGVuZXI7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IGk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocG9zaXRpb24gPCAwKVxuICAgICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAgIGlmIChwb3NpdGlvbiA9PT0gMClcbiAgICAgICAgICBsaXN0LnNoaWZ0KCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBzcGxpY2VPbmUobGlzdCwgcG9zaXRpb24pO1xuXG4gICAgICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMSlcbiAgICAgICAgICBldmVudHNbdHlwZV0gPSBsaXN0WzBdO1xuXG4gICAgICAgIGlmIChldmVudHMucmVtb3ZlTGlzdGVuZXIpXG4gICAgICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIG9yaWdpbmFsTGlzdGVuZXIgfHwgbGlzdGVuZXIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycyA9XG4gICAgZnVuY3Rpb24gcmVtb3ZlQWxsTGlzdGVuZXJzKHR5cGUpIHtcbiAgICAgIHZhciBsaXN0ZW5lcnMsIGV2ZW50cywgaTtcblxuICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICAgICAgaWYgKCFldmVudHMpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAvLyBub3QgbGlzdGVuaW5nIGZvciByZW1vdmVMaXN0ZW5lciwgbm8gbmVlZCB0byBlbWl0XG4gICAgICBpZiAoIWV2ZW50cy5yZW1vdmVMaXN0ZW5lcikge1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgICB0aGlzLl9ldmVudHNDb3VudCA9IDA7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnRzW3R5cGVdKSB7XG4gICAgICAgICAgaWYgKC0tdGhpcy5fZXZlbnRzQ291bnQgPT09IDApXG4gICAgICAgICAgICB0aGlzLl9ldmVudHMgPSBvYmplY3RDcmVhdGUobnVsbCk7XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgZGVsZXRlIGV2ZW50c1t0eXBlXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgLy8gZW1pdCByZW1vdmVMaXN0ZW5lciBmb3IgYWxsIGxpc3RlbmVycyBvbiBhbGwgZXZlbnRzXG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB2YXIga2V5cyA9IG9iamVjdEtleXMoZXZlbnRzKTtcbiAgICAgICAgdmFyIGtleTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICBrZXkgPSBrZXlzW2ldO1xuICAgICAgICAgIGlmIChrZXkgPT09ICdyZW1vdmVMaXN0ZW5lcicpIGNvbnRpbnVlO1xuICAgICAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ3JlbW92ZUxpc3RlbmVyJyk7XG4gICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgbGlzdGVuZXJzID0gZXZlbnRzW3R5cGVdO1xuXG4gICAgICBpZiAodHlwZW9mIGxpc3RlbmVycyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVycyk7XG4gICAgICB9IGVsc2UgaWYgKGxpc3RlbmVycykge1xuICAgICAgICAvLyBMSUZPIG9yZGVyXG4gICAgICAgIGZvciAoaSA9IGxpc3RlbmVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXJzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5mdW5jdGlvbiBfbGlzdGVuZXJzKHRhcmdldCwgdHlwZSwgdW53cmFwKSB7XG4gIHZhciBldmVudHMgPSB0YXJnZXQuX2V2ZW50cztcblxuICBpZiAoIWV2ZW50cylcbiAgICByZXR1cm4gW107XG5cbiAgdmFyIGV2bGlzdGVuZXIgPSBldmVudHNbdHlwZV07XG4gIGlmICghZXZsaXN0ZW5lcilcbiAgICByZXR1cm4gW107XG5cbiAgaWYgKHR5cGVvZiBldmxpc3RlbmVyID09PSAnZnVuY3Rpb24nKVxuICAgIHJldHVybiB1bndyYXAgPyBbZXZsaXN0ZW5lci5saXN0ZW5lciB8fCBldmxpc3RlbmVyXSA6IFtldmxpc3RlbmVyXTtcblxuICByZXR1cm4gdW53cmFwID8gdW53cmFwTGlzdGVuZXJzKGV2bGlzdGVuZXIpIDogYXJyYXlDbG9uZShldmxpc3RlbmVyLCBldmxpc3RlbmVyLmxlbmd0aCk7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24gbGlzdGVuZXJzKHR5cGUpIHtcbiAgcmV0dXJuIF9saXN0ZW5lcnModGhpcywgdHlwZSwgdHJ1ZSk7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJhd0xpc3RlbmVycyA9IGZ1bmN0aW9uIHJhd0xpc3RlbmVycyh0eXBlKSB7XG4gIHJldHVybiBfbGlzdGVuZXJzKHRoaXMsIHR5cGUsIGZhbHNlKTtcbn07XG5cbkV2ZW50RW1pdHRlci5saXN0ZW5lckNvdW50ID0gZnVuY3Rpb24oZW1pdHRlciwgdHlwZSkge1xuICBpZiAodHlwZW9mIGVtaXR0ZXIubGlzdGVuZXJDb3VudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBlbWl0dGVyLmxpc3RlbmVyQ291bnQodHlwZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGxpc3RlbmVyQ291bnQuY2FsbChlbWl0dGVyLCB0eXBlKTtcbiAgfVxufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5saXN0ZW5lckNvdW50ID0gbGlzdGVuZXJDb3VudDtcbmZ1bmN0aW9uIGxpc3RlbmVyQ291bnQodHlwZSkge1xuICB2YXIgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuXG4gIGlmIChldmVudHMpIHtcbiAgICB2YXIgZXZsaXN0ZW5lciA9IGV2ZW50c1t0eXBlXTtcblxuICAgIGlmICh0eXBlb2YgZXZsaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfSBlbHNlIGlmIChldmxpc3RlbmVyKSB7XG4gICAgICByZXR1cm4gZXZsaXN0ZW5lci5sZW5ndGg7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIDA7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuZXZlbnROYW1lcyA9IGZ1bmN0aW9uIGV2ZW50TmFtZXMoKSB7XG4gIHJldHVybiB0aGlzLl9ldmVudHNDb3VudCA+IDAgPyBSZWZsZWN0Lm93bktleXModGhpcy5fZXZlbnRzKSA6IFtdO1xufTtcblxuLy8gQWJvdXQgMS41eCBmYXN0ZXIgdGhhbiB0aGUgdHdvLWFyZyB2ZXJzaW9uIG9mIEFycmF5I3NwbGljZSgpLlxuZnVuY3Rpb24gc3BsaWNlT25lKGxpc3QsIGluZGV4KSB7XG4gIGZvciAodmFyIGkgPSBpbmRleCwgayA9IGkgKyAxLCBuID0gbGlzdC5sZW5ndGg7IGsgPCBuOyBpICs9IDEsIGsgKz0gMSlcbiAgICBsaXN0W2ldID0gbGlzdFtrXTtcbiAgbGlzdC5wb3AoKTtcbn1cblxuZnVuY3Rpb24gYXJyYXlDbG9uZShhcnIsIG4pIHtcbiAgdmFyIGNvcHkgPSBuZXcgQXJyYXkobik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgKytpKVxuICAgIGNvcHlbaV0gPSBhcnJbaV07XG4gIHJldHVybiBjb3B5O1xufVxuXG5mdW5jdGlvbiB1bndyYXBMaXN0ZW5lcnMoYXJyKSB7XG4gIHZhciByZXQgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcmV0Lmxlbmd0aDsgKytpKSB7XG4gICAgcmV0W2ldID0gYXJyW2ldLmxpc3RlbmVyIHx8IGFycltpXTtcbiAgfVxuICByZXR1cm4gcmV0O1xufVxuXG5mdW5jdGlvbiBvYmplY3RDcmVhdGVQb2x5ZmlsbChwcm90bykge1xuICB2YXIgRiA9IGZ1bmN0aW9uKCkge307XG4gIEYucHJvdG90eXBlID0gcHJvdG87XG4gIHJldHVybiBuZXcgRjtcbn1cbmZ1bmN0aW9uIG9iamVjdEtleXNQb2x5ZmlsbChvYmopIHtcbiAgdmFyIGtleXMgPSBbXTtcbiAgZm9yICh2YXIgayBpbiBvYmopIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrKSkge1xuICAgIGtleXMucHVzaChrKTtcbiAgfVxuICByZXR1cm4gaztcbn1cbmZ1bmN0aW9uIGZ1bmN0aW9uQmluZFBvbHlmaWxsKGNvbnRleHQpIHtcbiAgdmFyIGZuID0gdGhpcztcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZm4uYXBwbHkoY29udGV4dCwgYXJndW1lbnRzKTtcbiAgfTtcbn1cbiIsIi8qXG5vYmplY3QtYXNzaWduXG4oYykgU2luZHJlIFNvcmh1c1xuQGxpY2Vuc2UgTUlUXG4qL1xuXG4ndXNlIHN0cmljdCc7XG4vKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqL1xudmFyIGdldE93blByb3BlcnR5U3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7XG52YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O1xudmFyIHByb3BJc0VudW1lcmFibGUgPSBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlO1xuXG5mdW5jdGlvbiB0b09iamVjdCh2YWwpIHtcblx0aWYgKHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZCkge1xuXHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdC5hc3NpZ24gY2Fubm90IGJlIGNhbGxlZCB3aXRoIG51bGwgb3IgdW5kZWZpbmVkJyk7XG5cdH1cblxuXHRyZXR1cm4gT2JqZWN0KHZhbCk7XG59XG5cbmZ1bmN0aW9uIHNob3VsZFVzZU5hdGl2ZSgpIHtcblx0dHJ5IHtcblx0XHRpZiAoIU9iamVjdC5hc3NpZ24pIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBEZXRlY3QgYnVnZ3kgcHJvcGVydHkgZW51bWVyYXRpb24gb3JkZXIgaW4gb2xkZXIgVjggdmVyc2lvbnMuXG5cblx0XHQvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD00MTE4XG5cdFx0dmFyIHRlc3QxID0gbmV3IFN0cmluZygnYWJjJyk7ICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ldy13cmFwcGVyc1xuXHRcdHRlc3QxWzVdID0gJ2RlJztcblx0XHRpZiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGVzdDEpWzBdID09PSAnNScpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD0zMDU2XG5cdFx0dmFyIHRlc3QyID0ge307XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG5cdFx0XHR0ZXN0MlsnXycgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpXSA9IGk7XG5cdFx0fVxuXHRcdHZhciBvcmRlcjIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0ZXN0MikubWFwKGZ1bmN0aW9uIChuKSB7XG5cdFx0XHRyZXR1cm4gdGVzdDJbbl07XG5cdFx0fSk7XG5cdFx0aWYgKG9yZGVyMi5qb2luKCcnKSAhPT0gJzAxMjM0NTY3ODknKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0Ly8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzA1NlxuXHRcdHZhciB0ZXN0MyA9IHt9O1xuXHRcdCdhYmNkZWZnaGlqa2xtbm9wcXJzdCcuc3BsaXQoJycpLmZvckVhY2goZnVuY3Rpb24gKGxldHRlcikge1xuXHRcdFx0dGVzdDNbbGV0dGVyXSA9IGxldHRlcjtcblx0XHR9KTtcblx0XHRpZiAoT2JqZWN0LmtleXMoT2JqZWN0LmFzc2lnbih7fSwgdGVzdDMpKS5qb2luKCcnKSAhPT1cblx0XHRcdFx0J2FiY2RlZmdoaWprbG1ub3BxcnN0Jykge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdHJldHVybiB0cnVlO1xuXHR9IGNhdGNoIChlcnIpIHtcblx0XHQvLyBXZSBkb24ndCBleHBlY3QgYW55IG9mIHRoZSBhYm92ZSB0byB0aHJvdywgYnV0IGJldHRlciB0byBiZSBzYWZlLlxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHNob3VsZFVzZU5hdGl2ZSgpID8gT2JqZWN0LmFzc2lnbiA6IGZ1bmN0aW9uICh0YXJnZXQsIHNvdXJjZSkge1xuXHR2YXIgZnJvbTtcblx0dmFyIHRvID0gdG9PYmplY3QodGFyZ2V0KTtcblx0dmFyIHN5bWJvbHM7XG5cblx0Zm9yICh2YXIgcyA9IDE7IHMgPCBhcmd1bWVudHMubGVuZ3RoOyBzKyspIHtcblx0XHRmcm9tID0gT2JqZWN0KGFyZ3VtZW50c1tzXSk7XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gZnJvbSkge1xuXHRcdFx0aWYgKGhhc093blByb3BlcnR5LmNhbGwoZnJvbSwga2V5KSkge1xuXHRcdFx0XHR0b1trZXldID0gZnJvbVtrZXldO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChnZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHtcblx0XHRcdHN5bWJvbHMgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZnJvbSk7XG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHN5bWJvbHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYgKHByb3BJc0VudW1lcmFibGUuY2FsbChmcm9tLCBzeW1ib2xzW2ldKSkge1xuXHRcdFx0XHRcdHRvW3N5bWJvbHNbaV1dID0gZnJvbVtzeW1ib2xzW2ldXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiB0bztcbn07XG4iXX0=
