(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
// © 2001-2015 INOVx Solutions, Inc.
// 114 Pacifica Suite 300, Irvine, CA 92618 USA
// All rights reserved.
//
// This software is confidential, proprietary and unpublished property of
// INOVx Solutions, Inc.  It may NOT be copied in part or in whole on any
// medium, either electronic or printed, without the express written consent
// of INOVx Solutions, Inc.
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var ReactDOM = require("react-dom");
var OrganizationApp = require("./components/OrganizationApp");
try {
    InovxLoader.updateHelp('organization-access-rights');
}
catch (e) {
}
ReactDOM.render(React.createElement(OrganizationApp, null), document.getElementById('organizationApp'));

},{"./components/OrganizationApp":4,"react":"react","react-dom":"react-dom"}],2:[function(require,module,exports){
"use strict";
// © 2001-2015 INOVx Solutions, Inc.
// 114 Pacifica Suite 300, Irvine, CA 92618 USA
// All rights reserved.
//
// This software is confidential, proprietary and unpublished property of
// INOVx Solutions, Inc.  It may NOT be copied in part or in whole on any
// medium, either electronic or printed, without the express written consent
// of INOVx Solutions, Inc.
var Inovx = require("shared.web.client");
var OrganizationService = require("./../services/OrganizationServices");
var OrganizationConstants = require("./../constants/OrganizationConstants");
var OrganizationStore = require("./../stores/OrganizationStore");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
function _endEdit() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: OrganizationConstants.ORGANIZATION_END_EDIT
    });
}
var OrganizationActions = {
    getAllRoot: function (itemType, callback, errorCallback, ignoreDefaultError) {
        OrganizationService.getAllRoot(itemType, function (data) {
            if (callback !== undefined && callback != null) {
                callback();
            }
            Inovx.Shared.Flux.AppDispatcher.dispatch({
                actionType: OrganizationConstants.ORGANIZATION_RECIEVE_ROOTS,
                data: data
            });
        }, function (error) {
            if (errorCallback) {
                errorCallback(error);
            }
        }, ignoreDefaultError);
    },
    getChildren: function (organization, callback) {
        OrganizationService.getChildren(organization, function (data) {
            if (callback !== undefined && callback != null) {
                callback();
            }
            Inovx.Shared.Flux.AppDispatcher.dispatch({
                actionType: OrganizationConstants.ORGANIZATION_RECIEVE_CHILDREN,
                parent: organization,
                data: data
            });
        }, function () { });
    },
    beginEdit: function (organization) {
        OrganizationService.getAllRoles(function (roles) {
            Inovx.Shared.Flux.AppDispatcher.dispatch({
                actionType: OrganizationConstants.ORGANIZATION_RECEIVE_ALL_ROLES,
                roles: roles
            });
            OrganizationService.getOrganizationDetail(organization.ID, function (organization) {
                Inovx.Shared.Flux.AppDispatcher.dispatch({
                    actionType: OrganizationConstants.ORGANIZATION_BEGIN_EDIT,
                    organization: organization
                });
            }, function (error) {
            });
        }, function (error) {
        });
    },
    endEdit: function () {
        if (OrganizationStore.getHasChanges()) {
            SystemActions.displaySaveChangesDialog({
                message: InovxLoader.t("common:msgBox.saveChanges"),
                cancelCallback: _endEdit,
                confirmCallback: function () {
                    OrganizationActions.edit(OrganizationStore.getCurrentParent());
                }
            });
        }
        else {
            _endEdit();
        }
    },
    edit: function (parent, callback) {
        if (!SystemStore.isActionInProgress(OrganizationConstants.ORGANIZATION_EDIT)) {
            SystemActions.beginAction(OrganizationConstants.ORGANIZATION_EDIT);
            OrganizationService.editOrganization(OrganizationStore.getEditOrganization(), function (data) {
                if (parent == null) {
                    //Hard coded for now
                    OrganizationActions.getAllRoot(3);
                }
                else {
                    OrganizationActions.getChildren(parent);
                }
                if (callback !== undefined && callback != null) {
                    callback();
                }
                _endEdit();
                SystemActions.endAction(OrganizationConstants.ORGANIZATION_EDIT);
            }, function (error) {
                SystemActions.endAction(OrganizationConstants.ORGANIZATION_EDIT);
            });
        }
    },
    update: function (key, value) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: OrganizationConstants.ORGANIZATION_UPDATE_ORGANIZATION,
            key: key,
            value: value
        });
    }
};
module.exports = OrganizationActions;

},{"./../constants/OrganizationConstants":5,"./../services/OrganizationServices":6,"./../stores/OrganizationStore":7,"shared.web.client":"shared.web.client"}],3:[function(require,module,exports){
"use strict";
// © 2001-2015 INOVx Solutions, Inc.
// 114 Pacifica Suite 300, Irvine, CA 92618 USA
// All rights reserved.
//
// This software is confidential, proprietary and unpublished property of
// INOVx Solutions, Inc.  It may NOT be copied in part or in whole on any
// medium, either electronic or printed, without the express written consent
// of INOVx Solutions, Inc.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var React = require("react");
var OrganizationStore = require("./../stores/OrganizationStore");
var OrganizationConstants = require("./../constants/OrganizationConstants");
var OrganizationActions = require("./../actions/OrganizationActions");
var Inovx = require("shared.web.client");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
var ListHelper = Inovx.Shared.Common.ListHelper;
var InovxControls = Inovx.Shared.Controls;
var ORGANIZATION_HIERARCHY = 'Hierarchy';
function getActionInProgress() {
    return SystemStore.isActionInProgress(OrganizationConstants.ORGANIZATION_EDIT);
}
var _actionInProgressMsg;
function getFormState() {
    return {
        parent: OrganizationStore.getCurrentParent(),
        organization: OrganizationStore.getEditOrganization(),
        isActionInProgress: getActionInProgress(),
        actionInProgressMsg: _actionInProgressMsg,
        allRoles: OrganizationStore.getAllRoles()
    };
}
var OrganizationAccessRightForm = /** @class */ (function (_super) {
    __extends(OrganizationAccessRightForm, _super);
    function OrganizationAccessRightForm(props) {
        var _this = _super.call(this, props) || this;
        _this._onChange = function (event) {
            OrganizationActions.update(event.target.name, event.target.value);
        };
        _this._loadState = function () {
            _this.setState(getFormState());
        };
        _this._systemChange = function () {
            _this.setState({
                isActionInProgress: getActionInProgress()
            });
        };
        _this._saveOrganization = function () {
            OrganizationActions.edit(_this.state.parent);
            _this.setState({ actionInProgressMsg: InovxLoader.t('organization:form.saving') });
        };
        _this._cancel = function () {
            OrganizationActions.endEdit();
        };
        _this._isEmptyOrNull = function (value) {
            return value && value.length > 0;
        };
        _this._validateOrganization = function () {
            var form = _this.refs["name"];
            if (form.isValid(_this._isEmptyOrNull)) {
                return true;
            }
            return false;
        };
        _this._checkForUnsavedChanges = function (event) {
            if (OrganizationStore.getHasChanges()) {
                event.returnValue = InovxLoader.t('common:msgBox.browserSaveChanges');
            }
            ;
        };
        _this._validateRemove = function (selectedRoles) {
            for (var i = 0; i < selectedRoles.length; i++) {
                var role = selectedRoles[i];
                if (role.Inherited !== undefined && role.Inherited) {
                    var messageObject = {
                        message: InovxLoader.t('organization:error.inheritedRole')
                    };
                    SystemActions.displayErrorMessage(messageObject);
                    return false;
                }
            }
            return true;
        };
        _this._rolesChanged = function (roles) {
            OrganizationActions.update("AssignedRoles", roles);
        };
        _this._availableRoles = function () {
            var allRoles = _this.state.allRoles;
            var assignedRoles = _this.state.organization.AssignedRoles;
            var roles = allRoles.filter(function (role) {
                return assignedRoles.filter(function (assignedRole) {
                    return role.ID === assignedRole.ID && role.Name === assignedRole.Name;
                }).length === 0;
            });
            return roles;
        };
        _this.state = getFormState();
        return _this;
    }
    OrganizationAccessRightForm.prototype.componentWillMount = function () {
        ListHelper.sort(this.state.allRoles, "Name");
        ListHelper.sort(this.state.organization.AssignedRoles, "Name");
    };
    OrganizationAccessRightForm.prototype.componentWillUpdate = function (nextProps, nextState) {
        ListHelper.sort(this.state.organization.AssignedRoles, "Name");
    };
    OrganizationAccessRightForm.prototype.componentDidMount = function () {
        OrganizationStore.addChangeListener(this._loadState);
        SystemStore.addChangeListener(this._systemChange);
        window.addEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    OrganizationAccessRightForm.prototype.componentWillUnmount = function () {
        OrganizationStore.removeChangeListener(this._loadState);
        SystemStore.removeChangeListener(this._systemChange);
        window.removeEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    OrganizationAccessRightForm.prototype.render = function () {
        var inputObj = {
            className: 'form-control',
            type: 'text'
        };
        var Organization = this.state.organization;
        // Only a root item may get its names changed.
        // var editable = (Organization.InheritAccessRightFromID) ? false : true;
        // Renaming of the roots is temporarily disabled (bug #11591)
        var editable = false;
        var OrganizationNameInput = jQuery.extend({
            name: 'Name',
            value: Organization.Name
        }, inputObj);
        var header = InovxLoader.t('organization:form.header');
        var nameFieldHeader = InovxLoader.t("organization:common.organizationName");
        if (Organization.InheritAccessRightFromID) {
            nameFieldHeader = InovxLoader.t("organization:common.workspace");
        }
        return (React.createElement(InovxControls.StaticHeaderForm, { title: header, saveOnClick: this._saveOrganization, cancelOnClick: this._cancel, isActionInProgress: this.state.isActionInProgress, inProgressMessage: this.state.actionInProgressMsg },
            React.createElement(InovxControls.FormField, { title: "".concat(nameFieldHeader, "*"), inputName: 'Name' },
                React.createElement(InovxControls.RequiredInput, __assign({}, OrganizationNameInput, { onChangeCallback: this._onChange, ref: "name", readOnly: !editable }))),
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("organization:common.roles"), inputName: 'Role' },
                React.createElement("span", { className: "edit-role-description" }, InovxLoader.t("organization:form.rolesDescription"))),
            React.createElement(InovxControls.ObjectAssignment, { leftHeader: InovxLoader.t('organization:form.availableRoles'), rightHeader: InovxLoader.t('organization:form.assignedRoles'), availableObjects: this._availableRoles(), assignedObjects: this.state.organization.AssignedRoles, inheritedObjectAttribute: "Inherited", onValueChanged: this._rolesChanged, validateRemove: this._validateRemove })));
    };
    return OrganizationAccessRightForm;
}(React.Component));
module.exports = OrganizationAccessRightForm;

},{"./../actions/OrganizationActions":2,"./../constants/OrganizationConstants":5,"./../stores/OrganizationStore":7,"react":"react","shared.web.client":"shared.web.client"}],4:[function(require,module,exports){
"use strict";
// © 2001-2015 INOVx Solutions, Inc.
// 114 Pacifica Suite 300, Irvine, CA 92618 USA
// All rights reserved.
//
// This software is confidential, proprietary and unpublished property of
// INOVx Solutions, Inc.  It may NOT be copied in part or in whole on any
// medium, either electronic or printed, without the express written consent
// of INOVx Solutions, Inc.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var React = require("react");
var Inovx = require("shared.web.client");
var OrganizationActions = require("./../actions/OrganizationActions");
var OrganizationStore = require("./../stores/OrganizationStore");
var OrganizationAccessRightForm = require("./OrganizationAccessRightForm");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
var InovxControls = Inovx.Shared.Controls;
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
var ORGANIZATION_TERMINAL = 'Root';
var _breadcrumbList = [];
var _currentLevel = OrganizationStore.getCurrentOrganization();
function getOrganizationState() {
    return {
        breadcrumbList: _breadcrumbList,
        currentList: OrganizationStore.getCurrentList(),
        isEditing: OrganizationStore.getIsEditing()
    };
}
var OrganizationApp = /** @class */ (function (_super) {
    __extends(OrganizationApp, _super);
    function OrganizationApp(props, context) {
        var _this = _super.call(this, 'organization', props, context) || this;
        _this._onChange = function () {
            _this.setState(getOrganizationState());
        };
        _this._initialize = function () {
            _breadcrumbList.push({ Name: InovxLoader.t('organization:breadcrumb.root'), OrganizationType: "Root", ID: '', Description: '', TypeName: '', VersionToken: '', ItemType: 3 });
            _currentLevel = _breadcrumbList[0];
            //Hard coded for now
            OrganizationActions.getAllRoot(3, function () {
                _this._appLoaded = true;
            }, function (error) {
                _this._handlePermissionError(error);
            }, true);
        };
        _this._breadcrumbClicked = function (organization) {
            var index = _breadcrumbList.indexOf(organization) + 1;
            _breadcrumbList.splice(index, _breadcrumbList.length - index);
            if (organization.OrganizationType == "Root") {
                //Hard coded for now
                OrganizationActions.getAllRoot(3, function () {
                    _currentLevel = organization;
                });
            }
            else {
                _this._getChildren(organization);
            }
        };
        _this._itemClicked = function (organization) {
            _breadcrumbList.push(organization);
            _this._getChildren(organization);
        };
        _this._editItem = function (organization) {
            OrganizationActions.beginEdit(jQuery.extend(true, {}, organization));
        };
        _this._endEdit = function () {
            OrganizationActions.endEdit();
        };
        _this.state = getOrganizationState();
        return _this;
    }
    OrganizationApp.prototype._getChildren = function (organization) {
        OrganizationActions.getChildren(organization, function () {
            _currentLevel = organization;
        });
    };
    OrganizationApp.prototype.componentWillMount = function () {
        this.componentWillMountBase();
    };
    OrganizationApp.prototype.componentDidMount = function () {
        OrganizationStore.addChangeListener(this._onChange);
    };
    OrganizationApp.prototype.componentWillUnmount = function () {
        OrganizationStore.removeChangeListener(this._onChange);
    };
    OrganizationApp.prototype.render = function () {
        var _this = this;
        var canEdit = true, hasChildren = true, headerTitle = InovxLoader.t('organization:table.project');
        if (_currentLevel.OrganizationType !== ORGANIZATION_TERMINAL) {
            //canEdit = false;
            hasChildren = false;
            headerTitle = InovxLoader.t('organization:table.workspace');
        }
        var width = 80;
        var nameWidth = { width: 'calc(100%' + (canEdit ? ' - ' + width + 'px' : '') + ')' };
        var editWidth = { width: width + 'px' };
        var alt = true;
        var children = this.state.currentList.map(function (item) {
            alt = !alt;
            var nameProps = {
                className: 'tg-cell',
                style: nameWidth
            };
            if (hasChildren) {
                nameProps.onClick = function () { _this._itemClicked(item); };
                nameProps.className += ' edit';
            }
            ;
            return (React.createElement("div", { className: "tg-row ".concat(alt ? 'tg-alt' : ''), key: item.ID, style: { width: '100%' } },
                React.createElement("div", __assign({}, nameProps), item.Name),
                canEdit
                    ? React.createElement("div", { style: editWidth, className: 'tg-cell' },
                        React.createElement("a", { className: "grid-button", onClick: function () { return _this._editItem(item); } },
                            React.createElement("span", { className: "glyphicon glyphicon-pencil" })))
                    : null));
        });
        var iconHeaderProps = {
            iconUrl: "".concat(UrlUtilities.getBaseApplicationUrl(), "/images/Organization.png"),
            iconAtt: { alt: "Organization Access Rights" },
            title: InovxLoader.t('organization:header.organization'),
        };
        return (React.createElement(Inovx.Shared.Core.ReactLoader, { appReady: this.isAppLoaded(), errorStatus: this._errorStatus },
            React.createElement("div", { className: "organization-app-content" },
                React.createElement(Inovx.Shared.Layout.IconHeader, __assign({}, iconHeaderProps)),
                React.createElement(InovxControls.BreadcrumbPanel, { breadcrumb: this.state.breadcrumbList, onClick: this._breadcrumbClicked, displayProp: 'Name' },
                    React.createElement("div", { className: "tg-table" },
                        React.createElement("div", { className: "tg-grid" },
                            React.createElement("div", { className: "tg-header-container" },
                                React.createElement("div", { className: "tg-header tg-row" },
                                    React.createElement("div", { className: "tg-cell", style: nameWidth },
                                        React.createElement("div", { className: "tg-hdr-ctnt" },
                                            React.createElement("div", { className: "tg-title" }, headerTitle))),
                                    canEdit
                                        ? React.createElement("div", { className: "tg-cell", style: editWidth },
                                            React.createElement("div", { className: "tg-hdr-ctnt" },
                                                React.createElement("div", { className: "tg-title" }, InovxLoader.t('organization:table.action'))))
                                        : null))),
                        React.createElement("div", { className: "tg-content-container", style: { overflow: 'initial' } },
                            React.createElement("div", { className: 'tg-content' }, children))))),
            React.createElement(Inovx.Shared.Controls.ModalSlider, { isOpen: this.state.isEditing, onClose: this._endEdit },
                React.createElement(OrganizationAccessRightForm, null))));
    };
    return OrganizationApp;
}(Inovx.Shared.ReactExt.BaseAppComponent));
module.exports = OrganizationApp;

},{"./../actions/OrganizationActions":2,"./../stores/OrganizationStore":7,"./OrganizationAccessRightForm":3,"react":"react","shared.web.client":"shared.web.client"}],5:[function(require,module,exports){
"use strict";
// © 2001-2015 INOVx Solutions, Inc.
// 114 Pacifica Suite 300, Irvine, CA 92618 USA
// All rights reserved.
//
// This software is confidential, proprietary and unpublished property of
// INOVx Solutions, Inc.  It may NOT be copied in part or in whole on any
// medium, either electronic or printed, without the express written consent
// of INOVx Solutions, Inc.
var keymirror = require("fbjs/lib/keymirror");
var OrganizationConstants = keymirror({
    ORGANIZATION_RECIEVE_ROOTS: null,
    ORGANIZATION_RECIEVE_CHILDREN: null,
    ORGANIZATION_BEGIN_EDIT: null,
    ORGANIZATION_END_EDIT: null,
    ORGANIZATION_EDIT: null,
    ORGANIZATION_UPDATE_ORGANIZATION: null,
    ORGANIZATION_RECEIVE_ALL_ROLES: null
});
module.exports = OrganizationConstants;

},{"fbjs/lib/keymirror":"fbjs/lib/keymirror"}],6:[function(require,module,exports){
"use strict";
// © 2001-2015 INOVx Solutions, Inc.
// 114 Pacifica Suite 300, Irvine, CA 92618 USA
// All rights reserved.
//
// This software is confidential, proprietary and unpublished property of
// INOVx Solutions, Inc.  It may NOT be copied in part or in whole on any
// medium, either electronic or printed, without the express written consent
// of INOVx Solutions, Inc.
var Inovx = require("shared.web.client");
var assign = require("object-assign");
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
var roleUrl = "".concat(UrlUtilities.getApiUrl(), "/OrganizationApi/api/role");
var url = "".concat(UrlUtilities.getApiUrl(), "/OrganizationApi/api/organization");
var OrganizationServices = assign({}, Inovx.Shared.Flux.BaseService, {
    getAllRoot: function (itemType, successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.get("".concat(url, "/RootItems"), { itemType: itemType }, function (retData) {
            successCallback(retData);
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    getChildren: function (organization, successCallback, errorCallback) {
        var _this = this;
        this.get("".concat(url, "/ChildrenItems"), { id: organization.ID, itemType: 3 }, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    getOrganizationDetail: function (id, successCallback, errorCallback) {
        var _this = this;
        this.get("".concat(url, "/ItemDetail"), { id: id, itemType: 3 }, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    editOrganization: function (itemDetail, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/UpdateItem"), itemDetail, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    getAllRoles: function (successCallback, errorCallback) {
        var _this = this;
        this.get(roleUrl, null, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    }
});
module.exports = OrganizationServices;

},{"object-assign":9,"shared.web.client":"shared.web.client"}],7:[function(require,module,exports){
"use strict";
// © 2001-2015 INOVx Solutions, Inc.
// 114 Pacifica Suite 300, Irvine, CA 92618 USA
// All rights reserved.
//
// This software is confidential, proprietary and unpublished property of
// INOVx Solutions, Inc.  It may NOT be copied in part or in whole on any
// medium, either electronic or printed, without the express written consent
// of INOVx Solutions, Inc.
var NodeEvents = require("events");
var Inovx = require("shared.web.client");
var assign = require("object-assign");
var OrganizationConstants = require("./../constants/OrganizationConstants");
var EventEmitter = NodeEvents.EventEmitter;
var CHANGE_EVENT = 'Organization.change';
var _parent = null, _currentList = [], _currentOrganization = getBlankOrganization(), _editOrganization = getBlankOrganizationDetail(), _hasChanges = false, _isEditingOrganization = false, _allRoles = [];
function setEditingOrganization(organization) {
    _currentOrganization = organization;
    _isEditingOrganization = true;
    _editOrganization = $.extend({}, organization);
    _hasChanges = false;
}
function _updateEditOrganization(key, value) {
    _editOrganization[key] = value;
    _hasChanges = true;
}
function finishEditing() {
    _isEditingOrganization = false;
    _hasChanges = false;
}
function getBlankOrganization() {
    return { Name: '', OrganizationType: '', ID: '', Description: '', TypeName: '', VersionToken: '', ItemType: 3 };
}
function getBlankOrganizationDetail() {
    return { Name: '', OrganizationType: '', ID: '', Description: '', TypeName: '', VersionToken: '', ItemType: 3, AssignedRoles: [], InheritAccessRightFromID: "", Type: null };
}
var OrganizationStore = assign({}, EventEmitter.prototype, {
    getCurrentList: function () {
        return _currentList;
    },
    getCurrentOrganization: function () {
        return _currentOrganization;
    },
    getEditOrganization: function () {
        return _editOrganization;
    },
    getCurrentParent: function () {
        return _parent;
    },
    getHasChanges: function () {
        return _hasChanges;
    },
    getIsEditing: function () {
        return _isEditingOrganization;
    },
    getAllRoles: function () {
        return _allRoles;
    },
    emitChange: function () {
        this.emit(CHANGE_EVENT);
    },
    addChangeListener: function (callback) {
        this.on(CHANGE_EVENT, callback);
    },
    removeChangeListener: function (callback) {
        this.removeListener(CHANGE_EVENT, callback);
    }
});
Inovx.Shared.Flux.AppDispatcher.register(function (payload) {
    switch (payload.actionType) {
        case OrganizationConstants.ORGANIZATION_BEGIN_EDIT:
            setEditingOrganization(payload.organization);
            break;
        case OrganizationConstants.ORGANIZATION_END_EDIT:
            finishEditing();
            break;
        case OrganizationConstants.ORGANIZATION_RECIEVE_ROOTS:
        case OrganizationConstants.ORGANIZATION_RECIEVE_CHILDREN:
            _parent = payload.parent;
            _currentList = payload.data;
            break;
        case OrganizationConstants.ORGANIZATION_UPDATE_ORGANIZATION:
            _updateEditOrganization(payload.key, payload.value);
            break;
        case OrganizationConstants.ORGANIZATION_RECEIVE_ALL_ROLES:
            _allRoles = payload.roles;
            break;
        default: return true;
    }
    OrganizationStore.emitChange();
    return true;
});
module.exports = OrganizationStore;

},{"./../constants/OrganizationConstants":5,"events":8,"object-assign":9,"shared.web.client":"shared.web.client"}],8:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var objectCreate = Object.create || objectCreatePolyfill
var objectKeys = Object.keys || objectKeysPolyfill
var bind = Function.prototype.bind || functionBindPolyfill

function EventEmitter() {
  if (!this._events || !Object.prototype.hasOwnProperty.call(this, '_events')) {
    this._events = objectCreate(null);
    this._eventsCount = 0;
  }

  this._maxListeners = this._maxListeners || undefined;
}
module.exports = EventEmitter;

// Backwards-compat with node 0.10.x
EventEmitter.EventEmitter = EventEmitter;

EventEmitter.prototype._events = undefined;
EventEmitter.prototype._maxListeners = undefined;

// By default EventEmitters will print a warning if more than 10 listeners are
// added to it. This is a useful default which helps finding memory leaks.
var defaultMaxListeners = 10;

var hasDefineProperty;
try {
  var o = {};
  if (Object.defineProperty) Object.defineProperty(o, 'x', { value: 0 });
  hasDefineProperty = o.x === 0;
} catch (err) { hasDefineProperty = false }
if (hasDefineProperty) {
  Object.defineProperty(EventEmitter, 'defaultMaxListeners', {
    enumerable: true,
    get: function() {
      return defaultMaxListeners;
    },
    set: function(arg) {
      // check whether the input is a positive number (whose value is zero or
      // greater and not a NaN).
      if (typeof arg !== 'number' || arg < 0 || arg !== arg)
        throw new TypeError('"defaultMaxListeners" must be a positive number');
      defaultMaxListeners = arg;
    }
  });
} else {
  EventEmitter.defaultMaxListeners = defaultMaxListeners;
}

// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
EventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {
  if (typeof n !== 'number' || n < 0 || isNaN(n))
    throw new TypeError('"n" argument must be a positive number');
  this._maxListeners = n;
  return this;
};

function $getMaxListeners(that) {
  if (that._maxListeners === undefined)
    return EventEmitter.defaultMaxListeners;
  return that._maxListeners;
}

EventEmitter.prototype.getMaxListeners = function getMaxListeners() {
  return $getMaxListeners(this);
};

// These standalone emit* functions are used to optimize calling of event
// handlers for fast cases because emit() itself often has a variable number of
// arguments and can be deoptimized because of that. These functions always have
// the same number of arguments and thus do not get deoptimized, so the code
// inside them can execute faster.
function emitNone(handler, isFn, self) {
  if (isFn)
    handler.call(self);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self);
  }
}
function emitOne(handler, isFn, self, arg1) {
  if (isFn)
    handler.call(self, arg1);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1);
  }
}
function emitTwo(handler, isFn, self, arg1, arg2) {
  if (isFn)
    handler.call(self, arg1, arg2);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1, arg2);
  }
}
function emitThree(handler, isFn, self, arg1, arg2, arg3) {
  if (isFn)
    handler.call(self, arg1, arg2, arg3);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1, arg2, arg3);
  }
}

function emitMany(handler, isFn, self, args) {
  if (isFn)
    handler.apply(self, args);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].apply(self, args);
  }
}

EventEmitter.prototype.emit = function emit(type) {
  var er, handler, len, args, i, events;
  var doError = (type === 'error');

  events = this._events;
  if (events)
    doError = (doError && events.error == null);
  else if (!doError)
    return false;

  // If there is no 'error' event listener then throw.
  if (doError) {
    if (arguments.length > 1)
      er = arguments[1];
    if (er instanceof Error) {
      throw er; // Unhandled 'error' event
    } else {
      // At least give some kind of context to the user
      var err = new Error('Unhandled "error" event. (' + er + ')');
      err.context = er;
      throw err;
    }
    return false;
  }

  handler = events[type];

  if (!handler)
    return false;

  var isFn = typeof handler === 'function';
  len = arguments.length;
  switch (len) {
      // fast cases
    case 1:
      emitNone(handler, isFn, this);
      break;
    case 2:
      emitOne(handler, isFn, this, arguments[1]);
      break;
    case 3:
      emitTwo(handler, isFn, this, arguments[1], arguments[2]);
      break;
    case 4:
      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);
      break;
      // slower
    default:
      args = new Array(len - 1);
      for (i = 1; i < len; i++)
        args[i - 1] = arguments[i];
      emitMany(handler, isFn, this, args);
  }

  return true;
};

function _addListener(target, type, listener, prepend) {
  var m;
  var events;
  var existing;

  if (typeof listener !== 'function')
    throw new TypeError('"listener" argument must be a function');

  events = target._events;
  if (!events) {
    events = target._events = objectCreate(null);
    target._eventsCount = 0;
  } else {
    // To avoid recursion in the case that type === "newListener"! Before
    // adding it to the listeners, first emit "newListener".
    if (events.newListener) {
      target.emit('newListener', type,
          listener.listener ? listener.listener : listener);

      // Re-assign `events` because a newListener handler could have caused the
      // this._events to be assigned to a new object
      events = target._events;
    }
    existing = events[type];
  }

  if (!existing) {
    // Optimize the case of one listener. Don't need the extra array object.
    existing = events[type] = listener;
    ++target._eventsCount;
  } else {
    if (typeof existing === 'function') {
      // Adding the second element, need to change to array.
      existing = events[type] =
          prepend ? [listener, existing] : [existing, listener];
    } else {
      // If we've already got an array, just append.
      if (prepend) {
        existing.unshift(listener);
      } else {
        existing.push(listener);
      }
    }

    // Check for listener leak
    if (!existing.warned) {
      m = $getMaxListeners(target);
      if (m && m > 0 && existing.length > m) {
        existing.warned = true;
        var w = new Error('Possible EventEmitter memory leak detected. ' +
            existing.length + ' "' + String(type) + '" listeners ' +
            'added. Use emitter.setMaxListeners() to ' +
            'increase limit.');
        w.name = 'MaxListenersExceededWarning';
        w.emitter = target;
        w.type = type;
        w.count = existing.length;
        if (typeof console === 'object' && console.warn) {
          console.warn('%s: %s', w.name, w.message);
        }
      }
    }
  }

  return target;
}

EventEmitter.prototype.addListener = function addListener(type, listener) {
  return _addListener(this, type, listener, false);
};

EventEmitter.prototype.on = EventEmitter.prototype.addListener;

EventEmitter.prototype.prependListener =
    function prependListener(type, listener) {
      return _addListener(this, type, listener, true);
    };

function onceWrapper() {
  if (!this.fired) {
    this.target.removeListener(this.type, this.wrapFn);
    this.fired = true;
    switch (arguments.length) {
      case 0:
        return this.listener.call(this.target);
      case 1:
        return this.listener.call(this.target, arguments[0]);
      case 2:
        return this.listener.call(this.target, arguments[0], arguments[1]);
      case 3:
        return this.listener.call(this.target, arguments[0], arguments[1],
            arguments[2]);
      default:
        var args = new Array(arguments.length);
        for (var i = 0; i < args.length; ++i)
          args[i] = arguments[i];
        this.listener.apply(this.target, args);
    }
  }
}

function _onceWrap(target, type, listener) {
  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };
  var wrapped = bind.call(onceWrapper, state);
  wrapped.listener = listener;
  state.wrapFn = wrapped;
  return wrapped;
}

EventEmitter.prototype.once = function once(type, listener) {
  if (typeof listener !== 'function')
    throw new TypeError('"listener" argument must be a function');
  this.on(type, _onceWrap(this, type, listener));
  return this;
};

EventEmitter.prototype.prependOnceListener =
    function prependOnceListener(type, listener) {
      if (typeof listener !== 'function')
        throw new TypeError('"listener" argument must be a function');
      this.prependListener(type, _onceWrap(this, type, listener));
      return this;
    };

// Emits a 'removeListener' event if and only if the listener was removed.
EventEmitter.prototype.removeListener =
    function removeListener(type, listener) {
      var list, events, position, i, originalListener;

      if (typeof listener !== 'function')
        throw new TypeError('"listener" argument must be a function');

      events = this._events;
      if (!events)
        return this;

      list = events[type];
      if (!list)
        return this;

      if (list === listener || list.listener === listener) {
        if (--this._eventsCount === 0)
          this._events = objectCreate(null);
        else {
          delete events[type];
          if (events.removeListener)
            this.emit('removeListener', type, list.listener || listener);
        }
      } else if (typeof list !== 'function') {
        position = -1;

        for (i = list.length - 1; i >= 0; i--) {
          if (list[i] === listener || list[i].listener === listener) {
            originalListener = list[i].listener;
            position = i;
            break;
          }
        }

        if (position < 0)
          return this;

        if (position === 0)
          list.shift();
        else
          spliceOne(list, position);

        if (list.length === 1)
          events[type] = list[0];

        if (events.removeListener)
          this.emit('removeListener', type, originalListener || listener);
      }

      return this;
    };

EventEmitter.prototype.removeAllListeners =
    function removeAllListeners(type) {
      var listeners, events, i;

      events = this._events;
      if (!events)
        return this;

      // not listening for removeListener, no need to emit
      if (!events.removeListener) {
        if (arguments.length === 0) {
          this._events = objectCreate(null);
          this._eventsCount = 0;
        } else if (events[type]) {
          if (--this._eventsCount === 0)
            this._events = objectCreate(null);
          else
            delete events[type];
        }
        return this;
      }

      // emit removeListener for all listeners on all events
      if (arguments.length === 0) {
        var keys = objectKeys(events);
        var key;
        for (i = 0; i < keys.length; ++i) {
          key = keys[i];
          if (key === 'removeListener') continue;
          this.removeAllListeners(key);
        }
        this.removeAllListeners('removeListener');
        this._events = objectCreate(null);
        this._eventsCount = 0;
        return this;
      }

      listeners = events[type];

      if (typeof listeners === 'function') {
        this.removeListener(type, listeners);
      } else if (listeners) {
        // LIFO order
        for (i = listeners.length - 1; i >= 0; i--) {
          this.removeListener(type, listeners[i]);
        }
      }

      return this;
    };

function _listeners(target, type, unwrap) {
  var events = target._events;

  if (!events)
    return [];

  var evlistener = events[type];
  if (!evlistener)
    return [];

  if (typeof evlistener === 'function')
    return unwrap ? [evlistener.listener || evlistener] : [evlistener];

  return unwrap ? unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);
}

EventEmitter.prototype.listeners = function listeners(type) {
  return _listeners(this, type, true);
};

EventEmitter.prototype.rawListeners = function rawListeners(type) {
  return _listeners(this, type, false);
};

EventEmitter.listenerCount = function(emitter, type) {
  if (typeof emitter.listenerCount === 'function') {
    return emitter.listenerCount(type);
  } else {
    return listenerCount.call(emitter, type);
  }
};

EventEmitter.prototype.listenerCount = listenerCount;
function listenerCount(type) {
  var events = this._events;

  if (events) {
    var evlistener = events[type];

    if (typeof evlistener === 'function') {
      return 1;
    } else if (evlistener) {
      return evlistener.length;
    }
  }

  return 0;
}

EventEmitter.prototype.eventNames = function eventNames() {
  return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [];
};

// About 1.5x faster than the two-arg version of Array#splice().
function spliceOne(list, index) {
  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)
    list[i] = list[k];
  list.pop();
}

function arrayClone(arr, n) {
  var copy = new Array(n);
  for (var i = 0; i < n; ++i)
    copy[i] = arr[i];
  return copy;
}

function unwrapListeners(arr) {
  var ret = new Array(arr.length);
  for (var i = 0; i < ret.length; ++i) {
    ret[i] = arr[i].listener || arr[i];
  }
  return ret;
}

function objectCreatePolyfill(proto) {
  var F = function() {};
  F.prototype = proto;
  return new F;
}
function objectKeysPolyfill(obj) {
  var keys = [];
  for (var k in obj) if (Object.prototype.hasOwnProperty.call(obj, k)) {
    keys.push(k);
  }
  return k;
}
function functionBindPolyfill(context) {
  var fn = this;
  return function () {
    return fn.apply(context, arguments);
  };
}

},{}],9:[function(require,module,exports){
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/

'use strict';
/* eslint-disable no-unused-vars */
var getOwnPropertySymbols = Object.getOwnPropertySymbols;
var hasOwnProperty = Object.prototype.hasOwnProperty;
var propIsEnumerable = Object.prototype.propertyIsEnumerable;

function toObject(val) {
	if (val === null || val === undefined) {
		throw new TypeError('Object.assign cannot be called with null or undefined');
	}

	return Object(val);
}

function shouldUseNative() {
	try {
		if (!Object.assign) {
			return false;
		}

		// Detect buggy property enumeration order in older V8 versions.

		// https://bugs.chromium.org/p/v8/issues/detail?id=4118
		var test1 = new String('abc');  // eslint-disable-line no-new-wrappers
		test1[5] = 'de';
		if (Object.getOwnPropertyNames(test1)[0] === '5') {
			return false;
		}

		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
		var test2 = {};
		for (var i = 0; i < 10; i++) {
			test2['_' + String.fromCharCode(i)] = i;
		}
		var order2 = Object.getOwnPropertyNames(test2).map(function (n) {
			return test2[n];
		});
		if (order2.join('') !== '0123456789') {
			return false;
		}

		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
		var test3 = {};
		'abcdefghijklmnopqrst'.split('').forEach(function (letter) {
			test3[letter] = letter;
		});
		if (Object.keys(Object.assign({}, test3)).join('') !==
				'abcdefghijklmnopqrst') {
			return false;
		}

		return true;
	} catch (err) {
		// We don't expect any of the above to throw, but better to be safe.
		return false;
	}
}

module.exports = shouldUseNative() ? Object.assign : function (target, source) {
	var from;
	var to = toObject(target);
	var symbols;

	for (var s = 1; s < arguments.length; s++) {
		from = Object(arguments[s]);

		for (var key in from) {
			if (hasOwnProperty.call(from, key)) {
				to[key] = from[key];
			}
		}

		if (getOwnPropertySymbols) {
			symbols = getOwnPropertySymbols(from);
			for (var i = 0; i < symbols.length; i++) {
				if (propIsEnumerable.call(from, symbols[i])) {
					to[symbols[i]] = from[symbols[i]];
				}
			}
		}
	}

	return to;
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJiaW4vanMtb3V0L2FwcC9BcHAuanMiLCJiaW4vanMtb3V0L2FwcC9hY3Rpb25zL09yZ2FuaXphdGlvbkFjdGlvbnMuanMiLCJiaW4vanMtb3V0L2FwcC9jb21wb25lbnRzL09yZ2FuaXphdGlvbkFjY2Vzc1JpZ2h0Rm9ybS5qcyIsImJpbi9qcy1vdXQvYXBwL2NvbXBvbmVudHMvT3JnYW5pemF0aW9uQXBwLmpzIiwiYmluL2pzLW91dC9hcHAvY29uc3RhbnRzL09yZ2FuaXphdGlvbkNvbnN0YW50cy5qcyIsImJpbi9qcy1vdXQvYXBwL3NlcnZpY2VzL09yZ2FuaXphdGlvblNlcnZpY2VzLmpzIiwiYmluL2pzLW91dC9hcHAvc3RvcmVzL09yZ2FuaXphdGlvblN0b3JlLmpzIiwibm9kZV9tb2R1bGVzL2V2ZW50cy9ldmVudHMuanMiLCJub2RlX21vZHVsZXMvb2JqZWN0LWFzc2lnbi9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0tBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM2dCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIlwidXNlIHN0cmljdFwiO1xyXG4vLyDCqSAyMDAxLTIwMTUgSU5PVnggU29sdXRpb25zLCBJbmMuXHJcbi8vIDExNCBQYWNpZmljYSBTdWl0ZSAzMDAsIElydmluZSwgQ0EgOTI2MTggVVNBXHJcbi8vIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vXHJcbi8vIFRoaXMgc29mdHdhcmUgaXMgY29uZmlkZW50aWFsLCBwcm9wcmlldGFyeSBhbmQgdW5wdWJsaXNoZWQgcHJvcGVydHkgb2ZcclxuLy8gSU5PVnggU29sdXRpb25zLCBJbmMuICBJdCBtYXkgTk9UIGJlIGNvcGllZCBpbiBwYXJ0IG9yIGluIHdob2xlIG9uIGFueVxyXG4vLyBtZWRpdW0sIGVpdGhlciBlbGVjdHJvbmljIG9yIHByaW50ZWQsIHdpdGhvdXQgdGhlIGV4cHJlc3Mgd3JpdHRlbiBjb25zZW50XHJcbi8vIG9mIElOT1Z4IFNvbHV0aW9ucywgSW5jLlxyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbnZhciBSZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcclxudmFyIFJlYWN0RE9NID0gcmVxdWlyZShcInJlYWN0LWRvbVwiKTtcclxudmFyIE9yZ2FuaXphdGlvbkFwcCA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvT3JnYW5pemF0aW9uQXBwXCIpO1xyXG50cnkge1xyXG4gICAgSW5vdnhMb2FkZXIudXBkYXRlSGVscCgnb3JnYW5pemF0aW9uLWFjY2Vzcy1yaWdodHMnKTtcclxufVxyXG5jYXRjaCAoZSkge1xyXG59XHJcblJlYWN0RE9NLnJlbmRlcihSZWFjdC5jcmVhdGVFbGVtZW50KE9yZ2FuaXphdGlvbkFwcCwgbnVsbCksIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcmdhbml6YXRpb25BcHAnKSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gwqkgMjAwMS0yMDE1IElOT1Z4IFNvbHV0aW9ucywgSW5jLlxyXG4vLyAxMTQgUGFjaWZpY2EgU3VpdGUgMzAwLCBJcnZpbmUsIENBIDkyNjE4IFVTQVxyXG4vLyBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vL1xyXG4vLyBUaGlzIHNvZnR3YXJlIGlzIGNvbmZpZGVudGlhbCwgcHJvcHJpZXRhcnkgYW5kIHVucHVibGlzaGVkIHByb3BlcnR5IG9mXHJcbi8vIElOT1Z4IFNvbHV0aW9ucywgSW5jLiAgSXQgbWF5IE5PVCBiZSBjb3BpZWQgaW4gcGFydCBvciBpbiB3aG9sZSBvbiBhbnlcclxuLy8gbWVkaXVtLCBlaXRoZXIgZWxlY3Ryb25pYyBvciBwcmludGVkLCB3aXRob3V0IHRoZSBleHByZXNzIHdyaXR0ZW4gY29uc2VudFxyXG4vLyBvZiBJTk9WeCBTb2x1dGlvbnMsIEluYy5cclxudmFyIElub3Z4ID0gcmVxdWlyZShcInNoYXJlZC53ZWIuY2xpZW50XCIpO1xyXG52YXIgT3JnYW5pemF0aW9uU2VydmljZSA9IHJlcXVpcmUoXCIuLy4uL3NlcnZpY2VzL09yZ2FuaXphdGlvblNlcnZpY2VzXCIpO1xyXG52YXIgT3JnYW5pemF0aW9uQ29uc3RhbnRzID0gcmVxdWlyZShcIi4vLi4vY29uc3RhbnRzL09yZ2FuaXphdGlvbkNvbnN0YW50c1wiKTtcclxudmFyIE9yZ2FuaXphdGlvblN0b3JlID0gcmVxdWlyZShcIi4vLi4vc3RvcmVzL09yZ2FuaXphdGlvblN0b3JlXCIpO1xyXG52YXIgU3lzdGVtQWN0aW9ucyA9IElub3Z4LlNoYXJlZC5TeXN0ZW0uQWN0aW9ucztcclxudmFyIFN5c3RlbVN0b3JlID0gSW5vdnguU2hhcmVkLlN5c3RlbS5TdG9yZTtcclxuZnVuY3Rpb24gX2VuZEVkaXQoKSB7XHJcbiAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICBhY3Rpb25UeXBlOiBPcmdhbml6YXRpb25Db25zdGFudHMuT1JHQU5JWkFUSU9OX0VORF9FRElUXHJcbiAgICB9KTtcclxufVxyXG52YXIgT3JnYW5pemF0aW9uQWN0aW9ucyA9IHtcclxuICAgIGdldEFsbFJvb3Q6IGZ1bmN0aW9uIChpdGVtVHlwZSwgY2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIGlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgIE9yZ2FuaXphdGlvblNlcnZpY2UuZ2V0QWxsUm9vdChpdGVtVHlwZSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IE9yZ2FuaXphdGlvbkNvbnN0YW50cy5PUkdBTklaQVRJT05fUkVDSUVWRV9ST09UUyxcclxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIGlnbm9yZURlZmF1bHRFcnJvcik7XHJcbiAgICB9LFxyXG4gICAgZ2V0Q2hpbGRyZW46IGZ1bmN0aW9uIChvcmdhbml6YXRpb24sIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgT3JnYW5pemF0aW9uU2VydmljZS5nZXRDaGlsZHJlbihvcmdhbml6YXRpb24sIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkICYmIGNhbGxiYWNrICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiBPcmdhbml6YXRpb25Db25zdGFudHMuT1JHQU5JWkFUSU9OX1JFQ0lFVkVfQ0hJTERSRU4sXHJcbiAgICAgICAgICAgICAgICBwYXJlbnQ6IG9yZ2FuaXphdGlvbixcclxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkgeyB9KTtcclxuICAgIH0sXHJcbiAgICBiZWdpbkVkaXQ6IGZ1bmN0aW9uIChvcmdhbml6YXRpb24pIHtcclxuICAgICAgICBPcmdhbml6YXRpb25TZXJ2aWNlLmdldEFsbFJvbGVzKGZ1bmN0aW9uIChyb2xlcykge1xyXG4gICAgICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IE9yZ2FuaXphdGlvbkNvbnN0YW50cy5PUkdBTklaQVRJT05fUkVDRUlWRV9BTExfUk9MRVMsXHJcbiAgICAgICAgICAgICAgICByb2xlczogcm9sZXNcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIE9yZ2FuaXphdGlvblNlcnZpY2UuZ2V0T3JnYW5pemF0aW9uRGV0YWlsKG9yZ2FuaXphdGlvbi5JRCwgZnVuY3Rpb24gKG9yZ2FuaXphdGlvbikge1xyXG4gICAgICAgICAgICAgICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogT3JnYW5pemF0aW9uQ29uc3RhbnRzLk9SR0FOSVpBVElPTl9CRUdJTl9FRElULFxyXG4gICAgICAgICAgICAgICAgICAgIG9yZ2FuaXphdGlvbjogb3JnYW5pemF0aW9uXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGVuZEVkaXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoT3JnYW5pemF0aW9uU3RvcmUuZ2V0SGFzQ2hhbmdlcygpKSB7XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZGlzcGxheVNhdmVDaGFuZ2VzRGlhbG9nKHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IElub3Z4TG9hZGVyLnQoXCJjb21tb246bXNnQm94LnNhdmVDaGFuZ2VzXCIpLFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsQ2FsbGJhY2s6IF9lbmRFZGl0LFxyXG4gICAgICAgICAgICAgICAgY29uZmlybUNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgT3JnYW5pemF0aW9uQWN0aW9ucy5lZGl0KE9yZ2FuaXphdGlvblN0b3JlLmdldEN1cnJlbnRQYXJlbnQoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgX2VuZEVkaXQoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZWRpdDogZnVuY3Rpb24gKHBhcmVudCwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoIVN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhPcmdhbml6YXRpb25Db25zdGFudHMuT1JHQU5JWkFUSU9OX0VESVQpKSB7XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuYmVnaW5BY3Rpb24oT3JnYW5pemF0aW9uQ29uc3RhbnRzLk9SR0FOSVpBVElPTl9FRElUKTtcclxuICAgICAgICAgICAgT3JnYW5pemF0aW9uU2VydmljZS5lZGl0T3JnYW5pemF0aW9uKE9yZ2FuaXphdGlvblN0b3JlLmdldEVkaXRPcmdhbml6YXRpb24oKSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwYXJlbnQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vSGFyZCBjb2RlZCBmb3Igbm93XHJcbiAgICAgICAgICAgICAgICAgICAgT3JnYW5pemF0aW9uQWN0aW9ucy5nZXRBbGxSb290KDMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgT3JnYW5pemF0aW9uQWN0aW9ucy5nZXRDaGlsZHJlbihwYXJlbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBfZW5kRWRpdCgpO1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oT3JnYW5pemF0aW9uQ29uc3RhbnRzLk9SR0FOSVpBVElPTl9FRElUKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihPcmdhbml6YXRpb25Db25zdGFudHMuT1JHQU5JWkFUSU9OX0VESVQpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgICAgICBhY3Rpb25UeXBlOiBPcmdhbml6YXRpb25Db25zdGFudHMuT1JHQU5JWkFUSU9OX1VQREFURV9PUkdBTklaQVRJT04sXHJcbiAgICAgICAgICAgIGtleToga2V5LFxyXG4gICAgICAgICAgICB2YWx1ZTogdmFsdWVcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxubW9kdWxlLmV4cG9ydHMgPSBPcmdhbml6YXRpb25BY3Rpb25zO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Pcmdhbml6YXRpb25BY3Rpb25zLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG4vLyDCqSAyMDAxLTIwMTUgSU5PVnggU29sdXRpb25zLCBJbmMuXHJcbi8vIDExNCBQYWNpZmljYSBTdWl0ZSAzMDAsIElydmluZSwgQ0EgOTI2MTggVVNBXHJcbi8vIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vXHJcbi8vIFRoaXMgc29mdHdhcmUgaXMgY29uZmlkZW50aWFsLCBwcm9wcmlldGFyeSBhbmQgdW5wdWJsaXNoZWQgcHJvcGVydHkgb2ZcclxuLy8gSU5PVnggU29sdXRpb25zLCBJbmMuICBJdCBtYXkgTk9UIGJlIGNvcGllZCBpbiBwYXJ0IG9yIGluIHdob2xlIG9uIGFueVxyXG4vLyBtZWRpdW0sIGVpdGhlciBlbGVjdHJvbmljIG9yIHByaW50ZWQsIHdpdGhvdXQgdGhlIGV4cHJlc3Mgd3JpdHRlbiBjb25zZW50XHJcbi8vIG9mIElOT1Z4IFNvbHV0aW9ucywgSW5jLlxyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxudmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkge1xyXG4gICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHtcclxuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxyXG4gICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfTtcclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59O1xyXG52YXIgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XHJcbnZhciBPcmdhbml6YXRpb25TdG9yZSA9IHJlcXVpcmUoXCIuLy4uL3N0b3Jlcy9Pcmdhbml6YXRpb25TdG9yZVwiKTtcclxudmFyIE9yZ2FuaXphdGlvbkNvbnN0YW50cyA9IHJlcXVpcmUoXCIuLy4uL2NvbnN0YW50cy9Pcmdhbml6YXRpb25Db25zdGFudHNcIik7XHJcbnZhciBPcmdhbml6YXRpb25BY3Rpb25zID0gcmVxdWlyZShcIi4vLi4vYWN0aW9ucy9Pcmdhbml6YXRpb25BY3Rpb25zXCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBTeXN0ZW1BY3Rpb25zID0gSW5vdnguU2hhcmVkLlN5c3RlbS5BY3Rpb25zO1xyXG52YXIgU3lzdGVtU3RvcmUgPSBJbm92eC5TaGFyZWQuU3lzdGVtLlN0b3JlO1xyXG52YXIgTGlzdEhlbHBlciA9IElub3Z4LlNoYXJlZC5Db21tb24uTGlzdEhlbHBlcjtcclxudmFyIElub3Z4Q29udHJvbHMgPSBJbm92eC5TaGFyZWQuQ29udHJvbHM7XHJcbnZhciBPUkdBTklaQVRJT05fSElFUkFSQ0hZID0gJ0hpZXJhcmNoeSc7XHJcbmZ1bmN0aW9uIGdldEFjdGlvbkluUHJvZ3Jlc3MoKSB7XHJcbiAgICByZXR1cm4gU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKE9yZ2FuaXphdGlvbkNvbnN0YW50cy5PUkdBTklaQVRJT05fRURJVCk7XHJcbn1cclxudmFyIF9hY3Rpb25JblByb2dyZXNzTXNnO1xyXG5mdW5jdGlvbiBnZXRGb3JtU3RhdGUoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHBhcmVudDogT3JnYW5pemF0aW9uU3RvcmUuZ2V0Q3VycmVudFBhcmVudCgpLFxyXG4gICAgICAgIG9yZ2FuaXphdGlvbjogT3JnYW5pemF0aW9uU3RvcmUuZ2V0RWRpdE9yZ2FuaXphdGlvbigpLFxyXG4gICAgICAgIGlzQWN0aW9uSW5Qcm9ncmVzczogZ2V0QWN0aW9uSW5Qcm9ncmVzcygpLFxyXG4gICAgICAgIGFjdGlvbkluUHJvZ3Jlc3NNc2c6IF9hY3Rpb25JblByb2dyZXNzTXNnLFxyXG4gICAgICAgIGFsbFJvbGVzOiBPcmdhbml6YXRpb25TdG9yZS5nZXRBbGxSb2xlcygpXHJcbiAgICB9O1xyXG59XHJcbnZhciBPcmdhbml6YXRpb25BY2Nlc3NSaWdodEZvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoT3JnYW5pemF0aW9uQWNjZXNzUmlnaHRGb3JtLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gT3JnYW5pemF0aW9uQWNjZXNzUmlnaHRGb3JtKHByb3BzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX29uQ2hhbmdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIE9yZ2FuaXphdGlvbkFjdGlvbnMudXBkYXRlKGV2ZW50LnRhcmdldC5uYW1lLCBldmVudC50YXJnZXQudmFsdWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2xvYWRTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoZ2V0Rm9ybVN0YXRlKCkpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX3N5c3RlbUNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICAgICAgaXNBY3Rpb25JblByb2dyZXNzOiBnZXRBY3Rpb25JblByb2dyZXNzKClcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fc2F2ZU9yZ2FuaXphdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgT3JnYW5pemF0aW9uQWN0aW9ucy5lZGl0KF90aGlzLnN0YXRlLnBhcmVudCk7XHJcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgYWN0aW9uSW5Qcm9ncmVzc01zZzogSW5vdnhMb2FkZXIudCgnb3JnYW5pemF0aW9uOmZvcm0uc2F2aW5nJykgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBPcmdhbml6YXRpb25BY3Rpb25zLmVuZEVkaXQoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9pc0VtcHR5T3JOdWxsID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZSAmJiB2YWx1ZS5sZW5ndGggPiAwO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX3ZhbGlkYXRlT3JnYW5pemF0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgZm9ybSA9IF90aGlzLnJlZnNbXCJuYW1lXCJdO1xyXG4gICAgICAgICAgICBpZiAoZm9ybS5pc1ZhbGlkKF90aGlzLl9pc0VtcHR5T3JOdWxsKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2NoZWNrRm9yVW5zYXZlZENoYW5nZXMgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKE9yZ2FuaXphdGlvblN0b3JlLmdldEhhc0NoYW5nZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSBJbm92eExvYWRlci50KCdjb21tb246bXNnQm94LmJyb3dzZXJTYXZlQ2hhbmdlcycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl92YWxpZGF0ZVJlbW92ZSA9IGZ1bmN0aW9uIChzZWxlY3RlZFJvbGVzKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZWN0ZWRSb2xlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvbGUgPSBzZWxlY3RlZFJvbGVzW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvbGUuSW5oZXJpdGVkICE9PSB1bmRlZmluZWQgJiYgcm9sZS5Jbmhlcml0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZU9iamVjdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogSW5vdnhMb2FkZXIudCgnb3JnYW5pemF0aW9uOmVycm9yLmluaGVyaXRlZFJvbGUnKVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5kaXNwbGF5RXJyb3JNZXNzYWdlKG1lc3NhZ2VPYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9yb2xlc0NoYW5nZWQgPSBmdW5jdGlvbiAocm9sZXMpIHtcclxuICAgICAgICAgICAgT3JnYW5pemF0aW9uQWN0aW9ucy51cGRhdGUoXCJBc3NpZ25lZFJvbGVzXCIsIHJvbGVzKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9hdmFpbGFibGVSb2xlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGFsbFJvbGVzID0gX3RoaXMuc3RhdGUuYWxsUm9sZXM7XHJcbiAgICAgICAgICAgIHZhciBhc3NpZ25lZFJvbGVzID0gX3RoaXMuc3RhdGUub3JnYW5pemF0aW9uLkFzc2lnbmVkUm9sZXM7XHJcbiAgICAgICAgICAgIHZhciByb2xlcyA9IGFsbFJvbGVzLmZpbHRlcihmdW5jdGlvbiAocm9sZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFzc2lnbmVkUm9sZXMuZmlsdGVyKGZ1bmN0aW9uIChhc3NpZ25lZFJvbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm9sZS5JRCA9PT0gYXNzaWduZWRSb2xlLklEICYmIHJvbGUuTmFtZSA9PT0gYXNzaWduZWRSb2xlLk5hbWU7XHJcbiAgICAgICAgICAgICAgICB9KS5sZW5ndGggPT09IDA7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcm9sZXM7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5zdGF0ZSA9IGdldEZvcm1TdGF0ZSgpO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIE9yZ2FuaXphdGlvbkFjY2Vzc1JpZ2h0Rm9ybS5wcm90b3R5cGUuY29tcG9uZW50V2lsbE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIExpc3RIZWxwZXIuc29ydCh0aGlzLnN0YXRlLmFsbFJvbGVzLCBcIk5hbWVcIik7XHJcbiAgICAgICAgTGlzdEhlbHBlci5zb3J0KHRoaXMuc3RhdGUub3JnYW5pemF0aW9uLkFzc2lnbmVkUm9sZXMsIFwiTmFtZVwiKTtcclxuICAgIH07XHJcbiAgICBPcmdhbml6YXRpb25BY2Nlc3NSaWdodEZvcm0ucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVcGRhdGUgPSBmdW5jdGlvbiAobmV4dFByb3BzLCBuZXh0U3RhdGUpIHtcclxuICAgICAgICBMaXN0SGVscGVyLnNvcnQodGhpcy5zdGF0ZS5vcmdhbml6YXRpb24uQXNzaWduZWRSb2xlcywgXCJOYW1lXCIpO1xyXG4gICAgfTtcclxuICAgIE9yZ2FuaXphdGlvbkFjY2Vzc1JpZ2h0Rm9ybS5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgT3JnYW5pemF0aW9uU3RvcmUuYWRkQ2hhbmdlTGlzdGVuZXIodGhpcy5fbG9hZFN0YXRlKTtcclxuICAgICAgICBTeXN0ZW1TdG9yZS5hZGRDaGFuZ2VMaXN0ZW5lcih0aGlzLl9zeXN0ZW1DaGFuZ2UpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLl9jaGVja0ZvclVuc2F2ZWRDaGFuZ2VzKTtcclxuICAgIH07XHJcbiAgICBPcmdhbml6YXRpb25BY2Nlc3NSaWdodEZvcm0ucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIE9yZ2FuaXphdGlvblN0b3JlLnJlbW92ZUNoYW5nZUxpc3RlbmVyKHRoaXMuX2xvYWRTdGF0ZSk7XHJcbiAgICAgICAgU3lzdGVtU3RvcmUucmVtb3ZlQ2hhbmdlTGlzdGVuZXIodGhpcy5fc3lzdGVtQ2hhbmdlKTtcclxuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlcyk7XHJcbiAgICB9O1xyXG4gICAgT3JnYW5pemF0aW9uQWNjZXNzUmlnaHRGb3JtLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGlucHV0T2JqID0ge1xyXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdmb3JtLWNvbnRyb2wnLFxyXG4gICAgICAgICAgICB0eXBlOiAndGV4dCdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBPcmdhbml6YXRpb24gPSB0aGlzLnN0YXRlLm9yZ2FuaXphdGlvbjtcclxuICAgICAgICAvLyBPbmx5IGEgcm9vdCBpdGVtIG1heSBnZXQgaXRzIG5hbWVzIGNoYW5nZWQuXHJcbiAgICAgICAgLy8gdmFyIGVkaXRhYmxlID0gKE9yZ2FuaXphdGlvbi5Jbmhlcml0QWNjZXNzUmlnaHRGcm9tSUQpID8gZmFsc2UgOiB0cnVlO1xyXG4gICAgICAgIC8vIFJlbmFtaW5nIG9mIHRoZSByb290cyBpcyB0ZW1wb3JhcmlseSBkaXNhYmxlZCAoYnVnICMxMTU5MSlcclxuICAgICAgICB2YXIgZWRpdGFibGUgPSBmYWxzZTtcclxuICAgICAgICB2YXIgT3JnYW5pemF0aW9uTmFtZUlucHV0ID0galF1ZXJ5LmV4dGVuZCh7XHJcbiAgICAgICAgICAgIG5hbWU6ICdOYW1lJyxcclxuICAgICAgICAgICAgdmFsdWU6IE9yZ2FuaXphdGlvbi5OYW1lXHJcbiAgICAgICAgfSwgaW5wdXRPYmopO1xyXG4gICAgICAgIHZhciBoZWFkZXIgPSBJbm92eExvYWRlci50KCdvcmdhbml6YXRpb246Zm9ybS5oZWFkZXInKTtcclxuICAgICAgICB2YXIgbmFtZUZpZWxkSGVhZGVyID0gSW5vdnhMb2FkZXIudChcIm9yZ2FuaXphdGlvbjpjb21tb24ub3JnYW5pemF0aW9uTmFtZVwiKTtcclxuICAgICAgICBpZiAoT3JnYW5pemF0aW9uLkluaGVyaXRBY2Nlc3NSaWdodEZyb21JRCkge1xyXG4gICAgICAgICAgICBuYW1lRmllbGRIZWFkZXIgPSBJbm92eExvYWRlci50KFwib3JnYW5pemF0aW9uOmNvbW1vbi53b3Jrc3BhY2VcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLlN0YXRpY0hlYWRlckZvcm0sIHsgdGl0bGU6IGhlYWRlciwgc2F2ZU9uQ2xpY2s6IHRoaXMuX3NhdmVPcmdhbml6YXRpb24sIGNhbmNlbE9uQ2xpY2s6IHRoaXMuX2NhbmNlbCwgaXNBY3Rpb25JblByb2dyZXNzOiB0aGlzLnN0YXRlLmlzQWN0aW9uSW5Qcm9ncmVzcywgaW5Qcm9ncmVzc01lc3NhZ2U6IHRoaXMuc3RhdGUuYWN0aW9uSW5Qcm9ncmVzc01zZyB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBcIlwiLmNvbmNhdChuYW1lRmllbGRIZWFkZXIsIFwiKlwiKSwgaW5wdXROYW1lOiAnTmFtZScgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5SZXF1aXJlZElucHV0LCBfX2Fzc2lnbih7fSwgT3JnYW5pemF0aW9uTmFtZUlucHV0LCB7IG9uQ2hhbmdlQ2FsbGJhY2s6IHRoaXMuX29uQ2hhbmdlLCByZWY6IFwibmFtZVwiLCByZWFkT25seTogIWVkaXRhYmxlIH0pKSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IElub3Z4TG9hZGVyLnQoXCJvcmdhbml6YXRpb246Y29tbW9uLnJvbGVzXCIpLCBpbnB1dE5hbWU6ICdSb2xlJyB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwiZWRpdC1yb2xlLWRlc2NyaXB0aW9uXCIgfSwgSW5vdnhMb2FkZXIudChcIm9yZ2FuaXphdGlvbjpmb3JtLnJvbGVzRGVzY3JpcHRpb25cIikpKSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLk9iamVjdEFzc2lnbm1lbnQsIHsgbGVmdEhlYWRlcjogSW5vdnhMb2FkZXIudCgnb3JnYW5pemF0aW9uOmZvcm0uYXZhaWxhYmxlUm9sZXMnKSwgcmlnaHRIZWFkZXI6IElub3Z4TG9hZGVyLnQoJ29yZ2FuaXphdGlvbjpmb3JtLmFzc2lnbmVkUm9sZXMnKSwgYXZhaWxhYmxlT2JqZWN0czogdGhpcy5fYXZhaWxhYmxlUm9sZXMoKSwgYXNzaWduZWRPYmplY3RzOiB0aGlzLnN0YXRlLm9yZ2FuaXphdGlvbi5Bc3NpZ25lZFJvbGVzLCBpbmhlcml0ZWRPYmplY3RBdHRyaWJ1dGU6IFwiSW5oZXJpdGVkXCIsIG9uVmFsdWVDaGFuZ2VkOiB0aGlzLl9yb2xlc0NoYW5nZWQsIHZhbGlkYXRlUmVtb3ZlOiB0aGlzLl92YWxpZGF0ZVJlbW92ZSB9KSkpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBPcmdhbml6YXRpb25BY2Nlc3NSaWdodEZvcm07XHJcbn0oUmVhY3QuQ29tcG9uZW50KSk7XHJcbm1vZHVsZS5leHBvcnRzID0gT3JnYW5pemF0aW9uQWNjZXNzUmlnaHRGb3JtO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Pcmdhbml6YXRpb25BY2Nlc3NSaWdodEZvcm0uanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIMKpIDIwMDEtMjAxNSBJTk9WeCBTb2x1dGlvbnMsIEluYy5cclxuLy8gMTE0IFBhY2lmaWNhIFN1aXRlIDMwMCwgSXJ2aW5lLCBDQSA5MjYxOCBVU0FcclxuLy8gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy9cclxuLy8gVGhpcyBzb2Z0d2FyZSBpcyBjb25maWRlbnRpYWwsIHByb3ByaWV0YXJ5IGFuZCB1bnB1Ymxpc2hlZCBwcm9wZXJ0eSBvZlxyXG4vLyBJTk9WeCBTb2x1dGlvbnMsIEluYy4gIEl0IG1heSBOT1QgYmUgY29waWVkIGluIHBhcnQgb3IgaW4gd2hvbGUgb24gYW55XHJcbi8vIG1lZGl1bSwgZWl0aGVyIGVsZWN0cm9uaWMgb3IgcHJpbnRlZCwgd2l0aG91dCB0aGUgZXhwcmVzcyB3cml0dGVuIGNvbnNlbnRcclxuLy8gb2YgSU5PVnggU29sdXRpb25zLCBJbmMuXHJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBmdW5jdGlvbiAoKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXHJcbiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn07XHJcbnZhciBSZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcclxudmFyIElub3Z4ID0gcmVxdWlyZShcInNoYXJlZC53ZWIuY2xpZW50XCIpO1xyXG52YXIgT3JnYW5pemF0aW9uQWN0aW9ucyA9IHJlcXVpcmUoXCIuLy4uL2FjdGlvbnMvT3JnYW5pemF0aW9uQWN0aW9uc1wiKTtcclxudmFyIE9yZ2FuaXphdGlvblN0b3JlID0gcmVxdWlyZShcIi4vLi4vc3RvcmVzL09yZ2FuaXphdGlvblN0b3JlXCIpO1xyXG52YXIgT3JnYW5pemF0aW9uQWNjZXNzUmlnaHRGb3JtID0gcmVxdWlyZShcIi4vT3JnYW5pemF0aW9uQWNjZXNzUmlnaHRGb3JtXCIpO1xyXG52YXIgU3lzdGVtQWN0aW9ucyA9IElub3Z4LlNoYXJlZC5TeXN0ZW0uQWN0aW9ucztcclxudmFyIFN5c3RlbVN0b3JlID0gSW5vdnguU2hhcmVkLlN5c3RlbS5TdG9yZTtcclxudmFyIElub3Z4Q29udHJvbHMgPSBJbm92eC5TaGFyZWQuQ29udHJvbHM7XHJcbnZhciBVcmxVdGlsaXRpZXMgPSBJbm92eC5TaGFyZWQuQ29tbW9uLlVybFV0aWxpdGllcztcclxudmFyIE9SR0FOSVpBVElPTl9URVJNSU5BTCA9ICdSb290JztcclxudmFyIF9icmVhZGNydW1iTGlzdCA9IFtdO1xyXG52YXIgX2N1cnJlbnRMZXZlbCA9IE9yZ2FuaXphdGlvblN0b3JlLmdldEN1cnJlbnRPcmdhbml6YXRpb24oKTtcclxuZnVuY3Rpb24gZ2V0T3JnYW5pemF0aW9uU3RhdGUoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGJyZWFkY3J1bWJMaXN0OiBfYnJlYWRjcnVtYkxpc3QsXHJcbiAgICAgICAgY3VycmVudExpc3Q6IE9yZ2FuaXphdGlvblN0b3JlLmdldEN1cnJlbnRMaXN0KCksXHJcbiAgICAgICAgaXNFZGl0aW5nOiBPcmdhbml6YXRpb25TdG9yZS5nZXRJc0VkaXRpbmcoKVxyXG4gICAgfTtcclxufVxyXG52YXIgT3JnYW5pemF0aW9uQXBwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKE9yZ2FuaXphdGlvbkFwcCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIE9yZ2FuaXphdGlvbkFwcChwcm9wcywgY29udGV4dCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsICdvcmdhbml6YXRpb24nLCBwcm9wcywgY29udGV4dCkgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5fb25DaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKGdldE9yZ2FuaXphdGlvblN0YXRlKCkpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2luaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF9icmVhZGNydW1iTGlzdC5wdXNoKHsgTmFtZTogSW5vdnhMb2FkZXIudCgnb3JnYW5pemF0aW9uOmJyZWFkY3J1bWIucm9vdCcpLCBPcmdhbml6YXRpb25UeXBlOiBcIlJvb3RcIiwgSUQ6ICcnLCBEZXNjcmlwdGlvbjogJycsIFR5cGVOYW1lOiAnJywgVmVyc2lvblRva2VuOiAnJywgSXRlbVR5cGU6IDMgfSk7XHJcbiAgICAgICAgICAgIF9jdXJyZW50TGV2ZWwgPSBfYnJlYWRjcnVtYkxpc3RbMF07XHJcbiAgICAgICAgICAgIC8vSGFyZCBjb2RlZCBmb3Igbm93XHJcbiAgICAgICAgICAgIE9yZ2FuaXphdGlvbkFjdGlvbnMuZ2V0QWxsUm9vdCgzLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5fYXBwTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5faGFuZGxlUGVybWlzc2lvbkVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fYnJlYWRjcnVtYkNsaWNrZWQgPSBmdW5jdGlvbiAob3JnYW5pemF0aW9uKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmRleCA9IF9icmVhZGNydW1iTGlzdC5pbmRleE9mKG9yZ2FuaXphdGlvbikgKyAxO1xyXG4gICAgICAgICAgICBfYnJlYWRjcnVtYkxpc3Quc3BsaWNlKGluZGV4LCBfYnJlYWRjcnVtYkxpc3QubGVuZ3RoIC0gaW5kZXgpO1xyXG4gICAgICAgICAgICBpZiAob3JnYW5pemF0aW9uLk9yZ2FuaXphdGlvblR5cGUgPT0gXCJSb290XCIpIHtcclxuICAgICAgICAgICAgICAgIC8vSGFyZCBjb2RlZCBmb3Igbm93XHJcbiAgICAgICAgICAgICAgICBPcmdhbml6YXRpb25BY3Rpb25zLmdldEFsbFJvb3QoMywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9jdXJyZW50TGV2ZWwgPSBvcmdhbml6YXRpb247XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLl9nZXRDaGlsZHJlbihvcmdhbml6YXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5faXRlbUNsaWNrZWQgPSBmdW5jdGlvbiAob3JnYW5pemF0aW9uKSB7XHJcbiAgICAgICAgICAgIF9icmVhZGNydW1iTGlzdC5wdXNoKG9yZ2FuaXphdGlvbik7XHJcbiAgICAgICAgICAgIF90aGlzLl9nZXRDaGlsZHJlbihvcmdhbml6YXRpb24pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2VkaXRJdGVtID0gZnVuY3Rpb24gKG9yZ2FuaXphdGlvbikge1xyXG4gICAgICAgICAgICBPcmdhbml6YXRpb25BY3Rpb25zLmJlZ2luRWRpdChqUXVlcnkuZXh0ZW5kKHRydWUsIHt9LCBvcmdhbml6YXRpb24pKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9lbmRFZGl0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBPcmdhbml6YXRpb25BY3Rpb25zLmVuZEVkaXQoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLnN0YXRlID0gZ2V0T3JnYW5pemF0aW9uU3RhdGUoKTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBPcmdhbml6YXRpb25BcHAucHJvdG90eXBlLl9nZXRDaGlsZHJlbiA9IGZ1bmN0aW9uIChvcmdhbml6YXRpb24pIHtcclxuICAgICAgICBPcmdhbml6YXRpb25BY3Rpb25zLmdldENoaWxkcmVuKG9yZ2FuaXphdGlvbiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfY3VycmVudExldmVsID0gb3JnYW5pemF0aW9uO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIE9yZ2FuaXphdGlvbkFwcC5wcm90b3R5cGUuY29tcG9uZW50V2lsbE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuY29tcG9uZW50V2lsbE1vdW50QmFzZSgpO1xyXG4gICAgfTtcclxuICAgIE9yZ2FuaXphdGlvbkFwcC5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgT3JnYW5pemF0aW9uU3RvcmUuYWRkQ2hhbmdlTGlzdGVuZXIodGhpcy5fb25DaGFuZ2UpO1xyXG4gICAgfTtcclxuICAgIE9yZ2FuaXphdGlvbkFwcC5wcm90b3R5cGUuY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgT3JnYW5pemF0aW9uU3RvcmUucmVtb3ZlQ2hhbmdlTGlzdGVuZXIodGhpcy5fb25DaGFuZ2UpO1xyXG4gICAgfTtcclxuICAgIE9yZ2FuaXphdGlvbkFwcC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGNhbkVkaXQgPSB0cnVlLCBoYXNDaGlsZHJlbiA9IHRydWUsIGhlYWRlclRpdGxlID0gSW5vdnhMb2FkZXIudCgnb3JnYW5pemF0aW9uOnRhYmxlLnByb2plY3QnKTtcclxuICAgICAgICBpZiAoX2N1cnJlbnRMZXZlbC5Pcmdhbml6YXRpb25UeXBlICE9PSBPUkdBTklaQVRJT05fVEVSTUlOQUwpIHtcclxuICAgICAgICAgICAgLy9jYW5FZGl0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGhhc0NoaWxkcmVuID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGhlYWRlclRpdGxlID0gSW5vdnhMb2FkZXIudCgnb3JnYW5pemF0aW9uOnRhYmxlLndvcmtzcGFjZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgd2lkdGggPSA4MDtcclxuICAgICAgICB2YXIgbmFtZVdpZHRoID0geyB3aWR0aDogJ2NhbGMoMTAwJScgKyAoY2FuRWRpdCA/ICcgLSAnICsgd2lkdGggKyAncHgnIDogJycpICsgJyknIH07XHJcbiAgICAgICAgdmFyIGVkaXRXaWR0aCA9IHsgd2lkdGg6IHdpZHRoICsgJ3B4JyB9O1xyXG4gICAgICAgIHZhciBhbHQgPSB0cnVlO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuc3RhdGUuY3VycmVudExpc3QubWFwKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGFsdCA9ICFhbHQ7XHJcbiAgICAgICAgICAgIHZhciBuYW1lUHJvcHMgPSB7XHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICd0Zy1jZWxsJyxcclxuICAgICAgICAgICAgICAgIHN0eWxlOiBuYW1lV2lkdGhcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaWYgKGhhc0NoaWxkcmVuKSB7XHJcbiAgICAgICAgICAgICAgICBuYW1lUHJvcHMub25DbGljayA9IGZ1bmN0aW9uICgpIHsgX3RoaXMuX2l0ZW1DbGlja2VkKGl0ZW0pOyB9O1xyXG4gICAgICAgICAgICAgICAgbmFtZVByb3BzLmNsYXNzTmFtZSArPSAnIGVkaXQnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDtcclxuICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInRnLXJvdyBcIi5jb25jYXQoYWx0ID8gJ3RnLWFsdCcgOiAnJyksIGtleTogaXRlbS5JRCwgc3R5bGU6IHsgd2lkdGg6ICcxMDAlJyB9IH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIF9fYXNzaWduKHt9LCBuYW1lUHJvcHMpLCBpdGVtLk5hbWUpLFxyXG4gICAgICAgICAgICAgICAgY2FuRWRpdFxyXG4gICAgICAgICAgICAgICAgICAgID8gUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IHN0eWxlOiBlZGl0V2lkdGgsIGNsYXNzTmFtZTogJ3RnLWNlbGwnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJhXCIsIHsgY2xhc3NOYW1lOiBcImdyaWQtYnV0dG9uXCIsIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9lZGl0SXRlbShpdGVtKTsgfSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1wZW5jaWxcIiB9KSkpXHJcbiAgICAgICAgICAgICAgICAgICAgOiBudWxsKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIGljb25IZWFkZXJQcm9wcyA9IHtcclxuICAgICAgICAgICAgaWNvblVybDogXCJcIi5jb25jYXQoVXJsVXRpbGl0aWVzLmdldEJhc2VBcHBsaWNhdGlvblVybCgpLCBcIi9pbWFnZXMvT3JnYW5pemF0aW9uLnBuZ1wiKSxcclxuICAgICAgICAgICAgaWNvbkF0dDogeyBhbHQ6IFwiT3JnYW5pemF0aW9uIEFjY2VzcyBSaWdodHNcIiB9LFxyXG4gICAgICAgICAgICB0aXRsZTogSW5vdnhMb2FkZXIudCgnb3JnYW5pemF0aW9uOmhlYWRlci5vcmdhbml6YXRpb24nKSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuQ29yZS5SZWFjdExvYWRlciwgeyBhcHBSZWFkeTogdGhpcy5pc0FwcExvYWRlZCgpLCBlcnJvclN0YXR1czogdGhpcy5fZXJyb3JTdGF0dXMgfSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJvcmdhbml6YXRpb24tYXBwLWNvbnRlbnRcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuTGF5b3V0Lkljb25IZWFkZXIsIF9fYXNzaWduKHt9LCBpY29uSGVhZGVyUHJvcHMpKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5CcmVhZGNydW1iUGFuZWwsIHsgYnJlYWRjcnVtYjogdGhpcy5zdGF0ZS5icmVhZGNydW1iTGlzdCwgb25DbGljazogdGhpcy5fYnJlYWRjcnVtYkNsaWNrZWQsIGRpc3BsYXlQcm9wOiAnTmFtZScgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInRnLXRhYmxlXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ0Zy1ncmlkXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGctaGVhZGVyLWNvbnRhaW5lclwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ0Zy1oZWFkZXIgdGctcm93XCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJ0Zy1jZWxsXCIsIHN0eWxlOiBuYW1lV2lkdGggfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGctaGRyLWN0bnRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGctdGl0bGVcIiB9LCBoZWFkZXJUaXRsZSkpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuRWRpdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInRnLWNlbGxcIiwgc3R5bGU6IGVkaXRXaWR0aCB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGctaGRyLWN0bnRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInRnLXRpdGxlXCIgfSwgSW5vdnhMb2FkZXIudCgnb3JnYW5pemF0aW9uOnRhYmxlLmFjdGlvbicpKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IG51bGwpKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGctY29udGVudC1jb250YWluZXJcIiwgc3R5bGU6IHsgb3ZlcmZsb3c6ICdpbml0aWFsJyB9IH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiAndGctY29udGVudCcgfSwgY2hpbGRyZW4pKSkpKSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuQ29udHJvbHMuTW9kYWxTbGlkZXIsIHsgaXNPcGVuOiB0aGlzLnN0YXRlLmlzRWRpdGluZywgb25DbG9zZTogdGhpcy5fZW5kRWRpdCB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChPcmdhbml6YXRpb25BY2Nlc3NSaWdodEZvcm0sIG51bGwpKSkpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBPcmdhbml6YXRpb25BcHA7XHJcbn0oSW5vdnguU2hhcmVkLlJlYWN0RXh0LkJhc2VBcHBDb21wb25lbnQpKTtcclxubW9kdWxlLmV4cG9ydHMgPSBPcmdhbml6YXRpb25BcHA7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPU9yZ2FuaXphdGlvbkFwcC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gwqkgMjAwMS0yMDE1IElOT1Z4IFNvbHV0aW9ucywgSW5jLlxyXG4vLyAxMTQgUGFjaWZpY2EgU3VpdGUgMzAwLCBJcnZpbmUsIENBIDkyNjE4IFVTQVxyXG4vLyBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vL1xyXG4vLyBUaGlzIHNvZnR3YXJlIGlzIGNvbmZpZGVudGlhbCwgcHJvcHJpZXRhcnkgYW5kIHVucHVibGlzaGVkIHByb3BlcnR5IG9mXHJcbi8vIElOT1Z4IFNvbHV0aW9ucywgSW5jLiAgSXQgbWF5IE5PVCBiZSBjb3BpZWQgaW4gcGFydCBvciBpbiB3aG9sZSBvbiBhbnlcclxuLy8gbWVkaXVtLCBlaXRoZXIgZWxlY3Ryb25pYyBvciBwcmludGVkLCB3aXRob3V0IHRoZSBleHByZXNzIHdyaXR0ZW4gY29uc2VudFxyXG4vLyBvZiBJTk9WeCBTb2x1dGlvbnMsIEluYy5cclxudmFyIGtleW1pcnJvciA9IHJlcXVpcmUoXCJmYmpzL2xpYi9rZXltaXJyb3JcIik7XHJcbnZhciBPcmdhbml6YXRpb25Db25zdGFudHMgPSBrZXltaXJyb3Ioe1xyXG4gICAgT1JHQU5JWkFUSU9OX1JFQ0lFVkVfUk9PVFM6IG51bGwsXHJcbiAgICBPUkdBTklaQVRJT05fUkVDSUVWRV9DSElMRFJFTjogbnVsbCxcclxuICAgIE9SR0FOSVpBVElPTl9CRUdJTl9FRElUOiBudWxsLFxyXG4gICAgT1JHQU5JWkFUSU9OX0VORF9FRElUOiBudWxsLFxyXG4gICAgT1JHQU5JWkFUSU9OX0VESVQ6IG51bGwsXHJcbiAgICBPUkdBTklaQVRJT05fVVBEQVRFX09SR0FOSVpBVElPTjogbnVsbCxcclxuICAgIE9SR0FOSVpBVElPTl9SRUNFSVZFX0FMTF9ST0xFUzogbnVsbFxyXG59KTtcclxubW9kdWxlLmV4cG9ydHMgPSBPcmdhbml6YXRpb25Db25zdGFudHM7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPU9yZ2FuaXphdGlvbkNvbnN0YW50cy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gwqkgMjAwMS0yMDE1IElOT1Z4IFNvbHV0aW9ucywgSW5jLlxyXG4vLyAxMTQgUGFjaWZpY2EgU3VpdGUgMzAwLCBJcnZpbmUsIENBIDkyNjE4IFVTQVxyXG4vLyBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vL1xyXG4vLyBUaGlzIHNvZnR3YXJlIGlzIGNvbmZpZGVudGlhbCwgcHJvcHJpZXRhcnkgYW5kIHVucHVibGlzaGVkIHByb3BlcnR5IG9mXHJcbi8vIElOT1Z4IFNvbHV0aW9ucywgSW5jLiAgSXQgbWF5IE5PVCBiZSBjb3BpZWQgaW4gcGFydCBvciBpbiB3aG9sZSBvbiBhbnlcclxuLy8gbWVkaXVtLCBlaXRoZXIgZWxlY3Ryb25pYyBvciBwcmludGVkLCB3aXRob3V0IHRoZSBleHByZXNzIHdyaXR0ZW4gY29uc2VudFxyXG4vLyBvZiBJTk9WeCBTb2x1dGlvbnMsIEluYy5cclxudmFyIElub3Z4ID0gcmVxdWlyZShcInNoYXJlZC53ZWIuY2xpZW50XCIpO1xyXG52YXIgYXNzaWduID0gcmVxdWlyZShcIm9iamVjdC1hc3NpZ25cIik7XHJcbnZhciBVcmxVdGlsaXRpZXMgPSBJbm92eC5TaGFyZWQuQ29tbW9uLlVybFV0aWxpdGllcztcclxudmFyIHJvbGVVcmwgPSBcIlwiLmNvbmNhdChVcmxVdGlsaXRpZXMuZ2V0QXBpVXJsKCksIFwiL09yZ2FuaXphdGlvbkFwaS9hcGkvcm9sZVwiKTtcclxudmFyIHVybCA9IFwiXCIuY29uY2F0KFVybFV0aWxpdGllcy5nZXRBcGlVcmwoKSwgXCIvT3JnYW5pemF0aW9uQXBpL2FwaS9vcmdhbml6YXRpb25cIik7XHJcbnZhciBPcmdhbml6YXRpb25TZXJ2aWNlcyA9IGFzc2lnbih7fSwgSW5vdnguU2hhcmVkLkZsdXguQmFzZVNlcnZpY2UsIHtcclxuICAgIGdldEFsbFJvb3Q6IGZ1bmN0aW9uIChpdGVtVHlwZSwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBpZ25vcmVEZWZhdWx0RXJyb3IpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuZ2V0KFwiXCIuY29uY2F0KHVybCwgXCIvUm9vdEl0ZW1zXCIpLCB7IGl0ZW1UeXBlOiBpdGVtVHlwZSB9LCBmdW5jdGlvbiAocmV0RGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2socmV0RGF0YSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGlmICghaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZ2V0Q2hpbGRyZW46IGZ1bmN0aW9uIChvcmdhbml6YXRpb24sIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5nZXQoXCJcIi5jb25jYXQodXJsLCBcIi9DaGlsZHJlbkl0ZW1zXCIpLCB7IGlkOiBvcmdhbml6YXRpb24uSUQsIGl0ZW1UeXBlOiAzIH0sIGZ1bmN0aW9uIChyZXREYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXREYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBnZXRPcmdhbml6YXRpb25EZXRhaWw6IGZ1bmN0aW9uIChpZCwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmdldChcIlwiLmNvbmNhdCh1cmwsIFwiL0l0ZW1EZXRhaWxcIiksIHsgaWQ6IGlkLCBpdGVtVHlwZTogMyB9LCBmdW5jdGlvbiAocmV0RGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2socmV0RGF0YSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZWRpdE9yZ2FuaXphdGlvbjogZnVuY3Rpb24gKGl0ZW1EZXRhaWwsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvVXBkYXRlSXRlbVwiKSwgaXRlbURldGFpbCwgZnVuY3Rpb24gKHJldERhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHJldERhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGdldEFsbFJvbGVzOiBmdW5jdGlvbiAoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmdldChyb2xlVXJsLCBudWxsLCBmdW5jdGlvbiAocmV0RGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2socmV0RGF0YSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5tb2R1bGUuZXhwb3J0cyA9IE9yZ2FuaXphdGlvblNlcnZpY2VzO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Pcmdhbml6YXRpb25TZXJ2aWNlcy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gwqkgMjAwMS0yMDE1IElOT1Z4IFNvbHV0aW9ucywgSW5jLlxyXG4vLyAxMTQgUGFjaWZpY2EgU3VpdGUgMzAwLCBJcnZpbmUsIENBIDkyNjE4IFVTQVxyXG4vLyBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vL1xyXG4vLyBUaGlzIHNvZnR3YXJlIGlzIGNvbmZpZGVudGlhbCwgcHJvcHJpZXRhcnkgYW5kIHVucHVibGlzaGVkIHByb3BlcnR5IG9mXHJcbi8vIElOT1Z4IFNvbHV0aW9ucywgSW5jLiAgSXQgbWF5IE5PVCBiZSBjb3BpZWQgaW4gcGFydCBvciBpbiB3aG9sZSBvbiBhbnlcclxuLy8gbWVkaXVtLCBlaXRoZXIgZWxlY3Ryb25pYyBvciBwcmludGVkLCB3aXRob3V0IHRoZSBleHByZXNzIHdyaXR0ZW4gY29uc2VudFxyXG4vLyBvZiBJTk9WeCBTb2x1dGlvbnMsIEluYy5cclxudmFyIE5vZGVFdmVudHMgPSByZXF1aXJlKFwiZXZlbnRzXCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBhc3NpZ24gPSByZXF1aXJlKFwib2JqZWN0LWFzc2lnblwiKTtcclxudmFyIE9yZ2FuaXphdGlvbkNvbnN0YW50cyA9IHJlcXVpcmUoXCIuLy4uL2NvbnN0YW50cy9Pcmdhbml6YXRpb25Db25zdGFudHNcIik7XHJcbnZhciBFdmVudEVtaXR0ZXIgPSBOb2RlRXZlbnRzLkV2ZW50RW1pdHRlcjtcclxudmFyIENIQU5HRV9FVkVOVCA9ICdPcmdhbml6YXRpb24uY2hhbmdlJztcclxudmFyIF9wYXJlbnQgPSBudWxsLCBfY3VycmVudExpc3QgPSBbXSwgX2N1cnJlbnRPcmdhbml6YXRpb24gPSBnZXRCbGFua09yZ2FuaXphdGlvbigpLCBfZWRpdE9yZ2FuaXphdGlvbiA9IGdldEJsYW5rT3JnYW5pemF0aW9uRGV0YWlsKCksIF9oYXNDaGFuZ2VzID0gZmFsc2UsIF9pc0VkaXRpbmdPcmdhbml6YXRpb24gPSBmYWxzZSwgX2FsbFJvbGVzID0gW107XHJcbmZ1bmN0aW9uIHNldEVkaXRpbmdPcmdhbml6YXRpb24ob3JnYW5pemF0aW9uKSB7XHJcbiAgICBfY3VycmVudE9yZ2FuaXphdGlvbiA9IG9yZ2FuaXphdGlvbjtcclxuICAgIF9pc0VkaXRpbmdPcmdhbml6YXRpb24gPSB0cnVlO1xyXG4gICAgX2VkaXRPcmdhbml6YXRpb24gPSAkLmV4dGVuZCh7fSwgb3JnYW5pemF0aW9uKTtcclxuICAgIF9oYXNDaGFuZ2VzID0gZmFsc2U7XHJcbn1cclxuZnVuY3Rpb24gX3VwZGF0ZUVkaXRPcmdhbml6YXRpb24oa2V5LCB2YWx1ZSkge1xyXG4gICAgX2VkaXRPcmdhbml6YXRpb25ba2V5XSA9IHZhbHVlO1xyXG4gICAgX2hhc0NoYW5nZXMgPSB0cnVlO1xyXG59XHJcbmZ1bmN0aW9uIGZpbmlzaEVkaXRpbmcoKSB7XHJcbiAgICBfaXNFZGl0aW5nT3JnYW5pemF0aW9uID0gZmFsc2U7XHJcbiAgICBfaGFzQ2hhbmdlcyA9IGZhbHNlO1xyXG59XHJcbmZ1bmN0aW9uIGdldEJsYW5rT3JnYW5pemF0aW9uKCkge1xyXG4gICAgcmV0dXJuIHsgTmFtZTogJycsIE9yZ2FuaXphdGlvblR5cGU6ICcnLCBJRDogJycsIERlc2NyaXB0aW9uOiAnJywgVHlwZU5hbWU6ICcnLCBWZXJzaW9uVG9rZW46ICcnLCBJdGVtVHlwZTogMyB9O1xyXG59XHJcbmZ1bmN0aW9uIGdldEJsYW5rT3JnYW5pemF0aW9uRGV0YWlsKCkge1xyXG4gICAgcmV0dXJuIHsgTmFtZTogJycsIE9yZ2FuaXphdGlvblR5cGU6ICcnLCBJRDogJycsIERlc2NyaXB0aW9uOiAnJywgVHlwZU5hbWU6ICcnLCBWZXJzaW9uVG9rZW46ICcnLCBJdGVtVHlwZTogMywgQXNzaWduZWRSb2xlczogW10sIEluaGVyaXRBY2Nlc3NSaWdodEZyb21JRDogXCJcIiwgVHlwZTogbnVsbCB9O1xyXG59XHJcbnZhciBPcmdhbml6YXRpb25TdG9yZSA9IGFzc2lnbih7fSwgRXZlbnRFbWl0dGVyLnByb3RvdHlwZSwge1xyXG4gICAgZ2V0Q3VycmVudExpc3Q6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2N1cnJlbnRMaXN0O1xyXG4gICAgfSxcclxuICAgIGdldEN1cnJlbnRPcmdhbml6YXRpb246IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2N1cnJlbnRPcmdhbml6YXRpb247XHJcbiAgICB9LFxyXG4gICAgZ2V0RWRpdE9yZ2FuaXphdGlvbjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfZWRpdE9yZ2FuaXphdGlvbjtcclxuICAgIH0sXHJcbiAgICBnZXRDdXJyZW50UGFyZW50OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9wYXJlbnQ7XHJcbiAgICB9LFxyXG4gICAgZ2V0SGFzQ2hhbmdlczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfaGFzQ2hhbmdlcztcclxuICAgIH0sXHJcbiAgICBnZXRJc0VkaXRpbmc6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2lzRWRpdGluZ09yZ2FuaXphdGlvbjtcclxuICAgIH0sXHJcbiAgICBnZXRBbGxSb2xlczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfYWxsUm9sZXM7XHJcbiAgICB9LFxyXG4gICAgZW1pdENoYW5nZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuZW1pdChDSEFOR0VfRVZFTlQpO1xyXG4gICAgfSxcclxuICAgIGFkZENoYW5nZUxpc3RlbmVyOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgICAgICB0aGlzLm9uKENIQU5HRV9FVkVOVCwgY2FsbGJhY2spO1xyXG4gICAgfSxcclxuICAgIHJlbW92ZUNoYW5nZUxpc3RlbmVyOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKENIQU5HRV9FVkVOVCwgY2FsbGJhY2spO1xyXG4gICAgfVxyXG59KTtcclxuSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5yZWdpc3RlcihmdW5jdGlvbiAocGF5bG9hZCkge1xyXG4gICAgc3dpdGNoIChwYXlsb2FkLmFjdGlvblR5cGUpIHtcclxuICAgICAgICBjYXNlIE9yZ2FuaXphdGlvbkNvbnN0YW50cy5PUkdBTklaQVRJT05fQkVHSU5fRURJVDpcclxuICAgICAgICAgICAgc2V0RWRpdGluZ09yZ2FuaXphdGlvbihwYXlsb2FkLm9yZ2FuaXphdGlvbik7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgT3JnYW5pemF0aW9uQ29uc3RhbnRzLk9SR0FOSVpBVElPTl9FTkRfRURJVDpcclxuICAgICAgICAgICAgZmluaXNoRWRpdGluZygpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIE9yZ2FuaXphdGlvbkNvbnN0YW50cy5PUkdBTklaQVRJT05fUkVDSUVWRV9ST09UUzpcclxuICAgICAgICBjYXNlIE9yZ2FuaXphdGlvbkNvbnN0YW50cy5PUkdBTklaQVRJT05fUkVDSUVWRV9DSElMRFJFTjpcclxuICAgICAgICAgICAgX3BhcmVudCA9IHBheWxvYWQucGFyZW50O1xyXG4gICAgICAgICAgICBfY3VycmVudExpc3QgPSBwYXlsb2FkLmRhdGE7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgT3JnYW5pemF0aW9uQ29uc3RhbnRzLk9SR0FOSVpBVElPTl9VUERBVEVfT1JHQU5JWkFUSU9OOlxyXG4gICAgICAgICAgICBfdXBkYXRlRWRpdE9yZ2FuaXphdGlvbihwYXlsb2FkLmtleSwgcGF5bG9hZC52YWx1ZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgT3JnYW5pemF0aW9uQ29uc3RhbnRzLk9SR0FOSVpBVElPTl9SRUNFSVZFX0FMTF9ST0xFUzpcclxuICAgICAgICAgICAgX2FsbFJvbGVzID0gcGF5bG9hZC5yb2xlcztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDogcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBPcmdhbml6YXRpb25TdG9yZS5lbWl0Q2hhbmdlKCk7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxufSk7XHJcbm1vZHVsZS5leHBvcnRzID0gT3JnYW5pemF0aW9uU3RvcmU7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPU9yZ2FuaXphdGlvblN0b3JlLmpzLm1hcCIsIi8vIENvcHlyaWdodCBKb3llbnQsIEluYy4gYW5kIG90aGVyIE5vZGUgY29udHJpYnV0b3JzLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhXG4vLyBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlXG4vLyBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmdcbi8vIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCxcbi8vIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXRcbi8vIHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZVxuLy8gZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWRcbi8vIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1Ncbi8vIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0Zcbi8vIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU5cbi8vIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLFxuLy8gREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SXG4vLyBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFXG4vLyBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG52YXIgb2JqZWN0Q3JlYXRlID0gT2JqZWN0LmNyZWF0ZSB8fCBvYmplY3RDcmVhdGVQb2x5ZmlsbFxudmFyIG9iamVjdEtleXMgPSBPYmplY3Qua2V5cyB8fCBvYmplY3RLZXlzUG9seWZpbGxcbnZhciBiaW5kID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgfHwgZnVuY3Rpb25CaW5kUG9seWZpbGxcblxuZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkge1xuICBpZiAoIXRoaXMuX2V2ZW50cyB8fCAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMsICdfZXZlbnRzJykpIHtcbiAgICB0aGlzLl9ldmVudHMgPSBvYmplY3RDcmVhdGUobnVsbCk7XG4gICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwO1xuICB9XG5cbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gdGhpcy5fbWF4TGlzdGVuZXJzIHx8IHVuZGVmaW5lZDtcbn1cbm1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyO1xuXG4vLyBCYWNrd2FyZHMtY29tcGF0IHdpdGggbm9kZSAwLjEwLnhcbkV2ZW50RW1pdHRlci5FdmVudEVtaXR0ZXIgPSBFdmVudEVtaXR0ZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX2V2ZW50cyA9IHVuZGVmaW5lZDtcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX21heExpc3RlbmVycyA9IHVuZGVmaW5lZDtcblxuLy8gQnkgZGVmYXVsdCBFdmVudEVtaXR0ZXJzIHdpbGwgcHJpbnQgYSB3YXJuaW5nIGlmIG1vcmUgdGhhbiAxMCBsaXN0ZW5lcnMgYXJlXG4vLyBhZGRlZCB0byBpdC4gVGhpcyBpcyBhIHVzZWZ1bCBkZWZhdWx0IHdoaWNoIGhlbHBzIGZpbmRpbmcgbWVtb3J5IGxlYWtzLlxudmFyIGRlZmF1bHRNYXhMaXN0ZW5lcnMgPSAxMDtcblxudmFyIGhhc0RlZmluZVByb3BlcnR5O1xudHJ5IHtcbiAgdmFyIG8gPSB7fTtcbiAgaWYgKE9iamVjdC5kZWZpbmVQcm9wZXJ0eSkgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sICd4JywgeyB2YWx1ZTogMCB9KTtcbiAgaGFzRGVmaW5lUHJvcGVydHkgPSBvLnggPT09IDA7XG59IGNhdGNoIChlcnIpIHsgaGFzRGVmaW5lUHJvcGVydHkgPSBmYWxzZSB9XG5pZiAoaGFzRGVmaW5lUHJvcGVydHkpIHtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEV2ZW50RW1pdHRlciwgJ2RlZmF1bHRNYXhMaXN0ZW5lcnMnLCB7XG4gICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRNYXhMaXN0ZW5lcnM7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uKGFyZykge1xuICAgICAgLy8gY2hlY2sgd2hldGhlciB0aGUgaW5wdXQgaXMgYSBwb3NpdGl2ZSBudW1iZXIgKHdob3NlIHZhbHVlIGlzIHplcm8gb3JcbiAgICAgIC8vIGdyZWF0ZXIgYW5kIG5vdCBhIE5hTikuXG4gICAgICBpZiAodHlwZW9mIGFyZyAhPT0gJ251bWJlcicgfHwgYXJnIDwgMCB8fCBhcmcgIT09IGFyZylcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJkZWZhdWx0TWF4TGlzdGVuZXJzXCIgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlcicpO1xuICAgICAgZGVmYXVsdE1heExpc3RlbmVycyA9IGFyZztcbiAgICB9XG4gIH0pO1xufSBlbHNlIHtcbiAgRXZlbnRFbWl0dGVyLmRlZmF1bHRNYXhMaXN0ZW5lcnMgPSBkZWZhdWx0TWF4TGlzdGVuZXJzO1xufVxuXG4vLyBPYnZpb3VzbHkgbm90IGFsbCBFbWl0dGVycyBzaG91bGQgYmUgbGltaXRlZCB0byAxMC4gVGhpcyBmdW5jdGlvbiBhbGxvd3Ncbi8vIHRoYXQgdG8gYmUgaW5jcmVhc2VkLiBTZXQgdG8gemVybyBmb3IgdW5saW1pdGVkLlxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5zZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbiBzZXRNYXhMaXN0ZW5lcnMobikge1xuICBpZiAodHlwZW9mIG4gIT09ICdudW1iZXInIHx8IG4gPCAwIHx8IGlzTmFOKG4pKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wiblwiIGFyZ3VtZW50IG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtcbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gbjtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5mdW5jdGlvbiAkZ2V0TWF4TGlzdGVuZXJzKHRoYXQpIHtcbiAgaWYgKHRoYXQuX21heExpc3RlbmVycyA9PT0gdW5kZWZpbmVkKVxuICAgIHJldHVybiBFdmVudEVtaXR0ZXIuZGVmYXVsdE1heExpc3RlbmVycztcbiAgcmV0dXJuIHRoYXQuX21heExpc3RlbmVycztcbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5nZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbiBnZXRNYXhMaXN0ZW5lcnMoKSB7XG4gIHJldHVybiAkZ2V0TWF4TGlzdGVuZXJzKHRoaXMpO1xufTtcblxuLy8gVGhlc2Ugc3RhbmRhbG9uZSBlbWl0KiBmdW5jdGlvbnMgYXJlIHVzZWQgdG8gb3B0aW1pemUgY2FsbGluZyBvZiBldmVudFxuLy8gaGFuZGxlcnMgZm9yIGZhc3QgY2FzZXMgYmVjYXVzZSBlbWl0KCkgaXRzZWxmIG9mdGVuIGhhcyBhIHZhcmlhYmxlIG51bWJlciBvZlxuLy8gYXJndW1lbnRzIGFuZCBjYW4gYmUgZGVvcHRpbWl6ZWQgYmVjYXVzZSBvZiB0aGF0LiBUaGVzZSBmdW5jdGlvbnMgYWx3YXlzIGhhdmVcbi8vIHRoZSBzYW1lIG51bWJlciBvZiBhcmd1bWVudHMgYW5kIHRodXMgZG8gbm90IGdldCBkZW9wdGltaXplZCwgc28gdGhlIGNvZGVcbi8vIGluc2lkZSB0aGVtIGNhbiBleGVjdXRlIGZhc3Rlci5cbmZ1bmN0aW9uIGVtaXROb25lKGhhbmRsZXIsIGlzRm4sIHNlbGYpIHtcbiAgaWYgKGlzRm4pXG4gICAgaGFuZGxlci5jYWxsKHNlbGYpO1xuICBlbHNlIHtcbiAgICB2YXIgbGVuID0gaGFuZGxlci5sZW5ndGg7XG4gICAgdmFyIGxpc3RlbmVycyA9IGFycmF5Q2xvbmUoaGFuZGxlciwgbGVuKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKVxuICAgICAgbGlzdGVuZXJzW2ldLmNhbGwoc2VsZik7XG4gIH1cbn1cbmZ1bmN0aW9uIGVtaXRPbmUoaGFuZGxlciwgaXNGbiwgc2VsZiwgYXJnMSkge1xuICBpZiAoaXNGbilcbiAgICBoYW5kbGVyLmNhbGwoc2VsZiwgYXJnMSk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uY2FsbChzZWxmLCBhcmcxKTtcbiAgfVxufVxuZnVuY3Rpb24gZW1pdFR3byhoYW5kbGVyLCBpc0ZuLCBzZWxmLCBhcmcxLCBhcmcyKSB7XG4gIGlmIChpc0ZuKVxuICAgIGhhbmRsZXIuY2FsbChzZWxmLCBhcmcxLCBhcmcyKTtcbiAgZWxzZSB7XG4gICAgdmFyIGxlbiA9IGhhbmRsZXIubGVuZ3RoO1xuICAgIHZhciBsaXN0ZW5lcnMgPSBhcnJheUNsb25lKGhhbmRsZXIsIGxlbik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSlcbiAgICAgIGxpc3RlbmVyc1tpXS5jYWxsKHNlbGYsIGFyZzEsIGFyZzIpO1xuICB9XG59XG5mdW5jdGlvbiBlbWl0VGhyZWUoaGFuZGxlciwgaXNGbiwgc2VsZiwgYXJnMSwgYXJnMiwgYXJnMykge1xuICBpZiAoaXNGbilcbiAgICBoYW5kbGVyLmNhbGwoc2VsZiwgYXJnMSwgYXJnMiwgYXJnMyk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uY2FsbChzZWxmLCBhcmcxLCBhcmcyLCBhcmczKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBlbWl0TWFueShoYW5kbGVyLCBpc0ZuLCBzZWxmLCBhcmdzKSB7XG4gIGlmIChpc0ZuKVxuICAgIGhhbmRsZXIuYXBwbHkoc2VsZiwgYXJncyk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uYXBwbHkoc2VsZiwgYXJncyk7XG4gIH1cbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gZW1pdCh0eXBlKSB7XG4gIHZhciBlciwgaGFuZGxlciwgbGVuLCBhcmdzLCBpLCBldmVudHM7XG4gIHZhciBkb0Vycm9yID0gKHR5cGUgPT09ICdlcnJvcicpO1xuXG4gIGV2ZW50cyA9IHRoaXMuX2V2ZW50cztcbiAgaWYgKGV2ZW50cylcbiAgICBkb0Vycm9yID0gKGRvRXJyb3IgJiYgZXZlbnRzLmVycm9yID09IG51bGwpO1xuICBlbHNlIGlmICghZG9FcnJvcilcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgLy8gSWYgdGhlcmUgaXMgbm8gJ2Vycm9yJyBldmVudCBsaXN0ZW5lciB0aGVuIHRocm93LlxuICBpZiAoZG9FcnJvcikge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSlcbiAgICAgIGVyID0gYXJndW1lbnRzWzFdO1xuICAgIGlmIChlciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICB0aHJvdyBlcjsgLy8gVW5oYW5kbGVkICdlcnJvcicgZXZlbnRcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQXQgbGVhc3QgZ2l2ZSBzb21lIGtpbmQgb2YgY29udGV4dCB0byB0aGUgdXNlclxuICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcignVW5oYW5kbGVkIFwiZXJyb3JcIiBldmVudC4gKCcgKyBlciArICcpJyk7XG4gICAgICBlcnIuY29udGV4dCA9IGVyO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBoYW5kbGVyID0gZXZlbnRzW3R5cGVdO1xuXG4gIGlmICghaGFuZGxlcilcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgdmFyIGlzRm4gPSB0eXBlb2YgaGFuZGxlciA9PT0gJ2Z1bmN0aW9uJztcbiAgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgc3dpdGNoIChsZW4pIHtcbiAgICAgIC8vIGZhc3QgY2FzZXNcbiAgICBjYXNlIDE6XG4gICAgICBlbWl0Tm9uZShoYW5kbGVyLCBpc0ZuLCB0aGlzKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMjpcbiAgICAgIGVtaXRPbmUoaGFuZGxlciwgaXNGbiwgdGhpcywgYXJndW1lbnRzWzFdKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMzpcbiAgICAgIGVtaXRUd28oaGFuZGxlciwgaXNGbiwgdGhpcywgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0pO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSA0OlxuICAgICAgZW1pdFRocmVlKGhhbmRsZXIsIGlzRm4sIHRoaXMsIGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdLCBhcmd1bWVudHNbM10pO1xuICAgICAgYnJlYWs7XG4gICAgICAvLyBzbG93ZXJcbiAgICBkZWZhdWx0OlxuICAgICAgYXJncyA9IG5ldyBBcnJheShsZW4gLSAxKTtcbiAgICAgIGZvciAoaSA9IDE7IGkgPCBsZW47IGkrKylcbiAgICAgICAgYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07XG4gICAgICBlbWl0TWFueShoYW5kbGVyLCBpc0ZuLCB0aGlzLCBhcmdzKTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuZnVuY3Rpb24gX2FkZExpc3RlbmVyKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIsIHByZXBlbmQpIHtcbiAgdmFyIG07XG4gIHZhciBldmVudHM7XG4gIHZhciBleGlzdGluZztcblxuICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICBldmVudHMgPSB0YXJnZXQuX2V2ZW50cztcbiAgaWYgKCFldmVudHMpIHtcbiAgICBldmVudHMgPSB0YXJnZXQuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICB0YXJnZXQuX2V2ZW50c0NvdW50ID0gMDtcbiAgfSBlbHNlIHtcbiAgICAvLyBUbyBhdm9pZCByZWN1cnNpb24gaW4gdGhlIGNhc2UgdGhhdCB0eXBlID09PSBcIm5ld0xpc3RlbmVyXCIhIEJlZm9yZVxuICAgIC8vIGFkZGluZyBpdCB0byB0aGUgbGlzdGVuZXJzLCBmaXJzdCBlbWl0IFwibmV3TGlzdGVuZXJcIi5cbiAgICBpZiAoZXZlbnRzLm5ld0xpc3RlbmVyKSB7XG4gICAgICB0YXJnZXQuZW1pdCgnbmV3TGlzdGVuZXInLCB0eXBlLFxuICAgICAgICAgIGxpc3RlbmVyLmxpc3RlbmVyID8gbGlzdGVuZXIubGlzdGVuZXIgOiBsaXN0ZW5lcik7XG5cbiAgICAgIC8vIFJlLWFzc2lnbiBgZXZlbnRzYCBiZWNhdXNlIGEgbmV3TGlzdGVuZXIgaGFuZGxlciBjb3VsZCBoYXZlIGNhdXNlZCB0aGVcbiAgICAgIC8vIHRoaXMuX2V2ZW50cyB0byBiZSBhc3NpZ25lZCB0byBhIG5ldyBvYmplY3RcbiAgICAgIGV2ZW50cyA9IHRhcmdldC5fZXZlbnRzO1xuICAgIH1cbiAgICBleGlzdGluZyA9IGV2ZW50c1t0eXBlXTtcbiAgfVxuXG4gIGlmICghZXhpc3RpbmcpIHtcbiAgICAvLyBPcHRpbWl6ZSB0aGUgY2FzZSBvZiBvbmUgbGlzdGVuZXIuIERvbid0IG5lZWQgdGhlIGV4dHJhIGFycmF5IG9iamVjdC5cbiAgICBleGlzdGluZyA9IGV2ZW50c1t0eXBlXSA9IGxpc3RlbmVyO1xuICAgICsrdGFyZ2V0Ll9ldmVudHNDb3VudDtcbiAgfSBlbHNlIHtcbiAgICBpZiAodHlwZW9mIGV4aXN0aW5nID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAvLyBBZGRpbmcgdGhlIHNlY29uZCBlbGVtZW50LCBuZWVkIHRvIGNoYW5nZSB0byBhcnJheS5cbiAgICAgIGV4aXN0aW5nID0gZXZlbnRzW3R5cGVdID1cbiAgICAgICAgICBwcmVwZW5kID8gW2xpc3RlbmVyLCBleGlzdGluZ10gOiBbZXhpc3RpbmcsIGxpc3RlbmVyXTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgd2UndmUgYWxyZWFkeSBnb3QgYW4gYXJyYXksIGp1c3QgYXBwZW5kLlxuICAgICAgaWYgKHByZXBlbmQpIHtcbiAgICAgICAgZXhpc3RpbmcudW5zaGlmdChsaXN0ZW5lcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBleGlzdGluZy5wdXNoKGxpc3RlbmVyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgbGlzdGVuZXIgbGVha1xuICAgIGlmICghZXhpc3Rpbmcud2FybmVkKSB7XG4gICAgICBtID0gJGdldE1heExpc3RlbmVycyh0YXJnZXQpO1xuICAgICAgaWYgKG0gJiYgbSA+IDAgJiYgZXhpc3RpbmcubGVuZ3RoID4gbSkge1xuICAgICAgICBleGlzdGluZy53YXJuZWQgPSB0cnVlO1xuICAgICAgICB2YXIgdyA9IG5ldyBFcnJvcignUG9zc2libGUgRXZlbnRFbWl0dGVyIG1lbW9yeSBsZWFrIGRldGVjdGVkLiAnICtcbiAgICAgICAgICAgIGV4aXN0aW5nLmxlbmd0aCArICcgXCInICsgU3RyaW5nKHR5cGUpICsgJ1wiIGxpc3RlbmVycyAnICtcbiAgICAgICAgICAgICdhZGRlZC4gVXNlIGVtaXR0ZXIuc2V0TWF4TGlzdGVuZXJzKCkgdG8gJyArXG4gICAgICAgICAgICAnaW5jcmVhc2UgbGltaXQuJyk7XG4gICAgICAgIHcubmFtZSA9ICdNYXhMaXN0ZW5lcnNFeGNlZWRlZFdhcm5pbmcnO1xuICAgICAgICB3LmVtaXR0ZXIgPSB0YXJnZXQ7XG4gICAgICAgIHcudHlwZSA9IHR5cGU7XG4gICAgICAgIHcuY291bnQgPSBleGlzdGluZy5sZW5ndGg7XG4gICAgICAgIGlmICh0eXBlb2YgY29uc29sZSA9PT0gJ29iamVjdCcgJiYgY29uc29sZS53YXJuKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCclczogJXMnLCB3Lm5hbWUsIHcubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGFyZ2V0O1xufVxuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZExpc3RlbmVyID0gZnVuY3Rpb24gYWRkTGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHtcbiAgcmV0dXJuIF9hZGRMaXN0ZW5lcih0aGlzLCB0eXBlLCBsaXN0ZW5lciwgZmFsc2UpO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbiA9IEV2ZW50RW1pdHRlci5wcm90b3R5cGUuYWRkTGlzdGVuZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucHJlcGVuZExpc3RlbmVyID1cbiAgICBmdW5jdGlvbiBwcmVwZW5kTGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgIHJldHVybiBfYWRkTGlzdGVuZXIodGhpcywgdHlwZSwgbGlzdGVuZXIsIHRydWUpO1xuICAgIH07XG5cbmZ1bmN0aW9uIG9uY2VXcmFwcGVyKCkge1xuICBpZiAoIXRoaXMuZmlyZWQpIHtcbiAgICB0aGlzLnRhcmdldC5yZW1vdmVMaXN0ZW5lcih0aGlzLnR5cGUsIHRoaXMud3JhcEZuKTtcbiAgICB0aGlzLmZpcmVkID0gdHJ1ZTtcbiAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCk7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLmNhbGwodGhpcy50YXJnZXQsIGFyZ3VtZW50c1swXSk7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLmNhbGwodGhpcy50YXJnZXQsIGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdKTtcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCwgYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0sXG4gICAgICAgICAgICBhcmd1bWVudHNbMl0pO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7ICsraSlcbiAgICAgICAgICBhcmdzW2ldID0gYXJndW1lbnRzW2ldO1xuICAgICAgICB0aGlzLmxpc3RlbmVyLmFwcGx5KHRoaXMudGFyZ2V0LCBhcmdzKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gX29uY2VXcmFwKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIpIHtcbiAgdmFyIHN0YXRlID0geyBmaXJlZDogZmFsc2UsIHdyYXBGbjogdW5kZWZpbmVkLCB0YXJnZXQ6IHRhcmdldCwgdHlwZTogdHlwZSwgbGlzdGVuZXI6IGxpc3RlbmVyIH07XG4gIHZhciB3cmFwcGVkID0gYmluZC5jYWxsKG9uY2VXcmFwcGVyLCBzdGF0ZSk7XG4gIHdyYXBwZWQubGlzdGVuZXIgPSBsaXN0ZW5lcjtcbiAgc3RhdGUud3JhcEZuID0gd3JhcHBlZDtcbiAgcmV0dXJuIHdyYXBwZWQ7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uIG9uY2UodHlwZSwgbGlzdGVuZXIpIHtcbiAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gJ2Z1bmN0aW9uJylcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gIHRoaXMub24odHlwZSwgX29uY2VXcmFwKHRoaXMsIHR5cGUsIGxpc3RlbmVyKSk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5wcmVwZW5kT25jZUxpc3RlbmVyID1cbiAgICBmdW5jdGlvbiBwcmVwZW5kT25jZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgICB0aGlzLnByZXBlbmRMaXN0ZW5lcih0eXBlLCBfb25jZVdyYXAodGhpcywgdHlwZSwgbGlzdGVuZXIpKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbi8vIEVtaXRzIGEgJ3JlbW92ZUxpc3RlbmVyJyBldmVudCBpZiBhbmQgb25seSBpZiB0aGUgbGlzdGVuZXIgd2FzIHJlbW92ZWQuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyID1cbiAgICBmdW5jdGlvbiByZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikge1xuICAgICAgdmFyIGxpc3QsIGV2ZW50cywgcG9zaXRpb24sIGksIG9yaWdpbmFsTGlzdGVuZXI7XG5cbiAgICAgIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICAgICAgaWYgKCFldmVudHMpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICBsaXN0ID0gZXZlbnRzW3R5cGVdO1xuICAgICAgaWYgKCFsaXN0KVxuICAgICAgICByZXR1cm4gdGhpcztcblxuICAgICAgaWYgKGxpc3QgPT09IGxpc3RlbmVyIHx8IGxpc3QubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7XG4gICAgICAgIGlmICgtLXRoaXMuX2V2ZW50c0NvdW50ID09PSAwKVxuICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgZGVsZXRlIGV2ZW50c1t0eXBlXTtcbiAgICAgICAgICBpZiAoZXZlbnRzLnJlbW92ZUxpc3RlbmVyKVxuICAgICAgICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIGxpc3QubGlzdGVuZXIgfHwgbGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBsaXN0ICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHBvc2l0aW9uID0gLTE7XG5cbiAgICAgICAgZm9yIChpID0gbGlzdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIGlmIChsaXN0W2ldID09PSBsaXN0ZW5lciB8fCBsaXN0W2ldLmxpc3RlbmVyID09PSBsaXN0ZW5lcikge1xuICAgICAgICAgICAgb3JpZ2luYWxMaXN0ZW5lciA9IGxpc3RbaV0ubGlzdGVuZXI7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IGk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocG9zaXRpb24gPCAwKVxuICAgICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAgIGlmIChwb3NpdGlvbiA9PT0gMClcbiAgICAgICAgICBsaXN0LnNoaWZ0KCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBzcGxpY2VPbmUobGlzdCwgcG9zaXRpb24pO1xuXG4gICAgICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMSlcbiAgICAgICAgICBldmVudHNbdHlwZV0gPSBsaXN0WzBdO1xuXG4gICAgICAgIGlmIChldmVudHMucmVtb3ZlTGlzdGVuZXIpXG4gICAgICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIG9yaWdpbmFsTGlzdGVuZXIgfHwgbGlzdGVuZXIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycyA9XG4gICAgZnVuY3Rpb24gcmVtb3ZlQWxsTGlzdGVuZXJzKHR5cGUpIHtcbiAgICAgIHZhciBsaXN0ZW5lcnMsIGV2ZW50cywgaTtcblxuICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICAgICAgaWYgKCFldmVudHMpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAvLyBub3QgbGlzdGVuaW5nIGZvciByZW1vdmVMaXN0ZW5lciwgbm8gbmVlZCB0byBlbWl0XG4gICAgICBpZiAoIWV2ZW50cy5yZW1vdmVMaXN0ZW5lcikge1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgICB0aGlzLl9ldmVudHNDb3VudCA9IDA7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnRzW3R5cGVdKSB7XG4gICAgICAgICAgaWYgKC0tdGhpcy5fZXZlbnRzQ291bnQgPT09IDApXG4gICAgICAgICAgICB0aGlzLl9ldmVudHMgPSBvYmplY3RDcmVhdGUobnVsbCk7XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgZGVsZXRlIGV2ZW50c1t0eXBlXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgLy8gZW1pdCByZW1vdmVMaXN0ZW5lciBmb3IgYWxsIGxpc3RlbmVycyBvbiBhbGwgZXZlbnRzXG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB2YXIga2V5cyA9IG9iamVjdEtleXMoZXZlbnRzKTtcbiAgICAgICAgdmFyIGtleTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICBrZXkgPSBrZXlzW2ldO1xuICAgICAgICAgIGlmIChrZXkgPT09ICdyZW1vdmVMaXN0ZW5lcicpIGNvbnRpbnVlO1xuICAgICAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ3JlbW92ZUxpc3RlbmVyJyk7XG4gICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgbGlzdGVuZXJzID0gZXZlbnRzW3R5cGVdO1xuXG4gICAgICBpZiAodHlwZW9mIGxpc3RlbmVycyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVycyk7XG4gICAgICB9IGVsc2UgaWYgKGxpc3RlbmVycykge1xuICAgICAgICAvLyBMSUZPIG9yZGVyXG4gICAgICAgIGZvciAoaSA9IGxpc3RlbmVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXJzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5mdW5jdGlvbiBfbGlzdGVuZXJzKHRhcmdldCwgdHlwZSwgdW53cmFwKSB7XG4gIHZhciBldmVudHMgPSB0YXJnZXQuX2V2ZW50cztcblxuICBpZiAoIWV2ZW50cylcbiAgICByZXR1cm4gW107XG5cbiAgdmFyIGV2bGlzdGVuZXIgPSBldmVudHNbdHlwZV07XG4gIGlmICghZXZsaXN0ZW5lcilcbiAgICByZXR1cm4gW107XG5cbiAgaWYgKHR5cGVvZiBldmxpc3RlbmVyID09PSAnZnVuY3Rpb24nKVxuICAgIHJldHVybiB1bndyYXAgPyBbZXZsaXN0ZW5lci5saXN0ZW5lciB8fCBldmxpc3RlbmVyXSA6IFtldmxpc3RlbmVyXTtcblxuICByZXR1cm4gdW53cmFwID8gdW53cmFwTGlzdGVuZXJzKGV2bGlzdGVuZXIpIDogYXJyYXlDbG9uZShldmxpc3RlbmVyLCBldmxpc3RlbmVyLmxlbmd0aCk7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24gbGlzdGVuZXJzKHR5cGUpIHtcbiAgcmV0dXJuIF9saXN0ZW5lcnModGhpcywgdHlwZSwgdHJ1ZSk7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJhd0xpc3RlbmVycyA9IGZ1bmN0aW9uIHJhd0xpc3RlbmVycyh0eXBlKSB7XG4gIHJldHVybiBfbGlzdGVuZXJzKHRoaXMsIHR5cGUsIGZhbHNlKTtcbn07XG5cbkV2ZW50RW1pdHRlci5saXN0ZW5lckNvdW50ID0gZnVuY3Rpb24oZW1pdHRlciwgdHlwZSkge1xuICBpZiAodHlwZW9mIGVtaXR0ZXIubGlzdGVuZXJDb3VudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBlbWl0dGVyLmxpc3RlbmVyQ291bnQodHlwZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGxpc3RlbmVyQ291bnQuY2FsbChlbWl0dGVyLCB0eXBlKTtcbiAgfVxufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5saXN0ZW5lckNvdW50ID0gbGlzdGVuZXJDb3VudDtcbmZ1bmN0aW9uIGxpc3RlbmVyQ291bnQodHlwZSkge1xuICB2YXIgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuXG4gIGlmIChldmVudHMpIHtcbiAgICB2YXIgZXZsaXN0ZW5lciA9IGV2ZW50c1t0eXBlXTtcblxuICAgIGlmICh0eXBlb2YgZXZsaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfSBlbHNlIGlmIChldmxpc3RlbmVyKSB7XG4gICAgICByZXR1cm4gZXZsaXN0ZW5lci5sZW5ndGg7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIDA7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuZXZlbnROYW1lcyA9IGZ1bmN0aW9uIGV2ZW50TmFtZXMoKSB7XG4gIHJldHVybiB0aGlzLl9ldmVudHNDb3VudCA+IDAgPyBSZWZsZWN0Lm93bktleXModGhpcy5fZXZlbnRzKSA6IFtdO1xufTtcblxuLy8gQWJvdXQgMS41eCBmYXN0ZXIgdGhhbiB0aGUgdHdvLWFyZyB2ZXJzaW9uIG9mIEFycmF5I3NwbGljZSgpLlxuZnVuY3Rpb24gc3BsaWNlT25lKGxpc3QsIGluZGV4KSB7XG4gIGZvciAodmFyIGkgPSBpbmRleCwgayA9IGkgKyAxLCBuID0gbGlzdC5sZW5ndGg7IGsgPCBuOyBpICs9IDEsIGsgKz0gMSlcbiAgICBsaXN0W2ldID0gbGlzdFtrXTtcbiAgbGlzdC5wb3AoKTtcbn1cblxuZnVuY3Rpb24gYXJyYXlDbG9uZShhcnIsIG4pIHtcbiAgdmFyIGNvcHkgPSBuZXcgQXJyYXkobik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgKytpKVxuICAgIGNvcHlbaV0gPSBhcnJbaV07XG4gIHJldHVybiBjb3B5O1xufVxuXG5mdW5jdGlvbiB1bndyYXBMaXN0ZW5lcnMoYXJyKSB7XG4gIHZhciByZXQgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcmV0Lmxlbmd0aDsgKytpKSB7XG4gICAgcmV0W2ldID0gYXJyW2ldLmxpc3RlbmVyIHx8IGFycltpXTtcbiAgfVxuICByZXR1cm4gcmV0O1xufVxuXG5mdW5jdGlvbiBvYmplY3RDcmVhdGVQb2x5ZmlsbChwcm90bykge1xuICB2YXIgRiA9IGZ1bmN0aW9uKCkge307XG4gIEYucHJvdG90eXBlID0gcHJvdG87XG4gIHJldHVybiBuZXcgRjtcbn1cbmZ1bmN0aW9uIG9iamVjdEtleXNQb2x5ZmlsbChvYmopIHtcbiAgdmFyIGtleXMgPSBbXTtcbiAgZm9yICh2YXIgayBpbiBvYmopIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrKSkge1xuICAgIGtleXMucHVzaChrKTtcbiAgfVxuICByZXR1cm4gaztcbn1cbmZ1bmN0aW9uIGZ1bmN0aW9uQmluZFBvbHlmaWxsKGNvbnRleHQpIHtcbiAgdmFyIGZuID0gdGhpcztcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZm4uYXBwbHkoY29udGV4dCwgYXJndW1lbnRzKTtcbiAgfTtcbn1cbiIsIi8qXG5vYmplY3QtYXNzaWduXG4oYykgU2luZHJlIFNvcmh1c1xuQGxpY2Vuc2UgTUlUXG4qL1xuXG4ndXNlIHN0cmljdCc7XG4vKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqL1xudmFyIGdldE93blByb3BlcnR5U3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7XG52YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O1xudmFyIHByb3BJc0VudW1lcmFibGUgPSBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlO1xuXG5mdW5jdGlvbiB0b09iamVjdCh2YWwpIHtcblx0aWYgKHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZCkge1xuXHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdC5hc3NpZ24gY2Fubm90IGJlIGNhbGxlZCB3aXRoIG51bGwgb3IgdW5kZWZpbmVkJyk7XG5cdH1cblxuXHRyZXR1cm4gT2JqZWN0KHZhbCk7XG59XG5cbmZ1bmN0aW9uIHNob3VsZFVzZU5hdGl2ZSgpIHtcblx0dHJ5IHtcblx0XHRpZiAoIU9iamVjdC5hc3NpZ24pIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBEZXRlY3QgYnVnZ3kgcHJvcGVydHkgZW51bWVyYXRpb24gb3JkZXIgaW4gb2xkZXIgVjggdmVyc2lvbnMuXG5cblx0XHQvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD00MTE4XG5cdFx0dmFyIHRlc3QxID0gbmV3IFN0cmluZygnYWJjJyk7ICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ldy13cmFwcGVyc1xuXHRcdHRlc3QxWzVdID0gJ2RlJztcblx0XHRpZiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGVzdDEpWzBdID09PSAnNScpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD0zMDU2XG5cdFx0dmFyIHRlc3QyID0ge307XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG5cdFx0XHR0ZXN0MlsnXycgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpXSA9IGk7XG5cdFx0fVxuXHRcdHZhciBvcmRlcjIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0ZXN0MikubWFwKGZ1bmN0aW9uIChuKSB7XG5cdFx0XHRyZXR1cm4gdGVzdDJbbl07XG5cdFx0fSk7XG5cdFx0aWYgKG9yZGVyMi5qb2luKCcnKSAhPT0gJzAxMjM0NTY3ODknKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0Ly8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzA1NlxuXHRcdHZhciB0ZXN0MyA9IHt9O1xuXHRcdCdhYmNkZWZnaGlqa2xtbm9wcXJzdCcuc3BsaXQoJycpLmZvckVhY2goZnVuY3Rpb24gKGxldHRlcikge1xuXHRcdFx0dGVzdDNbbGV0dGVyXSA9IGxldHRlcjtcblx0XHR9KTtcblx0XHRpZiAoT2JqZWN0LmtleXMoT2JqZWN0LmFzc2lnbih7fSwgdGVzdDMpKS5qb2luKCcnKSAhPT1cblx0XHRcdFx0J2FiY2RlZmdoaWprbG1ub3BxcnN0Jykge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdHJldHVybiB0cnVlO1xuXHR9IGNhdGNoIChlcnIpIHtcblx0XHQvLyBXZSBkb24ndCBleHBlY3QgYW55IG9mIHRoZSBhYm92ZSB0byB0aHJvdywgYnV0IGJldHRlciB0byBiZSBzYWZlLlxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHNob3VsZFVzZU5hdGl2ZSgpID8gT2JqZWN0LmFzc2lnbiA6IGZ1bmN0aW9uICh0YXJnZXQsIHNvdXJjZSkge1xuXHR2YXIgZnJvbTtcblx0dmFyIHRvID0gdG9PYmplY3QodGFyZ2V0KTtcblx0dmFyIHN5bWJvbHM7XG5cblx0Zm9yICh2YXIgcyA9IDE7IHMgPCBhcmd1bWVudHMubGVuZ3RoOyBzKyspIHtcblx0XHRmcm9tID0gT2JqZWN0KGFyZ3VtZW50c1tzXSk7XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gZnJvbSkge1xuXHRcdFx0aWYgKGhhc093blByb3BlcnR5LmNhbGwoZnJvbSwga2V5KSkge1xuXHRcdFx0XHR0b1trZXldID0gZnJvbVtrZXldO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChnZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHtcblx0XHRcdHN5bWJvbHMgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZnJvbSk7XG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHN5bWJvbHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYgKHByb3BJc0VudW1lcmFibGUuY2FsbChmcm9tLCBzeW1ib2xzW2ldKSkge1xuXHRcdFx0XHRcdHRvW3N5bWJvbHNbaV1dID0gZnJvbVtzeW1ib2xzW2ldXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiB0bztcbn07XG4iXX0=
