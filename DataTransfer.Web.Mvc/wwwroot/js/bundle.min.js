(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
// Â© 2001-2015 INOVx Solutions, Inc.
// 114 Pacifica Suite 300, Irvine, CA 92618 USA
// All rights reserved.
//
// This software is confidential, proprietary and unpublished property of
// INOVx Solutions, Inc.  It may NOT be copied in part or in whole on any
// medium, either electronic or printed, without the express written consent
// of INOVx Solutions, Inc.
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var ReactDOM = require("react-dom");
var DataTransferApp = require("./components/DataTransferApp");
try {
    InovxLoader.updateHelp('data-transfer');
}
catch (e) {
}
ReactDOM.render(React.createElement(DataTransferApp, null), document.getElementById('datatransfer'));

},{"./components/DataTransferApp":5,"react":"react","react-dom":"react-dom"}],2:[function(require,module,exports){
"use strict";
// This file is only a template for actions.  Copy and paste this to your application's actions .ts file and start off from there
// Rename all things with App_Name.
// Naming convention for actions is "[App Name]Actions.ts" i.e. UsersActions.ts, EntitlementActions.ts
var Inovx = require("shared.web.client");
var DataTransferConstants = require("./../constants/DataTransferConstants");
var DataTransferServices = require("./../services/DataTransferServices");
var DataTransferStore = require("./../stores/DataTransferStore");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
function _receiveAllJobs(data) {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: DataTransferConstants.DATATRANSFER_GET_ALL_JOBS,
        data: data
    });
}
function _receiveCoreConnections(data) {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: DataTransferConstants.DATATRANSFER_GET_ALL_CORE_CONNECTIONS,
        data: data
    });
}
function _receiveConnectionProjects(data) {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: DataTransferConstants.DATATRANSFER_GET_ALL_CONNECTION_PROJECTS,
        data: data
    });
}
function _testCoreConnection() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: DataTransferConstants.DATATRANSFER_TEST_CONNECTION
    });
}
function _finishEditConnectionForm() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: DataTransferConstants.DATATRANSFER_FINISH_ADD_CONNECTION
    });
}
function _finishDeleteType() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: DataTransferConstants.DATATRANSFER_END_DELETE_TYPE
    });
}
function _finishEdit() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: DataTransferConstants.DATATRANSFER_FINISH_EDIT
    });
}
var DataTransferActions = {
    getAllJobs: function (callback, errorCallback, ignoreDefaultError) {
        DataTransferServices.getAllJobs(function (data) {
            if (callback && callback != null) {
                callback(data);
            }
            _receiveAllJobs(data);
        }, function (error) {
            if (errorCallback) {
                errorCallback(error);
            }
        }, ignoreDefaultError);
    },
    refreshData: function () {
        DataTransferActions.getAllJobs();
    },
    refreshConnections: function (callback) {
        DataTransferActions.getAllCoreConnections(function (data) {
            if (callback && callback != null) {
                callback(data);
            }
        });
    },
    beginCreateNewJob: function () {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: DataTransferConstants.DATATRANSFER_BEGIN_CREATE
        });
    },
    createJob: function (callback) {
        if (!SystemStore.isActionInProgress(DataTransferConstants.DATATRANSFER_CREATE)) {
            SystemActions.beginAction(DataTransferConstants.DATATRANSFER_CREATE);
            if (DataTransferStore.getTransferJobCreation().JobSchedule.DaysToRun.length > 0) {
                DataTransferServices.createJob(DataTransferStore.getTransferJobCreation(), function () {
                    DataTransferActions.refreshData();
                    if (callback && callback != null) {
                        callback();
                    }
                    _finishEdit();
                    SystemActions.endAction(DataTransferConstants.DATATRANSFER_CREATE);
                }, function (error) {
                    SystemActions.endAction(DataTransferConstants.DATATRANSFER_CREATE);
                });
            }
            else {
                var messageObject = {
                    message: InovxLoader.t("DataTransfer:message.jobScheduleDaysError")
                };
                SystemActions.displayErrorMessage(messageObject);
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_CREATE);
            }
        }
    },
    deleteJob: function (jobName, callback) {
        if (!SystemStore.isActionInProgress(DataTransferConstants.DATATRANSFER_DELETE_JOB)) {
            SystemActions.beginAction(DataTransferConstants.DATATRANSFER_DELETE_JOB);
            DataTransferServices.deleteJob(jobName, function () {
                DataTransferActions.refreshData();
                if (callback && callback != null) {
                    callback();
                }
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_DELETE_JOB);
            }, function (error) {
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_DELETE_JOB);
            });
        }
    },
    deleteAllJobContent: function (jobName, callback) {
        if (!SystemStore.isActionInProgress(DataTransferConstants.DATATRANSFER_DELETE_JOB)) {
            SystemActions.beginAction(DataTransferConstants.DATATRANSFER_DELETE_JOB);
            DataTransferServices.deleteAllJob(jobName, function () {
                DataTransferActions.refreshData();
                if (callback && callback != null) {
                    callback();
                }
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_DELETE_JOB);
            }, function (error) {
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_DELETE_JOB);
            });
        }
    },
    beginDeleteJobOnly: function (jobName) {
        var messageObject = {
            message: InovxLoader.t("DataTransfer:message.confirmDelete"),
            confirmCallback: function () {
                DataTransferActions.deleteJob(jobName);
            }
        };
        SystemActions.displayConfirmationMessage(messageObject);
    },
    beginDeleteAllJobContent: function (jobName, callback) {
        DataTransferServices.getJobDetails(jobName, function (jobDetail) {
            if (callback && callback != null) {
                callback(jobDetail);
            }
            Inovx.Shared.Flux.AppDispatcher.dispatch({
                actionType: DataTransferConstants.DATATRANSFER_BEGIN_DELETE_ALL,
                data: jobDetail
            });
        });
    },
    beginDeleteJob: function (jobName) {
        DataTransferServices.getJobDetails(jobName, function (jobDetail) {
            // Only show the dialog with the possibility to 'delete the project with data'
            // when the project has already been created/transferred. If not, only show
            // the job deletion prompt.
            if (jobDetail.IsProjectCreated) {
                Inovx.Shared.Flux.AppDispatcher.dispatch({
                    actionType: DataTransferConstants.DATATRANSFER_BEGIN_DELETE_TYPE,
                    data: jobDetail
                });
            }
            else {
                DataTransferActions.beginDeleteJobOnly(jobName);
            }
        });
    },
    beginEditJob: function (jobName, callback) {
        DataTransferServices.getJobDetails(jobName, function (jobDetail) {
            if (callback && callback != null) {
                callback(jobDetail);
            }
            Inovx.Shared.Flux.AppDispatcher.dispatch({
                actionType: DataTransferConstants.DATATRANSFER_BEGIN_EDIT,
                data: jobDetail
            });
        });
    },
    editJob: function (callback, errorCallback) {
        if (!SystemStore.isActionInProgress(DataTransferConstants.DATATRANSFER_EDIT)) {
            SystemActions.beginAction(DataTransferConstants.DATATRANSFER_EDIT);
            var job = DataTransferStore.getEditTransferJob();
            var changedConnection = DataTransferStore.getSelectedConnection();
            if (changedConnection && changedConnection.Id) {
                var jobEditInfo = {
                    ProjectName: job.ProjectName,
                    CoreProjectName: job.VSuiteCoreProjectName,
                    CoreConnectionId: changedConnection.Id,
                    JobSchedule: job.JobSchedule
                };
                DataTransferServices.editJob(job.Name, jobEditInfo, function (data) {
                    DataTransferActions.refreshData();
                    if (callback && callback != null) {
                        callback(data);
                    }
                    _finishEdit();
                    SystemActions.endAction(DataTransferConstants.DATATRANSFER_EDIT);
                }, function (error) {
                    SystemActions.endAction(DataTransferConstants.DATATRANSFER_EDIT);
                });
            }
            else {
                DataTransferServices.editJobSchedule(job.Name, job.JobSchedule, function (data) {
                    DataTransferActions.refreshData();
                    if (callback && callback != null) {
                        callback(data);
                    }
                    _finishEdit();
                    SystemActions.endAction(DataTransferConstants.DATATRANSFER_EDIT);
                }, function (error) {
                    SystemActions.endAction(DataTransferConstants.DATATRANSFER_EDIT);
                });
            }
        }
    },
    changeSelectedConnection: function (connection, callback) {
        if (callback && callback !== null) {
            callback();
        }
        DataTransferActions.updateJobFields("CoreConnectionId", connection.Id);
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: DataTransferConstants.DATATRANSFER_CHANGE_SELECTED_CONNECTION,
            data: connection
        });
    },
    updateJobFields: function (key, value, callback) {
        if (callback && callback != null) {
            callback();
        }
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: DataTransferConstants.DATATRANSFER_UPDATE_JOB_CREATION,
            key: key,
            value: value
        });
    },
    finishEdit: function () {
        if (DataTransferStore.getHasJobChanges()) {
            var callbackFunct = DataTransferActions.createJob;
            if (!DataTransferStore.getIsCreating()) {
                callbackFunct = DataTransferActions.editJob;
            }
            SystemActions.displaySaveChangesDialog({
                message: InovxLoader.t("common:msgBox.saveChanges"),
                confirmCallback: callbackFunct,
                cancelCallback: _finishEdit
            });
        }
        else {
            _finishEdit();
        }
    },
    getAllCoreConnections: function (callback) {
        if (!SystemStore.isActionInProgress(DataTransferConstants.DATATRANSFER_GET_ALL_CORE_CONNECTIONS)) {
            SystemActions.beginAction(DataTransferConstants.DATATRANSFER_GET_ALL_CORE_CONNECTIONS);
            DataTransferServices.getAllConnections(function (data) {
                if (callback && callback != null) {
                    callback(data);
                }
                _receiveCoreConnections(data);
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_GET_ALL_CORE_CONNECTIONS);
            }, function (error) {
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_GET_ALL_CORE_CONNECTIONS);
            });
        }
    },
    getConnectionProjects: function (id, callback) {
        if (!SystemStore.isActionInProgress(DataTransferConstants.DATATRANSFER_GET_ALL_CONNECTION_PROJECTS)) {
            SystemActions.beginAction(DataTransferConstants.DATATRANSFER_GET_ALL_CONNECTION_PROJECTS);
            DataTransferServices.getAllConnectionProjects(id, function (data) {
                if (callback && callback != null) {
                    callback(data);
                }
                _receiveConnectionProjects(data);
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_GET_ALL_CONNECTION_PROJECTS);
            }, function (error) {
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_GET_ALL_CONNECTION_PROJECTS);
            });
        }
    },
    beginAddNewConnection: function () {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: DataTransferConstants.DATATRANSFER_BEGIN_ADD_CONNECTION,
        });
    },
    updateConnection: function (key, value) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: DataTransferConstants.DATATRANSFER_UPDATE_CONNECTION,
            key: key,
            value: value
        });
    },
    editConnection: function () {
        DataTransferActions.getAllCoreConnections(function (e) {
            Inovx.Shared.Flux.AppDispatcher.dispatch({
                actionType: DataTransferConstants.DATATRANSFER_EDIT_CONNECTION,
            });
        });
    },
    closeEditConnection: function () {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: DataTransferConstants.DATATRANSFER_CLOSE_EDIT_CONNECTION,
        });
    },
    createConnection: function (configuration, callback) {
        if (!SystemStore.isActionInProgress(DataTransferConstants.DATATRANSFER_SAVE_CONNECTION)) {
            SystemActions.beginAction(DataTransferConstants.DATATRANSFER_SAVE_CONNECTION);
            if (DataTransferStore.getConnectionValidity()) {
                DataTransferServices.createCoreConnection(configuration, function (retData) {
                    DataTransferActions.refreshConnections();
                    if (callback && callback != null) {
                        callback(retData);
                    }
                    _finishEditConnectionForm();
                    SystemActions.endAction(DataTransferConstants.DATATRANSFER_SAVE_CONNECTION);
                }, function (error) {
                    SystemActions.endAction(DataTransferConstants.DATATRANSFER_SAVE_CONNECTION);
                });
            }
            else {
                var messageObject = {
                    message: InovxLoader.t("DataTransfer:message.createConnectionError")
                };
                SystemActions.displayErrorMessage(messageObject);
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_SAVE_CONNECTION);
            }
        }
    },
    testConnection: function (config, ignoreDefaultError) {
        if (!SystemStore.isActionInProgress(DataTransferConstants.DATATRANSFER_TEST_CONNECTION)) {
            SystemActions.beginAction(DataTransferConstants.DATATRANSFER_TEST_CONNECTION);
            var messageObject_1 = {};
            DataTransferServices.testCoreConnection(config, function (data) {
                _testCoreConnection();
                messageObject_1.message = InovxLoader.t("DataTransfer:message.connectionVerified");
                SystemActions.displayInfoMessage(messageObject_1);
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_TEST_CONNECTION);
            }, function (error) {
                messageObject_1.message = InovxLoader.t("DataTransfer:message.connectionFailed");
                messageObject_1.helpLink = Inovx.Shared.Common.UrlUtilities.getHelpUrl() + "/VSuiteCOREConnection.html";
                SystemActions.displayErrorMessage(messageObject_1);
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_TEST_CONNECTION);
            }, ignoreDefaultError);
        }
    },
    closeDeleteAllContentModal: function () {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: DataTransferConstants.DATATRANSFER_FINISH_DELETE_ALL
        });
    },
    finishDeleteTypePopup: function () {
        _finishDeleteType();
    },
    finishEditConnectionForm: function () {
        if (DataTransferStore.getConnectionFormHasChanges()) {
            SystemActions.displaySaveChangesDialog({
                message: InovxLoader.t("common:msgBox.saveChanges"),
                confirmCallback: DataTransferActions.createConnection,
                cancelCallback: _finishEditConnectionForm
            });
        }
        else {
            _finishEditConnectionForm();
        }
    },
    runJob: function (job, callback) {
        if (!SystemStore.isActionInProgress(DataTransferConstants.DATATRANSFER_RUN_JOB)) {
            SystemActions.beginAction(DataTransferConstants.DATATRANSFER_RUN_JOB);
            DataTransferServices.runJob(job, function (data) {
                if (callback && callback != null) {
                    callback(data);
                }
                var messageObject = {
                    message: InovxLoader.t("DataTransfer:message.jobSuccess")
                };
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_RUN_JOB);
                SystemActions.displayInfoMessage(messageObject);
            }, function (error) {
                SystemActions.endAction(DataTransferConstants.DATATRANSFER_RUN_JOB);
            });
        }
    }
};
module.exports = DataTransferActions;

},{"./../constants/DataTransferConstants":12,"./../services/DataTransferServices":15,"./../stores/DataTransferStore":16,"shared.web.client":"shared.web.client"}],3:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
// A '.tsx' file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var React = require("react");
var Inovx = require("shared.web.client");
var DataTransferActions = require("./../actions/DataTransferActions");
var DataTransferConstants = require("./../constants/DataTransferConstants");
var DataTransferStore = require("./../stores/DataTransferStore");
var InovxControls = Inovx.Shared.Controls;
var CoreConnectionEditModal = /** @class */ (function (_super) {
    __extends(CoreConnectionEditModal, _super);
    function CoreConnectionEditModal(props) {
        var _this = _super.call(this, props) || this;
        _this.changeConnection = function (connection) {
            _this._handleConnectionChange(connection);
        };
        _this._handleConnectionChange = function (connection) {
            _this.setState({
                selectedConnection: connection
            });
        };
        _this._onChange = function () {
            _this.setState(function (prevState) {
                // If no valid initialConnection was provided to us via the props,
                // we wait for the available connections list to be populated and
                // then take the first one as the one to selected by default.
                var connections = DataTransferStore.getAllCoreConnections();
                var selectedConnection = prevState.selectedConnection;
                if (!selectedConnection.Name) {
                    selectedConnection = connections[0];
                }
                return {
                    coreConnections: connections,
                    selectedConnection: selectedConnection
                };
            });
        };
        _this.state = {
            coreConnections: DataTransferStore.getAllCoreConnections(),
            selectedConnection: props.initialConnection
        };
        return _this;
    }
    CoreConnectionEditModal.prototype.componentDidMount = function () {
        DataTransferStore.addChangeListener(this._onChange);
    };
    CoreConnectionEditModal.prototype.componentWillUnmount = function () {
        DataTransferStore.removeChangeListener(this._onChange);
    };
    CoreConnectionEditModal.prototype.render = function () {
        var _this = this;
        return (React.createElement("div", { className: "panel panel-primary edit-connection" },
            React.createElement("div", { className: "panel-heading" }, "Edit Connection"),
            React.createElement("div", { className: "panel-body" },
                React.createElement(Inovx.Shared.Controls.ActionInProgressLoader, { actionKey: [DataTransferConstants.DATATRANSFER_TEST_CONNECTION], class: 'temp-modal-loader' },
                    React.createElement("div", { className: "action-in-progress-loader-sm" })),
                React.createElement("section", { className: "data-transfer-form-section border-bottom" },
                    React.createElement("h3", { className: "section-title" }, InovxLoader.t("DataTransfer:form.coreConnection")),
                    React.createElement("div", { className: "section-content" },
                        React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("DataTransfer:form.coreConnection")), inputName: "CoreConnections", className: "data-transfer-field" },
                            React.createElement(InovxControls.DropDownList, { datasource: this.state.coreConnections, onChange: this._handleConnectionChange, displayProp: "Name", autoWidth: true, width: "260px", initialValue: this.state.selectedConnection.Name, valueProp: "Name" }),
                            React.createElement("a", { className: "btn btn-primary add-btn", onClick: function () { DataTransferActions.beginAddNewConnection(); } }, InovxLoader.t("DataTransfer:form.add"))))),
                React.createElement("div", { className: "btn-bar-b-sm" },
                    React.createElement("button", { type: "button", className: "btn btn-primary", onClick: function () { _this.props.onSave(_this.state.selectedConnection); } }, InovxLoader.t("DataTransfer:form.ok")),
                    React.createElement("button", { type: "button", className: "btn btn-default", onClick: function () { _this.props.onCancel(); } }, InovxLoader.t("DataTransfer:form.cancel"))))));
    };
    return CoreConnectionEditModal;
}(React.Component));
module.exports = CoreConnectionEditModal;

},{"./../actions/DataTransferActions":2,"./../constants/DataTransferConstants":12,"./../stores/DataTransferStore":16,"react":"react","shared.web.client":"shared.web.client"}],4:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
// A '.tsx' file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var React = require("react");
var Inovx = require("shared.web.client");
var DataTransferActions = require("./../actions/DataTransferActions");
var DataTransferConstants = require("./../constants/DataTransferConstants");
var DataTransferStore = require("./../stores/DataTransferStore");
var SystemStore = Inovx.Shared.System.Store;
var InovxControls = Inovx.Shared.Controls;
var CoreConnectionSettingsModal = /** @class */ (function (_super) {
    __extends(CoreConnectionSettingsModal, _super);
    function CoreConnectionSettingsModal(props) {
        var _this = _super.call(this, props) || this;
        _this._onFieldChange = function (e) {
            DataTransferActions.updateConnection(e.target.name, e.target.value);
        };
        _this._onVersionChange = function (e) {
            DataTransferActions.updateConnection("Version", e);
        };
        _this._handleTestConnection = function () {
            DataTransferActions.testConnection(_this.state.coreConnectionSetting, true);
        };
        _this._handleSaveConnectionSettings = function () {
            _this.props.onSave(_this.state.coreConnectionSetting);
        };
        _this._handleCancel = function () {
            _this.props.onCancel();
        };
        _this._checkForUnsavedChanges = function () {
            if (DataTransferStore.getConnectionFormHasChanges()) {
                event.returnValue = InovxLoader.t('common:msgBox.browserSaveChanges');
            }
        };
        _this.state = {
            coreConnectionSetting: DataTransferStore.getCoreConnectionSetting()
        };
        return _this;
    }
    CoreConnectionSettingsModal.prototype.componentDidMount = function () {
        window.addEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    CoreConnectionSettingsModal.prototype.componentWillUnmount = function () {
        window.removeEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    CoreConnectionSettingsModal.prototype.render = function () {
        var inputObj = {
            className: 'form-control',
            type: 'text',
            readOnly: this.props.readOnly
        };
        var coreConnectionSetting = this.state.coreConnectionSetting;
        var aliasInput = jQuery.extend({
            name: "ConfigurationName",
            value: coreConnectionSetting.ConfigurationName
        }, inputObj);
        var sqlServerInput = jQuery.extend({
            name: "SqlServerName",
            value: coreConnectionSetting.SqlServerName
        }, inputObj);
        var sqlInstanceInput = jQuery.extend({
            name: "SqlServerInstance",
            value: coreConnectionSetting.SqlServerInstance
        }, inputObj);
        var tcpPortInput = jQuery.extend({
            name: "SqlServerTcpPort",
            value: coreConnectionSetting.SqlServerTcpPort
        }, inputObj);
        var coreServerName = jQuery.extend({
            name: "CoreServerName",
            value: coreConnectionSetting.CoreServerName
        }, inputObj);
        var coreAdminPassword = {
            className: 'form-control',
            id: 'dataTransfer-core-admin-password',
            name: "CoreAdminPassword",
            type: 'password',
            value: coreConnectionSetting.CoreAdminPassword,
            readOnly: inputObj.readOnly
        };
        //let coreAdminPassword = jQuery.extend({
        //    name: "CoreAdminPassword",
        //    type: 'password',
        //    value: coreConnectionSetting.CoreAdminPassword
        //}, inputObj);
        var versionInput = jQuery.extend({
            name: "Version",
            value: coreConnectionSetting.Version
        }, inputObj);
        return (React.createElement("div", { className: "panel panel-primary connection-settings" },
            React.createElement("div", { className: "panel-heading" }, this.props.readOnly ? InovxLoader.t("DataTransfer:form.coreConnection") : InovxLoader.t("DataTransfer:form.newConnection")),
            React.createElement("div", { className: "panel-body" },
                React.createElement(Inovx.Shared.Controls.ActionInProgressLoader, { actionKey: [DataTransferConstants.DATATRANSFER_TEST_CONNECTION], class: 'temp-modal-loader' },
                    React.createElement("div", { className: "action-in-progress-loader-sm" })),
                React.createElement("section", { className: "data-transfer-form-section border-bottom" },
                    React.createElement("h3", { className: "section-title" }, InovxLoader.t("DataTransfer:form.coreConnection")),
                    React.createElement("div", { className: "section-content" },
                        React.createElement(InovxControls.If, { condition: !this.props.readOnly },
                            React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("DataTransfer:form.alias"), "*"), className: "connection-form-field", inputName: "ConfigurationName" },
                                React.createElement("input", __assign({}, aliasInput, { onChange: this._onFieldChange })))),
                        React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("DataTransfer:form.coreSqlServer"), "*"), className: "connection-form-field", inputName: "SqlServerName" },
                            React.createElement("input", __assign({}, sqlServerInput, { onChange: this._onFieldChange }))),
                        React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("DataTransfer:form.coreSqlInstance")), className: "connection-form-field", inputName: "SqlServerInstance" },
                            React.createElement("input", __assign({}, sqlInstanceInput, { onChange: this._onFieldChange }))),
                        React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("DataTransfer:form.tcpPort")), className: "connection-form-field", inputName: "SqlServerTcpPort" },
                            React.createElement("input", __assign({}, tcpPortInput, { onChange: this._onFieldChange }))),
                        React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("DataTransfer:form.coreServerName"), "*"), className: "connection-form-field", inputName: "CoreServerName" },
                            React.createElement("input", __assign({}, coreServerName, { onChange: this._onFieldChange }))),
                        React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("DataTransfer:form.coreAdminPassword"), "*"), className: "connection-form-field", inputName: "CoreAdminPassword" },
                            React.createElement("input", __assign({}, coreAdminPassword, { onChange: this._onFieldChange }))),
                        React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("DataTransfer:form.coreVersion"), "*"), className: "connection-form-field", inputName: "Version" },
                            React.createElement(InovxControls.DropDownList, { datasource: ["6.2", "7.0", "7.1", "8.0", "9.0", "9.1"], initialValue: coreConnectionSetting.Version, onChange: this._onVersionChange, enabled: !this.props.readOnly, width: "207px" })),
                        React.createElement(InovxControls.If, { condition: !this.props.readOnly },
                            React.createElement("div", { className: "connection-form-field" },
                                React.createElement("button", { type: "button", className: "btn btn-primary ".concat(this.props.readOnly ? "disabled" : ""), onClick: this.props.readOnly ? null : this._handleTestConnection }, InovxLoader.t("DataTransfer:form.testConnection")))))),
                React.createElement("div", { className: "btn-bar-b-sm" },
                    React.createElement(InovxControls.If, { condition: !this.props.readOnly },
                        React.createElement("button", { type: "button", className: "btn btn-primary ".concat(this.props.readOnly ? "disabled" : ""), onClick: this.props.readOnly ? null : this._handleSaveConnectionSettings }, InovxLoader.t("DataTransfer:form.save"))),
                    React.createElement("button", { type: "button", className: "btn btn-default", onClick: this._handleCancel }, this.props.readOnly ? InovxLoader.t("DataTransfer:form.ok") : InovxLoader.t("DataTransfer:form.cancel"))))));
    };
    return CoreConnectionSettingsModal;
}(React.Component));
module.exports = CoreConnectionSettingsModal;

},{"./../actions/DataTransferActions":2,"./../constants/DataTransferConstants":12,"./../stores/DataTransferStore":16,"react":"react","shared.web.client":"shared.web.client"}],5:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var React = require("react");
var Inovx = require("shared.web.client");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
var PermissionService = Inovx.Shared.Permission.PermissionService;
var DataTransferPermissions = require("./../constants/DataTransferPermissions");
var DataTransferActions = require("./../actions/DataTransferActions");
var DataTransferStore = require("./../stores/DataTransferStore");
var DataTransferForm = require("./DataTransferForm");
var DeletionTypeModal = require("./DeletionTypeModal");
var DeleteAllContentModal = require("./DeleteAllContentModal");
var DataSourceTypeEnum = require("./../constants/DataSourceTypeEnum");
var SynchronizationStatusTypeEnum = require("./../constants/SynchronizationStatusTypeEnum");
var DataTransferApp = /** @class */ (function (_super) {
    __extends(DataTransferApp, _super);
    function DataTransferApp(props, context) {
        var _this = _super.call(this, 'DataTransfer', props, context) || this;
        _this._initialize = function () {
            DataTransferActions.getAllJobs(function () { return _this._appLoaded = true; }, function (error) { return _this._handlePermissionError(error); }, true);
        };
        _this._showCreateNewJob = function () {
            DataTransferActions.beginCreateNewJob();
        };
        _this._hideCreateNewJob = function () {
            DataTransferActions.finishEdit();
        };
        _this._beginEditJob = function (e, job) {
            DataTransferActions.beginEditJob(job.Name);
        };
        _this._deleteJob = function (e, job) {
            DataTransferActions.beginDeleteJob(job.Name);
        };
        _this._runJob = function (e, job) {
            DataTransferActions.runJob(job.Name);
        };
        _this._rowCommandsHandle = function (args) {
            if (args.rowData.SynchronizationStatus == SynchronizationStatusTypeEnum.Invalid || args.rowData.SynchronizationStatus == SynchronizationStatusTypeEnum.Disconnected) {
                var editButton = args.row.find(".grid-button-edit");
                if (editButton) {
                    editButton.addClass("e-disabled grid-button-disabled");
                    editButton.removeClass("grid-button-edit");
                }
                var runButton = args.row.find(".grid-button-run");
                if (runButton) {
                    runButton.addClass("e-disabled grid-button-disabled");
                    runButton.removeClass("grid-button-run");
                }
            }
        };
        _this._onChange = function () {
            _this.setState({
                modalVisible: DataTransferStore.getModalVisible(),
                isDeleteTypeModalVisible: DataTransferStore.getDeletionTypeModalVisible(),
                isDeleteAllModalVisible: DataTransferStore.getDeleteAllModalVisible(),
                allTransferJobs: DataTransferStore.getAllJobs()
            });
        };
        var datasourceType = window.DataSourceType;
        var addJob = true;
        if (datasourceType != DataSourceTypeEnum.SqlServer)
            addJob = false;
        _this.state = {
            modalVisible: false,
            canAddJob: addJob,
            isDeleteTypeModalVisible: false,
            isDeleteAllModalVisible: false,
            allTransferJobs: DataTransferStore.getAllJobs()
        };
        return _this;
    }
    DataTransferApp.prototype.componentWillMount = function () {
        this.componentWillMountBase();
    };
    DataTransferApp.prototype.componentDidMount = function () {
        DataTransferStore.addChangeListener(this._onChange);
    };
    DataTransferApp.prototype.componentWillUnmount = function () {
        DataTransferStore.removeChangeListener(this._onChange);
    };
    DataTransferApp.prototype.render = function () {
        var hasManageJobsPermission = PermissionService.checkPermission(DataTransferPermissions.DATATRANSFER_MANAGE);
        var iconHeaderProps = {
            iconUrl: "".concat(UrlUtilities.getBaseApplicationUrl(), "/images/DataTransfer.png"),
            iconAtt: { alt: InovxLoader.t("DataTransfer:common.title") },
            title: InovxLoader.t("DataTransfer:common.title"),
            rcClass: "cd-btn add-btn",
            onClick: this._showCreateNewJob,
        };
        if (hasManageJobsPermission && this.state.canAddJob) {
            iconHeaderProps.btnUrl = "".concat(UrlUtilities.getBaseApplicationUrl(), "/images/addDataTransfer.png");
            iconHeaderProps.btnAtt = {
                alt: InovxLoader.t("DataTransfer:form.newJob"),
                title: InovxLoader.t("DataTransfer:form.newJob")
            };
        }
        var commands = {
            command: [{
                    iconClassName: "glyphicon glyphicon-play",
                    className: "grid-button-run",
                    id: "command-play",
                    click: this._runJob,
                }],
            width: "115px",
            headerText: InovxLoader.t("DataTransfer:grid.commands")
        };
        if (hasManageJobsPermission) {
            var editCommands = [{
                    iconClassName: "glyphicon glyphicon-pencil",
                    className: "grid-button-edit",
                    id: "command-edit",
                    click: this._beginEditJob
                }
            ];
            var deleteCommands = [{
                    iconClassName: "glyphicon glyphicon-trash",
                    className: "grid-button",
                    id: "command-delete",
                    click: this._deleteJob
                }
            ];
            if (this.state.canAddJob) {
                commands.command = __spreadArray(__spreadArray(__spreadArray([], editCommands, true), deleteCommands, true), commands.command, true);
            }
            else {
                commands.command = __spreadArray(__spreadArray([], editCommands, true), commands.command, true);
            }
        }
        var columns = [{
                field: "ProjectName",
                headerText: InovxLoader.t("DataTransfer:grid.projectName"),
                type: "string"
            }, {
                field: "SqlServerName",
                headerText: InovxLoader.t("DataTransfer:grid.sqlServerName"),
                type: "string"
            }, {
                field: "SqlServerInstance",
                headerText: InovxLoader.t("DataTransfer:grid.sqlInstanceName"),
                type: "string"
            }, {
                field: "ScheduleEnabled",
                headerText: InovxLoader.t("DataTransfer:grid.schedule"),
                width: "120px",
                type: "boolean",
                values: [
                    { value: true, text: InovxLoader.t('DataTransfer:grid.enabled') },
                    { value: false, text: InovxLoader.t('DataTransfer:grid.disabled') }
                ]
            }, {
                field: "Synchronization",
                headerText: InovxLoader.t("DataTransfer:grid.synchronization"),
                type: "string"
            }
        ];
        var defaultSort = [{
                field: "Name",
                dir: "ascending"
            }];
        return (React.createElement(Inovx.Shared.Core.ReactLoader, { appReady: this.isAppLoaded(), errorStatus: this._errorStatus },
            React.createElement("div", { className: "data-transfer-app-content" },
                React.createElement(Inovx.Shared.Layout.IconHeader, __assign({}, iconHeaderProps)),
                React.createElement(Inovx.Shared.Controls.ModalPopUp, { isOpen: this.state.isDeleteTypeModalVisible, ref: 'modal' },
                    React.createElement(DeletionTypeModal, { readOnly: false })),
                React.createElement(Inovx.Shared.Controls.ModalPopUp, { isOpen: this.state.isDeleteAllModalVisible, ref: 'modal' },
                    React.createElement(DeleteAllContentModal, { readOnly: false })),
                React.createElement(Inovx.Shared.Controls.Grid, { dataSource: this.state.allTransferJobs, commands: commands, columns: columns, rowCommandsHandler: this._rowCommandsHandle, defaultSort: defaultSort, filter: true, sort: true, pageable: { pageCount: 5, pageSize: 10, pageSizes: [10, 20, 50] } })),
            React.createElement(Inovx.Shared.Controls.ModalSlider, { isOpen: this.state.modalVisible, onClose: this._hideCreateNewJob },
                React.createElement(DataTransferForm, { canModifyConnection: this.state.canAddJob }))));
    };
    return DataTransferApp;
}(Inovx.Shared.ReactExt.BaseAppComponent));
module.exports = DataTransferApp;

},{"./../actions/DataTransferActions":2,"./../constants/DataSourceTypeEnum":11,"./../constants/DataTransferPermissions":13,"./../constants/SynchronizationStatusTypeEnum":14,"./../stores/DataTransferStore":16,"./DataTransferForm":6,"./DeleteAllContentModal":8,"./DeletionTypeModal":9,"react":"react","shared.web.client":"shared.web.client"}],6:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
// A '.tsx' file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var React = require("react");
var Inovx = require("shared.web.client");
var DataTransferActions = require("./../actions/DataTransferActions");
var DataTransferConstants = require("./../constants/DataTransferConstants");
var DataTransferStore = require("./../stores/DataTransferStore");
var CoreConnectionSettingsModal = require("./CoreConnectionSettingsModal");
var CoreConnectionEditModal = require("./CoreConnectionEditModal");
var JobScheduler = require("./JobScheduler");
var ListHelper = Inovx.Shared.Common.ListHelper;
var InovxControls = Inovx.Shared.Controls;
var SystemStore = Inovx.Shared.System.Store;
function getDataTransferActionInProgress() {
    return SystemStore.isActionInProgress(DataTransferConstants.DATATRANSFER_GET_ALL_CORE_CONNECTIONS) || SystemStore.isActionInProgress(DataTransferConstants.DATATRANSFER_GET_ALL_CONNECTION_PROJECTS);
}
function getTransferJob() {
    if (DataTransferStore.getIsCreating()) {
        return DataTransferStore.getTransferJobCreation();
    }
    else {
        return DataTransferStore.getEditTransferJob();
    }
}
function getJobFormState() {
    return {
        transferJob: getTransferJob(),
        coreConnections: DataTransferStore.getAllCoreConnections(),
        connectionProjects: DataTransferStore.getConnectionProjects(),
        selectedConnection: DataTransferStore.getSelectedConnection(),
        isCreating: DataTransferStore.getIsCreating(),
        isAddViewConnectionModalOpen: DataTransferStore.getConnectionModalVisible(),
        isEditConnectionModalOpen: DataTransferStore.getEditConnectionModalVisible(),
        isActionInProgress: getDataTransferActionInProgress(),
        actionInProgressMsg: _dataTransferActionInProgress
    };
}
var _dataTransferActionInProgress;
var DataTransferForm = /** @class */ (function (_super) {
    __extends(DataTransferForm, _super);
    function DataTransferForm(props, context) {
        var _this = _super.call(this, props) || this;
        _this._editConnectionChanged = false;
        _this._saveJob = function () {
            if (_this.state.isCreating) {
                DataTransferActions.createJob();
            }
            else {
                DataTransferActions.editJob();
            }
            _this.setState({ actionInProgressMsg: InovxLoader.t("DataTransfer:form.saving") });
        };
        _this._cancel = function () {
            DataTransferActions.finishEdit();
        };
        _this._addOrViewConnection = function () {
            DataTransferActions.beginAddNewConnection();
        };
        _this._handleConnectionChange = function (e) {
            DataTransferActions.changeSelectedConnection(e, function () {
                DataTransferActions.getConnectionProjects(e.Id, function (projects) {
                    var selectedProject;
                    if (_this.state.isCreating) {
                        selectedProject = ListHelper.sort(projects, "Name")[0];
                    }
                    else {
                        _this._editConnectionChanged = true;
                        selectedProject = projects.filter(function (value) { return value.ProjectID.toLowerCase() == _this.state.transferJob.VSuiteCoreProjectID.toLowerCase(); })[0];
                    }
                    _this._handleCoreProjectChange(selectedProject);
                });
            });
        };
        _this._handleCoreProjectChange = function (project) {
            var projectName = (project) ? project.Name : "";
            DataTransferActions.updateJobFields("CoreProjectName", projectName);
            if (_this.state.isCreating) {
                DataTransferActions.updateJobFields("ProjectName", projectName);
            }
        };
        _this._handleFieldChange = function (e) {
            DataTransferActions.updateJobFields(e.target.name, e.target.value);
        };
        _this._storeChange = function () {
            _this.setState(getJobFormState());
        };
        _this._systemChange = function () {
            _this.setState(getJobFormState());
        };
        _this._checkForUnsavedChanges = function () {
            if (DataTransferStore.getHasJobChanges()) {
                event.returnValue = InovxLoader.t('common:msgBox.browserSaveChanges');
            }
        };
        _this._saveNewConnection = function (configuration) {
            DataTransferActions.createConnection(configuration, function (newConnection) {
                if (_this.state.isCreating) {
                    _this._handleConnectionChange(newConnection);
                }
                else if (_this.state.isEditConnectionModalOpen) {
                    _this.refs["edit-modal"].changeConnection(newConnection);
                }
            });
        };
        _this._cancelNewConnection = function () {
            DataTransferActions.finishEditConnectionForm();
        };
        _this._saveEditConnection = function (configuration) {
            if (configuration) {
                _this._handleConnectionChange(configuration);
            }
            DataTransferActions.closeEditConnection();
        };
        _this._cancelEditConnection = function () {
            DataTransferActions.closeEditConnection();
        };
        _this.state = getJobFormState();
        return _this;
    }
    DataTransferForm.prototype.componentDidMount = function () {
        var _this = this;
        if (this.state.isCreating) {
            DataTransferActions.getAllCoreConnections(function (e) {
                if (e.length > 0) {
                    _this._handleConnectionChange(e[0]);
                }
            });
        }
        DataTransferStore.addChangeListener(this._storeChange);
        SystemStore.addChangeListener(this._systemChange);
        window.addEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    DataTransferForm.prototype.componentWillUnmount = function () {
        DataTransferStore.removeChangeListener(this._storeChange);
        SystemStore.removeChangeListener(this._systemChange);
        window.removeEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    DataTransferForm.prototype.render = function () {
        var header;
        var fieldWidth = "260";
        var transferJob = this.state.transferJob;
        var inputObj = {
            className: "form-control",
            type: "text"
        };
        var projectNameInput = jQuery.extend({
            name: "ProjectName",
            value: transferJob.ProjectName,
            readOnly: !this.state.isCreating
        }, inputObj);
        var connectionProjectsDropDown;
        var actionKeys = [DataTransferConstants.DATATRANSFER_GET_ALL_CORE_CONNECTIONS, DataTransferConstants.DATATRANSFER_GET_ALL_CONNECTION_PROJECTS];
        var connectionDropDownVisible;
        var editConnectionEnabled;
        var saveButtonEnabled;
        if (this.state.isCreating) {
            header = InovxLoader.t("DataTransfer:form.newJob");
            connectionProjectsDropDown = ListHelper.sort(this.state.connectionProjects, "Name");
            connectionDropDownVisible = true;
            editConnectionEnabled = false;
            saveButtonEnabled = true;
        }
        else {
            header = InovxLoader.t("DataTransfer:form.editJob");
            connectionProjectsDropDown = [{ Name: transferJob.VSuiteCoreProjectName }];
            connectionDropDownVisible = this._editConnectionChanged;
            editConnectionEnabled = transferJob.IsProjectCreated;
            saveButtonEnabled = (transferJob.VSuiteCoreProjectName) ? true : false;
        }
        return (React.createElement(InovxControls.StaticHeaderForm, { title: header, saveOnClick: this._saveJob, cancelOnClick: this._cancel, saveDisabled: !saveButtonEnabled, isActionInProgress: this.state.isActionInProgress, inProgressMessage: this.state.actionInProgressMsg },
            React.createElement(Inovx.Shared.Controls.ActionInProgressLoader, { actionKey: actionKeys, class: 'temp-modal-loader' },
                React.createElement("div", { className: "action-in-progress-loader-sm" })),
            React.createElement("section", { className: "data-transfer-form-section" },
                React.createElement("h3", { className: "section-title" }, InovxLoader.t("DataTransfer:form.jobinformation")),
                React.createElement("div", { className: "section-content" },
                    React.createElement(InovxControls.If, { condition: !this.state.isCreating },
                        React.createElement(InovxControls.FormField, { title: InovxLoader.t("DataTransfer:form.name"), inputName: 'Name', className: "data-transfer-field" },
                            React.createElement("h5", null, this.state.transferJob.Name))),
                    React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("DataTransfer:form.coreConnection"), "*"), inputName: "CoreConnections", className: "data-transfer-field" },
                        React.createElement(InovxControls.If, { condition: connectionDropDownVisible },
                            React.createElement(InovxControls.DropDownList, { datasource: this.state.coreConnections, onChange: this._handleConnectionChange, enabled: this.state.isCreating, displayProp: "Name", autoWidth: true, width: "".concat(fieldWidth, "px"), initialValue: this.state.selectedConnection.Name, valueProp: "Name" })),
                        React.createElement(InovxControls.If, { condition: this.state.isCreating },
                            React.createElement("a", { className: "btn btn-primary add-btn", onClick: this._addOrViewConnection }, InovxLoader.t("DataTransfer:form.add"))),
                        React.createElement(InovxControls.If, { condition: !connectionDropDownVisible },
                            React.createElement("a", { className: "btn btn-primary add-btn", onClick: this._addOrViewConnection }, InovxLoader.t("DataTransfer:form.viewConnection"))),
                        React.createElement(InovxControls.If, { condition: !this.state.isCreating && this.props.canModifyConnection },
                            React.createElement("a", { className: "btn btn-primary add-btn ".concat(editConnectionEnabled ? "" : "disabled"), onClick: function () { DataTransferActions.editConnection(); } }, InovxLoader.t("DataTransfer:form.editConnection")))),
                    React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("DataTransfer:form.coreProjectName"), "*"), inputName: "VSuiteCoreProjectName", className: "data-transfer-field" },
                        React.createElement(InovxControls.DropDownList, { datasource: connectionProjectsDropDown, onChange: this._handleCoreProjectChange, enabled: this.state.isCreating, displayProp: "Name", autoWidth: true, width: "".concat(fieldWidth, "px") })),
                    React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("DataTransfer:form.vsuiteProjectName"), "*"), inputName: "VSuiteProjectName", className: "data-transfer-field" },
                        React.createElement("input", __assign({}, projectNameInput, { onChange: this.state.isCreating ? this._handleFieldChange : null }))))),
            React.createElement("section", { className: "data-transfer-form-section" },
                React.createElement("h3", { className: "section-title" }, InovxLoader.t("DataTransfer:form.jobschedule")),
                React.createElement("div", { className: "section-content" },
                    React.createElement(JobScheduler, { editSchedule: this.state.isCreating ? null : this.state.transferJob.JobSchedule, fieldWidth: fieldWidth }))),
            React.createElement(InovxControls.ModalPopUp, { isOpen: this.state.isAddViewConnectionModalOpen },
                React.createElement(CoreConnectionSettingsModal, { readOnly: !this.state.isCreating && !this.state.isEditConnectionModalOpen, onSave: this._saveNewConnection, onCancel: this._cancelNewConnection })),
            React.createElement(InovxControls.ModalPopUp, { isOpen: this.state.isEditConnectionModalOpen },
                React.createElement(CoreConnectionEditModal, { onSave: this._saveEditConnection, onCancel: this._cancelEditConnection, initialConnection: this.state.selectedConnection, ref: "edit-modal" }))));
    };
    return DataTransferForm;
}(React.Component));
module.exports = DataTransferForm;

},{"./../actions/DataTransferActions":2,"./../constants/DataTransferConstants":12,"./../stores/DataTransferStore":16,"./CoreConnectionEditModal":3,"./CoreConnectionSettingsModal":4,"./JobScheduler":10,"react":"react","shared.web.client":"shared.web.client"}],7:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
// A '.tsx' file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var React = require("react");
var DataTransferStore = require("./../stores/DataTransferStore");
var DayPicker = /** @class */ (function (_super) {
    __extends(DayPicker, _super);
    function DayPicker(props) {
        var _this = _super.call(this, props) || this;
        _this.state = {
            selectedDays: _this.props.defaultChecked
        };
        return _this;
    }
    DayPicker.prototype.render = function () {
        return (React.createElement("div", { className: "date-picker-container" },
            React.createElement(Checkbox, { day: InovxLoader.t("DataTransfer:form.sun"), value: 0, defaultChecked: this.state.selectedDays.indexOf(0) > -1, onChange: this.props.onDayChange }),
            React.createElement(Checkbox, { day: InovxLoader.t("DataTransfer:form.mon"), value: 1, defaultChecked: this.state.selectedDays.indexOf(1) > -1, onChange: this.props.onDayChange }),
            React.createElement(Checkbox, { day: InovxLoader.t("DataTransfer:form.tue"), value: 2, defaultChecked: this.state.selectedDays.indexOf(2) > -1, onChange: this.props.onDayChange }),
            React.createElement(Checkbox, { day: InovxLoader.t("DataTransfer:form.wed"), value: 3, defaultChecked: this.state.selectedDays.indexOf(3) > -1, onChange: this.props.onDayChange }),
            React.createElement(Checkbox, { day: InovxLoader.t("DataTransfer:form.thu"), value: 4, defaultChecked: this.state.selectedDays.indexOf(4) > -1, onChange: this.props.onDayChange }),
            React.createElement(Checkbox, { day: InovxLoader.t("DataTransfer:form.fri"), value: 5, defaultChecked: this.state.selectedDays.indexOf(5) > -1, onChange: this.props.onDayChange }),
            React.createElement(Checkbox, { day: InovxLoader.t("DataTransfer:form.sat"), value: 6, defaultChecked: this.state.selectedDays.indexOf(6) > -1, onChange: this.props.onDayChange })));
    };
    return DayPicker;
}(React.Component));
var Checkbox = /** @class */ (function (_super) {
    __extends(Checkbox, _super);
    function Checkbox(props) {
        var _this = _super.call(this, props) || this;
        _this._handleCheckboxChange = function (e) {
            var daysToRun = DataTransferStore.getIsCreating() ? DataTransferStore.getTransferJobCreation().JobSchedule.DaysToRun : DataTransferStore.getEditTransferJob().JobSchedule.DaysToRun;
            var checked;
            if (e.target.checked) {
                daysToRun.push(_this.props.value);
                checked = true;
            }
            else {
                var dayIndex = daysToRun.indexOf(_this.props.value);
                if (dayIndex > -1) {
                    daysToRun.splice(dayIndex, 1);
                    checked = false;
                }
            }
            _this.props.onChange(daysToRun);
            _this.setState({
                checked: checked
            });
        };
        _this.state = {
            checked: _this.props.defaultChecked
        };
        return _this;
    }
    Checkbox.prototype.render = function () {
        var _this = this;
        var checkboxProps = {
            type: "checkbox",
            className: "job-schedule-check-box",
            id: "checkbox-".concat(this.props.day),
            onChange: function (e) { return _this._handleCheckboxChange(e); },
            checked: this.state.checked
        };
        return (React.createElement("label", { className: "date-container" },
            React.createElement("input", __assign({}, checkboxProps)),
            this.props.day));
    };
    return Checkbox;
}(React.Component));
module.exports = DayPicker;

},{"./../stores/DataTransferStore":16,"react":"react"}],8:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
// A '.tsx' file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var React = require("react");
var Inovx = require("shared.web.client");
var DataTransferActions = require("./../actions/DataTransferActions");
var DataTransferStore = require("./../stores/DataTransferStore");
var SystemStore = Inovx.Shared.System.Store;
var InovxControls = Inovx.Shared.Controls;
var DeleteAllContentModal = /** @class */ (function (_super) {
    __extends(DeleteAllContentModal, _super);
    function DeleteAllContentModal(props) {
        var _this = _super.call(this, props) || this;
        _this._handleOk = function () {
            if (!_this.state.notAcknowledged) {
                DataTransferActions.deleteAllJobContent(_this.state.deleteAllContentSetting.Name);
                DataTransferActions.closeDeleteAllContentModal();
            }
        };
        _this._onCheck = function (e) {
            _this.setState({ notAcknowledged: !e.target.checked });
        };
        _this._handleCancel = function () {
            DataTransferActions.closeDeleteAllContentModal();
        };
        _this.state = {
            deleteAllContentSetting: DataTransferStore.getEditTransferJob(),
            notAcknowledged: true
        };
        return _this;
    }
    DeleteAllContentModal.prototype.render = function () {
        var _this = this;
        var inputObj = {
            className: 'form-control',
            type: 'text',
            readOnly: this.props.readOnly ? "readonly" : null
        };
        var deleteAllContentSetting = this.state.deleteAllContentSetting;
        return (React.createElement("div", { className: "panel panel-primary connection-settings" },
            React.createElement("div", { className: "panel-heading" }, InovxLoader.t("DataTransfer:form.confirmAllContentDelection")),
            React.createElement("div", { className: "panel-body fc-margin" },
                React.createElement("div", null, InovxLoader.t("DataTransfer:form.delAllMsgPart1").replace("{0}", this.state.deleteAllContentSetting.ProjectName)),
                React.createElement("div", null, InovxLoader.t("DataTransfer:form.delAllMsgPart2").replace("{0}", this.state.deleteAllContentSetting.ProjectName)),
                React.createElement("div", null,
                    React.createElement("label", null,
                        " ",
                        React.createElement("input", { type: 'checkbox', name: 'acknowledgedChk', onClick: function (e) { return _this._onCheck(e); } }),
                        " ",
                        InovxLoader.t("DataTransfer:form.readAgreement"))),
                React.createElement("div", { className: "btn-bar-b-sm" },
                    React.createElement("button", { type: "button", className: "btn btn-primary ".concat(this.state.notAcknowledged ? "disabled" : ""), onClick: this._handleOk }, InovxLoader.t("DataTransfer:form.ok")),
                    React.createElement("button", { type: "button", className: "btn btn-default", onClick: this._handleCancel }, InovxLoader.t("DataTransfer:form.cancel"))))));
    };
    return DeleteAllContentModal;
}(React.Component));
module.exports = DeleteAllContentModal;

},{"./../actions/DataTransferActions":2,"./../stores/DataTransferStore":16,"react":"react","shared.web.client":"shared.web.client"}],9:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
// A '.tsx' file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var React = require("react");
var Inovx = require("shared.web.client");
var DataTransferActions = require("./../actions/DataTransferActions");
var DataTransferStore = require("./../stores/DataTransferStore");
var SystemStore = Inovx.Shared.System.Store;
var InovxControls = Inovx.Shared.Controls;
var DeletionTypeModal = /** @class */ (function (_super) {
    __extends(DeletionTypeModal, _super);
    function DeletionTypeModal(props) {
        var _this = _super.call(this, props) || this;
        _this._handleJobOnly = function () {
            DataTransferActions.finishDeleteTypePopup();
            DataTransferActions.beginDeleteJobOnly(_this.state.deletionJobInfo.Name);
        };
        _this._handleAllData = function () {
            DataTransferActions.finishDeleteTypePopup();
            DataTransferActions.beginDeleteAllJobContent(_this.state.deletionJobInfo.Name);
        };
        _this._handleCancel = function () {
            DataTransferActions.finishDeleteTypePopup();
        };
        _this._checkForUnsavedChanges = function () {
            if (DataTransferStore.getConnectionFormHasChanges()) {
                event.returnValue = InovxLoader.t('common:msgBox.browserSaveChanges');
            }
        };
        _this.state = {
            deletionJobInfo: DataTransferStore.getEditTransferJob()
        };
        return _this;
    }
    DeletionTypeModal.prototype.componentDidMount = function () {
        //window.addEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    DeletionTypeModal.prototype.componentWillUnmount = function () {
        //window.removeEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    DeletionTypeModal.prototype.render = function () {
        var inputObj = {
            className: 'form-control',
            type: 'text',
            readOnly: this.props.readOnly ? "readonly" : null
        };
        var coreConnectionSetting = this.state.deletionJobInfo;
        return (React.createElement("div", { className: "panel panel-primary connection-settings" },
            React.createElement("div", { className: "panel-heading" }, InovxLoader.t("DataTransfer:form.selectDeletionType")),
            React.createElement("div", { className: "panel-body fc-margin" },
                React.createElement("div", null, InovxLoader.t("DataTransfer:form.delMsgPart1")),
                React.createElement("div", null, InovxLoader.t("DataTransfer:form.delMsgPart2")),
                React.createElement("div", null, InovxLoader.t("DataTransfer:form.delMsgPart3")),
                React.createElement("div", { className: "btn-bar-b-sm" },
                    React.createElement("button", { type: "button", className: "btn btn-primary", onClick: this._handleJobOnly }, InovxLoader.t("DataTransfer:form.deleteDataTransferOnly")),
                    React.createElement("button", { type: "button", className: "btn btn-primary", onClick: this._handleAllData }, InovxLoader.t("DataTransfer:form.deleteAllContent")),
                    React.createElement("button", { type: "button", className: "btn btn-default", onClick: this._handleCancel }, InovxLoader.t("DataTransfer:form.cancel"))))));
    };
    return DeletionTypeModal;
}(React.Component));
module.exports = DeletionTypeModal;

},{"./../actions/DataTransferActions":2,"./../stores/DataTransferStore":16,"react":"react","shared.web.client":"shared.web.client"}],10:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
//A '.tsx' file enables JSX support in the TypeScript compiler, 
//for more information see the following page on the TypeScript wiki:
//https://github.com/Microsoft/TypeScript/wiki/JSX
var React = require("react");
var Inovx = require("shared.web.client");
var DayPicker = require("./DayPicker");
var DataTransferActions = require("./../actions/DataTransferActions");
var DataTransferStore = require("./../stores/DataTransferStore");
var InovxControls = Inovx.Shared.Controls;
var JobScheduler = /** @class */ (function (_super) {
    __extends(JobScheduler, _super);
    function JobScheduler(props) {
        var _this = _super.call(this, props) || this;
        _this._jobSchedule = { DaysToRun: [], StartDate: new Date().toISOString(), RunOnceDaily: true, RunEveryHours: 0, RunStartTime: "00:00", RunEndTime: "00:00", ScheduleEnabled: false };
        _this._handleFieldChange = function (value, type) {
            var hour, minute;
            switch (type) {
                case "enabled":
                    _this._jobSchedule.ScheduleEnabled = value.target.checked;
                    break;
                case "day":
                    _this._jobSchedule.DaysToRun = value;
                    break;
                case "date":
                    _this._jobSchedule.StartDate = value;
                    break;
                case "frequency":
                    _this._jobSchedule.RunEveryHours = value.Value;
                    if (_this._jobSchedule.RunEveryHours === 0) {
                        _this._jobSchedule.RunOnceDaily = true;
                    }
                    else {
                        _this._jobSchedule.RunOnceDaily = false;
                    }
                    break;
            }
            DataTransferActions.updateJobFields("JobSchedule", _this._jobSchedule);
        };
        _this._handleStartTimeChange = function (time) {
            _this._jobSchedule.RunStartTime = time;
            DataTransferActions.updateJobFields("JobSchedule", _this._jobSchedule);
        };
        _this._handleEndTimeChange = function (time) {
            _this._jobSchedule.RunEndTime = time;
            DataTransferActions.updateJobFields("JobSchedule", _this._jobSchedule);
        };
        _this._getJobFrequencies = function () {
            return [
                { Frequency: InovxLoader.t("DataTransfer:form.frequencyOnce"), Value: 0 },
                { Frequency: InovxLoader.t("DataTransfer:form.frequencyEveryHour"), Value: 1 },
                { Frequency: InovxLoader.t("DataTransfer:form.frequencyEveryTwo"), Value: 2 },
                { Frequency: InovxLoader.t("DataTransfer:form.frequencyEveryFour"), Value: 4 },
                { Frequency: InovxLoader.t("DataTransfer:form.frequencyEveryEight"), Value: 8 }
            ];
        };
        _this._selectFrequency = function () {
            var frequency;
            _this._getJobFrequencies().filter(function (object) {
                if (object.Value === _this._jobSchedule.RunEveryHours) {
                    frequency = object.Frequency;
                }
                return true;
            });
            return frequency;
        };
        _this._formatTime = function (time) {
            if (time.split(":").length === 3) {
                var array = time.split(":");
                array.pop();
                return array.join(":");
            }
            else {
                return time;
            }
        };
        _this._onChange = function () {
            _this.setState({
                jobSchedule: DataTransferStore.getTransferJobCreation().JobSchedule
            });
        };
        _this.props.editSchedule ? _this._jobSchedule = _this.props.editSchedule : null;
        _this.state = {
            jobSchedule: _this._jobSchedule
        };
        return _this;
    }
    JobScheduler.prototype.componentWillMount = function () {
        this._jobSchedule.RunStartTime = this._formatTime(this._jobSchedule.RunStartTime);
        this._jobSchedule.RunEndTime = this._formatTime(this._jobSchedule.RunEndTime);
    };
    JobScheduler.prototype.componentDidMount = function () {
        DataTransferStore.addChangeListener(this._onChange);
    };
    JobScheduler.prototype.componentWillUnmount = function () {
        DataTransferStore.removeChangeListener(this._onChange);
    };
    JobScheduler.prototype.render = function () {
        var _this = this;
        var timePickerTitle = this.state.jobSchedule.RunEveryHours > 0 ? InovxLoader.t("DataTransfer:form.between") : InovxLoader.t("DataTransfer:form.at");
        timePickerTitle += InovxLoader.t("DataTransfer:form.localDate");
        return (React.createElement("div", { className: "job-schedule-container" },
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("DataTransfer:form.schedule"), inputName: "ScheduleEnabled", className: "data-transfer-field" },
                React.createElement("label", { className: "date-container" },
                    React.createElement("input", { type: "checkbox", className: "job-schedule-check-box", onChange: function (e) { return _this._handleFieldChange(e, "enabled"); }, checked: this.state.jobSchedule.ScheduleEnabled }),
                    InovxLoader.t("DataTransfer:form.enabled"))),
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("DataTransfer:form.daysToRun"), inputName: "DaysToRun", className: "data-transfer-field" },
                React.createElement(DayPicker, { onDayChange: function (e) { return _this._handleFieldChange(e, "day"); }, defaultChecked: this._jobSchedule.DaysToRun })),
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("DataTransfer:form.startDate"), inputName: "StartDate", className: "data-transfer-field" },
                React.createElement(InovxControls.DatePicker, { onChange: function (e) { return _this._handleFieldChange(e, "date"); }, value: this._jobSchedule.StartDate, width: this.props.fieldWidth })),
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("DataTransfer:form.frequency"), inputName: "RunEveryHours", className: "data-transfer-field" },
                React.createElement(InovxControls.DropDownList, { datasource: this._getJobFrequencies(), onChange: function (e) { return _this._handleFieldChange(e, "frequency"); }, valueProp: "Frequency", displayProp: "Frequency", initialValue: this._selectFrequency(), width: "".concat(this.props.fieldWidth, "px") })),
            React.createElement(InovxControls.FormField, { title: timePickerTitle, inputName: "Time", className: "data-transfer-field" },
                React.createElement(InovxControls.TimePicker, { interval: 30, onChange: this._handleStartTimeChange, timeFormat: "HH:mm", value: this._formatTime(this._jobSchedule.RunStartTime), id: "jobStartTime", width: this.props.fieldWidth }),
                React.createElement(InovxControls.If, { condition: this.state.jobSchedule.RunEveryHours > 0 },
                    React.createElement("span", { className: "bold-blue-text" }, InovxLoader.t("DataTransfer:form.and"))),
                React.createElement(InovxControls.If, { condition: this.state.jobSchedule.RunEveryHours > 0 },
                    React.createElement(InovxControls.TimePicker, { interval: 30, onChange: this._handleEndTimeChange, timeFormat: "HH:mm", value: this._formatTime(this._jobSchedule.RunEndTime), id: "jobEndTime", width: this.props.fieldWidth })))));
    };
    return JobScheduler;
}(React.Component));
module.exports = JobScheduler;

},{"./../actions/DataTransferActions":2,"./../stores/DataTransferStore":16,"./DayPicker":7,"react":"react","shared.web.client":"shared.web.client"}],11:[function(require,module,exports){
"use strict";
var DataSourceTypeEnum;
(function (DataSourceTypeEnum) {
    DataSourceTypeEnum["Postgres"] = "Postgres";
    DataSourceTypeEnum["SqlServer"] = "SqlServer";
})(DataSourceTypeEnum || (DataSourceTypeEnum = {}));
;
module.exports = DataSourceTypeEnum;

},{}],12:[function(require,module,exports){
"use strict";
// This file is only a template for constants.  Copy and paste this to your application's constants .ts file and start off from there
// Rename all things with App_Name.
// Naming convention for constants is "[App Name]Constants.ts" i.e. UsersConstants.ts, EntitlementConstants.ts
var keymirror = require("fbjs/lib/keymirror");
// convention for constants is
// [App_Name]_[Action]
var DataTransferConstants = keymirror({
    DATATRANSFER_GET_ALL_JOBS: null,
    DATATRANSFER_BEGIN_DELETE_TYPE: null,
    DATATRANSFER_END_DELETE_TYPE: null,
    DATATRANSFER_BEGIN_DELETE_ALL: null,
    DATATRANSFER_BEGIN_CREATE: null,
    DATATRANSFER_CREATE: null,
    DATATRANSFER_BEGIN_EDIT: null,
    DATATRANSFER_EDIT: null,
    DATATRANSFER_FINISH_EDIT: null,
    DATATRANSFER_FINISH_DELETE_ALL: null,
    DATATRANSFER_FINISH_DELETE: null,
    DATATRANSFER_UPDATE_JOB_CREATION: null,
    DATATRANSFER_UPDATE_JOB_EDIT: null,
    DATATRANSFER_UPDATE_CONNECTION: null,
    DATATRANSFER_CHANGE_SELECTED_CONNECTION: null,
    DATATRANSFER_GET_ALL_CORE_CONNECTIONS: null,
    DATATRANSFER_GET_ALL_CONNECTION_PROJECTS: null,
    DATATRANSFER_BEGIN_ADD_CONNECTION: null,
    DATATRANSFER_TEST_CONNECTION: null,
    DATATRANSFER_FINISH_ADD_CONNECTION: null,
    DATATRANSFER_EDIT_CONNECTION: null,
    DATATRANSFER_CLOSE_EDIT_CONNECTION: null,
    DATATRANSFER_SAVE_CONNECTION: null,
    DATATRANSFER_DELETE_JOB: null,
    DATATRANSFER_RUN_JOB: null
});
module.exports = DataTransferConstants;

},{"fbjs/lib/keymirror":"fbjs/lib/keymirror"}],13:[function(require,module,exports){
"use strict";
var DataTransferPermissions = {
    DATATRANSFER_MANAGE: "DataTransfer.Manage",
    DATATRANSFER_RUN: "DataTransfer.Run",
};
module.exports = DataTransferPermissions;

},{}],14:[function(require,module,exports){
"use strict";
var SynchronizationStatusTypeEnum;
(function (SynchronizationStatusTypeEnum) {
    SynchronizationStatusTypeEnum["NotSynchronized"] = "0";
    SynchronizationStatusTypeEnum["Synchronized"] = "1";
    SynchronizationStatusTypeEnum["Invalid"] = "2";
    SynchronizationStatusTypeEnum["Disconnected"] = "3";
})(SynchronizationStatusTypeEnum || (SynchronizationStatusTypeEnum = {}));
;
module.exports = SynchronizationStatusTypeEnum;

},{}],15:[function(require,module,exports){
"use strict";
// This file is only a template for services.  Copy and paste this to your application's service .ts file and start off from there
// Rename all things with App_Name.
// Naming convention for services is "[App Name]Services.ts" i.e. UsersServices.ts, EntitlementServices.ts
var Inovx = require("shared.web.client");
var assign = require("object-assign");
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
var url = UrlUtilities.getApiUrl() + '/DataTransferApi/api/DataTransfer';
var DataTransferServices = assign({}, Inovx.Shared.Flux.BaseService, {
    //Replace method accordingly
    getAllJobs: function (successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.get("".concat(url, "/GetAll"), null, function (retData) {
            successCallback(retData);
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    getJobDetails: function (jobName, successCallback, errorCallback) {
        var _this = this;
        this.get("".concat(url, "/Details"), { jobName: jobName }, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    getAllConnections: function (successCallback, errorCallback) {
        var _this = this;
        this.get("".concat(url, "/GetAllCoreConnections"), null, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    getAllConnectionProjects: function (id, successCallback, errorCallback) {
        var _this = this;
        this.get("".concat(url, "/GetAllConfigurationProjects"), { id: id }, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    createJob: function (job, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/Create"), job, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    editJob: function (jobName, job, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/Update"), { jobName: jobName, data: job }, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    editJobSchedule: function (jobName, jobSchedule, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/UpdateSchedule"), { jobName: jobName, jobSchedule: jobSchedule }, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    deleteJob: function (jobName, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/Delete"), { jobName: jobName }, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    deleteAllJob: function (jobName, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/DeleteProject"), { jobName: jobName }, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    testCoreConnection: function (configuration, successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.post("".concat(url, "/TestConnection"), configuration, function (retData) {
            successCallback(retData);
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    createCoreConnection: function (configuration, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/CreateConfig"), configuration, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    runJob: function (jobName, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/RunJob"), { jobName: jobName }, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    }
});
module.exports = DataTransferServices;

},{"object-assign":18,"shared.web.client":"shared.web.client"}],16:[function(require,module,exports){
"use strict";
// This file is only a template for Stores.  Copy and paste this to your application store .ts file and start off from there
// Rename all things with App_Name.
// Naming convention for Stores is "[App Name]Store.ts" i.e. UserStore.ts, EntitlementStore.ts
var NodeEvents = require("events");
var Inovx = require("shared.web.client");
var assign = require("object-assign");
var DataTransferConstants = require("./../constants/DataTransferConstants");
var SynchronizationStatusTypeEnum = require("./../constants/SynchronizationStatusTypeEnum");
var EventEmitter = NodeEvents.EventEmitter;
var DateTimeFormatHelper = Inovx.Shared.Common.DateTimeFormatHelper;
var CHANGE_EVENT = 'DataTransfer.change';
var _isCreatingJob = false, _changesMadeToJob = false, _connectionFormChangesMade = false, _transferJobCreation = getBlankTransferJobCreation(), _editTransferJob = getBlankTransferJobInfo(), _transferJobs = [], _coreConnectionSetting = getBlankCoreSettings(), _coreConnections = [], _selectedConnection = getBlankConnectionName(), _connectionValid = false, _connectionProjects = [], _connectionModalVisible = false, _editConnectionModalVisible = false, _deleteConfirmationVisible = false, _modalVisible = false, _deletionTypeVisible = false, _deleteAllVisible = false;
function setCoreConnection(connections) {
    _coreConnections = connections;
}
function setBeginCreatingNewJob() {
    resetJobModalData();
    _isCreatingJob = true;
    _modalVisible = true;
}
function setBeginEdittingJob(jobDetails) {
    resetJobModalData();
    _isCreatingJob = false;
    _modalVisible = true;
    _editTransferJob = jobDetails;
}
function resetJobModalData() {
    _connectionModalVisible = false;
    _editConnectionModalVisible = false;
    _changesMadeToJob = false;
    _connectionValid = false;
    _connectionProjects = [];
    _transferJobCreation = getBlankTransferJobCreation();
    _editTransferJob = getBlankTransferJobInfo();
    _selectedConnection = getBlankConnectionName();
}
function setBeginDeletionTypePopup(jobDetails) {
    _editTransferJob = jobDetails;
    _deletionTypeVisible = true;
}
function setBeginDeleteAllPopup() {
    _deleteAllVisible = true;
}
function setEndDeleteAllPopup() {
    _deleteAllVisible = false;
}
function setEndDeletionTypePopup() {
    _deletionTypeVisible = false;
}
function setBeginAddingConnection() {
    _connectionModalVisible = true;
    if (!_isCreatingJob && !_editConnectionModalVisible) {
        var SqlServerName = _editTransferJob.SqlServerName, SqlServerInstance = _editTransferJob.SqlServerInstance, SqlServerPort = _editTransferJob.SqlServerPort, CoreServerName = _editTransferJob.CoreServerName, CoreVersion = _editTransferJob.CoreVersion;
        _coreConnectionSetting.SqlServerName = SqlServerName;
        _coreConnectionSetting.SqlServerInstance = SqlServerInstance;
        _coreConnectionSetting.SqlServerTcpPort = SqlServerPort.toString() === '0' ? '' : SqlServerPort;
        _coreConnectionSetting.CoreServerName = CoreServerName;
        _coreConnectionSetting.Version = CoreVersion;
    }
}
function setFinishAddingConnection() {
    _connectionModalVisible = false;
    _connectionFormChangesMade = false;
    _coreConnectionSetting = getBlankCoreSettings();
}
function getBlankTransferJobCreation() {
    return {
        ProjectName: "",
        CoreProjectName: "",
        CoreConnectionId: "",
        JobSchedule: getBlankJobSchedule()
    };
}
function getBlankTransferJobInfo() {
    return {
        Name: "",
        ProjectName: "",
        VSuiteCoreProjectName: "",
        SqlServerName: "",
        SqlServerInstance: "",
        ScheduleEnabled: false,
        SqlServerPort: "",
        CoreServerName: "",
        CoreVersion: "",
        JobSchedule: getBlankJobSchedule(),
        Synchronization: "",
        SynchronizationStatus: "",
        LastTransferDate: ""
    };
}
function getBlankCoreSettings() {
    return {
        ConfigurationName: "",
        SqlServerName: "",
        SqlServerInstance: "",
        SqlServerTcpPort: "",
        CoreServerName: "",
        CoreAdminPassword: "",
        Version: "6.2"
    };
}
function getBlankConnectionName() {
    return { Id: "", Name: "" };
}
function getBlankJobSchedule() {
    return {
        DaysToRun: [],
        StartDate: new Date().toISOString(),
        RunOnceDaily: true,
        RunEveryHours: 0,
        RunStartTime: "00:00",
        RunEndTime: "00:00",
        ScheduleEnabled: false
    };
}
function updateJobCreation(key, value) {
    _changesMadeToJob = true;
    _transferJobCreation[key] = value;
    if (!_isCreatingJob) {
        if (key === "CoreProjectName") {
            _editTransferJob.VSuiteCoreProjectName = value;
        }
    }
}
function updateConnection(key, value) {
    _connectionFormChangesMade = true;
    _connectionValid = false;
    _coreConnectionSetting[key] = value;
}
var DataTransferStore = assign({}, EventEmitter.prototype, {
    // Add store getters here
    getAllJobs: function () {
        return _transferJobs;
    },
    getTransferJobCreation: function () {
        return _transferJobCreation;
    },
    getEditTransferJob: function () {
        return _editTransferJob;
    },
    getAllCoreConnections: function () {
        return _coreConnections;
    },
    getConnectionProjects: function () {
        return _connectionProjects;
    },
    getSelectedConnection: function () {
        return _selectedConnection;
    },
    getCoreConnectionSetting: function () {
        return _coreConnectionSetting;
    },
    getIsCreating: function () {
        return _isCreatingJob;
    },
    getHasJobChanges: function () {
        return _changesMadeToJob;
    },
    getConnectionFormHasChanges: function () {
        return _connectionFormChangesMade;
    },
    getConnectionValidity: function () {
        return _connectionValid;
    },
    getConnectionModalVisible: function () {
        return _connectionModalVisible;
    },
    getEditConnectionModalVisible: function () {
        return _editConnectionModalVisible;
    },
    getDeletionTypeVisible: function () {
        return _deletionTypeVisible;
    },
    getModalVisible: function () {
        return _modalVisible;
    },
    getDeletionTypeModalVisible: function () {
        return _deletionTypeVisible;
    },
    getDeleteAllModalVisible: function () {
        return _deleteAllVisible;
    },
    emitChange: function () {
        this.emit(CHANGE_EVENT);
    },
    addChangeListener: function (callback) {
        this.on(CHANGE_EVENT, callback);
    },
    removeChangeListener: function (callback) {
        this.removeListener(CHANGE_EVENT, callback);
    }
});
function ShowCustomDialog() {
    ShowDialogBox('Warning', 'Record updated successfully.', 'Ok', '', 'GoToAssetList', null);
}
function ShowDialogBox(title, content, btn1text, btn2text, functionText, parameterList) {
    var btn1css;
    var btn2css;
    if (btn1text == '') {
        btn1css = "hidecss";
    }
    else {
        btn1css = "showcss";
    }
    if (btn2text == '') {
        btn2css = "hidecss";
    }
    else {
        btn2css = "showcss";
    }
    $("#lblMessage").html(content);
    var dialog = document.createElement("DIALOG");
    $("#dialog").dialog({
        resizable: false,
        title: title,
        modal: true,
        width: '400px',
        height: 'auto',
        bgiframe: false,
        hide: { effect: 'scale', duration: 400 },
        buttons: [
            {
                text: btn1text,
                "class": btn1css,
                click: function () {
                    $("#dialog").dialog('close');
                }
            },
            {
                text: btn2text,
                "class": btn2css,
                click: function () {
                    $("#dialog").dialog('close');
                }
            }
        ]
    });
}
function fixJobData(data) {
    if (data) {
        data.forEach(function (job) {
            if (job.SynchronizationStatus == SynchronizationStatusTypeEnum.NotSynchronized) {
                job.Synchronization = InovxLoader.t("DataTransfer:grid.notSynchronized");
            }
            else if (job.SynchronizationStatus == SynchronizationStatusTypeEnum.Synchronized) {
                job.Synchronization = DateTimeFormatHelper.getFormatDate(job.LastTransferDate) + " " + DateTimeFormatHelper.getFormatTime(job.LastTransferDate, false);
            }
            else if (job.SynchronizationStatus == SynchronizationStatusTypeEnum.Invalid) {
                job.Synchronization = InovxLoader.t("DataTransfer:grid.invalid");
            }
            else if (job.SynchronizationStatus == SynchronizationStatusTypeEnum.Disconnected) {
                job.Synchronization = InovxLoader.t("DataTransfer:grid.disconnected");
            }
        });
    }
}
Inovx.Shared.Flux.AppDispatcher.register(function (payload) {
    switch (payload.actionType) {
        case DataTransferConstants.DATATRANSFER_BEGIN_DELETE_TYPE:
            setBeginDeletionTypePopup(payload.data);
            break;
        case DataTransferConstants.DATATRANSFER_END_DELETE_TYPE:
            setEndDeletionTypePopup();
            break;
        case DataTransferConstants.DATATRANSFER_BEGIN_DELETE_ALL:
            setBeginDeleteAllPopup();
            break;
        case DataTransferConstants.DATATRANSFER_FINISH_DELETE_ALL:
            setEndDeleteAllPopup();
            break;
        case DataTransferConstants.DATATRANSFER_GET_ALL_JOBS:
            _transferJobs = payload.data;
            fixJobData(_transferJobs);
            break;
        case DataTransferConstants.DATATRANSFER_BEGIN_CREATE:
            setBeginCreatingNewJob();
            break;
        case DataTransferConstants.DATATRANSFER_BEGIN_EDIT:
            setBeginEdittingJob(payload.data);
            break;
        case DataTransferConstants.DATATRANSFER_FINISH_EDIT:
            _modalVisible = false;
            _changesMadeToJob = false;
            break;
        case DataTransferConstants.DATATRANSFER_CHANGE_SELECTED_CONNECTION:
            _selectedConnection = payload.data;
            break;
        case DataTransferConstants.DATATRANSFER_GET_ALL_CORE_CONNECTIONS:
            setCoreConnection(payload.data);
            break;
        case DataTransferConstants.DATATRANSFER_GET_ALL_CONNECTION_PROJECTS:
            _connectionProjects = payload.data;
            break;
        case DataTransferConstants.DATATRANSFER_UPDATE_JOB_CREATION:
            updateJobCreation(payload.key, payload.value);
            break;
        case DataTransferConstants.DATATRANSFER_UPDATE_CONNECTION:
            updateConnection(payload.key, payload.value);
            break;
        case DataTransferConstants.DATATRANSFER_BEGIN_ADD_CONNECTION:
            setBeginAddingConnection();
            break;
        case DataTransferConstants.DATATRANSFER_FINISH_ADD_CONNECTION:
            setFinishAddingConnection();
            break;
        case DataTransferConstants.DATATRANSFER_TEST_CONNECTION:
            _connectionValid = true;
            break;
        case DataTransferConstants.DATATRANSFER_EDIT_CONNECTION:
            _editConnectionModalVisible = true;
            break;
        case DataTransferConstants.DATATRANSFER_CLOSE_EDIT_CONNECTION:
            _editConnectionModalVisible = false;
            break;
        default: return true;
    }
    DataTransferStore.emitChange();
    return true;
});
module.exports = DataTransferStore;

},{"./../constants/DataTransferConstants":12,"./../constants/SynchronizationStatusTypeEnum":14,"events":17,"object-assign":18,"shared.web.client":"shared.web.client"}],17:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var objectCreate = Object.create || objectCreatePolyfill
var objectKeys = Object.keys || objectKeysPolyfill
var bind = Function.prototype.bind || functionBindPolyfill

function EventEmitter() {
  if (!this._events || !Object.prototype.hasOwnProperty.call(this, '_events')) {
    this._events = objectCreate(null);
    this._eventsCount = 0;
  }

  this._maxListeners = this._maxListeners || undefined;
}
module.exports = EventEmitter;

// Backwards-compat with node 0.10.x
EventEmitter.EventEmitter = EventEmitter;

EventEmitter.prototype._events = undefined;
EventEmitter.prototype._maxListeners = undefined;

// By default EventEmitters will print a warning if more than 10 listeners are
// added to it. This is a useful default which helps finding memory leaks.
var defaultMaxListeners = 10;

var hasDefineProperty;
try {
  var o = {};
  if (Object.defineProperty) Object.defineProperty(o, 'x', { value: 0 });
  hasDefineProperty = o.x === 0;
} catch (err) { hasDefineProperty = false }
if (hasDefineProperty) {
  Object.defineProperty(EventEmitter, 'defaultMaxListeners', {
    enumerable: true,
    get: function() {
      return defaultMaxListeners;
    },
    set: function(arg) {
      // check whether the input is a positive number (whose value is zero or
      // greater and not a NaN).
      if (typeof arg !== 'number' || arg < 0 || arg !== arg)
        throw new TypeError('"defaultMaxListeners" must be a positive number');
      defaultMaxListeners = arg;
    }
  });
} else {
  EventEmitter.defaultMaxListeners = defaultMaxListeners;
}

// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
EventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {
  if (typeof n !== 'number' || n < 0 || isNaN(n))
    throw new TypeError('"n" argument must be a positive number');
  this._maxListeners = n;
  return this;
};

function $getMaxListeners(that) {
  if (that._maxListeners === undefined)
    return EventEmitter.defaultMaxListeners;
  return that._maxListeners;
}

EventEmitter.prototype.getMaxListeners = function getMaxListeners() {
  return $getMaxListeners(this);
};

// These standalone emit* functions are used to optimize calling of event
// handlers for fast cases because emit() itself often has a variable number of
// arguments and can be deoptimized because of that. These functions always have
// the same number of arguments and thus do not get deoptimized, so the code
// inside them can execute faster.
function emitNone(handler, isFn, self) {
  if (isFn)
    handler.call(self);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self);
  }
}
function emitOne(handler, isFn, self, arg1) {
  if (isFn)
    handler.call(self, arg1);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1);
  }
}
function emitTwo(handler, isFn, self, arg1, arg2) {
  if (isFn)
    handler.call(self, arg1, arg2);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1, arg2);
  }
}
function emitThree(handler, isFn, self, arg1, arg2, arg3) {
  if (isFn)
    handler.call(self, arg1, arg2, arg3);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1, arg2, arg3);
  }
}

function emitMany(handler, isFn, self, args) {
  if (isFn)
    handler.apply(self, args);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].apply(self, args);
  }
}

EventEmitter.prototype.emit = function emit(type) {
  var er, handler, len, args, i, events;
  var doError = (type === 'error');

  events = this._events;
  if (events)
    doError = (doError && events.error == null);
  else if (!doError)
    return false;

  // If there is no 'error' event listener then throw.
  if (doError) {
    if (arguments.length > 1)
      er = arguments[1];
    if (er instanceof Error) {
      throw er; // Unhandled 'error' event
    } else {
      // At least give some kind of context to the user
      var err = new Error('Unhandled "error" event. (' + er + ')');
      err.context = er;
      throw err;
    }
    return false;
  }

  handler = events[type];

  if (!handler)
    return false;

  var isFn = typeof handler === 'function';
  len = arguments.length;
  switch (len) {
      // fast cases
    case 1:
      emitNone(handler, isFn, this);
      break;
    case 2:
      emitOne(handler, isFn, this, arguments[1]);
      break;
    case 3:
      emitTwo(handler, isFn, this, arguments[1], arguments[2]);
      break;
    case 4:
      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);
      break;
      // slower
    default:
      args = new Array(len - 1);
      for (i = 1; i < len; i++)
        args[i - 1] = arguments[i];
      emitMany(handler, isFn, this, args);
  }

  return true;
};

function _addListener(target, type, listener, prepend) {
  var m;
  var events;
  var existing;

  if (typeof listener !== 'function')
    throw new TypeError('"listener" argument must be a function');

  events = target._events;
  if (!events) {
    events = target._events = objectCreate(null);
    target._eventsCount = 0;
  } else {
    // To avoid recursion in the case that type === "newListener"! Before
    // adding it to the listeners, first emit "newListener".
    if (events.newListener) {
      target.emit('newListener', type,
          listener.listener ? listener.listener : listener);

      // Re-assign `events` because a newListener handler could have caused the
      // this._events to be assigned to a new object
      events = target._events;
    }
    existing = events[type];
  }

  if (!existing) {
    // Optimize the case of one listener. Don't need the extra array object.
    existing = events[type] = listener;
    ++target._eventsCount;
  } else {
    if (typeof existing === 'function') {
      // Adding the second element, need to change to array.
      existing = events[type] =
          prepend ? [listener, existing] : [existing, listener];
    } else {
      // If we've already got an array, just append.
      if (prepend) {
        existing.unshift(listener);
      } else {
        existing.push(listener);
      }
    }

    // Check for listener leak
    if (!existing.warned) {
      m = $getMaxListeners(target);
      if (m && m > 0 && existing.length > m) {
        existing.warned = true;
        var w = new Error('Possible EventEmitter memory leak detected. ' +
            existing.length + ' "' + String(type) + '" listeners ' +
            'added. Use emitter.setMaxListeners() to ' +
            'increase limit.');
        w.name = 'MaxListenersExceededWarning';
        w.emitter = target;
        w.type = type;
        w.count = existing.length;
        if (typeof console === 'object' && console.warn) {
          console.warn('%s: %s', w.name, w.message);
        }
      }
    }
  }

  return target;
}

EventEmitter.prototype.addListener = function addListener(type, listener) {
  return _addListener(this, type, listener, false);
};

EventEmitter.prototype.on = EventEmitter.prototype.addListener;

EventEmitter.prototype.prependListener =
    function prependListener(type, listener) {
      return _addListener(this, type, listener, true);
    };

function onceWrapper() {
  if (!this.fired) {
    this.target.removeListener(this.type, this.wrapFn);
    this.fired = true;
    switch (arguments.length) {
      case 0:
        return this.listener.call(this.target);
      case 1:
        return this.listener.call(this.target, arguments[0]);
      case 2:
        return this.listener.call(this.target, arguments[0], arguments[1]);
      case 3:
        return this.listener.call(this.target, arguments[0], arguments[1],
            arguments[2]);
      default:
        var args = new Array(arguments.length);
        for (var i = 0; i < args.length; ++i)
          args[i] = arguments[i];
        this.listener.apply(this.target, args);
    }
  }
}

function _onceWrap(target, type, listener) {
  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };
  var wrapped = bind.call(onceWrapper, state);
  wrapped.listener = listener;
  state.wrapFn = wrapped;
  return wrapped;
}

EventEmitter.prototype.once = function once(type, listener) {
  if (typeof listener !== 'function')
    throw new TypeError('"listener" argument must be a function');
  this.on(type, _onceWrap(this, type, listener));
  return this;
};

EventEmitter.prototype.prependOnceListener =
    function prependOnceListener(type, listener) {
      if (typeof listener !== 'function')
        throw new TypeError('"listener" argument must be a function');
      this.prependListener(type, _onceWrap(this, type, listener));
      return this;
    };

// Emits a 'removeListener' event if and only if the listener was removed.
EventEmitter.prototype.removeListener =
    function removeListener(type, listener) {
      var list, events, position, i, originalListener;

      if (typeof listener !== 'function')
        throw new TypeError('"listener" argument must be a function');

      events = this._events;
      if (!events)
        return this;

      list = events[type];
      if (!list)
        return this;

      if (list === listener || list.listener === listener) {
        if (--this._eventsCount === 0)
          this._events = objectCreate(null);
        else {
          delete events[type];
          if (events.removeListener)
            this.emit('removeListener', type, list.listener || listener);
        }
      } else if (typeof list !== 'function') {
        position = -1;

        for (i = list.length - 1; i >= 0; i--) {
          if (list[i] === listener || list[i].listener === listener) {
            originalListener = list[i].listener;
            position = i;
            break;
          }
        }

        if (position < 0)
          return this;

        if (position === 0)
          list.shift();
        else
          spliceOne(list, position);

        if (list.length === 1)
          events[type] = list[0];

        if (events.removeListener)
          this.emit('removeListener', type, originalListener || listener);
      }

      return this;
    };

EventEmitter.prototype.removeAllListeners =
    function removeAllListeners(type) {
      var listeners, events, i;

      events = this._events;
      if (!events)
        return this;

      // not listening for removeListener, no need to emit
      if (!events.removeListener) {
        if (arguments.length === 0) {
          this._events = objectCreate(null);
          this._eventsCount = 0;
        } else if (events[type]) {
          if (--this._eventsCount === 0)
            this._events = objectCreate(null);
          else
            delete events[type];
        }
        return this;
      }

      // emit removeListener for all listeners on all events
      if (arguments.length === 0) {
        var keys = objectKeys(events);
        var key;
        for (i = 0; i < keys.length; ++i) {
          key = keys[i];
          if (key === 'removeListener') continue;
          this.removeAllListeners(key);
        }
        this.removeAllListeners('removeListener');
        this._events = objectCreate(null);
        this._eventsCount = 0;
        return this;
      }

      listeners = events[type];

      if (typeof listeners === 'function') {
        this.removeListener(type, listeners);
      } else if (listeners) {
        // LIFO order
        for (i = listeners.length - 1; i >= 0; i--) {
          this.removeListener(type, listeners[i]);
        }
      }

      return this;
    };

function _listeners(target, type, unwrap) {
  var events = target._events;

  if (!events)
    return [];

  var evlistener = events[type];
  if (!evlistener)
    return [];

  if (typeof evlistener === 'function')
    return unwrap ? [evlistener.listener || evlistener] : [evlistener];

  return unwrap ? unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);
}

EventEmitter.prototype.listeners = function listeners(type) {
  return _listeners(this, type, true);
};

EventEmitter.prototype.rawListeners = function rawListeners(type) {
  return _listeners(this, type, false);
};

EventEmitter.listenerCount = function(emitter, type) {
  if (typeof emitter.listenerCount === 'function') {
    return emitter.listenerCount(type);
  } else {
    return listenerCount.call(emitter, type);
  }
};

EventEmitter.prototype.listenerCount = listenerCount;
function listenerCount(type) {
  var events = this._events;

  if (events) {
    var evlistener = events[type];

    if (typeof evlistener === 'function') {
      return 1;
    } else if (evlistener) {
      return evlistener.length;
    }
  }

  return 0;
}

EventEmitter.prototype.eventNames = function eventNames() {
  return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [];
};

// About 1.5x faster than the two-arg version of Array#splice().
function spliceOne(list, index) {
  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)
    list[i] = list[k];
  list.pop();
}

function arrayClone(arr, n) {
  var copy = new Array(n);
  for (var i = 0; i < n; ++i)
    copy[i] = arr[i];
  return copy;
}

function unwrapListeners(arr) {
  var ret = new Array(arr.length);
  for (var i = 0; i < ret.length; ++i) {
    ret[i] = arr[i].listener || arr[i];
  }
  return ret;
}

function objectCreatePolyfill(proto) {
  var F = function() {};
  F.prototype = proto;
  return new F;
}
function objectKeysPolyfill(obj) {
  var keys = [];
  for (var k in obj) if (Object.prototype.hasOwnProperty.call(obj, k)) {
    keys.push(k);
  }
  return k;
}
function functionBindPolyfill(context) {
  var fn = this;
  return function () {
    return fn.apply(context, arguments);
  };
}

},{}],18:[function(require,module,exports){
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/

'use strict';
/* eslint-disable no-unused-vars */
var getOwnPropertySymbols = Object.getOwnPropertySymbols;
var hasOwnProperty = Object.prototype.hasOwnProperty;
var propIsEnumerable = Object.prototype.propertyIsEnumerable;

function toObject(val) {
	if (val === null || val === undefined) {
		throw new TypeError('Object.assign cannot be called with null or undefined');
	}

	return Object(val);
}

function shouldUseNative() {
	try {
		if (!Object.assign) {
			return false;
		}

		// Detect buggy property enumeration order in older V8 versions.

		// https://bugs.chromium.org/p/v8/issues/detail?id=4118
		var test1 = new String('abc');  // eslint-disable-line no-new-wrappers
		test1[5] = 'de';
		if (Object.getOwnPropertyNames(test1)[0] === '5') {
			return false;
		}

		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
		var test2 = {};
		for (var i = 0; i < 10; i++) {
			test2['_' + String.fromCharCode(i)] = i;
		}
		var order2 = Object.getOwnPropertyNames(test2).map(function (n) {
			return test2[n];
		});
		if (order2.join('') !== '0123456789') {
			return false;
		}

		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
		var test3 = {};
		'abcdefghijklmnopqrst'.split('').forEach(function (letter) {
			test3[letter] = letter;
		});
		if (Object.keys(Object.assign({}, test3)).join('') !==
				'abcdefghijklmnopqrst') {
			return false;
		}

		return true;
	} catch (err) {
		// We don't expect any of the above to throw, but better to be safe.
		return false;
	}
}

module.exports = shouldUseNative() ? Object.assign : function (target, source) {
	var from;
	var to = toObject(target);
	var symbols;

	for (var s = 1; s < arguments.length; s++) {
		from = Object(arguments[s]);

		for (var key in from) {
			if (hasOwnProperty.call(from, key)) {
				to[key] = from[key];
			}
		}

		if (getOwnPropertySymbols) {
			symbols = getOwnPropertySymbols(from);
			for (var i = 0; i < symbols.length; i++) {
				if (propIsEnumerable.call(from, symbols[i])) {
					to[symbols[i]] = from[symbols[i]];
				}
			}
		}
	}

	return to;
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJiaW4vanMtb3V0L2FwcC9BcHAuanMiLCJiaW4vanMtb3V0L2FwcC9hY3Rpb25zL0RhdGFUcmFuc2ZlckFjdGlvbnMuanMiLCJiaW4vanMtb3V0L2FwcC9jb21wb25lbnRzL0NvcmVDb25uZWN0aW9uRWRpdE1vZGFsLmpzIiwiYmluL2pzLW91dC9hcHAvY29tcG9uZW50cy9Db3JlQ29ubmVjdGlvblNldHRpbmdzTW9kYWwuanMiLCJiaW4vanMtb3V0L2FwcC9jb21wb25lbnRzL0RhdGFUcmFuc2ZlckFwcC5qcyIsImJpbi9qcy1vdXQvYXBwL2NvbXBvbmVudHMvRGF0YVRyYW5zZmVyRm9ybS5qcyIsImJpbi9qcy1vdXQvYXBwL2NvbXBvbmVudHMvRGF5UGlja2VyLmpzIiwiYmluL2pzLW91dC9hcHAvY29tcG9uZW50cy9EZWxldGVBbGxDb250ZW50TW9kYWwuanMiLCJiaW4vanMtb3V0L2FwcC9jb21wb25lbnRzL0RlbGV0aW9uVHlwZU1vZGFsLmpzIiwiYmluL2pzLW91dC9hcHAvY29tcG9uZW50cy9Kb2JTY2hlZHVsZXIuanMiLCJiaW4vanMtb3V0L2FwcC9jb25zdGFudHMvRGF0YVNvdXJjZVR5cGVFbnVtLmpzIiwiYmluL2pzLW91dC9hcHAvY29uc3RhbnRzL0RhdGFUcmFuc2ZlckNvbnN0YW50cy5qcyIsImJpbi9qcy1vdXQvYXBwL2NvbnN0YW50cy9EYXRhVHJhbnNmZXJQZXJtaXNzaW9ucy5qcyIsImJpbi9qcy1vdXQvYXBwL2NvbnN0YW50cy9TeW5jaHJvbml6YXRpb25TdGF0dXNUeXBlRW51bS5qcyIsImJpbi9qcy1vdXQvYXBwL3NlcnZpY2VzL0RhdGFUcmFuc2ZlclNlcnZpY2VzLmpzIiwiYmluL2pzLW91dC9hcHAvc3RvcmVzL0RhdGFUcmFuc2ZlclN0b3JlLmpzIiwibm9kZV9tb2R1bGVzL2V2ZW50cy9ldmVudHMuanMiLCJub2RlX21vZHVsZXMvb2JqZWN0LWFzc2lnbi9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1WEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdk9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gwqkgMjAwMS0yMDE1IElOT1Z4IFNvbHV0aW9ucywgSW5jLlxyXG4vLyAxMTQgUGFjaWZpY2EgU3VpdGUgMzAwLCBJcnZpbmUsIENBIDkyNjE4IFVTQVxyXG4vLyBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vL1xyXG4vLyBUaGlzIHNvZnR3YXJlIGlzIGNvbmZpZGVudGlhbCwgcHJvcHJpZXRhcnkgYW5kIHVucHVibGlzaGVkIHByb3BlcnR5IG9mXHJcbi8vIElOT1Z4IFNvbHV0aW9ucywgSW5jLiAgSXQgbWF5IE5PVCBiZSBjb3BpZWQgaW4gcGFydCBvciBpbiB3aG9sZSBvbiBhbnlcclxuLy8gbWVkaXVtLCBlaXRoZXIgZWxlY3Ryb25pYyBvciBwcmludGVkLCB3aXRob3V0IHRoZSBleHByZXNzIHdyaXR0ZW4gY29uc2VudFxyXG4vLyBvZiBJTk9WeCBTb2x1dGlvbnMsIEluYy5cclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG52YXIgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XHJcbnZhciBSZWFjdERPTSA9IHJlcXVpcmUoXCJyZWFjdC1kb21cIik7XHJcbnZhciBEYXRhVHJhbnNmZXJBcHAgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL0RhdGFUcmFuc2ZlckFwcFwiKTtcclxudHJ5IHtcclxuICAgIElub3Z4TG9hZGVyLnVwZGF0ZUhlbHAoJ2RhdGEtdHJhbnNmZXInKTtcclxufVxyXG5jYXRjaCAoZSkge1xyXG59XHJcblJlYWN0RE9NLnJlbmRlcihSZWFjdC5jcmVhdGVFbGVtZW50KERhdGFUcmFuc2ZlckFwcCwgbnVsbCksIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRhdHJhbnNmZXInKSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gVGhpcyBmaWxlIGlzIG9ubHkgYSB0ZW1wbGF0ZSBmb3IgYWN0aW9ucy4gIENvcHkgYW5kIHBhc3RlIHRoaXMgdG8geW91ciBhcHBsaWNhdGlvbidzIGFjdGlvbnMgLnRzIGZpbGUgYW5kIHN0YXJ0IG9mZiBmcm9tIHRoZXJlXHJcbi8vIFJlbmFtZSBhbGwgdGhpbmdzIHdpdGggQXBwX05hbWUuXHJcbi8vIE5hbWluZyBjb252ZW50aW9uIGZvciBhY3Rpb25zIGlzIFwiW0FwcCBOYW1lXUFjdGlvbnMudHNcIiBpLmUuIFVzZXJzQWN0aW9ucy50cywgRW50aXRsZW1lbnRBY3Rpb25zLnRzXHJcbnZhciBJbm92eCA9IHJlcXVpcmUoXCJzaGFyZWQud2ViLmNsaWVudFwiKTtcclxudmFyIERhdGFUcmFuc2ZlckNvbnN0YW50cyA9IHJlcXVpcmUoXCIuLy4uL2NvbnN0YW50cy9EYXRhVHJhbnNmZXJDb25zdGFudHNcIik7XHJcbnZhciBEYXRhVHJhbnNmZXJTZXJ2aWNlcyA9IHJlcXVpcmUoXCIuLy4uL3NlcnZpY2VzL0RhdGFUcmFuc2ZlclNlcnZpY2VzXCIpO1xyXG52YXIgRGF0YVRyYW5zZmVyU3RvcmUgPSByZXF1aXJlKFwiLi8uLi9zdG9yZXMvRGF0YVRyYW5zZmVyU3RvcmVcIik7XHJcbnZhciBTeXN0ZW1BY3Rpb25zID0gSW5vdnguU2hhcmVkLlN5c3RlbS5BY3Rpb25zO1xyXG52YXIgU3lzdGVtU3RvcmUgPSBJbm92eC5TaGFyZWQuU3lzdGVtLlN0b3JlO1xyXG5mdW5jdGlvbiBfcmVjZWl2ZUFsbEpvYnMoZGF0YSkge1xyXG4gICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgYWN0aW9uVHlwZTogRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9HRVRfQUxMX0pPQlMsXHJcbiAgICAgICAgZGF0YTogZGF0YVxyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gX3JlY2VpdmVDb3JlQ29ubmVjdGlvbnMoZGF0YSkge1xyXG4gICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgYWN0aW9uVHlwZTogRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9HRVRfQUxMX0NPUkVfQ09OTkVDVElPTlMsXHJcbiAgICAgICAgZGF0YTogZGF0YVxyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gX3JlY2VpdmVDb25uZWN0aW9uUHJvamVjdHMoZGF0YSkge1xyXG4gICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgYWN0aW9uVHlwZTogRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9HRVRfQUxMX0NPTk5FQ1RJT05fUFJPSkVDVFMsXHJcbiAgICAgICAgZGF0YTogZGF0YVxyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gX3Rlc3RDb3JlQ29ubmVjdGlvbigpIHtcclxuICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgIGFjdGlvblR5cGU6IERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfVEVTVF9DT05ORUNUSU9OXHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBfZmluaXNoRWRpdENvbm5lY3Rpb25Gb3JtKCkge1xyXG4gICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgYWN0aW9uVHlwZTogRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9GSU5JU0hfQUREX0NPTk5FQ1RJT05cclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIF9maW5pc2hEZWxldGVUeXBlKCkge1xyXG4gICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgYWN0aW9uVHlwZTogRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9FTkRfREVMRVRFX1RZUEVcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIF9maW5pc2hFZGl0KCkge1xyXG4gICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgYWN0aW9uVHlwZTogRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9GSU5JU0hfRURJVFxyXG4gICAgfSk7XHJcbn1cclxudmFyIERhdGFUcmFuc2ZlckFjdGlvbnMgPSB7XHJcbiAgICBnZXRBbGxKb2JzOiBmdW5jdGlvbiAoY2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIGlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgIERhdGFUcmFuc2ZlclNlcnZpY2VzLmdldEFsbEpvYnMoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF9yZWNlaXZlQWxsSm9icyhkYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgaWYgKGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgaWdub3JlRGVmYXVsdEVycm9yKTtcclxuICAgIH0sXHJcbiAgICByZWZyZXNoRGF0YTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuZ2V0QWxsSm9icygpO1xyXG4gICAgfSxcclxuICAgIHJlZnJlc2hDb25uZWN0aW9uczogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5nZXRBbGxDb3JlQ29ubmVjdGlvbnMoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgYmVnaW5DcmVhdGVOZXdKb2I6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgYWN0aW9uVHlwZTogRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9CRUdJTl9DUkVBVEVcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBjcmVhdGVKb2I6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfQ1JFQVRFKSkge1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmJlZ2luQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfQ1JFQVRFKTtcclxuICAgICAgICAgICAgaWYgKERhdGFUcmFuc2ZlclN0b3JlLmdldFRyYW5zZmVySm9iQ3JlYXRpb24oKS5Kb2JTY2hlZHVsZS5EYXlzVG9SdW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgRGF0YVRyYW5zZmVyU2VydmljZXMuY3JlYXRlSm9iKERhdGFUcmFuc2ZlclN0b3JlLmdldFRyYW5zZmVySm9iQ3JlYXRpb24oKSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMucmVmcmVzaERhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBfZmluaXNoRWRpdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfQ1JFQVRFKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfQ1JFQVRFKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VPYmplY3QgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2ZlcjptZXNzYWdlLmpvYlNjaGVkdWxlRGF5c0Vycm9yXCIpXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5kaXNwbGF5RXJyb3JNZXNzYWdlKG1lc3NhZ2VPYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9DUkVBVEUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGRlbGV0ZUpvYjogZnVuY3Rpb24gKGpvYk5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKCFTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9ERUxFVEVfSk9CKSkge1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmJlZ2luQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfREVMRVRFX0pPQik7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlclNlcnZpY2VzLmRlbGV0ZUpvYihqb2JOYW1lLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBEYXRhVHJhbnNmZXJBY3Rpb25zLnJlZnJlc2hEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0RFTEVURV9KT0IpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfREVMRVRFX0pPQik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBkZWxldGVBbGxKb2JDb250ZW50OiBmdW5jdGlvbiAoam9iTmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoIVN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0RFTEVURV9KT0IpKSB7XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuYmVnaW5BY3Rpb24oRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9ERUxFVEVfSk9CKTtcclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyU2VydmljZXMuZGVsZXRlQWxsSm9iKGpvYk5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMucmVmcmVzaERhdGEoKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfREVMRVRFX0pPQik7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9ERUxFVEVfSk9CKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGJlZ2luRGVsZXRlSm9iT25seTogZnVuY3Rpb24gKGpvYk5hbWUpIHtcclxuICAgICAgICB2YXIgbWVzc2FnZU9iamVjdCA9IHtcclxuICAgICAgICAgICAgbWVzc2FnZTogSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2ZlcjptZXNzYWdlLmNvbmZpcm1EZWxldGVcIiksXHJcbiAgICAgICAgICAgIGNvbmZpcm1DYWxsYmFjazogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5kZWxldGVKb2Ioam9iTmFtZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIFN5c3RlbUFjdGlvbnMuZGlzcGxheUNvbmZpcm1hdGlvbk1lc3NhZ2UobWVzc2FnZU9iamVjdCk7XHJcbiAgICB9LFxyXG4gICAgYmVnaW5EZWxldGVBbGxKb2JDb250ZW50OiBmdW5jdGlvbiAoam9iTmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICBEYXRhVHJhbnNmZXJTZXJ2aWNlcy5nZXRKb2JEZXRhaWxzKGpvYk5hbWUsIGZ1bmN0aW9uIChqb2JEZXRhaWwpIHtcclxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGpvYkRldGFpbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiBEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0JFR0lOX0RFTEVURV9BTEwsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBqb2JEZXRhaWxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgYmVnaW5EZWxldGVKb2I6IGZ1bmN0aW9uIChqb2JOYW1lKSB7XHJcbiAgICAgICAgRGF0YVRyYW5zZmVyU2VydmljZXMuZ2V0Sm9iRGV0YWlscyhqb2JOYW1lLCBmdW5jdGlvbiAoam9iRGV0YWlsKSB7XHJcbiAgICAgICAgICAgIC8vIE9ubHkgc2hvdyB0aGUgZGlhbG9nIHdpdGggdGhlIHBvc3NpYmlsaXR5IHRvICdkZWxldGUgdGhlIHByb2plY3Qgd2l0aCBkYXRhJ1xyXG4gICAgICAgICAgICAvLyB3aGVuIHRoZSBwcm9qZWN0IGhhcyBhbHJlYWR5IGJlZW4gY3JlYXRlZC90cmFuc2ZlcnJlZC4gSWYgbm90LCBvbmx5IHNob3dcclxuICAgICAgICAgICAgLy8gdGhlIGpvYiBkZWxldGlvbiBwcm9tcHQuXHJcbiAgICAgICAgICAgIGlmIChqb2JEZXRhaWwuSXNQcm9qZWN0Q3JlYXRlZCkge1xyXG4gICAgICAgICAgICAgICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9CRUdJTl9ERUxFVEVfVFlQRSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBqb2JEZXRhaWxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5iZWdpbkRlbGV0ZUpvYk9ubHkoam9iTmFtZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBiZWdpbkVkaXRKb2I6IGZ1bmN0aW9uIChqb2JOYW1lLCBjYWxsYmFjaykge1xyXG4gICAgICAgIERhdGFUcmFuc2ZlclNlcnZpY2VzLmdldEpvYkRldGFpbHMoam9iTmFtZSwgZnVuY3Rpb24gKGpvYkRldGFpbCkge1xyXG4gICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soam9iRGV0YWlsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfQkVHSU5fRURJVCxcclxuICAgICAgICAgICAgICAgIGRhdGE6IGpvYkRldGFpbFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBlZGl0Sm9iOiBmdW5jdGlvbiAoY2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoIVN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0VESVQpKSB7XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuYmVnaW5BY3Rpb24oRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9FRElUKTtcclxuICAgICAgICAgICAgdmFyIGpvYiA9IERhdGFUcmFuc2ZlclN0b3JlLmdldEVkaXRUcmFuc2ZlckpvYigpO1xyXG4gICAgICAgICAgICB2YXIgY2hhbmdlZENvbm5lY3Rpb24gPSBEYXRhVHJhbnNmZXJTdG9yZS5nZXRTZWxlY3RlZENvbm5lY3Rpb24oKTtcclxuICAgICAgICAgICAgaWYgKGNoYW5nZWRDb25uZWN0aW9uICYmIGNoYW5nZWRDb25uZWN0aW9uLklkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgam9iRWRpdEluZm8gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgUHJvamVjdE5hbWU6IGpvYi5Qcm9qZWN0TmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBDb3JlUHJvamVjdE5hbWU6IGpvYi5WU3VpdGVDb3JlUHJvamVjdE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgQ29yZUNvbm5lY3Rpb25JZDogY2hhbmdlZENvbm5lY3Rpb24uSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgSm9iU2NoZWR1bGU6IGpvYi5Kb2JTY2hlZHVsZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIERhdGFUcmFuc2ZlclNlcnZpY2VzLmVkaXRKb2Ioam9iLk5hbWUsIGpvYkVkaXRJbmZvLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMucmVmcmVzaERhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgX2ZpbmlzaEVkaXQoKTtcclxuICAgICAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0VESVQpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5lbmRBY3Rpb24oRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9FRElUKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgRGF0YVRyYW5zZmVyU2VydmljZXMuZWRpdEpvYlNjaGVkdWxlKGpvYi5OYW1lLCBqb2IuSm9iU2NoZWR1bGUsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5yZWZyZXNoRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBfZmluaXNoRWRpdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfRURJVCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0VESVQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgY2hhbmdlU2VsZWN0ZWRDb25uZWN0aW9uOiBmdW5jdGlvbiAoY29ubmVjdGlvbiwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy51cGRhdGVKb2JGaWVsZHMoXCJDb3JlQ29ubmVjdGlvbklkXCIsIGNvbm5lY3Rpb24uSWQpO1xyXG4gICAgICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgICAgICBhY3Rpb25UeXBlOiBEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0NIQU5HRV9TRUxFQ1RFRF9DT05ORUNUSU9OLFxyXG4gICAgICAgICAgICBkYXRhOiBjb25uZWN0aW9uXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgdXBkYXRlSm9iRmllbGRzOiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgYWN0aW9uVHlwZTogRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9VUERBVEVfSk9CX0NSRUFUSU9OLFxyXG4gICAgICAgICAgICBrZXk6IGtleSxcclxuICAgICAgICAgICAgdmFsdWU6IHZhbHVlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZmluaXNoRWRpdDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChEYXRhVHJhbnNmZXJTdG9yZS5nZXRIYXNKb2JDaGFuZ2VzKCkpIHtcclxuICAgICAgICAgICAgdmFyIGNhbGxiYWNrRnVuY3QgPSBEYXRhVHJhbnNmZXJBY3Rpb25zLmNyZWF0ZUpvYjtcclxuICAgICAgICAgICAgaWYgKCFEYXRhVHJhbnNmZXJTdG9yZS5nZXRJc0NyZWF0aW5nKCkpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuY3QgPSBEYXRhVHJhbnNmZXJBY3Rpb25zLmVkaXRKb2I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5kaXNwbGF5U2F2ZUNoYW5nZXNEaWFsb2coe1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogSW5vdnhMb2FkZXIudChcImNvbW1vbjptc2dCb3guc2F2ZUNoYW5nZXNcIiksXHJcbiAgICAgICAgICAgICAgICBjb25maXJtQ2FsbGJhY2s6IGNhbGxiYWNrRnVuY3QsXHJcbiAgICAgICAgICAgICAgICBjYW5jZWxDYWxsYmFjazogX2ZpbmlzaEVkaXRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBfZmluaXNoRWRpdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBnZXRBbGxDb3JlQ29ubmVjdGlvbnM6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfR0VUX0FMTF9DT1JFX0NPTk5FQ1RJT05TKSkge1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmJlZ2luQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfR0VUX0FMTF9DT1JFX0NPTk5FQ1RJT05TKTtcclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyU2VydmljZXMuZ2V0QWxsQ29ubmVjdGlvbnMoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBfcmVjZWl2ZUNvcmVDb25uZWN0aW9ucyhkYXRhKTtcclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfR0VUX0FMTF9DT1JFX0NPTk5FQ1RJT05TKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0dFVF9BTExfQ09SRV9DT05ORUNUSU9OUyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBnZXRDb25uZWN0aW9uUHJvamVjdHM6IGZ1bmN0aW9uIChpZCwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoIVN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0dFVF9BTExfQ09OTkVDVElPTl9QUk9KRUNUUykpIHtcclxuICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5iZWdpbkFjdGlvbihEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0dFVF9BTExfQ09OTkVDVElPTl9QUk9KRUNUUyk7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlclNlcnZpY2VzLmdldEFsbENvbm5lY3Rpb25Qcm9qZWN0cyhpZCwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBfcmVjZWl2ZUNvbm5lY3Rpb25Qcm9qZWN0cyhkYXRhKTtcclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfR0VUX0FMTF9DT05ORUNUSU9OX1BST0pFQ1RTKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0dFVF9BTExfQ09OTkVDVElPTl9QUk9KRUNUUyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBiZWdpbkFkZE5ld0Nvbm5lY3Rpb246IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgYWN0aW9uVHlwZTogRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9CRUdJTl9BRERfQ09OTkVDVElPTixcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICB1cGRhdGVDb25uZWN0aW9uOiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgICAgICBhY3Rpb25UeXBlOiBEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX1VQREFURV9DT05ORUNUSU9OLFxyXG4gICAgICAgICAgICBrZXk6IGtleSxcclxuICAgICAgICAgICAgdmFsdWU6IHZhbHVlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZWRpdENvbm5lY3Rpb246IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBEYXRhVHJhbnNmZXJBY3Rpb25zLmdldEFsbENvcmVDb25uZWN0aW9ucyhmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfRURJVF9DT05ORUNUSU9OLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBjbG9zZUVkaXRDb25uZWN0aW9uOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgIGFjdGlvblR5cGU6IERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfQ0xPU0VfRURJVF9DT05ORUNUSU9OLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGNyZWF0ZUNvbm5lY3Rpb246IGZ1bmN0aW9uIChjb25maWd1cmF0aW9uLCBjYWxsYmFjaykge1xyXG4gICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfU0FWRV9DT05ORUNUSU9OKSkge1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmJlZ2luQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfU0FWRV9DT05ORUNUSU9OKTtcclxuICAgICAgICAgICAgaWYgKERhdGFUcmFuc2ZlclN0b3JlLmdldENvbm5lY3Rpb25WYWxpZGl0eSgpKSB7XHJcbiAgICAgICAgICAgICAgICBEYXRhVHJhbnNmZXJTZXJ2aWNlcy5jcmVhdGVDb3JlQ29ubmVjdGlvbihjb25maWd1cmF0aW9uLCBmdW5jdGlvbiAocmV0RGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMucmVmcmVzaENvbm5lY3Rpb25zKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmV0RGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIF9maW5pc2hFZGl0Q29ubmVjdGlvbkZvcm0oKTtcclxuICAgICAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX1NBVkVfQ09OTkVDVElPTik7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX1NBVkVfQ09OTkVDVElPTik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlT2JqZWN0ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6bWVzc2FnZS5jcmVhdGVDb25uZWN0aW9uRXJyb3JcIilcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmRpc3BsYXlFcnJvck1lc3NhZ2UobWVzc2FnZU9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX1NBVkVfQ09OTkVDVElPTik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgdGVzdENvbm5lY3Rpb246IGZ1bmN0aW9uIChjb25maWcsIGlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfVEVTVF9DT05ORUNUSU9OKSkge1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmJlZ2luQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfVEVTVF9DT05ORUNUSU9OKTtcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2VPYmplY3RfMSA9IHt9O1xyXG4gICAgICAgICAgICBEYXRhVHJhbnNmZXJTZXJ2aWNlcy50ZXN0Q29yZUNvbm5lY3Rpb24oY29uZmlnLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgX3Rlc3RDb3JlQ29ubmVjdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZU9iamVjdF8xLm1lc3NhZ2UgPSBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOm1lc3NhZ2UuY29ubmVjdGlvblZlcmlmaWVkXCIpO1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5kaXNwbGF5SW5mb01lc3NhZ2UobWVzc2FnZU9iamVjdF8xKTtcclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfVEVTVF9DT05ORUNUSU9OKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlT2JqZWN0XzEubWVzc2FnZSA9IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6bWVzc2FnZS5jb25uZWN0aW9uRmFpbGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZU9iamVjdF8xLmhlbHBMaW5rID0gSW5vdnguU2hhcmVkLkNvbW1vbi5VcmxVdGlsaXRpZXMuZ2V0SGVscFVybCgpICsgXCIvVlN1aXRlQ09SRUNvbm5lY3Rpb24uaHRtbFwiO1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5kaXNwbGF5RXJyb3JNZXNzYWdlKG1lc3NhZ2VPYmplY3RfMSk7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX1RFU1RfQ09OTkVDVElPTik7XHJcbiAgICAgICAgICAgIH0sIGlnbm9yZURlZmF1bHRFcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGNsb3NlRGVsZXRlQWxsQ29udGVudE1vZGFsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgIGFjdGlvblR5cGU6IERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfRklOSVNIX0RFTEVURV9BTExcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBmaW5pc2hEZWxldGVUeXBlUG9wdXA6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBfZmluaXNoRGVsZXRlVHlwZSgpO1xyXG4gICAgfSxcclxuICAgIGZpbmlzaEVkaXRDb25uZWN0aW9uRm9ybTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChEYXRhVHJhbnNmZXJTdG9yZS5nZXRDb25uZWN0aW9uRm9ybUhhc0NoYW5nZXMoKSkge1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmRpc3BsYXlTYXZlQ2hhbmdlc0RpYWxvZyh7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBJbm92eExvYWRlci50KFwiY29tbW9uOm1zZ0JveC5zYXZlQ2hhbmdlc1wiKSxcclxuICAgICAgICAgICAgICAgIGNvbmZpcm1DYWxsYmFjazogRGF0YVRyYW5zZmVyQWN0aW9ucy5jcmVhdGVDb25uZWN0aW9uLFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsQ2FsbGJhY2s6IF9maW5pc2hFZGl0Q29ubmVjdGlvbkZvcm1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBfZmluaXNoRWRpdENvbm5lY3Rpb25Gb3JtKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHJ1bkpvYjogZnVuY3Rpb24gKGpvYiwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoIVN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX1JVTl9KT0IpKSB7XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuYmVnaW5BY3Rpb24oRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9SVU5fSk9CKTtcclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyU2VydmljZXMucnVuSm9iKGpvYiwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZU9iamVjdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOm1lc3NhZ2Uuam9iU3VjY2Vzc1wiKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfUlVOX0pPQik7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmRpc3BsYXlJbmZvTWVzc2FnZShtZXNzYWdlT2JqZWN0KTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX1JVTl9KT0IpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcbm1vZHVsZS5leHBvcnRzID0gRGF0YVRyYW5zZmVyQWN0aW9ucztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RGF0YVRyYW5zZmVyQWN0aW9ucy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbi8vIEEgJy50c3gnIGZpbGUgZW5hYmxlcyBKU1ggc3VwcG9ydCBpbiB0aGUgVHlwZVNjcmlwdCBjb21waWxlciwgXHJcbi8vIGZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSB0aGUgZm9sbG93aW5nIHBhZ2Ugb24gdGhlIFR5cGVTY3JpcHQgd2lraTpcclxuLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L3dpa2kvSlNYXHJcbnZhciBSZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcclxudmFyIElub3Z4ID0gcmVxdWlyZShcInNoYXJlZC53ZWIuY2xpZW50XCIpO1xyXG52YXIgRGF0YVRyYW5zZmVyQWN0aW9ucyA9IHJlcXVpcmUoXCIuLy4uL2FjdGlvbnMvRGF0YVRyYW5zZmVyQWN0aW9uc1wiKTtcclxudmFyIERhdGFUcmFuc2ZlckNvbnN0YW50cyA9IHJlcXVpcmUoXCIuLy4uL2NvbnN0YW50cy9EYXRhVHJhbnNmZXJDb25zdGFudHNcIik7XHJcbnZhciBEYXRhVHJhbnNmZXJTdG9yZSA9IHJlcXVpcmUoXCIuLy4uL3N0b3Jlcy9EYXRhVHJhbnNmZXJTdG9yZVwiKTtcclxudmFyIElub3Z4Q29udHJvbHMgPSBJbm92eC5TaGFyZWQuQ29udHJvbHM7XHJcbnZhciBDb3JlQ29ubmVjdGlvbkVkaXRNb2RhbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhDb3JlQ29ubmVjdGlvbkVkaXRNb2RhbCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIENvcmVDb25uZWN0aW9uRWRpdE1vZGFsKHByb3BzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuY2hhbmdlQ29ubmVjdGlvbiA9IGZ1bmN0aW9uIChjb25uZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9oYW5kbGVDb25uZWN0aW9uQ2hhbmdlKGNvbm5lY3Rpb24pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2hhbmRsZUNvbm5lY3Rpb25DaGFuZ2UgPSBmdW5jdGlvbiAoY29ubmVjdGlvbikge1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZENvbm5lY3Rpb246IGNvbm5lY3Rpb25cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fb25DaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChwcmV2U3RhdGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIG5vIHZhbGlkIGluaXRpYWxDb25uZWN0aW9uIHdhcyBwcm92aWRlZCB0byB1cyB2aWEgdGhlIHByb3BzLFxyXG4gICAgICAgICAgICAgICAgLy8gd2Ugd2FpdCBmb3IgdGhlIGF2YWlsYWJsZSBjb25uZWN0aW9ucyBsaXN0IHRvIGJlIHBvcHVsYXRlZCBhbmRcclxuICAgICAgICAgICAgICAgIC8vIHRoZW4gdGFrZSB0aGUgZmlyc3Qgb25lIGFzIHRoZSBvbmUgdG8gc2VsZWN0ZWQgYnkgZGVmYXVsdC5cclxuICAgICAgICAgICAgICAgIHZhciBjb25uZWN0aW9ucyA9IERhdGFUcmFuc2ZlclN0b3JlLmdldEFsbENvcmVDb25uZWN0aW9ucygpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkQ29ubmVjdGlvbiA9IHByZXZTdGF0ZS5zZWxlY3RlZENvbm5lY3Rpb247XHJcbiAgICAgICAgICAgICAgICBpZiAoIXNlbGVjdGVkQ29ubmVjdGlvbi5OYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRDb25uZWN0aW9uID0gY29ubmVjdGlvbnNbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvcmVDb25uZWN0aW9uczogY29ubmVjdGlvbnMsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRDb25uZWN0aW9uOiBzZWxlY3RlZENvbm5lY3Rpb25cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuc3RhdGUgPSB7XHJcbiAgICAgICAgICAgIGNvcmVDb25uZWN0aW9uczogRGF0YVRyYW5zZmVyU3RvcmUuZ2V0QWxsQ29yZUNvbm5lY3Rpb25zKCksXHJcbiAgICAgICAgICAgIHNlbGVjdGVkQ29ubmVjdGlvbjogcHJvcHMuaW5pdGlhbENvbm5lY3Rpb25cclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIENvcmVDb25uZWN0aW9uRWRpdE1vZGFsLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBEYXRhVHJhbnNmZXJTdG9yZS5hZGRDaGFuZ2VMaXN0ZW5lcih0aGlzLl9vbkNoYW5nZSk7XHJcbiAgICB9O1xyXG4gICAgQ29yZUNvbm5lY3Rpb25FZGl0TW9kYWwucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIERhdGFUcmFuc2ZlclN0b3JlLnJlbW92ZUNoYW5nZUxpc3RlbmVyKHRoaXMuX29uQ2hhbmdlKTtcclxuICAgIH07XHJcbiAgICBDb3JlQ29ubmVjdGlvbkVkaXRNb2RhbC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInBhbmVsIHBhbmVsLXByaW1hcnkgZWRpdC1jb25uZWN0aW9uXCIgfSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJwYW5lbC1oZWFkaW5nXCIgfSwgXCJFZGl0IENvbm5lY3Rpb25cIiksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicGFuZWwtYm9keVwiIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5Db250cm9scy5BY3Rpb25JblByb2dyZXNzTG9hZGVyLCB7IGFjdGlvbktleTogW0RhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfVEVTVF9DT05ORUNUSU9OXSwgY2xhc3M6ICd0ZW1wLW1vZGFsLWxvYWRlcicgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImFjdGlvbi1pbi1wcm9ncmVzcy1sb2FkZXItc21cIiB9KSksXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwic2VjdGlvblwiLCB7IGNsYXNzTmFtZTogXCJkYXRhLXRyYW5zZmVyLWZvcm0tc2VjdGlvbiBib3JkZXItYm90dG9tXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaDNcIiwgeyBjbGFzc05hbWU6IFwic2VjdGlvbi10aXRsZVwiIH0sIElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5jb3JlQ29ubmVjdGlvblwiKSksXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzZWN0aW9uLWNvbnRlbnRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBcIlwiLmNvbmNhdChJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uY29yZUNvbm5lY3Rpb25cIikpLCBpbnB1dE5hbWU6IFwiQ29yZUNvbm5lY3Rpb25zXCIsIGNsYXNzTmFtZTogXCJkYXRhLXRyYW5zZmVyLWZpZWxkXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Ecm9wRG93bkxpc3QsIHsgZGF0YXNvdXJjZTogdGhpcy5zdGF0ZS5jb3JlQ29ubmVjdGlvbnMsIG9uQ2hhbmdlOiB0aGlzLl9oYW5kbGVDb25uZWN0aW9uQ2hhbmdlLCBkaXNwbGF5UHJvcDogXCJOYW1lXCIsIGF1dG9XaWR0aDogdHJ1ZSwgd2lkdGg6IFwiMjYwcHhcIiwgaW5pdGlhbFZhbHVlOiB0aGlzLnN0YXRlLnNlbGVjdGVkQ29ubmVjdGlvbi5OYW1lLCB2YWx1ZVByb3A6IFwiTmFtZVwiIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImFcIiwgeyBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IGFkZC1idG5cIiwgb25DbGljazogZnVuY3Rpb24gKCkgeyBEYXRhVHJhbnNmZXJBY3Rpb25zLmJlZ2luQWRkTmV3Q29ubmVjdGlvbigpOyB9IH0sIElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5hZGRcIikpKSkpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJidG4tYmFyLWItc21cIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIiwgeyB0eXBlOiBcImJ1dHRvblwiLCBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5XCIsIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsgX3RoaXMucHJvcHMub25TYXZlKF90aGlzLnN0YXRlLnNlbGVjdGVkQ29ubmVjdGlvbik7IH0gfSwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLm9rXCIpKSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIsIHsgdHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImJ0biBidG4tZGVmYXVsdFwiLCBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7IF90aGlzLnByb3BzLm9uQ2FuY2VsKCk7IH0gfSwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmNhbmNlbFwiKSkpKSkpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBDb3JlQ29ubmVjdGlvbkVkaXRNb2RhbDtcclxufShSZWFjdC5Db21wb25lbnQpKTtcclxubW9kdWxlLmV4cG9ydHMgPSBDb3JlQ29ubmVjdGlvbkVkaXRNb2RhbDtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q29yZUNvbm5lY3Rpb25FZGl0TW9kYWwuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBmdW5jdGlvbiAoKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXHJcbiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn07XHJcbi8vIEEgJy50c3gnIGZpbGUgZW5hYmxlcyBKU1ggc3VwcG9ydCBpbiB0aGUgVHlwZVNjcmlwdCBjb21waWxlciwgXHJcbi8vIGZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSB0aGUgZm9sbG93aW5nIHBhZ2Ugb24gdGhlIFR5cGVTY3JpcHQgd2lraTpcclxuLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L3dpa2kvSlNYXHJcbnZhciBSZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcclxudmFyIElub3Z4ID0gcmVxdWlyZShcInNoYXJlZC53ZWIuY2xpZW50XCIpO1xyXG52YXIgRGF0YVRyYW5zZmVyQWN0aW9ucyA9IHJlcXVpcmUoXCIuLy4uL2FjdGlvbnMvRGF0YVRyYW5zZmVyQWN0aW9uc1wiKTtcclxudmFyIERhdGFUcmFuc2ZlckNvbnN0YW50cyA9IHJlcXVpcmUoXCIuLy4uL2NvbnN0YW50cy9EYXRhVHJhbnNmZXJDb25zdGFudHNcIik7XHJcbnZhciBEYXRhVHJhbnNmZXJTdG9yZSA9IHJlcXVpcmUoXCIuLy4uL3N0b3Jlcy9EYXRhVHJhbnNmZXJTdG9yZVwiKTtcclxudmFyIFN5c3RlbVN0b3JlID0gSW5vdnguU2hhcmVkLlN5c3RlbS5TdG9yZTtcclxudmFyIElub3Z4Q29udHJvbHMgPSBJbm92eC5TaGFyZWQuQ29udHJvbHM7XHJcbnZhciBDb3JlQ29ubmVjdGlvblNldHRpbmdzTW9kYWwgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQ29yZUNvbm5lY3Rpb25TZXR0aW5nc01vZGFsLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ29yZUNvbm5lY3Rpb25TZXR0aW5nc01vZGFsKHByb3BzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX29uRmllbGRDaGFuZ2UgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBEYXRhVHJhbnNmZXJBY3Rpb25zLnVwZGF0ZUNvbm5lY3Rpb24oZS50YXJnZXQubmFtZSwgZS50YXJnZXQudmFsdWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX29uVmVyc2lvbkNoYW5nZSA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMudXBkYXRlQ29ubmVjdGlvbihcIlZlcnNpb25cIiwgZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5faGFuZGxlVGVzdENvbm5lY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMudGVzdENvbm5lY3Rpb24oX3RoaXMuc3RhdGUuY29yZUNvbm5lY3Rpb25TZXR0aW5nLCB0cnVlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9oYW5kbGVTYXZlQ29ubmVjdGlvblNldHRpbmdzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5wcm9wcy5vblNhdmUoX3RoaXMuc3RhdGUuY29yZUNvbm5lY3Rpb25TZXR0aW5nKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9oYW5kbGVDYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnByb3BzLm9uQ2FuY2VsKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKERhdGFUcmFuc2ZlclN0b3JlLmdldENvbm5lY3Rpb25Gb3JtSGFzQ2hhbmdlcygpKSB7XHJcbiAgICAgICAgICAgICAgICBldmVudC5yZXR1cm5WYWx1ZSA9IElub3Z4TG9hZGVyLnQoJ2NvbW1vbjptc2dCb3guYnJvd3NlclNhdmVDaGFuZ2VzJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLnN0YXRlID0ge1xyXG4gICAgICAgICAgICBjb3JlQ29ubmVjdGlvblNldHRpbmc6IERhdGFUcmFuc2ZlclN0b3JlLmdldENvcmVDb25uZWN0aW9uU2V0dGluZygpXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBDb3JlQ29ubmVjdGlvblNldHRpbmdzTW9kYWwucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLl9jaGVja0ZvclVuc2F2ZWRDaGFuZ2VzKTtcclxuICAgIH07XHJcbiAgICBDb3JlQ29ubmVjdGlvblNldHRpbmdzTW9kYWwucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLl9jaGVja0ZvclVuc2F2ZWRDaGFuZ2VzKTtcclxuICAgIH07XHJcbiAgICBDb3JlQ29ubmVjdGlvblNldHRpbmdzTW9kYWwucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaW5wdXRPYmogPSB7XHJcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2Zvcm0tY29udHJvbCcsXHJcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcclxuICAgICAgICAgICAgcmVhZE9ubHk6IHRoaXMucHJvcHMucmVhZE9ubHlcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBjb3JlQ29ubmVjdGlvblNldHRpbmcgPSB0aGlzLnN0YXRlLmNvcmVDb25uZWN0aW9uU2V0dGluZztcclxuICAgICAgICB2YXIgYWxpYXNJbnB1dCA9IGpRdWVyeS5leHRlbmQoe1xyXG4gICAgICAgICAgICBuYW1lOiBcIkNvbmZpZ3VyYXRpb25OYW1lXCIsXHJcbiAgICAgICAgICAgIHZhbHVlOiBjb3JlQ29ubmVjdGlvblNldHRpbmcuQ29uZmlndXJhdGlvbk5hbWVcclxuICAgICAgICB9LCBpbnB1dE9iaik7XHJcbiAgICAgICAgdmFyIHNxbFNlcnZlcklucHV0ID0galF1ZXJ5LmV4dGVuZCh7XHJcbiAgICAgICAgICAgIG5hbWU6IFwiU3FsU2VydmVyTmFtZVwiLFxyXG4gICAgICAgICAgICB2YWx1ZTogY29yZUNvbm5lY3Rpb25TZXR0aW5nLlNxbFNlcnZlck5hbWVcclxuICAgICAgICB9LCBpbnB1dE9iaik7XHJcbiAgICAgICAgdmFyIHNxbEluc3RhbmNlSW5wdXQgPSBqUXVlcnkuZXh0ZW5kKHtcclxuICAgICAgICAgICAgbmFtZTogXCJTcWxTZXJ2ZXJJbnN0YW5jZVwiLFxyXG4gICAgICAgICAgICB2YWx1ZTogY29yZUNvbm5lY3Rpb25TZXR0aW5nLlNxbFNlcnZlckluc3RhbmNlXHJcbiAgICAgICAgfSwgaW5wdXRPYmopO1xyXG4gICAgICAgIHZhciB0Y3BQb3J0SW5wdXQgPSBqUXVlcnkuZXh0ZW5kKHtcclxuICAgICAgICAgICAgbmFtZTogXCJTcWxTZXJ2ZXJUY3BQb3J0XCIsXHJcbiAgICAgICAgICAgIHZhbHVlOiBjb3JlQ29ubmVjdGlvblNldHRpbmcuU3FsU2VydmVyVGNwUG9ydFxyXG4gICAgICAgIH0sIGlucHV0T2JqKTtcclxuICAgICAgICB2YXIgY29yZVNlcnZlck5hbWUgPSBqUXVlcnkuZXh0ZW5kKHtcclxuICAgICAgICAgICAgbmFtZTogXCJDb3JlU2VydmVyTmFtZVwiLFxyXG4gICAgICAgICAgICB2YWx1ZTogY29yZUNvbm5lY3Rpb25TZXR0aW5nLkNvcmVTZXJ2ZXJOYW1lXHJcbiAgICAgICAgfSwgaW5wdXRPYmopO1xyXG4gICAgICAgIHZhciBjb3JlQWRtaW5QYXNzd29yZCA9IHtcclxuICAgICAgICAgICAgY2xhc3NOYW1lOiAnZm9ybS1jb250cm9sJyxcclxuICAgICAgICAgICAgaWQ6ICdkYXRhVHJhbnNmZXItY29yZS1hZG1pbi1wYXNzd29yZCcsXHJcbiAgICAgICAgICAgIG5hbWU6IFwiQ29yZUFkbWluUGFzc3dvcmRcIixcclxuICAgICAgICAgICAgdHlwZTogJ3Bhc3N3b3JkJyxcclxuICAgICAgICAgICAgdmFsdWU6IGNvcmVDb25uZWN0aW9uU2V0dGluZy5Db3JlQWRtaW5QYXNzd29yZCxcclxuICAgICAgICAgICAgcmVhZE9ubHk6IGlucHV0T2JqLnJlYWRPbmx5XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvL2xldCBjb3JlQWRtaW5QYXNzd29yZCA9IGpRdWVyeS5leHRlbmQoe1xyXG4gICAgICAgIC8vICAgIG5hbWU6IFwiQ29yZUFkbWluUGFzc3dvcmRcIixcclxuICAgICAgICAvLyAgICB0eXBlOiAncGFzc3dvcmQnLFxyXG4gICAgICAgIC8vICAgIHZhbHVlOiBjb3JlQ29ubmVjdGlvblNldHRpbmcuQ29yZUFkbWluUGFzc3dvcmRcclxuICAgICAgICAvL30sIGlucHV0T2JqKTtcclxuICAgICAgICB2YXIgdmVyc2lvbklucHV0ID0galF1ZXJ5LmV4dGVuZCh7XHJcbiAgICAgICAgICAgIG5hbWU6IFwiVmVyc2lvblwiLFxyXG4gICAgICAgICAgICB2YWx1ZTogY29yZUNvbm5lY3Rpb25TZXR0aW5nLlZlcnNpb25cclxuICAgICAgICB9LCBpbnB1dE9iaik7XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInBhbmVsIHBhbmVsLXByaW1hcnkgY29ubmVjdGlvbi1zZXR0aW5nc1wiIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicGFuZWwtaGVhZGluZ1wiIH0sIHRoaXMucHJvcHMucmVhZE9ubHkgPyBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uY29yZUNvbm5lY3Rpb25cIikgOiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0ubmV3Q29ubmVjdGlvblwiKSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicGFuZWwtYm9keVwiIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5Db250cm9scy5BY3Rpb25JblByb2dyZXNzTG9hZGVyLCB7IGFjdGlvbktleTogW0RhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfVEVTVF9DT05ORUNUSU9OXSwgY2xhc3M6ICd0ZW1wLW1vZGFsLWxvYWRlcicgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImFjdGlvbi1pbi1wcm9ncmVzcy1sb2FkZXItc21cIiB9KSksXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwic2VjdGlvblwiLCB7IGNsYXNzTmFtZTogXCJkYXRhLXRyYW5zZmVyLWZvcm0tc2VjdGlvbiBib3JkZXItYm90dG9tXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaDNcIiwgeyBjbGFzc05hbWU6IFwic2VjdGlvbi10aXRsZVwiIH0sIElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5jb3JlQ29ubmVjdGlvblwiKSksXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzZWN0aW9uLWNvbnRlbnRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuSWYsIHsgY29uZGl0aW9uOiAhdGhpcy5wcm9wcy5yZWFkT25seSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogXCJcIi5jb25jYXQoSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmFsaWFzXCIpLCBcIipcIiksIGNsYXNzTmFtZTogXCJjb25uZWN0aW9uLWZvcm0tZmllbGRcIiwgaW5wdXROYW1lOiBcIkNvbmZpZ3VyYXRpb25OYW1lXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgX19hc3NpZ24oe30sIGFsaWFzSW5wdXQsIHsgb25DaGFuZ2U6IHRoaXMuX29uRmllbGRDaGFuZ2UgfSkpKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IFwiXCIuY29uY2F0KElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5jb3JlU3FsU2VydmVyXCIpLCBcIipcIiksIGNsYXNzTmFtZTogXCJjb25uZWN0aW9uLWZvcm0tZmllbGRcIiwgaW5wdXROYW1lOiBcIlNxbFNlcnZlck5hbWVcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIF9fYXNzaWduKHt9LCBzcWxTZXJ2ZXJJbnB1dCwgeyBvbkNoYW5nZTogdGhpcy5fb25GaWVsZENoYW5nZSB9KSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBcIlwiLmNvbmNhdChJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uY29yZVNxbEluc3RhbmNlXCIpKSwgY2xhc3NOYW1lOiBcImNvbm5lY3Rpb24tZm9ybS1maWVsZFwiLCBpbnB1dE5hbWU6IFwiU3FsU2VydmVySW5zdGFuY2VcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIF9fYXNzaWduKHt9LCBzcWxJbnN0YW5jZUlucHV0LCB7IG9uQ2hhbmdlOiB0aGlzLl9vbkZpZWxkQ2hhbmdlIH0pKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IFwiXCIuY29uY2F0KElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS50Y3BQb3J0XCIpKSwgY2xhc3NOYW1lOiBcImNvbm5lY3Rpb24tZm9ybS1maWVsZFwiLCBpbnB1dE5hbWU6IFwiU3FsU2VydmVyVGNwUG9ydFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgX19hc3NpZ24oe30sIHRjcFBvcnRJbnB1dCwgeyBvbkNoYW5nZTogdGhpcy5fb25GaWVsZENoYW5nZSB9KSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBcIlwiLmNvbmNhdChJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uY29yZVNlcnZlck5hbWVcIiksIFwiKlwiKSwgY2xhc3NOYW1lOiBcImNvbm5lY3Rpb24tZm9ybS1maWVsZFwiLCBpbnB1dE5hbWU6IFwiQ29yZVNlcnZlck5hbWVcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIF9fYXNzaWduKHt9LCBjb3JlU2VydmVyTmFtZSwgeyBvbkNoYW5nZTogdGhpcy5fb25GaWVsZENoYW5nZSB9KSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBcIlwiLmNvbmNhdChJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uY29yZUFkbWluUGFzc3dvcmRcIiksIFwiKlwiKSwgY2xhc3NOYW1lOiBcImNvbm5lY3Rpb24tZm9ybS1maWVsZFwiLCBpbnB1dE5hbWU6IFwiQ29yZUFkbWluUGFzc3dvcmRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIF9fYXNzaWduKHt9LCBjb3JlQWRtaW5QYXNzd29yZCwgeyBvbkNoYW5nZTogdGhpcy5fb25GaWVsZENoYW5nZSB9KSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBcIlwiLmNvbmNhdChJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uY29yZVZlcnNpb25cIiksIFwiKlwiKSwgY2xhc3NOYW1lOiBcImNvbm5lY3Rpb24tZm9ybS1maWVsZFwiLCBpbnB1dE5hbWU6IFwiVmVyc2lvblwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRHJvcERvd25MaXN0LCB7IGRhdGFzb3VyY2U6IFtcIjYuMlwiLCBcIjcuMFwiLCBcIjcuMVwiLCBcIjguMFwiLCBcIjkuMFwiLCBcIjkuMVwiXSwgaW5pdGlhbFZhbHVlOiBjb3JlQ29ubmVjdGlvblNldHRpbmcuVmVyc2lvbiwgb25DaGFuZ2U6IHRoaXMuX29uVmVyc2lvbkNoYW5nZSwgZW5hYmxlZDogIXRoaXMucHJvcHMucmVhZE9ubHksIHdpZHRoOiBcIjIwN3B4XCIgfSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuSWYsIHsgY29uZGl0aW9uOiAhdGhpcy5wcm9wcy5yZWFkT25seSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJjb25uZWN0aW9uLWZvcm0tZmllbGRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIiwgeyB0eXBlOiBcImJ1dHRvblwiLCBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IFwiLmNvbmNhdCh0aGlzLnByb3BzLnJlYWRPbmx5ID8gXCJkaXNhYmxlZFwiIDogXCJcIiksIG9uQ2xpY2s6IHRoaXMucHJvcHMucmVhZE9ubHkgPyBudWxsIDogdGhpcy5faGFuZGxlVGVzdENvbm5lY3Rpb24gfSwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLnRlc3RDb25uZWN0aW9uXCIpKSkpKSksXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImJ0bi1iYXItYi1zbVwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLklmLCB7IGNvbmRpdGlvbjogIXRoaXMucHJvcHMucmVhZE9ubHkgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiLCB7IHR5cGU6IFwiYnV0dG9uXCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLXByaW1hcnkgXCIuY29uY2F0KHRoaXMucHJvcHMucmVhZE9ubHkgPyBcImRpc2FibGVkXCIgOiBcIlwiKSwgb25DbGljazogdGhpcy5wcm9wcy5yZWFkT25seSA/IG51bGwgOiB0aGlzLl9oYW5kbGVTYXZlQ29ubmVjdGlvblNldHRpbmdzIH0sIElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5zYXZlXCIpKSksXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiLCB7IHR5cGU6IFwiYnV0dG9uXCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLWRlZmF1bHRcIiwgb25DbGljazogdGhpcy5faGFuZGxlQ2FuY2VsIH0sIHRoaXMucHJvcHMucmVhZE9ubHkgPyBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0ub2tcIikgOiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uY2FuY2VsXCIpKSkpKSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENvcmVDb25uZWN0aW9uU2V0dGluZ3NNb2RhbDtcclxufShSZWFjdC5Db21wb25lbnQpKTtcclxubW9kdWxlLmV4cG9ydHMgPSBDb3JlQ29ubmVjdGlvblNldHRpbmdzTW9kYWw7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNvcmVDb25uZWN0aW9uU2V0dGluZ3NNb2RhbC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSlcclxuICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufTtcclxudmFyIF9fc3ByZWFkQXJyYXkgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXkpIHx8IGZ1bmN0aW9uICh0bywgZnJvbSwgcGFjaykge1xyXG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XHJcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XHJcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcclxufTtcclxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBTeXN0ZW1BY3Rpb25zID0gSW5vdnguU2hhcmVkLlN5c3RlbS5BY3Rpb25zO1xyXG52YXIgU3lzdGVtU3RvcmUgPSBJbm92eC5TaGFyZWQuU3lzdGVtLlN0b3JlO1xyXG52YXIgVXJsVXRpbGl0aWVzID0gSW5vdnguU2hhcmVkLkNvbW1vbi5VcmxVdGlsaXRpZXM7XHJcbnZhciBQZXJtaXNzaW9uU2VydmljZSA9IElub3Z4LlNoYXJlZC5QZXJtaXNzaW9uLlBlcm1pc3Npb25TZXJ2aWNlO1xyXG52YXIgRGF0YVRyYW5zZmVyUGVybWlzc2lvbnMgPSByZXF1aXJlKFwiLi8uLi9jb25zdGFudHMvRGF0YVRyYW5zZmVyUGVybWlzc2lvbnNcIik7XHJcbnZhciBEYXRhVHJhbnNmZXJBY3Rpb25zID0gcmVxdWlyZShcIi4vLi4vYWN0aW9ucy9EYXRhVHJhbnNmZXJBY3Rpb25zXCIpO1xyXG52YXIgRGF0YVRyYW5zZmVyU3RvcmUgPSByZXF1aXJlKFwiLi8uLi9zdG9yZXMvRGF0YVRyYW5zZmVyU3RvcmVcIik7XHJcbnZhciBEYXRhVHJhbnNmZXJGb3JtID0gcmVxdWlyZShcIi4vRGF0YVRyYW5zZmVyRm9ybVwiKTtcclxudmFyIERlbGV0aW9uVHlwZU1vZGFsID0gcmVxdWlyZShcIi4vRGVsZXRpb25UeXBlTW9kYWxcIik7XHJcbnZhciBEZWxldGVBbGxDb250ZW50TW9kYWwgPSByZXF1aXJlKFwiLi9EZWxldGVBbGxDb250ZW50TW9kYWxcIik7XHJcbnZhciBEYXRhU291cmNlVHlwZUVudW0gPSByZXF1aXJlKFwiLi8uLi9jb25zdGFudHMvRGF0YVNvdXJjZVR5cGVFbnVtXCIpO1xyXG52YXIgU3luY2hyb25pemF0aW9uU3RhdHVzVHlwZUVudW0gPSByZXF1aXJlKFwiLi8uLi9jb25zdGFudHMvU3luY2hyb25pemF0aW9uU3RhdHVzVHlwZUVudW1cIik7XHJcbnZhciBEYXRhVHJhbnNmZXJBcHAgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRGF0YVRyYW5zZmVyQXBwLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gRGF0YVRyYW5zZmVyQXBwKHByb3BzLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgJ0RhdGFUcmFuc2ZlcicsIHByb3BzLCBjb250ZXh0KSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBEYXRhVHJhbnNmZXJBY3Rpb25zLmdldEFsbEpvYnMoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2FwcExvYWRlZCA9IHRydWU7IH0sIGZ1bmN0aW9uIChlcnJvcikgeyByZXR1cm4gX3RoaXMuX2hhbmRsZVBlcm1pc3Npb25FcnJvcihlcnJvcik7IH0sIHRydWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX3Nob3dDcmVhdGVOZXdKb2IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuYmVnaW5DcmVhdGVOZXdKb2IoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9oaWRlQ3JlYXRlTmV3Sm9iID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBEYXRhVHJhbnNmZXJBY3Rpb25zLmZpbmlzaEVkaXQoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9iZWdpbkVkaXRKb2IgPSBmdW5jdGlvbiAoZSwgam9iKSB7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuYmVnaW5FZGl0Sm9iKGpvYi5OYW1lKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9kZWxldGVKb2IgPSBmdW5jdGlvbiAoZSwgam9iKSB7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuYmVnaW5EZWxldGVKb2Ioam9iLk5hbWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX3J1bkpvYiA9IGZ1bmN0aW9uIChlLCBqb2IpIHtcclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5ydW5Kb2Ioam9iLk5hbWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX3Jvd0NvbW1hbmRzSGFuZGxlID0gZnVuY3Rpb24gKGFyZ3MpIHtcclxuICAgICAgICAgICAgaWYgKGFyZ3Mucm93RGF0YS5TeW5jaHJvbml6YXRpb25TdGF0dXMgPT0gU3luY2hyb25pemF0aW9uU3RhdHVzVHlwZUVudW0uSW52YWxpZCB8fCBhcmdzLnJvd0RhdGEuU3luY2hyb25pemF0aW9uU3RhdHVzID09IFN5bmNocm9uaXphdGlvblN0YXR1c1R5cGVFbnVtLkRpc2Nvbm5lY3RlZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVkaXRCdXR0b24gPSBhcmdzLnJvdy5maW5kKFwiLmdyaWQtYnV0dG9uLWVkaXRcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWRpdEJ1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRCdXR0b24uYWRkQ2xhc3MoXCJlLWRpc2FibGVkIGdyaWQtYnV0dG9uLWRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRCdXR0b24ucmVtb3ZlQ2xhc3MoXCJncmlkLWJ1dHRvbi1lZGl0XCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIHJ1bkJ1dHRvbiA9IGFyZ3Mucm93LmZpbmQoXCIuZ3JpZC1idXR0b24tcnVuXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJ1bkJ1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJ1bkJ1dHRvbi5hZGRDbGFzcyhcImUtZGlzYWJsZWQgZ3JpZC1idXR0b24tZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVuQnV0dG9uLnJlbW92ZUNsYXNzKFwiZ3JpZC1idXR0b24tcnVuXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fb25DaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHtcclxuICAgICAgICAgICAgICAgIG1vZGFsVmlzaWJsZTogRGF0YVRyYW5zZmVyU3RvcmUuZ2V0TW9kYWxWaXNpYmxlKCksXHJcbiAgICAgICAgICAgICAgICBpc0RlbGV0ZVR5cGVNb2RhbFZpc2libGU6IERhdGFUcmFuc2ZlclN0b3JlLmdldERlbGV0aW9uVHlwZU1vZGFsVmlzaWJsZSgpLFxyXG4gICAgICAgICAgICAgICAgaXNEZWxldGVBbGxNb2RhbFZpc2libGU6IERhdGFUcmFuc2ZlclN0b3JlLmdldERlbGV0ZUFsbE1vZGFsVmlzaWJsZSgpLFxyXG4gICAgICAgICAgICAgICAgYWxsVHJhbnNmZXJKb2JzOiBEYXRhVHJhbnNmZXJTdG9yZS5nZXRBbGxKb2JzKClcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgZGF0YXNvdXJjZVR5cGUgPSB3aW5kb3cuRGF0YVNvdXJjZVR5cGU7XHJcbiAgICAgICAgdmFyIGFkZEpvYiA9IHRydWU7XHJcbiAgICAgICAgaWYgKGRhdGFzb3VyY2VUeXBlICE9IERhdGFTb3VyY2VUeXBlRW51bS5TcWxTZXJ2ZXIpXHJcbiAgICAgICAgICAgIGFkZEpvYiA9IGZhbHNlO1xyXG4gICAgICAgIF90aGlzLnN0YXRlID0ge1xyXG4gICAgICAgICAgICBtb2RhbFZpc2libGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBjYW5BZGRKb2I6IGFkZEpvYixcclxuICAgICAgICAgICAgaXNEZWxldGVUeXBlTW9kYWxWaXNpYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgaXNEZWxldGVBbGxNb2RhbFZpc2libGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBhbGxUcmFuc2ZlckpvYnM6IERhdGFUcmFuc2ZlclN0b3JlLmdldEFsbEpvYnMoKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgRGF0YVRyYW5zZmVyQXBwLnByb3RvdHlwZS5jb21wb25lbnRXaWxsTW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5jb21wb25lbnRXaWxsTW91bnRCYXNlKCk7XHJcbiAgICB9O1xyXG4gICAgRGF0YVRyYW5zZmVyQXBwLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBEYXRhVHJhbnNmZXJTdG9yZS5hZGRDaGFuZ2VMaXN0ZW5lcih0aGlzLl9vbkNoYW5nZSk7XHJcbiAgICB9O1xyXG4gICAgRGF0YVRyYW5zZmVyQXBwLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBEYXRhVHJhbnNmZXJTdG9yZS5yZW1vdmVDaGFuZ2VMaXN0ZW5lcih0aGlzLl9vbkNoYW5nZSk7XHJcbiAgICB9O1xyXG4gICAgRGF0YVRyYW5zZmVyQXBwLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGhhc01hbmFnZUpvYnNQZXJtaXNzaW9uID0gUGVybWlzc2lvblNlcnZpY2UuY2hlY2tQZXJtaXNzaW9uKERhdGFUcmFuc2ZlclBlcm1pc3Npb25zLkRBVEFUUkFOU0ZFUl9NQU5BR0UpO1xyXG4gICAgICAgIHZhciBpY29uSGVhZGVyUHJvcHMgPSB7XHJcbiAgICAgICAgICAgIGljb25Vcmw6IFwiXCIuY29uY2F0KFVybFV0aWxpdGllcy5nZXRCYXNlQXBwbGljYXRpb25VcmwoKSwgXCIvaW1hZ2VzL0RhdGFUcmFuc2Zlci5wbmdcIiksXHJcbiAgICAgICAgICAgIGljb25BdHQ6IHsgYWx0OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmNvbW1vbi50aXRsZVwiKSB9LFxyXG4gICAgICAgICAgICB0aXRsZTogSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpjb21tb24udGl0bGVcIiksXHJcbiAgICAgICAgICAgIHJjQ2xhc3M6IFwiY2QtYnRuIGFkZC1idG5cIixcclxuICAgICAgICAgICAgb25DbGljazogdGhpcy5fc2hvd0NyZWF0ZU5ld0pvYixcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChoYXNNYW5hZ2VKb2JzUGVybWlzc2lvbiAmJiB0aGlzLnN0YXRlLmNhbkFkZEpvYikge1xyXG4gICAgICAgICAgICBpY29uSGVhZGVyUHJvcHMuYnRuVXJsID0gXCJcIi5jb25jYXQoVXJsVXRpbGl0aWVzLmdldEJhc2VBcHBsaWNhdGlvblVybCgpLCBcIi9pbWFnZXMvYWRkRGF0YVRyYW5zZmVyLnBuZ1wiKTtcclxuICAgICAgICAgICAgaWNvbkhlYWRlclByb3BzLmJ0bkF0dCA9IHtcclxuICAgICAgICAgICAgICAgIGFsdDogSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLm5ld0pvYlwiKSxcclxuICAgICAgICAgICAgICAgIHRpdGxlOiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0ubmV3Sm9iXCIpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjb21tYW5kcyA9IHtcclxuICAgICAgICAgICAgY29tbWFuZDogW3tcclxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiBcImdseXBoaWNvbiBnbHlwaGljb24tcGxheVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJncmlkLWJ1dHRvbi1ydW5cIixcclxuICAgICAgICAgICAgICAgICAgICBpZDogXCJjb21tYW5kLXBsYXlcIixcclxuICAgICAgICAgICAgICAgICAgICBjbGljazogdGhpcy5fcnVuSm9iLFxyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgIHdpZHRoOiBcIjExNXB4XCIsXHJcbiAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Z3JpZC5jb21tYW5kc1wiKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGhhc01hbmFnZUpvYnNQZXJtaXNzaW9uKSB7XHJcbiAgICAgICAgICAgIHZhciBlZGl0Q29tbWFuZHMgPSBbe1xyXG4gICAgICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWU6IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1wZW5jaWxcIixcclxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiZ3JpZC1idXR0b24tZWRpdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBcImNvbW1hbmQtZWRpdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrOiB0aGlzLl9iZWdpbkVkaXRKb2JcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgdmFyIGRlbGV0ZUNvbW1hbmRzID0gW3tcclxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiBcImdseXBoaWNvbiBnbHlwaGljb24tdHJhc2hcIixcclxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiZ3JpZC1idXR0b25cIixcclxuICAgICAgICAgICAgICAgICAgICBpZDogXCJjb21tYW5kLWRlbGV0ZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrOiB0aGlzLl9kZWxldGVKb2JcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuY2FuQWRkSm9iKSB7XHJcbiAgICAgICAgICAgICAgICBjb21tYW5kcy5jb21tYW5kID0gX19zcHJlYWRBcnJheShfX3NwcmVhZEFycmF5KF9fc3ByZWFkQXJyYXkoW10sIGVkaXRDb21tYW5kcywgdHJ1ZSksIGRlbGV0ZUNvbW1hbmRzLCB0cnVlKSwgY29tbWFuZHMuY29tbWFuZCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb21tYW5kcy5jb21tYW5kID0gX19zcHJlYWRBcnJheShfX3NwcmVhZEFycmF5KFtdLCBlZGl0Q29tbWFuZHMsIHRydWUpLCBjb21tYW5kcy5jb21tYW5kLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY29sdW1ucyA9IFt7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJQcm9qZWN0TmFtZVwiLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyVGV4dDogSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2ZlcjpncmlkLnByb2plY3ROYW1lXCIpLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxyXG4gICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJTcWxTZXJ2ZXJOYW1lXCIsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJUZXh0OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmdyaWQuc3FsU2VydmVyTmFtZVwiKSxcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcclxuICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwiU3FsU2VydmVySW5zdGFuY2VcIixcclxuICAgICAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Z3JpZC5zcWxJbnN0YW5jZU5hbWVcIiksXHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXHJcbiAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBcIlNjaGVkdWxlRW5hYmxlZFwiLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyVGV4dDogSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2ZlcjpncmlkLnNjaGVkdWxlXCIpLFxyXG4gICAgICAgICAgICAgICAgd2lkdGg6IFwiMTIwcHhcIixcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxyXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogdHJ1ZSwgdGV4dDogSW5vdnhMb2FkZXIudCgnRGF0YVRyYW5zZmVyOmdyaWQuZW5hYmxlZCcpIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogZmFsc2UsIHRleHQ6IElub3Z4TG9hZGVyLnQoJ0RhdGFUcmFuc2ZlcjpncmlkLmRpc2FibGVkJykgfVxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJTeW5jaHJvbml6YXRpb25cIixcclxuICAgICAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Z3JpZC5zeW5jaHJvbml6YXRpb25cIiksXHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdO1xyXG4gICAgICAgIHZhciBkZWZhdWx0U29ydCA9IFt7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJOYW1lXCIsXHJcbiAgICAgICAgICAgICAgICBkaXI6IFwiYXNjZW5kaW5nXCJcclxuICAgICAgICAgICAgfV07XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5Db3JlLlJlYWN0TG9hZGVyLCB7IGFwcFJlYWR5OiB0aGlzLmlzQXBwTG9hZGVkKCksIGVycm9yU3RhdHVzOiB0aGlzLl9lcnJvclN0YXR1cyB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImRhdGEtdHJhbnNmZXItYXBwLWNvbnRlbnRcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuTGF5b3V0Lkljb25IZWFkZXIsIF9fYXNzaWduKHt9LCBpY29uSGVhZGVyUHJvcHMpKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnguU2hhcmVkLkNvbnRyb2xzLk1vZGFsUG9wVXAsIHsgaXNPcGVuOiB0aGlzLnN0YXRlLmlzRGVsZXRlVHlwZU1vZGFsVmlzaWJsZSwgcmVmOiAnbW9kYWwnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChEZWxldGlvblR5cGVNb2RhbCwgeyByZWFkT25seTogZmFsc2UgfSkpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuQ29udHJvbHMuTW9kYWxQb3BVcCwgeyBpc09wZW46IHRoaXMuc3RhdGUuaXNEZWxldGVBbGxNb2RhbFZpc2libGUsIHJlZjogJ21vZGFsJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRGVsZXRlQWxsQ29udGVudE1vZGFsLCB7IHJlYWRPbmx5OiBmYWxzZSB9KSksXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5Db250cm9scy5HcmlkLCB7IGRhdGFTb3VyY2U6IHRoaXMuc3RhdGUuYWxsVHJhbnNmZXJKb2JzLCBjb21tYW5kczogY29tbWFuZHMsIGNvbHVtbnM6IGNvbHVtbnMsIHJvd0NvbW1hbmRzSGFuZGxlcjogdGhpcy5fcm93Q29tbWFuZHNIYW5kbGUsIGRlZmF1bHRTb3J0OiBkZWZhdWx0U29ydCwgZmlsdGVyOiB0cnVlLCBzb3J0OiB0cnVlLCBwYWdlYWJsZTogeyBwYWdlQ291bnQ6IDUsIHBhZ2VTaXplOiAxMCwgcGFnZVNpemVzOiBbMTAsIDIwLCA1MF0gfSB9KSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnguU2hhcmVkLkNvbnRyb2xzLk1vZGFsU2xpZGVyLCB7IGlzT3BlbjogdGhpcy5zdGF0ZS5tb2RhbFZpc2libGUsIG9uQ2xvc2U6IHRoaXMuX2hpZGVDcmVhdGVOZXdKb2IgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRGF0YVRyYW5zZmVyRm9ybSwgeyBjYW5Nb2RpZnlDb25uZWN0aW9uOiB0aGlzLnN0YXRlLmNhbkFkZEpvYiB9KSkpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gRGF0YVRyYW5zZmVyQXBwO1xyXG59KElub3Z4LlNoYXJlZC5SZWFjdEV4dC5CYXNlQXBwQ29tcG9uZW50KSk7XHJcbm1vZHVsZS5leHBvcnRzID0gRGF0YVRyYW5zZmVyQXBwO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1EYXRhVHJhbnNmZXJBcHAuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBmdW5jdGlvbiAoKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXHJcbiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn07XHJcbi8vIEEgJy50c3gnIGZpbGUgZW5hYmxlcyBKU1ggc3VwcG9ydCBpbiB0aGUgVHlwZVNjcmlwdCBjb21waWxlciwgXHJcbi8vIGZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSB0aGUgZm9sbG93aW5nIHBhZ2Ugb24gdGhlIFR5cGVTY3JpcHQgd2lraTpcclxuLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L3dpa2kvSlNYXHJcbnZhciBSZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcclxudmFyIElub3Z4ID0gcmVxdWlyZShcInNoYXJlZC53ZWIuY2xpZW50XCIpO1xyXG52YXIgRGF0YVRyYW5zZmVyQWN0aW9ucyA9IHJlcXVpcmUoXCIuLy4uL2FjdGlvbnMvRGF0YVRyYW5zZmVyQWN0aW9uc1wiKTtcclxudmFyIERhdGFUcmFuc2ZlckNvbnN0YW50cyA9IHJlcXVpcmUoXCIuLy4uL2NvbnN0YW50cy9EYXRhVHJhbnNmZXJDb25zdGFudHNcIik7XHJcbnZhciBEYXRhVHJhbnNmZXJTdG9yZSA9IHJlcXVpcmUoXCIuLy4uL3N0b3Jlcy9EYXRhVHJhbnNmZXJTdG9yZVwiKTtcclxudmFyIENvcmVDb25uZWN0aW9uU2V0dGluZ3NNb2RhbCA9IHJlcXVpcmUoXCIuL0NvcmVDb25uZWN0aW9uU2V0dGluZ3NNb2RhbFwiKTtcclxudmFyIENvcmVDb25uZWN0aW9uRWRpdE1vZGFsID0gcmVxdWlyZShcIi4vQ29yZUNvbm5lY3Rpb25FZGl0TW9kYWxcIik7XHJcbnZhciBKb2JTY2hlZHVsZXIgPSByZXF1aXJlKFwiLi9Kb2JTY2hlZHVsZXJcIik7XHJcbnZhciBMaXN0SGVscGVyID0gSW5vdnguU2hhcmVkLkNvbW1vbi5MaXN0SGVscGVyO1xyXG52YXIgSW5vdnhDb250cm9scyA9IElub3Z4LlNoYXJlZC5Db250cm9scztcclxudmFyIFN5c3RlbVN0b3JlID0gSW5vdnguU2hhcmVkLlN5c3RlbS5TdG9yZTtcclxuZnVuY3Rpb24gZ2V0RGF0YVRyYW5zZmVyQWN0aW9uSW5Qcm9ncmVzcygpIHtcclxuICAgIHJldHVybiBTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9HRVRfQUxMX0NPUkVfQ09OTkVDVElPTlMpIHx8IFN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0dFVF9BTExfQ09OTkVDVElPTl9QUk9KRUNUUyk7XHJcbn1cclxuZnVuY3Rpb24gZ2V0VHJhbnNmZXJKb2IoKSB7XHJcbiAgICBpZiAoRGF0YVRyYW5zZmVyU3RvcmUuZ2V0SXNDcmVhdGluZygpKSB7XHJcbiAgICAgICAgcmV0dXJuIERhdGFUcmFuc2ZlclN0b3JlLmdldFRyYW5zZmVySm9iQ3JlYXRpb24oKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBEYXRhVHJhbnNmZXJTdG9yZS5nZXRFZGl0VHJhbnNmZXJKb2IoKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBnZXRKb2JGb3JtU3RhdGUoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHRyYW5zZmVySm9iOiBnZXRUcmFuc2ZlckpvYigpLFxyXG4gICAgICAgIGNvcmVDb25uZWN0aW9uczogRGF0YVRyYW5zZmVyU3RvcmUuZ2V0QWxsQ29yZUNvbm5lY3Rpb25zKCksXHJcbiAgICAgICAgY29ubmVjdGlvblByb2plY3RzOiBEYXRhVHJhbnNmZXJTdG9yZS5nZXRDb25uZWN0aW9uUHJvamVjdHMoKSxcclxuICAgICAgICBzZWxlY3RlZENvbm5lY3Rpb246IERhdGFUcmFuc2ZlclN0b3JlLmdldFNlbGVjdGVkQ29ubmVjdGlvbigpLFxyXG4gICAgICAgIGlzQ3JlYXRpbmc6IERhdGFUcmFuc2ZlclN0b3JlLmdldElzQ3JlYXRpbmcoKSxcclxuICAgICAgICBpc0FkZFZpZXdDb25uZWN0aW9uTW9kYWxPcGVuOiBEYXRhVHJhbnNmZXJTdG9yZS5nZXRDb25uZWN0aW9uTW9kYWxWaXNpYmxlKCksXHJcbiAgICAgICAgaXNFZGl0Q29ubmVjdGlvbk1vZGFsT3BlbjogRGF0YVRyYW5zZmVyU3RvcmUuZ2V0RWRpdENvbm5lY3Rpb25Nb2RhbFZpc2libGUoKSxcclxuICAgICAgICBpc0FjdGlvbkluUHJvZ3Jlc3M6IGdldERhdGFUcmFuc2ZlckFjdGlvbkluUHJvZ3Jlc3MoKSxcclxuICAgICAgICBhY3Rpb25JblByb2dyZXNzTXNnOiBfZGF0YVRyYW5zZmVyQWN0aW9uSW5Qcm9ncmVzc1xyXG4gICAgfTtcclxufVxyXG52YXIgX2RhdGFUcmFuc2ZlckFjdGlvbkluUHJvZ3Jlc3M7XHJcbnZhciBEYXRhVHJhbnNmZXJGb3JtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKERhdGFUcmFuc2ZlckZvcm0sIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBEYXRhVHJhbnNmZXJGb3JtKHByb3BzLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX2VkaXRDb25uZWN0aW9uQ2hhbmdlZCA9IGZhbHNlO1xyXG4gICAgICAgIF90aGlzLl9zYXZlSm9iID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuc3RhdGUuaXNDcmVhdGluZykge1xyXG4gICAgICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5jcmVhdGVKb2IoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuZWRpdEpvYigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgYWN0aW9uSW5Qcm9ncmVzc01zZzogSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLnNhdmluZ1wiKSB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuZmluaXNoRWRpdCgpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2FkZE9yVmlld0Nvbm5lY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuYmVnaW5BZGROZXdDb25uZWN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5faGFuZGxlQ29ubmVjdGlvbkNoYW5nZSA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuY2hhbmdlU2VsZWN0ZWRDb25uZWN0aW9uKGUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuZ2V0Q29ubmVjdGlvblByb2plY3RzKGUuSWQsIGZ1bmN0aW9uIChwcm9qZWN0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZFByb2plY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnN0YXRlLmlzQ3JlYXRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRQcm9qZWN0ID0gTGlzdEhlbHBlci5zb3J0KHByb2plY3RzLCBcIk5hbWVcIilbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5fZWRpdENvbm5lY3Rpb25DaGFuZ2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRQcm9qZWN0ID0gcHJvamVjdHMuZmlsdGVyKGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUuUHJvamVjdElELnRvTG93ZXJDYXNlKCkgPT0gX3RoaXMuc3RhdGUudHJhbnNmZXJKb2IuVlN1aXRlQ29yZVByb2plY3RJRC50b0xvd2VyQ2FzZSgpOyB9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2hhbmRsZUNvcmVQcm9qZWN0Q2hhbmdlKHNlbGVjdGVkUHJvamVjdCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5faGFuZGxlQ29yZVByb2plY3RDaGFuZ2UgPSBmdW5jdGlvbiAocHJvamVjdCkge1xyXG4gICAgICAgICAgICB2YXIgcHJvamVjdE5hbWUgPSAocHJvamVjdCkgPyBwcm9qZWN0Lk5hbWUgOiBcIlwiO1xyXG4gICAgICAgICAgICBEYXRhVHJhbnNmZXJBY3Rpb25zLnVwZGF0ZUpvYkZpZWxkcyhcIkNvcmVQcm9qZWN0TmFtZVwiLCBwcm9qZWN0TmFtZSk7XHJcbiAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5pc0NyZWF0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICBEYXRhVHJhbnNmZXJBY3Rpb25zLnVwZGF0ZUpvYkZpZWxkcyhcIlByb2plY3ROYW1lXCIsIHByb2plY3ROYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2hhbmRsZUZpZWxkQ2hhbmdlID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy51cGRhdGVKb2JGaWVsZHMoZS50YXJnZXQubmFtZSwgZS50YXJnZXQudmFsdWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX3N0b3JlQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZShnZXRKb2JGb3JtU3RhdGUoKSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fc3lzdGVtQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZShnZXRKb2JGb3JtU3RhdGUoKSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKERhdGFUcmFuc2ZlclN0b3JlLmdldEhhc0pvYkNoYW5nZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSBJbm92eExvYWRlci50KCdjb21tb246bXNnQm94LmJyb3dzZXJTYXZlQ2hhbmdlcycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fc2F2ZU5ld0Nvbm5lY3Rpb24gPSBmdW5jdGlvbiAoY29uZmlndXJhdGlvbikge1xyXG4gICAgICAgICAgICBEYXRhVHJhbnNmZXJBY3Rpb25zLmNyZWF0ZUNvbm5lY3Rpb24oY29uZmlndXJhdGlvbiwgZnVuY3Rpb24gKG5ld0Nvbm5lY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5pc0NyZWF0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2hhbmRsZUNvbm5lY3Rpb25DaGFuZ2UobmV3Q29ubmVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChfdGhpcy5zdGF0ZS5pc0VkaXRDb25uZWN0aW9uTW9kYWxPcGVuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVmc1tcImVkaXQtbW9kYWxcIl0uY2hhbmdlQ29ubmVjdGlvbihuZXdDb25uZWN0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2FuY2VsTmV3Q29ubmVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5maW5pc2hFZGl0Q29ubmVjdGlvbkZvcm0oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9zYXZlRWRpdENvbm5lY3Rpb24gPSBmdW5jdGlvbiAoY29uZmlndXJhdGlvbikge1xyXG4gICAgICAgICAgICBpZiAoY29uZmlndXJhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuX2hhbmRsZUNvbm5lY3Rpb25DaGFuZ2UoY29uZmlndXJhdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5jbG9zZUVkaXRDb25uZWN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2FuY2VsRWRpdENvbm5lY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuY2xvc2VFZGl0Q29ubmVjdGlvbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuc3RhdGUgPSBnZXRKb2JGb3JtU3RhdGUoKTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBEYXRhVHJhbnNmZXJGb3JtLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmlzQ3JlYXRpbmcpIHtcclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5nZXRBbGxDb3JlQ29ubmVjdGlvbnMoZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5faGFuZGxlQ29ubmVjdGlvbkNoYW5nZShlWzBdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIERhdGFUcmFuc2ZlclN0b3JlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX3N0b3JlQ2hhbmdlKTtcclxuICAgICAgICBTeXN0ZW1TdG9yZS5hZGRDaGFuZ2VMaXN0ZW5lcih0aGlzLl9zeXN0ZW1DaGFuZ2UpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLl9jaGVja0ZvclVuc2F2ZWRDaGFuZ2VzKTtcclxuICAgIH07XHJcbiAgICBEYXRhVHJhbnNmZXJGb3JtLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBEYXRhVHJhbnNmZXJTdG9yZS5yZW1vdmVDaGFuZ2VMaXN0ZW5lcih0aGlzLl9zdG9yZUNoYW5nZSk7XHJcbiAgICAgICAgU3lzdGVtU3RvcmUucmVtb3ZlQ2hhbmdlTGlzdGVuZXIodGhpcy5fc3lzdGVtQ2hhbmdlKTtcclxuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlcyk7XHJcbiAgICB9O1xyXG4gICAgRGF0YVRyYW5zZmVyRm9ybS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBoZWFkZXI7XHJcbiAgICAgICAgdmFyIGZpZWxkV2lkdGggPSBcIjI2MFwiO1xyXG4gICAgICAgIHZhciB0cmFuc2ZlckpvYiA9IHRoaXMuc3RhdGUudHJhbnNmZXJKb2I7XHJcbiAgICAgICAgdmFyIGlucHV0T2JqID0ge1xyXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sXCIsXHJcbiAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgcHJvamVjdE5hbWVJbnB1dCA9IGpRdWVyeS5leHRlbmQoe1xyXG4gICAgICAgICAgICBuYW1lOiBcIlByb2plY3ROYW1lXCIsXHJcbiAgICAgICAgICAgIHZhbHVlOiB0cmFuc2ZlckpvYi5Qcm9qZWN0TmFtZSxcclxuICAgICAgICAgICAgcmVhZE9ubHk6ICF0aGlzLnN0YXRlLmlzQ3JlYXRpbmdcclxuICAgICAgICB9LCBpbnB1dE9iaik7XHJcbiAgICAgICAgdmFyIGNvbm5lY3Rpb25Qcm9qZWN0c0Ryb3BEb3duO1xyXG4gICAgICAgIHZhciBhY3Rpb25LZXlzID0gW0RhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfR0VUX0FMTF9DT1JFX0NPTk5FQ1RJT05TLCBEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0dFVF9BTExfQ09OTkVDVElPTl9QUk9KRUNUU107XHJcbiAgICAgICAgdmFyIGNvbm5lY3Rpb25Ecm9wRG93blZpc2libGU7XHJcbiAgICAgICAgdmFyIGVkaXRDb25uZWN0aW9uRW5hYmxlZDtcclxuICAgICAgICB2YXIgc2F2ZUJ1dHRvbkVuYWJsZWQ7XHJcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNDcmVhdGluZykge1xyXG4gICAgICAgICAgICBoZWFkZXIgPSBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0ubmV3Sm9iXCIpO1xyXG4gICAgICAgICAgICBjb25uZWN0aW9uUHJvamVjdHNEcm9wRG93biA9IExpc3RIZWxwZXIuc29ydCh0aGlzLnN0YXRlLmNvbm5lY3Rpb25Qcm9qZWN0cywgXCJOYW1lXCIpO1xyXG4gICAgICAgICAgICBjb25uZWN0aW9uRHJvcERvd25WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgZWRpdENvbm5lY3Rpb25FbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHNhdmVCdXR0b25FbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGhlYWRlciA9IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5lZGl0Sm9iXCIpO1xyXG4gICAgICAgICAgICBjb25uZWN0aW9uUHJvamVjdHNEcm9wRG93biA9IFt7IE5hbWU6IHRyYW5zZmVySm9iLlZTdWl0ZUNvcmVQcm9qZWN0TmFtZSB9XTtcclxuICAgICAgICAgICAgY29ubmVjdGlvbkRyb3BEb3duVmlzaWJsZSA9IHRoaXMuX2VkaXRDb25uZWN0aW9uQ2hhbmdlZDtcclxuICAgICAgICAgICAgZWRpdENvbm5lY3Rpb25FbmFibGVkID0gdHJhbnNmZXJKb2IuSXNQcm9qZWN0Q3JlYXRlZDtcclxuICAgICAgICAgICAgc2F2ZUJ1dHRvbkVuYWJsZWQgPSAodHJhbnNmZXJKb2IuVlN1aXRlQ29yZVByb2plY3ROYW1lKSA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuU3RhdGljSGVhZGVyRm9ybSwgeyB0aXRsZTogaGVhZGVyLCBzYXZlT25DbGljazogdGhpcy5fc2F2ZUpvYiwgY2FuY2VsT25DbGljazogdGhpcy5fY2FuY2VsLCBzYXZlRGlzYWJsZWQ6ICFzYXZlQnV0dG9uRW5hYmxlZCwgaXNBY3Rpb25JblByb2dyZXNzOiB0aGlzLnN0YXRlLmlzQWN0aW9uSW5Qcm9ncmVzcywgaW5Qcm9ncmVzc01lc3NhZ2U6IHRoaXMuc3RhdGUuYWN0aW9uSW5Qcm9ncmVzc01zZyB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5Db250cm9scy5BY3Rpb25JblByb2dyZXNzTG9hZGVyLCB7IGFjdGlvbktleTogYWN0aW9uS2V5cywgY2xhc3M6ICd0ZW1wLW1vZGFsLWxvYWRlcicgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiYWN0aW9uLWluLXByb2dyZXNzLWxvYWRlci1zbVwiIH0pKSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInNlY3Rpb25cIiwgeyBjbGFzc05hbWU6IFwiZGF0YS10cmFuc2Zlci1mb3JtLXNlY3Rpb25cIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImgzXCIsIHsgY2xhc3NOYW1lOiBcInNlY3Rpb24tdGl0bGVcIiB9LCBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uam9iaW5mb3JtYXRpb25cIikpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzZWN0aW9uLWNvbnRlbnRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5JZiwgeyBjb25kaXRpb246ICF0aGlzLnN0YXRlLmlzQ3JlYXRpbmcgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLm5hbWVcIiksIGlucHV0TmFtZTogJ05hbWUnLCBjbGFzc05hbWU6IFwiZGF0YS10cmFuc2Zlci1maWVsZFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaDVcIiwgbnVsbCwgdGhpcy5zdGF0ZS50cmFuc2ZlckpvYi5OYW1lKSkpLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IFwiXCIuY29uY2F0KElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5jb3JlQ29ubmVjdGlvblwiKSwgXCIqXCIpLCBpbnB1dE5hbWU6IFwiQ29yZUNvbm5lY3Rpb25zXCIsIGNsYXNzTmFtZTogXCJkYXRhLXRyYW5zZmVyLWZpZWxkXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLklmLCB7IGNvbmRpdGlvbjogY29ubmVjdGlvbkRyb3BEb3duVmlzaWJsZSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkRyb3BEb3duTGlzdCwgeyBkYXRhc291cmNlOiB0aGlzLnN0YXRlLmNvcmVDb25uZWN0aW9ucywgb25DaGFuZ2U6IHRoaXMuX2hhbmRsZUNvbm5lY3Rpb25DaGFuZ2UsIGVuYWJsZWQ6IHRoaXMuc3RhdGUuaXNDcmVhdGluZywgZGlzcGxheVByb3A6IFwiTmFtZVwiLCBhdXRvV2lkdGg6IHRydWUsIHdpZHRoOiBcIlwiLmNvbmNhdChmaWVsZFdpZHRoLCBcInB4XCIpLCBpbml0aWFsVmFsdWU6IHRoaXMuc3RhdGUuc2VsZWN0ZWRDb25uZWN0aW9uLk5hbWUsIHZhbHVlUHJvcDogXCJOYW1lXCIgfSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuSWYsIHsgY29uZGl0aW9uOiB0aGlzLnN0YXRlLmlzQ3JlYXRpbmcgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJhXCIsIHsgY2xhc3NOYW1lOiBcImJ0biBidG4tcHJpbWFyeSBhZGQtYnRuXCIsIG9uQ2xpY2s6IHRoaXMuX2FkZE9yVmlld0Nvbm5lY3Rpb24gfSwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmFkZFwiKSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuSWYsIHsgY29uZGl0aW9uOiAhY29ubmVjdGlvbkRyb3BEb3duVmlzaWJsZSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImFcIiwgeyBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IGFkZC1idG5cIiwgb25DbGljazogdGhpcy5fYWRkT3JWaWV3Q29ubmVjdGlvbiB9LCBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0udmlld0Nvbm5lY3Rpb25cIikpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLklmLCB7IGNvbmRpdGlvbjogIXRoaXMuc3RhdGUuaXNDcmVhdGluZyAmJiB0aGlzLnByb3BzLmNhbk1vZGlmeUNvbm5lY3Rpb24gfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJhXCIsIHsgY2xhc3NOYW1lOiBcImJ0biBidG4tcHJpbWFyeSBhZGQtYnRuIFwiLmNvbmNhdChlZGl0Q29ubmVjdGlvbkVuYWJsZWQgPyBcIlwiIDogXCJkaXNhYmxlZFwiKSwgb25DbGljazogZnVuY3Rpb24gKCkgeyBEYXRhVHJhbnNmZXJBY3Rpb25zLmVkaXRDb25uZWN0aW9uKCk7IH0gfSwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmVkaXRDb25uZWN0aW9uXCIpKSkpLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IFwiXCIuY29uY2F0KElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5jb3JlUHJvamVjdE5hbWVcIiksIFwiKlwiKSwgaW5wdXROYW1lOiBcIlZTdWl0ZUNvcmVQcm9qZWN0TmFtZVwiLCBjbGFzc05hbWU6IFwiZGF0YS10cmFuc2Zlci1maWVsZFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Ecm9wRG93bkxpc3QsIHsgZGF0YXNvdXJjZTogY29ubmVjdGlvblByb2plY3RzRHJvcERvd24sIG9uQ2hhbmdlOiB0aGlzLl9oYW5kbGVDb3JlUHJvamVjdENoYW5nZSwgZW5hYmxlZDogdGhpcy5zdGF0ZS5pc0NyZWF0aW5nLCBkaXNwbGF5UHJvcDogXCJOYW1lXCIsIGF1dG9XaWR0aDogdHJ1ZSwgd2lkdGg6IFwiXCIuY29uY2F0KGZpZWxkV2lkdGgsIFwicHhcIikgfSkpLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IFwiXCIuY29uY2F0KElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS52c3VpdGVQcm9qZWN0TmFtZVwiKSwgXCIqXCIpLCBpbnB1dE5hbWU6IFwiVlN1aXRlUHJvamVjdE5hbWVcIiwgY2xhc3NOYW1lOiBcImRhdGEtdHJhbnNmZXItZmllbGRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgX19hc3NpZ24oe30sIHByb2plY3ROYW1lSW5wdXQsIHsgb25DaGFuZ2U6IHRoaXMuc3RhdGUuaXNDcmVhdGluZyA/IHRoaXMuX2hhbmRsZUZpZWxkQ2hhbmdlIDogbnVsbCB9KSkpKSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzZWN0aW9uXCIsIHsgY2xhc3NOYW1lOiBcImRhdGEtdHJhbnNmZXItZm9ybS1zZWN0aW9uXCIgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJoM1wiLCB7IGNsYXNzTmFtZTogXCJzZWN0aW9uLXRpdGxlXCIgfSwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmpvYnNjaGVkdWxlXCIpKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic2VjdGlvbi1jb250ZW50XCIgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEpvYlNjaGVkdWxlciwgeyBlZGl0U2NoZWR1bGU6IHRoaXMuc3RhdGUuaXNDcmVhdGluZyA/IG51bGwgOiB0aGlzLnN0YXRlLnRyYW5zZmVySm9iLkpvYlNjaGVkdWxlLCBmaWVsZFdpZHRoOiBmaWVsZFdpZHRoIH0pKSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Nb2RhbFBvcFVwLCB7IGlzT3BlbjogdGhpcy5zdGF0ZS5pc0FkZFZpZXdDb25uZWN0aW9uTW9kYWxPcGVuIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KENvcmVDb25uZWN0aW9uU2V0dGluZ3NNb2RhbCwgeyByZWFkT25seTogIXRoaXMuc3RhdGUuaXNDcmVhdGluZyAmJiAhdGhpcy5zdGF0ZS5pc0VkaXRDb25uZWN0aW9uTW9kYWxPcGVuLCBvblNhdmU6IHRoaXMuX3NhdmVOZXdDb25uZWN0aW9uLCBvbkNhbmNlbDogdGhpcy5fY2FuY2VsTmV3Q29ubmVjdGlvbiB9KSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Nb2RhbFBvcFVwLCB7IGlzT3BlbjogdGhpcy5zdGF0ZS5pc0VkaXRDb25uZWN0aW9uTW9kYWxPcGVuIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KENvcmVDb25uZWN0aW9uRWRpdE1vZGFsLCB7IG9uU2F2ZTogdGhpcy5fc2F2ZUVkaXRDb25uZWN0aW9uLCBvbkNhbmNlbDogdGhpcy5fY2FuY2VsRWRpdENvbm5lY3Rpb24sIGluaXRpYWxDb25uZWN0aW9uOiB0aGlzLnN0YXRlLnNlbGVjdGVkQ29ubmVjdGlvbiwgcmVmOiBcImVkaXQtbW9kYWxcIiB9KSkpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gRGF0YVRyYW5zZmVyRm9ybTtcclxufShSZWFjdC5Db21wb25lbnQpKTtcclxubW9kdWxlLmV4cG9ydHMgPSBEYXRhVHJhbnNmZXJGb3JtO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1EYXRhVHJhbnNmZXJGb3JtLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxudmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkge1xyXG4gICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHtcclxuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxyXG4gICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfTtcclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59O1xyXG4vLyBBICcudHN4JyBmaWxlIGVuYWJsZXMgSlNYIHN1cHBvcnQgaW4gdGhlIFR5cGVTY3JpcHQgY29tcGlsZXIsIFxyXG4vLyBmb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgdGhlIGZvbGxvd2luZyBwYWdlIG9uIHRoZSBUeXBlU2NyaXB0IHdpa2k6XHJcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC93aWtpL0pTWFxyXG52YXIgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XHJcbnZhciBEYXRhVHJhbnNmZXJTdG9yZSA9IHJlcXVpcmUoXCIuLy4uL3N0b3Jlcy9EYXRhVHJhbnNmZXJTdG9yZVwiKTtcclxudmFyIERheVBpY2tlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhEYXlQaWNrZXIsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBEYXlQaWNrZXIocHJvcHMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5zdGF0ZSA9IHtcclxuICAgICAgICAgICAgc2VsZWN0ZWREYXlzOiBfdGhpcy5wcm9wcy5kZWZhdWx0Q2hlY2tlZFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgRGF5UGlja2VyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImRhdGUtcGlja2VyLWNvbnRhaW5lclwiIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2tib3gsIHsgZGF5OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uc3VuXCIpLCB2YWx1ZTogMCwgZGVmYXVsdENoZWNrZWQ6IHRoaXMuc3RhdGUuc2VsZWN0ZWREYXlzLmluZGV4T2YoMCkgPiAtMSwgb25DaGFuZ2U6IHRoaXMucHJvcHMub25EYXlDaGFuZ2UgfSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2tib3gsIHsgZGF5OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0ubW9uXCIpLCB2YWx1ZTogMSwgZGVmYXVsdENoZWNrZWQ6IHRoaXMuc3RhdGUuc2VsZWN0ZWREYXlzLmluZGV4T2YoMSkgPiAtMSwgb25DaGFuZ2U6IHRoaXMucHJvcHMub25EYXlDaGFuZ2UgfSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2tib3gsIHsgZGF5OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0udHVlXCIpLCB2YWx1ZTogMiwgZGVmYXVsdENoZWNrZWQ6IHRoaXMuc3RhdGUuc2VsZWN0ZWREYXlzLmluZGV4T2YoMikgPiAtMSwgb25DaGFuZ2U6IHRoaXMucHJvcHMub25EYXlDaGFuZ2UgfSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2tib3gsIHsgZGF5OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0ud2VkXCIpLCB2YWx1ZTogMywgZGVmYXVsdENoZWNrZWQ6IHRoaXMuc3RhdGUuc2VsZWN0ZWREYXlzLmluZGV4T2YoMykgPiAtMSwgb25DaGFuZ2U6IHRoaXMucHJvcHMub25EYXlDaGFuZ2UgfSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2tib3gsIHsgZGF5OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0udGh1XCIpLCB2YWx1ZTogNCwgZGVmYXVsdENoZWNrZWQ6IHRoaXMuc3RhdGUuc2VsZWN0ZWREYXlzLmluZGV4T2YoNCkgPiAtMSwgb25DaGFuZ2U6IHRoaXMucHJvcHMub25EYXlDaGFuZ2UgfSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2tib3gsIHsgZGF5OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uZnJpXCIpLCB2YWx1ZTogNSwgZGVmYXVsdENoZWNrZWQ6IHRoaXMuc3RhdGUuc2VsZWN0ZWREYXlzLmluZGV4T2YoNSkgPiAtMSwgb25DaGFuZ2U6IHRoaXMucHJvcHMub25EYXlDaGFuZ2UgfSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2tib3gsIHsgZGF5OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uc2F0XCIpLCB2YWx1ZTogNiwgZGVmYXVsdENoZWNrZWQ6IHRoaXMuc3RhdGUuc2VsZWN0ZWREYXlzLmluZGV4T2YoNikgPiAtMSwgb25DaGFuZ2U6IHRoaXMucHJvcHMub25EYXlDaGFuZ2UgfSkpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gRGF5UGlja2VyO1xyXG59KFJlYWN0LkNvbXBvbmVudCkpO1xyXG52YXIgQ2hlY2tib3ggPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQ2hlY2tib3gsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBDaGVja2JveChwcm9wcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9oYW5kbGVDaGVja2JveENoYW5nZSA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIHZhciBkYXlzVG9SdW4gPSBEYXRhVHJhbnNmZXJTdG9yZS5nZXRJc0NyZWF0aW5nKCkgPyBEYXRhVHJhbnNmZXJTdG9yZS5nZXRUcmFuc2ZlckpvYkNyZWF0aW9uKCkuSm9iU2NoZWR1bGUuRGF5c1RvUnVuIDogRGF0YVRyYW5zZmVyU3RvcmUuZ2V0RWRpdFRyYW5zZmVySm9iKCkuSm9iU2NoZWR1bGUuRGF5c1RvUnVuO1xyXG4gICAgICAgICAgICB2YXIgY2hlY2tlZDtcclxuICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIHtcclxuICAgICAgICAgICAgICAgIGRheXNUb1J1bi5wdXNoKF90aGlzLnByb3BzLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRheUluZGV4ID0gZGF5c1RvUnVuLmluZGV4T2YoX3RoaXMucHJvcHMudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRheUluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXlzVG9SdW4uc3BsaWNlKGRheUluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICBjaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3RoaXMucHJvcHMub25DaGFuZ2UoZGF5c1RvUnVuKTtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICAgICAgY2hlY2tlZDogY2hlY2tlZFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLnN0YXRlID0ge1xyXG4gICAgICAgICAgICBjaGVja2VkOiBfdGhpcy5wcm9wcy5kZWZhdWx0Q2hlY2tlZFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgQ2hlY2tib3gucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBjaGVja2JveFByb3BzID0ge1xyXG4gICAgICAgICAgICB0eXBlOiBcImNoZWNrYm94XCIsXHJcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJqb2Itc2NoZWR1bGUtY2hlY2stYm94XCIsXHJcbiAgICAgICAgICAgIGlkOiBcImNoZWNrYm94LVwiLmNvbmNhdCh0aGlzLnByb3BzLmRheSksXHJcbiAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gX3RoaXMuX2hhbmRsZUNoZWNrYm94Q2hhbmdlKGUpOyB9LFxyXG4gICAgICAgICAgICBjaGVja2VkOiB0aGlzLnN0YXRlLmNoZWNrZWRcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChcImxhYmVsXCIsIHsgY2xhc3NOYW1lOiBcImRhdGUtY29udGFpbmVyXCIgfSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIF9fYXNzaWduKHt9LCBjaGVja2JveFByb3BzKSksXHJcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZGF5KSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENoZWNrYm94O1xyXG59KFJlYWN0LkNvbXBvbmVudCkpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IERheVBpY2tlcjtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RGF5UGlja2VyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxuLy8gQSAnLnRzeCcgZmlsZSBlbmFibGVzIEpTWCBzdXBwb3J0IGluIHRoZSBUeXBlU2NyaXB0IGNvbXBpbGVyLCBcclxuLy8gZm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIHRoZSBmb2xsb3dpbmcgcGFnZSBvbiB0aGUgVHlwZVNjcmlwdCB3aWtpOlxyXG4vLyBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQvd2lraS9KU1hcclxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBEYXRhVHJhbnNmZXJBY3Rpb25zID0gcmVxdWlyZShcIi4vLi4vYWN0aW9ucy9EYXRhVHJhbnNmZXJBY3Rpb25zXCIpO1xyXG52YXIgRGF0YVRyYW5zZmVyU3RvcmUgPSByZXF1aXJlKFwiLi8uLi9zdG9yZXMvRGF0YVRyYW5zZmVyU3RvcmVcIik7XHJcbnZhciBTeXN0ZW1TdG9yZSA9IElub3Z4LlNoYXJlZC5TeXN0ZW0uU3RvcmU7XHJcbnZhciBJbm92eENvbnRyb2xzID0gSW5vdnguU2hhcmVkLkNvbnRyb2xzO1xyXG52YXIgRGVsZXRlQWxsQ29udGVudE1vZGFsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKERlbGV0ZUFsbENvbnRlbnRNb2RhbCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIERlbGV0ZUFsbENvbnRlbnRNb2RhbChwcm9wcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9oYW5kbGVPayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCFfdGhpcy5zdGF0ZS5ub3RBY2tub3dsZWRnZWQpIHtcclxuICAgICAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuZGVsZXRlQWxsSm9iQ29udGVudChfdGhpcy5zdGF0ZS5kZWxldGVBbGxDb250ZW50U2V0dGluZy5OYW1lKTtcclxuICAgICAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMuY2xvc2VEZWxldGVBbGxDb250ZW50TW9kYWwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX29uQ2hlY2sgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IG5vdEFja25vd2xlZGdlZDogIWUudGFyZ2V0LmNoZWNrZWQgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5faGFuZGxlQ2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBEYXRhVHJhbnNmZXJBY3Rpb25zLmNsb3NlRGVsZXRlQWxsQ29udGVudE1vZGFsKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5zdGF0ZSA9IHtcclxuICAgICAgICAgICAgZGVsZXRlQWxsQ29udGVudFNldHRpbmc6IERhdGFUcmFuc2ZlclN0b3JlLmdldEVkaXRUcmFuc2ZlckpvYigpLFxyXG4gICAgICAgICAgICBub3RBY2tub3dsZWRnZWQ6IHRydWVcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIERlbGV0ZUFsbENvbnRlbnRNb2RhbC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGlucHV0T2JqID0ge1xyXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdmb3JtLWNvbnRyb2wnLFxyXG4gICAgICAgICAgICB0eXBlOiAndGV4dCcsXHJcbiAgICAgICAgICAgIHJlYWRPbmx5OiB0aGlzLnByb3BzLnJlYWRPbmx5ID8gXCJyZWFkb25seVwiIDogbnVsbFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIGRlbGV0ZUFsbENvbnRlbnRTZXR0aW5nID0gdGhpcy5zdGF0ZS5kZWxldGVBbGxDb250ZW50U2V0dGluZztcclxuICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicGFuZWwgcGFuZWwtcHJpbWFyeSBjb25uZWN0aW9uLXNldHRpbmdzXCIgfSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJwYW5lbC1oZWFkaW5nXCIgfSwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmNvbmZpcm1BbGxDb250ZW50RGVsZWN0aW9uXCIpKSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJwYW5lbC1ib2R5IGZjLW1hcmdpblwiIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIG51bGwsIElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5kZWxBbGxNc2dQYXJ0MVwiKS5yZXBsYWNlKFwiezB9XCIsIHRoaXMuc3RhdGUuZGVsZXRlQWxsQ29udGVudFNldHRpbmcuUHJvamVjdE5hbWUpKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgbnVsbCwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmRlbEFsbE1zZ1BhcnQyXCIpLnJlcGxhY2UoXCJ7MH1cIiwgdGhpcy5zdGF0ZS5kZWxldGVBbGxDb250ZW50U2V0dGluZy5Qcm9qZWN0TmFtZSkpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiLCBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIiBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIHsgdHlwZTogJ2NoZWNrYm94JywgbmFtZTogJ2Fja25vd2xlZGdlZENoaycsIG9uQ2xpY2s6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25DaGVjayhlKTsgfSB9KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCIgXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5yZWFkQWdyZWVtZW50XCIpKSksXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImJ0bi1iYXItYi1zbVwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiLCB7IHR5cGU6IFwiYnV0dG9uXCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLXByaW1hcnkgXCIuY29uY2F0KHRoaXMuc3RhdGUubm90QWNrbm93bGVkZ2VkID8gXCJkaXNhYmxlZFwiIDogXCJcIiksIG9uQ2xpY2s6IHRoaXMuX2hhbmRsZU9rIH0sIElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5va1wiKSksXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiLCB7IHR5cGU6IFwiYnV0dG9uXCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLWRlZmF1bHRcIiwgb25DbGljazogdGhpcy5faGFuZGxlQ2FuY2VsIH0sIElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5jYW5jZWxcIikpKSkpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gRGVsZXRlQWxsQ29udGVudE1vZGFsO1xyXG59KFJlYWN0LkNvbXBvbmVudCkpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IERlbGV0ZUFsbENvbnRlbnRNb2RhbDtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RGVsZXRlQWxsQ29udGVudE1vZGFsLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxuLy8gQSAnLnRzeCcgZmlsZSBlbmFibGVzIEpTWCBzdXBwb3J0IGluIHRoZSBUeXBlU2NyaXB0IGNvbXBpbGVyLCBcclxuLy8gZm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIHRoZSBmb2xsb3dpbmcgcGFnZSBvbiB0aGUgVHlwZVNjcmlwdCB3aWtpOlxyXG4vLyBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQvd2lraS9KU1hcclxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBEYXRhVHJhbnNmZXJBY3Rpb25zID0gcmVxdWlyZShcIi4vLi4vYWN0aW9ucy9EYXRhVHJhbnNmZXJBY3Rpb25zXCIpO1xyXG52YXIgRGF0YVRyYW5zZmVyU3RvcmUgPSByZXF1aXJlKFwiLi8uLi9zdG9yZXMvRGF0YVRyYW5zZmVyU3RvcmVcIik7XHJcbnZhciBTeXN0ZW1TdG9yZSA9IElub3Z4LlNoYXJlZC5TeXN0ZW0uU3RvcmU7XHJcbnZhciBJbm92eENvbnRyb2xzID0gSW5vdnguU2hhcmVkLkNvbnRyb2xzO1xyXG52YXIgRGVsZXRpb25UeXBlTW9kYWwgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRGVsZXRpb25UeXBlTW9kYWwsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBEZWxldGlvblR5cGVNb2RhbChwcm9wcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9oYW5kbGVKb2JPbmx5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBEYXRhVHJhbnNmZXJBY3Rpb25zLmZpbmlzaERlbGV0ZVR5cGVQb3B1cCgpO1xyXG4gICAgICAgICAgICBEYXRhVHJhbnNmZXJBY3Rpb25zLmJlZ2luRGVsZXRlSm9iT25seShfdGhpcy5zdGF0ZS5kZWxldGlvbkpvYkluZm8uTmFtZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5faGFuZGxlQWxsRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5maW5pc2hEZWxldGVUeXBlUG9wdXAoKTtcclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5iZWdpbkRlbGV0ZUFsbEpvYkNvbnRlbnQoX3RoaXMuc3RhdGUuZGVsZXRpb25Kb2JJbmZvLk5hbWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2hhbmRsZUNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy5maW5pc2hEZWxldGVUeXBlUG9wdXAoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9jaGVja0ZvclVuc2F2ZWRDaGFuZ2VzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoRGF0YVRyYW5zZmVyU3RvcmUuZ2V0Q29ubmVjdGlvbkZvcm1IYXNDaGFuZ2VzKCkpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gSW5vdnhMb2FkZXIudCgnY29tbW9uOm1zZ0JveC5icm93c2VyU2F2ZUNoYW5nZXMnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuc3RhdGUgPSB7XHJcbiAgICAgICAgICAgIGRlbGV0aW9uSm9iSW5mbzogRGF0YVRyYW5zZmVyU3RvcmUuZ2V0RWRpdFRyYW5zZmVySm9iKClcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIERlbGV0aW9uVHlwZU1vZGFsLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvL3dpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLl9jaGVja0ZvclVuc2F2ZWRDaGFuZ2VzKTtcclxuICAgIH07XHJcbiAgICBEZWxldGlvblR5cGVNb2RhbC5wcm90b3R5cGUuY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy93aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgdGhpcy5fY2hlY2tGb3JVbnNhdmVkQ2hhbmdlcyk7XHJcbiAgICB9O1xyXG4gICAgRGVsZXRpb25UeXBlTW9kYWwucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaW5wdXRPYmogPSB7XHJcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2Zvcm0tY29udHJvbCcsXHJcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcclxuICAgICAgICAgICAgcmVhZE9ubHk6IHRoaXMucHJvcHMucmVhZE9ubHkgPyBcInJlYWRvbmx5XCIgOiBudWxsXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgY29yZUNvbm5lY3Rpb25TZXR0aW5nID0gdGhpcy5zdGF0ZS5kZWxldGlvbkpvYkluZm87XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInBhbmVsIHBhbmVsLXByaW1hcnkgY29ubmVjdGlvbi1zZXR0aW5nc1wiIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicGFuZWwtaGVhZGluZ1wiIH0sIElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5zZWxlY3REZWxldGlvblR5cGVcIikpLFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInBhbmVsLWJvZHkgZmMtbWFyZ2luXCIgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgbnVsbCwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmRlbE1zZ1BhcnQxXCIpKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgbnVsbCwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmRlbE1zZ1BhcnQyXCIpKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgbnVsbCwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmRlbE1zZ1BhcnQzXCIpKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiYnRuLWJhci1iLXNtXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIsIHsgdHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImJ0biBidG4tcHJpbWFyeVwiLCBvbkNsaWNrOiB0aGlzLl9oYW5kbGVKb2JPbmx5IH0sIElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5kZWxldGVEYXRhVHJhbnNmZXJPbmx5XCIpKSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIsIHsgdHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImJ0biBidG4tcHJpbWFyeVwiLCBvbkNsaWNrOiB0aGlzLl9oYW5kbGVBbGxEYXRhIH0sIElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5kZWxldGVBbGxDb250ZW50XCIpKSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIsIHsgdHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImJ0biBidG4tZGVmYXVsdFwiLCBvbkNsaWNrOiB0aGlzLl9oYW5kbGVDYW5jZWwgfSwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmNhbmNlbFwiKSkpKSkpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBEZWxldGlvblR5cGVNb2RhbDtcclxufShSZWFjdC5Db21wb25lbnQpKTtcclxubW9kdWxlLmV4cG9ydHMgPSBEZWxldGlvblR5cGVNb2RhbDtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RGVsZXRpb25UeXBlTW9kYWwuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG4vL0EgJy50c3gnIGZpbGUgZW5hYmxlcyBKU1ggc3VwcG9ydCBpbiB0aGUgVHlwZVNjcmlwdCBjb21waWxlciwgXHJcbi8vZm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIHRoZSBmb2xsb3dpbmcgcGFnZSBvbiB0aGUgVHlwZVNjcmlwdCB3aWtpOlxyXG4vL2h0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC93aWtpL0pTWFxyXG52YXIgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XHJcbnZhciBJbm92eCA9IHJlcXVpcmUoXCJzaGFyZWQud2ViLmNsaWVudFwiKTtcclxudmFyIERheVBpY2tlciA9IHJlcXVpcmUoXCIuL0RheVBpY2tlclwiKTtcclxudmFyIERhdGFUcmFuc2ZlckFjdGlvbnMgPSByZXF1aXJlKFwiLi8uLi9hY3Rpb25zL0RhdGFUcmFuc2ZlckFjdGlvbnNcIik7XHJcbnZhciBEYXRhVHJhbnNmZXJTdG9yZSA9IHJlcXVpcmUoXCIuLy4uL3N0b3Jlcy9EYXRhVHJhbnNmZXJTdG9yZVwiKTtcclxudmFyIElub3Z4Q29udHJvbHMgPSBJbm92eC5TaGFyZWQuQ29udHJvbHM7XHJcbnZhciBKb2JTY2hlZHVsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoSm9iU2NoZWR1bGVyLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gSm9iU2NoZWR1bGVyKHByb3BzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX2pvYlNjaGVkdWxlID0geyBEYXlzVG9SdW46IFtdLCBTdGFydERhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwgUnVuT25jZURhaWx5OiB0cnVlLCBSdW5FdmVyeUhvdXJzOiAwLCBSdW5TdGFydFRpbWU6IFwiMDA6MDBcIiwgUnVuRW5kVGltZTogXCIwMDowMFwiLCBTY2hlZHVsZUVuYWJsZWQ6IGZhbHNlIH07XHJcbiAgICAgICAgX3RoaXMuX2hhbmRsZUZpZWxkQ2hhbmdlID0gZnVuY3Rpb24gKHZhbHVlLCB0eXBlKSB7XHJcbiAgICAgICAgICAgIHZhciBob3VyLCBtaW51dGU7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImVuYWJsZWRcIjpcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fam9iU2NoZWR1bGUuU2NoZWR1bGVFbmFibGVkID0gdmFsdWUudGFyZ2V0LmNoZWNrZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF5XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2pvYlNjaGVkdWxlLkRheXNUb1J1biA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGVcIjpcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fam9iU2NoZWR1bGUuU3RhcnREYXRlID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiZnJlcXVlbmN5XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2pvYlNjaGVkdWxlLlJ1bkV2ZXJ5SG91cnMgPSB2YWx1ZS5WYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuX2pvYlNjaGVkdWxlLlJ1bkV2ZXJ5SG91cnMgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2pvYlNjaGVkdWxlLlJ1bk9uY2VEYWlseSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5fam9iU2NoZWR1bGUuUnVuT25jZURhaWx5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMudXBkYXRlSm9iRmllbGRzKFwiSm9iU2NoZWR1bGVcIiwgX3RoaXMuX2pvYlNjaGVkdWxlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9oYW5kbGVTdGFydFRpbWVDaGFuZ2UgPSBmdW5jdGlvbiAodGltZSkge1xyXG4gICAgICAgICAgICBfdGhpcy5fam9iU2NoZWR1bGUuUnVuU3RhcnRUaW1lID0gdGltZTtcclxuICAgICAgICAgICAgRGF0YVRyYW5zZmVyQWN0aW9ucy51cGRhdGVKb2JGaWVsZHMoXCJKb2JTY2hlZHVsZVwiLCBfdGhpcy5fam9iU2NoZWR1bGUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2hhbmRsZUVuZFRpbWVDaGFuZ2UgPSBmdW5jdGlvbiAodGltZSkge1xyXG4gICAgICAgICAgICBfdGhpcy5fam9iU2NoZWR1bGUuUnVuRW5kVGltZSA9IHRpbWU7XHJcbiAgICAgICAgICAgIERhdGFUcmFuc2ZlckFjdGlvbnMudXBkYXRlSm9iRmllbGRzKFwiSm9iU2NoZWR1bGVcIiwgX3RoaXMuX2pvYlNjaGVkdWxlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9nZXRKb2JGcmVxdWVuY2llcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgICAgIHsgRnJlcXVlbmN5OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uZnJlcXVlbmN5T25jZVwiKSwgVmFsdWU6IDAgfSxcclxuICAgICAgICAgICAgICAgIHsgRnJlcXVlbmN5OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uZnJlcXVlbmN5RXZlcnlIb3VyXCIpLCBWYWx1ZTogMSB9LFxyXG4gICAgICAgICAgICAgICAgeyBGcmVxdWVuY3k6IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5mcmVxdWVuY3lFdmVyeVR3b1wiKSwgVmFsdWU6IDIgfSxcclxuICAgICAgICAgICAgICAgIHsgRnJlcXVlbmN5OiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uZnJlcXVlbmN5RXZlcnlGb3VyXCIpLCBWYWx1ZTogNCB9LFxyXG4gICAgICAgICAgICAgICAgeyBGcmVxdWVuY3k6IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5mcmVxdWVuY3lFdmVyeUVpZ2h0XCIpLCBWYWx1ZTogOCB9XHJcbiAgICAgICAgICAgIF07XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fc2VsZWN0RnJlcXVlbmN5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgZnJlcXVlbmN5O1xyXG4gICAgICAgICAgICBfdGhpcy5fZ2V0Sm9iRnJlcXVlbmNpZXMoKS5maWx0ZXIoZnVuY3Rpb24gKG9iamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdC5WYWx1ZSA9PT0gX3RoaXMuX2pvYlNjaGVkdWxlLlJ1bkV2ZXJ5SG91cnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBmcmVxdWVuY3kgPSBvYmplY3QuRnJlcXVlbmN5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZnJlcXVlbmN5O1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2Zvcm1hdFRpbWUgPSBmdW5jdGlvbiAodGltZSkge1xyXG4gICAgICAgICAgICBpZiAodGltZS5zcGxpdChcIjpcIikubGVuZ3RoID09PSAzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJyYXkgPSB0aW1lLnNwbGl0KFwiOlwiKTtcclxuICAgICAgICAgICAgICAgIGFycmF5LnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFycmF5LmpvaW4oXCI6XCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRpbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9vbkNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICAgICAgam9iU2NoZWR1bGU6IERhdGFUcmFuc2ZlclN0b3JlLmdldFRyYW5zZmVySm9iQ3JlYXRpb24oKS5Kb2JTY2hlZHVsZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLnByb3BzLmVkaXRTY2hlZHVsZSA/IF90aGlzLl9qb2JTY2hlZHVsZSA9IF90aGlzLnByb3BzLmVkaXRTY2hlZHVsZSA6IG51bGw7XHJcbiAgICAgICAgX3RoaXMuc3RhdGUgPSB7XHJcbiAgICAgICAgICAgIGpvYlNjaGVkdWxlOiBfdGhpcy5fam9iU2NoZWR1bGVcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIEpvYlNjaGVkdWxlci5wcm90b3R5cGUuY29tcG9uZW50V2lsbE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuX2pvYlNjaGVkdWxlLlJ1blN0YXJ0VGltZSA9IHRoaXMuX2Zvcm1hdFRpbWUodGhpcy5fam9iU2NoZWR1bGUuUnVuU3RhcnRUaW1lKTtcclxuICAgICAgICB0aGlzLl9qb2JTY2hlZHVsZS5SdW5FbmRUaW1lID0gdGhpcy5fZm9ybWF0VGltZSh0aGlzLl9qb2JTY2hlZHVsZS5SdW5FbmRUaW1lKTtcclxuICAgIH07XHJcbiAgICBKb2JTY2hlZHVsZXIucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIERhdGFUcmFuc2ZlclN0b3JlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX29uQ2hhbmdlKTtcclxuICAgIH07XHJcbiAgICBKb2JTY2hlZHVsZXIucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIERhdGFUcmFuc2ZlclN0b3JlLnJlbW92ZUNoYW5nZUxpc3RlbmVyKHRoaXMuX29uQ2hhbmdlKTtcclxuICAgIH07XHJcbiAgICBKb2JTY2hlZHVsZXIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciB0aW1lUGlja2VyVGl0bGUgPSB0aGlzLnN0YXRlLmpvYlNjaGVkdWxlLlJ1bkV2ZXJ5SG91cnMgPiAwID8gSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmJldHdlZW5cIikgOiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uYXRcIik7XHJcbiAgICAgICAgdGltZVBpY2tlclRpdGxlICs9IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5sb2NhbERhdGVcIik7XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImpvYi1zY2hlZHVsZS1jb250YWluZXJcIiB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBJbm92eExvYWRlci50KFwiRGF0YVRyYW5zZmVyOmZvcm0uc2NoZWR1bGVcIiksIGlucHV0TmFtZTogXCJTY2hlZHVsZUVuYWJsZWRcIiwgY2xhc3NOYW1lOiBcImRhdGEtdHJhbnNmZXItZmllbGRcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImxhYmVsXCIsIHsgY2xhc3NOYW1lOiBcImRhdGUtY29udGFpbmVyXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgeyB0eXBlOiBcImNoZWNrYm94XCIsIGNsYXNzTmFtZTogXCJqb2Itc2NoZWR1bGUtY2hlY2stYm94XCIsIG9uQ2hhbmdlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gX3RoaXMuX2hhbmRsZUZpZWxkQ2hhbmdlKGUsIFwiZW5hYmxlZFwiKTsgfSwgY2hlY2tlZDogdGhpcy5zdGF0ZS5qb2JTY2hlZHVsZS5TY2hlZHVsZUVuYWJsZWQgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmVuYWJsZWRcIikpKSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmRheXNUb1J1blwiKSwgaW5wdXROYW1lOiBcIkRheXNUb1J1blwiLCBjbGFzc05hbWU6IFwiZGF0YS10cmFuc2Zlci1maWVsZFwiIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KERheVBpY2tlciwgeyBvbkRheUNoYW5nZTogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9oYW5kbGVGaWVsZENoYW5nZShlLCBcImRheVwiKTsgfSwgZGVmYXVsdENoZWNrZWQ6IHRoaXMuX2pvYlNjaGVkdWxlLkRheXNUb1J1biB9KSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Zm9ybS5zdGFydERhdGVcIiksIGlucHV0TmFtZTogXCJTdGFydERhdGVcIiwgY2xhc3NOYW1lOiBcImRhdGEtdHJhbnNmZXItZmllbGRcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkRhdGVQaWNrZXIsIHsgb25DaGFuZ2U6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5faGFuZGxlRmllbGRDaGFuZ2UoZSwgXCJkYXRlXCIpOyB9LCB2YWx1ZTogdGhpcy5fam9iU2NoZWR1bGUuU3RhcnREYXRlLCB3aWR0aDogdGhpcy5wcm9wcy5maWVsZFdpZHRoIH0pKSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmZyZXF1ZW5jeVwiKSwgaW5wdXROYW1lOiBcIlJ1bkV2ZXJ5SG91cnNcIiwgY2xhc3NOYW1lOiBcImRhdGEtdHJhbnNmZXItZmllbGRcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkRyb3BEb3duTGlzdCwgeyBkYXRhc291cmNlOiB0aGlzLl9nZXRKb2JGcmVxdWVuY2llcygpLCBvbkNoYW5nZTogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9oYW5kbGVGaWVsZENoYW5nZShlLCBcImZyZXF1ZW5jeVwiKTsgfSwgdmFsdWVQcm9wOiBcIkZyZXF1ZW5jeVwiLCBkaXNwbGF5UHJvcDogXCJGcmVxdWVuY3lcIiwgaW5pdGlhbFZhbHVlOiB0aGlzLl9zZWxlY3RGcmVxdWVuY3koKSwgd2lkdGg6IFwiXCIuY29uY2F0KHRoaXMucHJvcHMuZmllbGRXaWR0aCwgXCJweFwiKSB9KSksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5Gb3JtRmllbGQsIHsgdGl0bGU6IHRpbWVQaWNrZXJUaXRsZSwgaW5wdXROYW1lOiBcIlRpbWVcIiwgY2xhc3NOYW1lOiBcImRhdGEtdHJhbnNmZXItZmllbGRcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLlRpbWVQaWNrZXIsIHsgaW50ZXJ2YWw6IDMwLCBvbkNoYW5nZTogdGhpcy5faGFuZGxlU3RhcnRUaW1lQ2hhbmdlLCB0aW1lRm9ybWF0OiBcIkhIOm1tXCIsIHZhbHVlOiB0aGlzLl9mb3JtYXRUaW1lKHRoaXMuX2pvYlNjaGVkdWxlLlJ1blN0YXJ0VGltZSksIGlkOiBcImpvYlN0YXJ0VGltZVwiLCB3aWR0aDogdGhpcy5wcm9wcy5maWVsZFdpZHRoIH0pLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLklmLCB7IGNvbmRpdGlvbjogdGhpcy5zdGF0ZS5qb2JTY2hlZHVsZS5SdW5FdmVyeUhvdXJzID4gMCB9LFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcImJvbGQtYmx1ZS10ZXh0XCIgfSwgSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2Zlcjpmb3JtLmFuZFwiKSkpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLklmLCB7IGNvbmRpdGlvbjogdGhpcy5zdGF0ZS5qb2JTY2hlZHVsZS5SdW5FdmVyeUhvdXJzID4gMCB9LFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5UaW1lUGlja2VyLCB7IGludGVydmFsOiAzMCwgb25DaGFuZ2U6IHRoaXMuX2hhbmRsZUVuZFRpbWVDaGFuZ2UsIHRpbWVGb3JtYXQ6IFwiSEg6bW1cIiwgdmFsdWU6IHRoaXMuX2Zvcm1hdFRpbWUodGhpcy5fam9iU2NoZWR1bGUuUnVuRW5kVGltZSksIGlkOiBcImpvYkVuZFRpbWVcIiwgd2lkdGg6IHRoaXMucHJvcHMuZmllbGRXaWR0aCB9KSkpKSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEpvYlNjaGVkdWxlcjtcclxufShSZWFjdC5Db21wb25lbnQpKTtcclxubW9kdWxlLmV4cG9ydHMgPSBKb2JTY2hlZHVsZXI7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUpvYlNjaGVkdWxlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIERhdGFTb3VyY2VUeXBlRW51bTtcclxuKGZ1bmN0aW9uIChEYXRhU291cmNlVHlwZUVudW0pIHtcclxuICAgIERhdGFTb3VyY2VUeXBlRW51bVtcIlBvc3RncmVzXCJdID0gXCJQb3N0Z3Jlc1wiO1xyXG4gICAgRGF0YVNvdXJjZVR5cGVFbnVtW1wiU3FsU2VydmVyXCJdID0gXCJTcWxTZXJ2ZXJcIjtcclxufSkoRGF0YVNvdXJjZVR5cGVFbnVtIHx8IChEYXRhU291cmNlVHlwZUVudW0gPSB7fSkpO1xyXG47XHJcbm1vZHVsZS5leHBvcnRzID0gRGF0YVNvdXJjZVR5cGVFbnVtO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1EYXRhU291cmNlVHlwZUVudW0uanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIFRoaXMgZmlsZSBpcyBvbmx5IGEgdGVtcGxhdGUgZm9yIGNvbnN0YW50cy4gIENvcHkgYW5kIHBhc3RlIHRoaXMgdG8geW91ciBhcHBsaWNhdGlvbidzIGNvbnN0YW50cyAudHMgZmlsZSBhbmQgc3RhcnQgb2ZmIGZyb20gdGhlcmVcclxuLy8gUmVuYW1lIGFsbCB0aGluZ3Mgd2l0aCBBcHBfTmFtZS5cclxuLy8gTmFtaW5nIGNvbnZlbnRpb24gZm9yIGNvbnN0YW50cyBpcyBcIltBcHAgTmFtZV1Db25zdGFudHMudHNcIiBpLmUuIFVzZXJzQ29uc3RhbnRzLnRzLCBFbnRpdGxlbWVudENvbnN0YW50cy50c1xyXG52YXIga2V5bWlycm9yID0gcmVxdWlyZShcImZianMvbGliL2tleW1pcnJvclwiKTtcclxuLy8gY29udmVudGlvbiBmb3IgY29uc3RhbnRzIGlzXHJcbi8vIFtBcHBfTmFtZV1fW0FjdGlvbl1cclxudmFyIERhdGFUcmFuc2ZlckNvbnN0YW50cyA9IGtleW1pcnJvcih7XHJcbiAgICBEQVRBVFJBTlNGRVJfR0VUX0FMTF9KT0JTOiBudWxsLFxyXG4gICAgREFUQVRSQU5TRkVSX0JFR0lOX0RFTEVURV9UWVBFOiBudWxsLFxyXG4gICAgREFUQVRSQU5TRkVSX0VORF9ERUxFVEVfVFlQRTogbnVsbCxcclxuICAgIERBVEFUUkFOU0ZFUl9CRUdJTl9ERUxFVEVfQUxMOiBudWxsLFxyXG4gICAgREFUQVRSQU5TRkVSX0JFR0lOX0NSRUFURTogbnVsbCxcclxuICAgIERBVEFUUkFOU0ZFUl9DUkVBVEU6IG51bGwsXHJcbiAgICBEQVRBVFJBTlNGRVJfQkVHSU5fRURJVDogbnVsbCxcclxuICAgIERBVEFUUkFOU0ZFUl9FRElUOiBudWxsLFxyXG4gICAgREFUQVRSQU5TRkVSX0ZJTklTSF9FRElUOiBudWxsLFxyXG4gICAgREFUQVRSQU5TRkVSX0ZJTklTSF9ERUxFVEVfQUxMOiBudWxsLFxyXG4gICAgREFUQVRSQU5TRkVSX0ZJTklTSF9ERUxFVEU6IG51bGwsXHJcbiAgICBEQVRBVFJBTlNGRVJfVVBEQVRFX0pPQl9DUkVBVElPTjogbnVsbCxcclxuICAgIERBVEFUUkFOU0ZFUl9VUERBVEVfSk9CX0VESVQ6IG51bGwsXHJcbiAgICBEQVRBVFJBTlNGRVJfVVBEQVRFX0NPTk5FQ1RJT046IG51bGwsXHJcbiAgICBEQVRBVFJBTlNGRVJfQ0hBTkdFX1NFTEVDVEVEX0NPTk5FQ1RJT046IG51bGwsXHJcbiAgICBEQVRBVFJBTlNGRVJfR0VUX0FMTF9DT1JFX0NPTk5FQ1RJT05TOiBudWxsLFxyXG4gICAgREFUQVRSQU5TRkVSX0dFVF9BTExfQ09OTkVDVElPTl9QUk9KRUNUUzogbnVsbCxcclxuICAgIERBVEFUUkFOU0ZFUl9CRUdJTl9BRERfQ09OTkVDVElPTjogbnVsbCxcclxuICAgIERBVEFUUkFOU0ZFUl9URVNUX0NPTk5FQ1RJT046IG51bGwsXHJcbiAgICBEQVRBVFJBTlNGRVJfRklOSVNIX0FERF9DT05ORUNUSU9OOiBudWxsLFxyXG4gICAgREFUQVRSQU5TRkVSX0VESVRfQ09OTkVDVElPTjogbnVsbCxcclxuICAgIERBVEFUUkFOU0ZFUl9DTE9TRV9FRElUX0NPTk5FQ1RJT046IG51bGwsXHJcbiAgICBEQVRBVFJBTlNGRVJfU0FWRV9DT05ORUNUSU9OOiBudWxsLFxyXG4gICAgREFUQVRSQU5TRkVSX0RFTEVURV9KT0I6IG51bGwsXHJcbiAgICBEQVRBVFJBTlNGRVJfUlVOX0pPQjogbnVsbFxyXG59KTtcclxubW9kdWxlLmV4cG9ydHMgPSBEYXRhVHJhbnNmZXJDb25zdGFudHM7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPURhdGFUcmFuc2ZlckNvbnN0YW50cy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIERhdGFUcmFuc2ZlclBlcm1pc3Npb25zID0ge1xyXG4gICAgREFUQVRSQU5TRkVSX01BTkFHRTogXCJEYXRhVHJhbnNmZXIuTWFuYWdlXCIsXHJcbiAgICBEQVRBVFJBTlNGRVJfUlVOOiBcIkRhdGFUcmFuc2Zlci5SdW5cIixcclxufTtcclxubW9kdWxlLmV4cG9ydHMgPSBEYXRhVHJhbnNmZXJQZXJtaXNzaW9ucztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RGF0YVRyYW5zZmVyUGVybWlzc2lvbnMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBTeW5jaHJvbml6YXRpb25TdGF0dXNUeXBlRW51bTtcclxuKGZ1bmN0aW9uIChTeW5jaHJvbml6YXRpb25TdGF0dXNUeXBlRW51bSkge1xyXG4gICAgU3luY2hyb25pemF0aW9uU3RhdHVzVHlwZUVudW1bXCJOb3RTeW5jaHJvbml6ZWRcIl0gPSBcIjBcIjtcclxuICAgIFN5bmNocm9uaXphdGlvblN0YXR1c1R5cGVFbnVtW1wiU3luY2hyb25pemVkXCJdID0gXCIxXCI7XHJcbiAgICBTeW5jaHJvbml6YXRpb25TdGF0dXNUeXBlRW51bVtcIkludmFsaWRcIl0gPSBcIjJcIjtcclxuICAgIFN5bmNocm9uaXphdGlvblN0YXR1c1R5cGVFbnVtW1wiRGlzY29ubmVjdGVkXCJdID0gXCIzXCI7XHJcbn0pKFN5bmNocm9uaXphdGlvblN0YXR1c1R5cGVFbnVtIHx8IChTeW5jaHJvbml6YXRpb25TdGF0dXNUeXBlRW51bSA9IHt9KSk7XHJcbjtcclxubW9kdWxlLmV4cG9ydHMgPSBTeW5jaHJvbml6YXRpb25TdGF0dXNUeXBlRW51bTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U3luY2hyb25pemF0aW9uU3RhdHVzVHlwZUVudW0uanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIFRoaXMgZmlsZSBpcyBvbmx5IGEgdGVtcGxhdGUgZm9yIHNlcnZpY2VzLiAgQ29weSBhbmQgcGFzdGUgdGhpcyB0byB5b3VyIGFwcGxpY2F0aW9uJ3Mgc2VydmljZSAudHMgZmlsZSBhbmQgc3RhcnQgb2ZmIGZyb20gdGhlcmVcclxuLy8gUmVuYW1lIGFsbCB0aGluZ3Mgd2l0aCBBcHBfTmFtZS5cclxuLy8gTmFtaW5nIGNvbnZlbnRpb24gZm9yIHNlcnZpY2VzIGlzIFwiW0FwcCBOYW1lXVNlcnZpY2VzLnRzXCIgaS5lLiBVc2Vyc1NlcnZpY2VzLnRzLCBFbnRpdGxlbWVudFNlcnZpY2VzLnRzXHJcbnZhciBJbm92eCA9IHJlcXVpcmUoXCJzaGFyZWQud2ViLmNsaWVudFwiKTtcclxudmFyIGFzc2lnbiA9IHJlcXVpcmUoXCJvYmplY3QtYXNzaWduXCIpO1xyXG52YXIgVXJsVXRpbGl0aWVzID0gSW5vdnguU2hhcmVkLkNvbW1vbi5VcmxVdGlsaXRpZXM7XHJcbnZhciB1cmwgPSBVcmxVdGlsaXRpZXMuZ2V0QXBpVXJsKCkgKyAnL0RhdGFUcmFuc2ZlckFwaS9hcGkvRGF0YVRyYW5zZmVyJztcclxudmFyIERhdGFUcmFuc2ZlclNlcnZpY2VzID0gYXNzaWduKHt9LCBJbm92eC5TaGFyZWQuRmx1eC5CYXNlU2VydmljZSwge1xyXG4gICAgLy9SZXBsYWNlIG1ldGhvZCBhY2NvcmRpbmdseVxyXG4gICAgZ2V0QWxsSm9iczogZnVuY3Rpb24gKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmdldChcIlwiLmNvbmNhdCh1cmwsIFwiL0dldEFsbFwiKSwgbnVsbCwgZnVuY3Rpb24gKHJldERhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHJldERhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBpZiAoIWlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGdldEpvYkRldGFpbHM6IGZ1bmN0aW9uIChqb2JOYW1lLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuZ2V0KFwiXCIuY29uY2F0KHVybCwgXCIvRGV0YWlsc1wiKSwgeyBqb2JOYW1lOiBqb2JOYW1lIH0sIGZ1bmN0aW9uIChyZXREYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXREYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBnZXRBbGxDb25uZWN0aW9uczogZnVuY3Rpb24gKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5nZXQoXCJcIi5jb25jYXQodXJsLCBcIi9HZXRBbGxDb3JlQ29ubmVjdGlvbnNcIiksIG51bGwsIGZ1bmN0aW9uIChyZXREYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXREYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBnZXRBbGxDb25uZWN0aW9uUHJvamVjdHM6IGZ1bmN0aW9uIChpZCwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmdldChcIlwiLmNvbmNhdCh1cmwsIFwiL0dldEFsbENvbmZpZ3VyYXRpb25Qcm9qZWN0c1wiKSwgeyBpZDogaWQgfSwgZnVuY3Rpb24gKHJldERhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHJldERhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGNyZWF0ZUpvYjogZnVuY3Rpb24gKGpvYiwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLnBvc3QoXCJcIi5jb25jYXQodXJsLCBcIi9DcmVhdGVcIiksIGpvYiwgZnVuY3Rpb24gKHJldERhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHJldERhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGVkaXRKb2I6IGZ1bmN0aW9uIChqb2JOYW1lLCBqb2IsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvVXBkYXRlXCIpLCB7IGpvYk5hbWU6IGpvYk5hbWUsIGRhdGE6IGpvYiB9LCBmdW5jdGlvbiAocmV0RGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2socmV0RGF0YSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZWRpdEpvYlNjaGVkdWxlOiBmdW5jdGlvbiAoam9iTmFtZSwgam9iU2NoZWR1bGUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvVXBkYXRlU2NoZWR1bGVcIiksIHsgam9iTmFtZTogam9iTmFtZSwgam9iU2NoZWR1bGU6IGpvYlNjaGVkdWxlIH0sIGZ1bmN0aW9uIChyZXREYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXREYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBkZWxldGVKb2I6IGZ1bmN0aW9uIChqb2JOYW1lLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucG9zdChcIlwiLmNvbmNhdCh1cmwsIFwiL0RlbGV0ZVwiKSwgeyBqb2JOYW1lOiBqb2JOYW1lIH0sIGZ1bmN0aW9uIChyZXREYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXREYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBkZWxldGVBbGxKb2I6IGZ1bmN0aW9uIChqb2JOYW1lLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucG9zdChcIlwiLmNvbmNhdCh1cmwsIFwiL0RlbGV0ZVByb2plY3RcIiksIHsgam9iTmFtZTogam9iTmFtZSB9LCBmdW5jdGlvbiAocmV0RGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2socmV0RGF0YSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgdGVzdENvcmVDb25uZWN0aW9uOiBmdW5jdGlvbiAoY29uZmlndXJhdGlvbiwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBpZ25vcmVEZWZhdWx0RXJyb3IpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucG9zdChcIlwiLmNvbmNhdCh1cmwsIFwiL1Rlc3RDb25uZWN0aW9uXCIpLCBjb25maWd1cmF0aW9uLCBmdW5jdGlvbiAocmV0RGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2socmV0RGF0YSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGlmICghaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgY3JlYXRlQ29yZUNvbm5lY3Rpb246IGZ1bmN0aW9uIChjb25maWd1cmF0aW9uLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucG9zdChcIlwiLmNvbmNhdCh1cmwsIFwiL0NyZWF0ZUNvbmZpZ1wiKSwgY29uZmlndXJhdGlvbiwgZnVuY3Rpb24gKHJldERhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHJldERhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIHJ1bkpvYjogZnVuY3Rpb24gKGpvYk5hbWUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvUnVuSm9iXCIpLCB7IGpvYk5hbWU6IGpvYk5hbWUgfSwgZnVuY3Rpb24gKHJldERhdGEpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHJldERhdGEpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxubW9kdWxlLmV4cG9ydHMgPSBEYXRhVHJhbnNmZXJTZXJ2aWNlcztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RGF0YVRyYW5zZmVyU2VydmljZXMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIFRoaXMgZmlsZSBpcyBvbmx5IGEgdGVtcGxhdGUgZm9yIFN0b3Jlcy4gIENvcHkgYW5kIHBhc3RlIHRoaXMgdG8geW91ciBhcHBsaWNhdGlvbiBzdG9yZSAudHMgZmlsZSBhbmQgc3RhcnQgb2ZmIGZyb20gdGhlcmVcclxuLy8gUmVuYW1lIGFsbCB0aGluZ3Mgd2l0aCBBcHBfTmFtZS5cclxuLy8gTmFtaW5nIGNvbnZlbnRpb24gZm9yIFN0b3JlcyBpcyBcIltBcHAgTmFtZV1TdG9yZS50c1wiIGkuZS4gVXNlclN0b3JlLnRzLCBFbnRpdGxlbWVudFN0b3JlLnRzXHJcbnZhciBOb2RlRXZlbnRzID0gcmVxdWlyZShcImV2ZW50c1wiKTtcclxudmFyIElub3Z4ID0gcmVxdWlyZShcInNoYXJlZC53ZWIuY2xpZW50XCIpO1xyXG52YXIgYXNzaWduID0gcmVxdWlyZShcIm9iamVjdC1hc3NpZ25cIik7XHJcbnZhciBEYXRhVHJhbnNmZXJDb25zdGFudHMgPSByZXF1aXJlKFwiLi8uLi9jb25zdGFudHMvRGF0YVRyYW5zZmVyQ29uc3RhbnRzXCIpO1xyXG52YXIgU3luY2hyb25pemF0aW9uU3RhdHVzVHlwZUVudW0gPSByZXF1aXJlKFwiLi8uLi9jb25zdGFudHMvU3luY2hyb25pemF0aW9uU3RhdHVzVHlwZUVudW1cIik7XHJcbnZhciBFdmVudEVtaXR0ZXIgPSBOb2RlRXZlbnRzLkV2ZW50RW1pdHRlcjtcclxudmFyIERhdGVUaW1lRm9ybWF0SGVscGVyID0gSW5vdnguU2hhcmVkLkNvbW1vbi5EYXRlVGltZUZvcm1hdEhlbHBlcjtcclxudmFyIENIQU5HRV9FVkVOVCA9ICdEYXRhVHJhbnNmZXIuY2hhbmdlJztcclxudmFyIF9pc0NyZWF0aW5nSm9iID0gZmFsc2UsIF9jaGFuZ2VzTWFkZVRvSm9iID0gZmFsc2UsIF9jb25uZWN0aW9uRm9ybUNoYW5nZXNNYWRlID0gZmFsc2UsIF90cmFuc2ZlckpvYkNyZWF0aW9uID0gZ2V0QmxhbmtUcmFuc2ZlckpvYkNyZWF0aW9uKCksIF9lZGl0VHJhbnNmZXJKb2IgPSBnZXRCbGFua1RyYW5zZmVySm9iSW5mbygpLCBfdHJhbnNmZXJKb2JzID0gW10sIF9jb3JlQ29ubmVjdGlvblNldHRpbmcgPSBnZXRCbGFua0NvcmVTZXR0aW5ncygpLCBfY29yZUNvbm5lY3Rpb25zID0gW10sIF9zZWxlY3RlZENvbm5lY3Rpb24gPSBnZXRCbGFua0Nvbm5lY3Rpb25OYW1lKCksIF9jb25uZWN0aW9uVmFsaWQgPSBmYWxzZSwgX2Nvbm5lY3Rpb25Qcm9qZWN0cyA9IFtdLCBfY29ubmVjdGlvbk1vZGFsVmlzaWJsZSA9IGZhbHNlLCBfZWRpdENvbm5lY3Rpb25Nb2RhbFZpc2libGUgPSBmYWxzZSwgX2RlbGV0ZUNvbmZpcm1hdGlvblZpc2libGUgPSBmYWxzZSwgX21vZGFsVmlzaWJsZSA9IGZhbHNlLCBfZGVsZXRpb25UeXBlVmlzaWJsZSA9IGZhbHNlLCBfZGVsZXRlQWxsVmlzaWJsZSA9IGZhbHNlO1xyXG5mdW5jdGlvbiBzZXRDb3JlQ29ubmVjdGlvbihjb25uZWN0aW9ucykge1xyXG4gICAgX2NvcmVDb25uZWN0aW9ucyA9IGNvbm5lY3Rpb25zO1xyXG59XHJcbmZ1bmN0aW9uIHNldEJlZ2luQ3JlYXRpbmdOZXdKb2IoKSB7XHJcbiAgICByZXNldEpvYk1vZGFsRGF0YSgpO1xyXG4gICAgX2lzQ3JlYXRpbmdKb2IgPSB0cnVlO1xyXG4gICAgX21vZGFsVmlzaWJsZSA9IHRydWU7XHJcbn1cclxuZnVuY3Rpb24gc2V0QmVnaW5FZGl0dGluZ0pvYihqb2JEZXRhaWxzKSB7XHJcbiAgICByZXNldEpvYk1vZGFsRGF0YSgpO1xyXG4gICAgX2lzQ3JlYXRpbmdKb2IgPSBmYWxzZTtcclxuICAgIF9tb2RhbFZpc2libGUgPSB0cnVlO1xyXG4gICAgX2VkaXRUcmFuc2ZlckpvYiA9IGpvYkRldGFpbHM7XHJcbn1cclxuZnVuY3Rpb24gcmVzZXRKb2JNb2RhbERhdGEoKSB7XHJcbiAgICBfY29ubmVjdGlvbk1vZGFsVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgX2VkaXRDb25uZWN0aW9uTW9kYWxWaXNpYmxlID0gZmFsc2U7XHJcbiAgICBfY2hhbmdlc01hZGVUb0pvYiA9IGZhbHNlO1xyXG4gICAgX2Nvbm5lY3Rpb25WYWxpZCA9IGZhbHNlO1xyXG4gICAgX2Nvbm5lY3Rpb25Qcm9qZWN0cyA9IFtdO1xyXG4gICAgX3RyYW5zZmVySm9iQ3JlYXRpb24gPSBnZXRCbGFua1RyYW5zZmVySm9iQ3JlYXRpb24oKTtcclxuICAgIF9lZGl0VHJhbnNmZXJKb2IgPSBnZXRCbGFua1RyYW5zZmVySm9iSW5mbygpO1xyXG4gICAgX3NlbGVjdGVkQ29ubmVjdGlvbiA9IGdldEJsYW5rQ29ubmVjdGlvbk5hbWUoKTtcclxufVxyXG5mdW5jdGlvbiBzZXRCZWdpbkRlbGV0aW9uVHlwZVBvcHVwKGpvYkRldGFpbHMpIHtcclxuICAgIF9lZGl0VHJhbnNmZXJKb2IgPSBqb2JEZXRhaWxzO1xyXG4gICAgX2RlbGV0aW9uVHlwZVZpc2libGUgPSB0cnVlO1xyXG59XHJcbmZ1bmN0aW9uIHNldEJlZ2luRGVsZXRlQWxsUG9wdXAoKSB7XHJcbiAgICBfZGVsZXRlQWxsVmlzaWJsZSA9IHRydWU7XHJcbn1cclxuZnVuY3Rpb24gc2V0RW5kRGVsZXRlQWxsUG9wdXAoKSB7XHJcbiAgICBfZGVsZXRlQWxsVmlzaWJsZSA9IGZhbHNlO1xyXG59XHJcbmZ1bmN0aW9uIHNldEVuZERlbGV0aW9uVHlwZVBvcHVwKCkge1xyXG4gICAgX2RlbGV0aW9uVHlwZVZpc2libGUgPSBmYWxzZTtcclxufVxyXG5mdW5jdGlvbiBzZXRCZWdpbkFkZGluZ0Nvbm5lY3Rpb24oKSB7XHJcbiAgICBfY29ubmVjdGlvbk1vZGFsVmlzaWJsZSA9IHRydWU7XHJcbiAgICBpZiAoIV9pc0NyZWF0aW5nSm9iICYmICFfZWRpdENvbm5lY3Rpb25Nb2RhbFZpc2libGUpIHtcclxuICAgICAgICB2YXIgU3FsU2VydmVyTmFtZSA9IF9lZGl0VHJhbnNmZXJKb2IuU3FsU2VydmVyTmFtZSwgU3FsU2VydmVySW5zdGFuY2UgPSBfZWRpdFRyYW5zZmVySm9iLlNxbFNlcnZlckluc3RhbmNlLCBTcWxTZXJ2ZXJQb3J0ID0gX2VkaXRUcmFuc2ZlckpvYi5TcWxTZXJ2ZXJQb3J0LCBDb3JlU2VydmVyTmFtZSA9IF9lZGl0VHJhbnNmZXJKb2IuQ29yZVNlcnZlck5hbWUsIENvcmVWZXJzaW9uID0gX2VkaXRUcmFuc2ZlckpvYi5Db3JlVmVyc2lvbjtcclxuICAgICAgICBfY29yZUNvbm5lY3Rpb25TZXR0aW5nLlNxbFNlcnZlck5hbWUgPSBTcWxTZXJ2ZXJOYW1lO1xyXG4gICAgICAgIF9jb3JlQ29ubmVjdGlvblNldHRpbmcuU3FsU2VydmVySW5zdGFuY2UgPSBTcWxTZXJ2ZXJJbnN0YW5jZTtcclxuICAgICAgICBfY29yZUNvbm5lY3Rpb25TZXR0aW5nLlNxbFNlcnZlclRjcFBvcnQgPSBTcWxTZXJ2ZXJQb3J0LnRvU3RyaW5nKCkgPT09ICcwJyA/ICcnIDogU3FsU2VydmVyUG9ydDtcclxuICAgICAgICBfY29yZUNvbm5lY3Rpb25TZXR0aW5nLkNvcmVTZXJ2ZXJOYW1lID0gQ29yZVNlcnZlck5hbWU7XHJcbiAgICAgICAgX2NvcmVDb25uZWN0aW9uU2V0dGluZy5WZXJzaW9uID0gQ29yZVZlcnNpb247XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gc2V0RmluaXNoQWRkaW5nQ29ubmVjdGlvbigpIHtcclxuICAgIF9jb25uZWN0aW9uTW9kYWxWaXNpYmxlID0gZmFsc2U7XHJcbiAgICBfY29ubmVjdGlvbkZvcm1DaGFuZ2VzTWFkZSA9IGZhbHNlO1xyXG4gICAgX2NvcmVDb25uZWN0aW9uU2V0dGluZyA9IGdldEJsYW5rQ29yZVNldHRpbmdzKCk7XHJcbn1cclxuZnVuY3Rpb24gZ2V0QmxhbmtUcmFuc2ZlckpvYkNyZWF0aW9uKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBQcm9qZWN0TmFtZTogXCJcIixcclxuICAgICAgICBDb3JlUHJvamVjdE5hbWU6IFwiXCIsXHJcbiAgICAgICAgQ29yZUNvbm5lY3Rpb25JZDogXCJcIixcclxuICAgICAgICBKb2JTY2hlZHVsZTogZ2V0QmxhbmtKb2JTY2hlZHVsZSgpXHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIGdldEJsYW5rVHJhbnNmZXJKb2JJbmZvKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBOYW1lOiBcIlwiLFxyXG4gICAgICAgIFByb2plY3ROYW1lOiBcIlwiLFxyXG4gICAgICAgIFZTdWl0ZUNvcmVQcm9qZWN0TmFtZTogXCJcIixcclxuICAgICAgICBTcWxTZXJ2ZXJOYW1lOiBcIlwiLFxyXG4gICAgICAgIFNxbFNlcnZlckluc3RhbmNlOiBcIlwiLFxyXG4gICAgICAgIFNjaGVkdWxlRW5hYmxlZDogZmFsc2UsXHJcbiAgICAgICAgU3FsU2VydmVyUG9ydDogXCJcIixcclxuICAgICAgICBDb3JlU2VydmVyTmFtZTogXCJcIixcclxuICAgICAgICBDb3JlVmVyc2lvbjogXCJcIixcclxuICAgICAgICBKb2JTY2hlZHVsZTogZ2V0QmxhbmtKb2JTY2hlZHVsZSgpLFxyXG4gICAgICAgIFN5bmNocm9uaXphdGlvbjogXCJcIixcclxuICAgICAgICBTeW5jaHJvbml6YXRpb25TdGF0dXM6IFwiXCIsXHJcbiAgICAgICAgTGFzdFRyYW5zZmVyRGF0ZTogXCJcIlxyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBnZXRCbGFua0NvcmVTZXR0aW5ncygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgQ29uZmlndXJhdGlvbk5hbWU6IFwiXCIsXHJcbiAgICAgICAgU3FsU2VydmVyTmFtZTogXCJcIixcclxuICAgICAgICBTcWxTZXJ2ZXJJbnN0YW5jZTogXCJcIixcclxuICAgICAgICBTcWxTZXJ2ZXJUY3BQb3J0OiBcIlwiLFxyXG4gICAgICAgIENvcmVTZXJ2ZXJOYW1lOiBcIlwiLFxyXG4gICAgICAgIENvcmVBZG1pblBhc3N3b3JkOiBcIlwiLFxyXG4gICAgICAgIFZlcnNpb246IFwiNi4yXCJcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gZ2V0QmxhbmtDb25uZWN0aW9uTmFtZSgpIHtcclxuICAgIHJldHVybiB7IElkOiBcIlwiLCBOYW1lOiBcIlwiIH07XHJcbn1cclxuZnVuY3Rpb24gZ2V0QmxhbmtKb2JTY2hlZHVsZSgpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgRGF5c1RvUnVuOiBbXSxcclxuICAgICAgICBTdGFydERhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICBSdW5PbmNlRGFpbHk6IHRydWUsXHJcbiAgICAgICAgUnVuRXZlcnlIb3VyczogMCxcclxuICAgICAgICBSdW5TdGFydFRpbWU6IFwiMDA6MDBcIixcclxuICAgICAgICBSdW5FbmRUaW1lOiBcIjAwOjAwXCIsXHJcbiAgICAgICAgU2NoZWR1bGVFbmFibGVkOiBmYWxzZVxyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiB1cGRhdGVKb2JDcmVhdGlvbihrZXksIHZhbHVlKSB7XHJcbiAgICBfY2hhbmdlc01hZGVUb0pvYiA9IHRydWU7XHJcbiAgICBfdHJhbnNmZXJKb2JDcmVhdGlvbltrZXldID0gdmFsdWU7XHJcbiAgICBpZiAoIV9pc0NyZWF0aW5nSm9iKSB7XHJcbiAgICAgICAgaWYgKGtleSA9PT0gXCJDb3JlUHJvamVjdE5hbWVcIikge1xyXG4gICAgICAgICAgICBfZWRpdFRyYW5zZmVySm9iLlZTdWl0ZUNvcmVQcm9qZWN0TmFtZSA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiB1cGRhdGVDb25uZWN0aW9uKGtleSwgdmFsdWUpIHtcclxuICAgIF9jb25uZWN0aW9uRm9ybUNoYW5nZXNNYWRlID0gdHJ1ZTtcclxuICAgIF9jb25uZWN0aW9uVmFsaWQgPSBmYWxzZTtcclxuICAgIF9jb3JlQ29ubmVjdGlvblNldHRpbmdba2V5XSA9IHZhbHVlO1xyXG59XHJcbnZhciBEYXRhVHJhbnNmZXJTdG9yZSA9IGFzc2lnbih7fSwgRXZlbnRFbWl0dGVyLnByb3RvdHlwZSwge1xyXG4gICAgLy8gQWRkIHN0b3JlIGdldHRlcnMgaGVyZVxyXG4gICAgZ2V0QWxsSm9iczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfdHJhbnNmZXJKb2JzO1xyXG4gICAgfSxcclxuICAgIGdldFRyYW5zZmVySm9iQ3JlYXRpb246IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX3RyYW5zZmVySm9iQ3JlYXRpb247XHJcbiAgICB9LFxyXG4gICAgZ2V0RWRpdFRyYW5zZmVySm9iOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9lZGl0VHJhbnNmZXJKb2I7XHJcbiAgICB9LFxyXG4gICAgZ2V0QWxsQ29yZUNvbm5lY3Rpb25zOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9jb3JlQ29ubmVjdGlvbnM7XHJcbiAgICB9LFxyXG4gICAgZ2V0Q29ubmVjdGlvblByb2plY3RzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9jb25uZWN0aW9uUHJvamVjdHM7XHJcbiAgICB9LFxyXG4gICAgZ2V0U2VsZWN0ZWRDb25uZWN0aW9uOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zZWxlY3RlZENvbm5lY3Rpb247XHJcbiAgICB9LFxyXG4gICAgZ2V0Q29yZUNvbm5lY3Rpb25TZXR0aW5nOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9jb3JlQ29ubmVjdGlvblNldHRpbmc7XHJcbiAgICB9LFxyXG4gICAgZ2V0SXNDcmVhdGluZzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfaXNDcmVhdGluZ0pvYjtcclxuICAgIH0sXHJcbiAgICBnZXRIYXNKb2JDaGFuZ2VzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9jaGFuZ2VzTWFkZVRvSm9iO1xyXG4gICAgfSxcclxuICAgIGdldENvbm5lY3Rpb25Gb3JtSGFzQ2hhbmdlczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfY29ubmVjdGlvbkZvcm1DaGFuZ2VzTWFkZTtcclxuICAgIH0sXHJcbiAgICBnZXRDb25uZWN0aW9uVmFsaWRpdHk6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2Nvbm5lY3Rpb25WYWxpZDtcclxuICAgIH0sXHJcbiAgICBnZXRDb25uZWN0aW9uTW9kYWxWaXNpYmxlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9jb25uZWN0aW9uTW9kYWxWaXNpYmxlO1xyXG4gICAgfSxcclxuICAgIGdldEVkaXRDb25uZWN0aW9uTW9kYWxWaXNpYmxlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9lZGl0Q29ubmVjdGlvbk1vZGFsVmlzaWJsZTtcclxuICAgIH0sXHJcbiAgICBnZXREZWxldGlvblR5cGVWaXNpYmxlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9kZWxldGlvblR5cGVWaXNpYmxlO1xyXG4gICAgfSxcclxuICAgIGdldE1vZGFsVmlzaWJsZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfbW9kYWxWaXNpYmxlO1xyXG4gICAgfSxcclxuICAgIGdldERlbGV0aW9uVHlwZU1vZGFsVmlzaWJsZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfZGVsZXRpb25UeXBlVmlzaWJsZTtcclxuICAgIH0sXHJcbiAgICBnZXREZWxldGVBbGxNb2RhbFZpc2libGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2RlbGV0ZUFsbFZpc2libGU7XHJcbiAgICB9LFxyXG4gICAgZW1pdENoYW5nZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuZW1pdChDSEFOR0VfRVZFTlQpO1xyXG4gICAgfSxcclxuICAgIGFkZENoYW5nZUxpc3RlbmVyOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgICAgICB0aGlzLm9uKENIQU5HRV9FVkVOVCwgY2FsbGJhY2spO1xyXG4gICAgfSxcclxuICAgIHJlbW92ZUNoYW5nZUxpc3RlbmVyOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKENIQU5HRV9FVkVOVCwgY2FsbGJhY2spO1xyXG4gICAgfVxyXG59KTtcclxuZnVuY3Rpb24gU2hvd0N1c3RvbURpYWxvZygpIHtcclxuICAgIFNob3dEaWFsb2dCb3goJ1dhcm5pbmcnLCAnUmVjb3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LicsICdPaycsICcnLCAnR29Ub0Fzc2V0TGlzdCcsIG51bGwpO1xyXG59XHJcbmZ1bmN0aW9uIFNob3dEaWFsb2dCb3godGl0bGUsIGNvbnRlbnQsIGJ0bjF0ZXh0LCBidG4ydGV4dCwgZnVuY3Rpb25UZXh0LCBwYXJhbWV0ZXJMaXN0KSB7XHJcbiAgICB2YXIgYnRuMWNzcztcclxuICAgIHZhciBidG4yY3NzO1xyXG4gICAgaWYgKGJ0bjF0ZXh0ID09ICcnKSB7XHJcbiAgICAgICAgYnRuMWNzcyA9IFwiaGlkZWNzc1wiO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgYnRuMWNzcyA9IFwic2hvd2Nzc1wiO1xyXG4gICAgfVxyXG4gICAgaWYgKGJ0bjJ0ZXh0ID09ICcnKSB7XHJcbiAgICAgICAgYnRuMmNzcyA9IFwiaGlkZWNzc1wiO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgYnRuMmNzcyA9IFwic2hvd2Nzc1wiO1xyXG4gICAgfVxyXG4gICAgJChcIiNsYmxNZXNzYWdlXCIpLmh0bWwoY29udGVudCk7XHJcbiAgICB2YXIgZGlhbG9nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkRJQUxPR1wiKTtcclxuICAgICQoXCIjZGlhbG9nXCIpLmRpYWxvZyh7XHJcbiAgICAgICAgcmVzaXphYmxlOiBmYWxzZSxcclxuICAgICAgICB0aXRsZTogdGl0bGUsXHJcbiAgICAgICAgbW9kYWw6IHRydWUsXHJcbiAgICAgICAgd2lkdGg6ICc0MDBweCcsXHJcbiAgICAgICAgaGVpZ2h0OiAnYXV0bycsXHJcbiAgICAgICAgYmdpZnJhbWU6IGZhbHNlLFxyXG4gICAgICAgIGhpZGU6IHsgZWZmZWN0OiAnc2NhbGUnLCBkdXJhdGlvbjogNDAwIH0sXHJcbiAgICAgICAgYnV0dG9uczogW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0OiBidG4xdGV4dCxcclxuICAgICAgICAgICAgICAgIFwiY2xhc3NcIjogYnRuMWNzcyxcclxuICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcIiNkaWFsb2dcIikuZGlhbG9nKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0OiBidG4ydGV4dCxcclxuICAgICAgICAgICAgICAgIFwiY2xhc3NcIjogYnRuMmNzcyxcclxuICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcIiNkaWFsb2dcIikuZGlhbG9nKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXVxyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gZml4Sm9iRGF0YShkYXRhKSB7XHJcbiAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoam9iKSB7XHJcbiAgICAgICAgICAgIGlmIChqb2IuU3luY2hyb25pemF0aW9uU3RhdHVzID09IFN5bmNocm9uaXphdGlvblN0YXR1c1R5cGVFbnVtLk5vdFN5bmNocm9uaXplZCkge1xyXG4gICAgICAgICAgICAgICAgam9iLlN5bmNocm9uaXphdGlvbiA9IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Z3JpZC5ub3RTeW5jaHJvbml6ZWRcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoam9iLlN5bmNocm9uaXphdGlvblN0YXR1cyA9PSBTeW5jaHJvbml6YXRpb25TdGF0dXNUeXBlRW51bS5TeW5jaHJvbml6ZWQpIHtcclxuICAgICAgICAgICAgICAgIGpvYi5TeW5jaHJvbml6YXRpb24gPSBEYXRlVGltZUZvcm1hdEhlbHBlci5nZXRGb3JtYXREYXRlKGpvYi5MYXN0VHJhbnNmZXJEYXRlKSArIFwiIFwiICsgRGF0ZVRpbWVGb3JtYXRIZWxwZXIuZ2V0Rm9ybWF0VGltZShqb2IuTGFzdFRyYW5zZmVyRGF0ZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGpvYi5TeW5jaHJvbml6YXRpb25TdGF0dXMgPT0gU3luY2hyb25pemF0aW9uU3RhdHVzVHlwZUVudW0uSW52YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgam9iLlN5bmNocm9uaXphdGlvbiA9IElub3Z4TG9hZGVyLnQoXCJEYXRhVHJhbnNmZXI6Z3JpZC5pbnZhbGlkXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGpvYi5TeW5jaHJvbml6YXRpb25TdGF0dXMgPT0gU3luY2hyb25pemF0aW9uU3RhdHVzVHlwZUVudW0uRGlzY29ubmVjdGVkKSB7XHJcbiAgICAgICAgICAgICAgICBqb2IuU3luY2hyb25pemF0aW9uID0gSW5vdnhMb2FkZXIudChcIkRhdGFUcmFuc2ZlcjpncmlkLmRpc2Nvbm5lY3RlZFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbklub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIucmVnaXN0ZXIoZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgIHN3aXRjaCAocGF5bG9hZC5hY3Rpb25UeXBlKSB7XHJcbiAgICAgICAgY2FzZSBEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0JFR0lOX0RFTEVURV9UWVBFOlxyXG4gICAgICAgICAgICBzZXRCZWdpbkRlbGV0aW9uVHlwZVBvcHVwKHBheWxvYWQuZGF0YSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9FTkRfREVMRVRFX1RZUEU6XHJcbiAgICAgICAgICAgIHNldEVuZERlbGV0aW9uVHlwZVBvcHVwKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9CRUdJTl9ERUxFVEVfQUxMOlxyXG4gICAgICAgICAgICBzZXRCZWdpbkRlbGV0ZUFsbFBvcHVwKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9GSU5JU0hfREVMRVRFX0FMTDpcclxuICAgICAgICAgICAgc2V0RW5kRGVsZXRlQWxsUG9wdXAoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0dFVF9BTExfSk9CUzpcclxuICAgICAgICAgICAgX3RyYW5zZmVySm9icyA9IHBheWxvYWQuZGF0YTtcclxuICAgICAgICAgICAgZml4Sm9iRGF0YShfdHJhbnNmZXJKb2JzKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0JFR0lOX0NSRUFURTpcclxuICAgICAgICAgICAgc2V0QmVnaW5DcmVhdGluZ05ld0pvYigpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfQkVHSU5fRURJVDpcclxuICAgICAgICAgICAgc2V0QmVnaW5FZGl0dGluZ0pvYihwYXlsb2FkLmRhdGEpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfRklOSVNIX0VESVQ6XHJcbiAgICAgICAgICAgIF9tb2RhbFZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgX2NoYW5nZXNNYWRlVG9Kb2IgPSBmYWxzZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBEYXRhVHJhbnNmZXJDb25zdGFudHMuREFUQVRSQU5TRkVSX0NIQU5HRV9TRUxFQ1RFRF9DT05ORUNUSU9OOlxyXG4gICAgICAgICAgICBfc2VsZWN0ZWRDb25uZWN0aW9uID0gcGF5bG9hZC5kYXRhO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfR0VUX0FMTF9DT1JFX0NPTk5FQ1RJT05TOlxyXG4gICAgICAgICAgICBzZXRDb3JlQ29ubmVjdGlvbihwYXlsb2FkLmRhdGEpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfR0VUX0FMTF9DT05ORUNUSU9OX1BST0pFQ1RTOlxyXG4gICAgICAgICAgICBfY29ubmVjdGlvblByb2plY3RzID0gcGF5bG9hZC5kYXRhO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfVVBEQVRFX0pPQl9DUkVBVElPTjpcclxuICAgICAgICAgICAgdXBkYXRlSm9iQ3JlYXRpb24ocGF5bG9hZC5rZXksIHBheWxvYWQudmFsdWUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfVVBEQVRFX0NPTk5FQ1RJT046XHJcbiAgICAgICAgICAgIHVwZGF0ZUNvbm5lY3Rpb24ocGF5bG9hZC5rZXksIHBheWxvYWQudmFsdWUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfQkVHSU5fQUREX0NPTk5FQ1RJT046XHJcbiAgICAgICAgICAgIHNldEJlZ2luQWRkaW5nQ29ubmVjdGlvbigpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfRklOSVNIX0FERF9DT05ORUNUSU9OOlxyXG4gICAgICAgICAgICBzZXRGaW5pc2hBZGRpbmdDb25uZWN0aW9uKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRGF0YVRyYW5zZmVyQ29uc3RhbnRzLkRBVEFUUkFOU0ZFUl9URVNUX0NPTk5FQ1RJT046XHJcbiAgICAgICAgICAgIF9jb25uZWN0aW9uVmFsaWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfRURJVF9DT05ORUNUSU9OOlxyXG4gICAgICAgICAgICBfZWRpdENvbm5lY3Rpb25Nb2RhbFZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFUcmFuc2ZlckNvbnN0YW50cy5EQVRBVFJBTlNGRVJfQ0xPU0VfRURJVF9DT05ORUNUSU9OOlxyXG4gICAgICAgICAgICBfZWRpdENvbm5lY3Rpb25Nb2RhbFZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDogcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBEYXRhVHJhbnNmZXJTdG9yZS5lbWl0Q2hhbmdlKCk7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxufSk7XHJcbm1vZHVsZS5leHBvcnRzID0gRGF0YVRyYW5zZmVyU3RvcmU7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPURhdGFUcmFuc2ZlclN0b3JlLmpzLm1hcCIsIi8vIENvcHlyaWdodCBKb3llbnQsIEluYy4gYW5kIG90aGVyIE5vZGUgY29udHJpYnV0b3JzLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhXG4vLyBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlXG4vLyBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmdcbi8vIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCxcbi8vIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXRcbi8vIHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZVxuLy8gZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWRcbi8vIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1Ncbi8vIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0Zcbi8vIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU5cbi8vIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLFxuLy8gREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SXG4vLyBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFXG4vLyBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG52YXIgb2JqZWN0Q3JlYXRlID0gT2JqZWN0LmNyZWF0ZSB8fCBvYmplY3RDcmVhdGVQb2x5ZmlsbFxudmFyIG9iamVjdEtleXMgPSBPYmplY3Qua2V5cyB8fCBvYmplY3RLZXlzUG9seWZpbGxcbnZhciBiaW5kID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgfHwgZnVuY3Rpb25CaW5kUG9seWZpbGxcblxuZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkge1xuICBpZiAoIXRoaXMuX2V2ZW50cyB8fCAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMsICdfZXZlbnRzJykpIHtcbiAgICB0aGlzLl9ldmVudHMgPSBvYmplY3RDcmVhdGUobnVsbCk7XG4gICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwO1xuICB9XG5cbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gdGhpcy5fbWF4TGlzdGVuZXJzIHx8IHVuZGVmaW5lZDtcbn1cbm1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyO1xuXG4vLyBCYWNrd2FyZHMtY29tcGF0IHdpdGggbm9kZSAwLjEwLnhcbkV2ZW50RW1pdHRlci5FdmVudEVtaXR0ZXIgPSBFdmVudEVtaXR0ZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX2V2ZW50cyA9IHVuZGVmaW5lZDtcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX21heExpc3RlbmVycyA9IHVuZGVmaW5lZDtcblxuLy8gQnkgZGVmYXVsdCBFdmVudEVtaXR0ZXJzIHdpbGwgcHJpbnQgYSB3YXJuaW5nIGlmIG1vcmUgdGhhbiAxMCBsaXN0ZW5lcnMgYXJlXG4vLyBhZGRlZCB0byBpdC4gVGhpcyBpcyBhIHVzZWZ1bCBkZWZhdWx0IHdoaWNoIGhlbHBzIGZpbmRpbmcgbWVtb3J5IGxlYWtzLlxudmFyIGRlZmF1bHRNYXhMaXN0ZW5lcnMgPSAxMDtcblxudmFyIGhhc0RlZmluZVByb3BlcnR5O1xudHJ5IHtcbiAgdmFyIG8gPSB7fTtcbiAgaWYgKE9iamVjdC5kZWZpbmVQcm9wZXJ0eSkgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sICd4JywgeyB2YWx1ZTogMCB9KTtcbiAgaGFzRGVmaW5lUHJvcGVydHkgPSBvLnggPT09IDA7XG59IGNhdGNoIChlcnIpIHsgaGFzRGVmaW5lUHJvcGVydHkgPSBmYWxzZSB9XG5pZiAoaGFzRGVmaW5lUHJvcGVydHkpIHtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEV2ZW50RW1pdHRlciwgJ2RlZmF1bHRNYXhMaXN0ZW5lcnMnLCB7XG4gICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRNYXhMaXN0ZW5lcnM7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uKGFyZykge1xuICAgICAgLy8gY2hlY2sgd2hldGhlciB0aGUgaW5wdXQgaXMgYSBwb3NpdGl2ZSBudW1iZXIgKHdob3NlIHZhbHVlIGlzIHplcm8gb3JcbiAgICAgIC8vIGdyZWF0ZXIgYW5kIG5vdCBhIE5hTikuXG4gICAgICBpZiAodHlwZW9mIGFyZyAhPT0gJ251bWJlcicgfHwgYXJnIDwgMCB8fCBhcmcgIT09IGFyZylcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJkZWZhdWx0TWF4TGlzdGVuZXJzXCIgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlcicpO1xuICAgICAgZGVmYXVsdE1heExpc3RlbmVycyA9IGFyZztcbiAgICB9XG4gIH0pO1xufSBlbHNlIHtcbiAgRXZlbnRFbWl0dGVyLmRlZmF1bHRNYXhMaXN0ZW5lcnMgPSBkZWZhdWx0TWF4TGlzdGVuZXJzO1xufVxuXG4vLyBPYnZpb3VzbHkgbm90IGFsbCBFbWl0dGVycyBzaG91bGQgYmUgbGltaXRlZCB0byAxMC4gVGhpcyBmdW5jdGlvbiBhbGxvd3Ncbi8vIHRoYXQgdG8gYmUgaW5jcmVhc2VkLiBTZXQgdG8gemVybyBmb3IgdW5saW1pdGVkLlxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5zZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbiBzZXRNYXhMaXN0ZW5lcnMobikge1xuICBpZiAodHlwZW9mIG4gIT09ICdudW1iZXInIHx8IG4gPCAwIHx8IGlzTmFOKG4pKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wiblwiIGFyZ3VtZW50IG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtcbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gbjtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5mdW5jdGlvbiAkZ2V0TWF4TGlzdGVuZXJzKHRoYXQpIHtcbiAgaWYgKHRoYXQuX21heExpc3RlbmVycyA9PT0gdW5kZWZpbmVkKVxuICAgIHJldHVybiBFdmVudEVtaXR0ZXIuZGVmYXVsdE1heExpc3RlbmVycztcbiAgcmV0dXJuIHRoYXQuX21heExpc3RlbmVycztcbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5nZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbiBnZXRNYXhMaXN0ZW5lcnMoKSB7XG4gIHJldHVybiAkZ2V0TWF4TGlzdGVuZXJzKHRoaXMpO1xufTtcblxuLy8gVGhlc2Ugc3RhbmRhbG9uZSBlbWl0KiBmdW5jdGlvbnMgYXJlIHVzZWQgdG8gb3B0aW1pemUgY2FsbGluZyBvZiBldmVudFxuLy8gaGFuZGxlcnMgZm9yIGZhc3QgY2FzZXMgYmVjYXVzZSBlbWl0KCkgaXRzZWxmIG9mdGVuIGhhcyBhIHZhcmlhYmxlIG51bWJlciBvZlxuLy8gYXJndW1lbnRzIGFuZCBjYW4gYmUgZGVvcHRpbWl6ZWQgYmVjYXVzZSBvZiB0aGF0LiBUaGVzZSBmdW5jdGlvbnMgYWx3YXlzIGhhdmVcbi8vIHRoZSBzYW1lIG51bWJlciBvZiBhcmd1bWVudHMgYW5kIHRodXMgZG8gbm90IGdldCBkZW9wdGltaXplZCwgc28gdGhlIGNvZGVcbi8vIGluc2lkZSB0aGVtIGNhbiBleGVjdXRlIGZhc3Rlci5cbmZ1bmN0aW9uIGVtaXROb25lKGhhbmRsZXIsIGlzRm4sIHNlbGYpIHtcbiAgaWYgKGlzRm4pXG4gICAgaGFuZGxlci5jYWxsKHNlbGYpO1xuICBlbHNlIHtcbiAgICB2YXIgbGVuID0gaGFuZGxlci5sZW5ndGg7XG4gICAgdmFyIGxpc3RlbmVycyA9IGFycmF5Q2xvbmUoaGFuZGxlciwgbGVuKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKVxuICAgICAgbGlzdGVuZXJzW2ldLmNhbGwoc2VsZik7XG4gIH1cbn1cbmZ1bmN0aW9uIGVtaXRPbmUoaGFuZGxlciwgaXNGbiwgc2VsZiwgYXJnMSkge1xuICBpZiAoaXNGbilcbiAgICBoYW5kbGVyLmNhbGwoc2VsZiwgYXJnMSk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uY2FsbChzZWxmLCBhcmcxKTtcbiAgfVxufVxuZnVuY3Rpb24gZW1pdFR3byhoYW5kbGVyLCBpc0ZuLCBzZWxmLCBhcmcxLCBhcmcyKSB7XG4gIGlmIChpc0ZuKVxuICAgIGhhbmRsZXIuY2FsbChzZWxmLCBhcmcxLCBhcmcyKTtcbiAgZWxzZSB7XG4gICAgdmFyIGxlbiA9IGhhbmRsZXIubGVuZ3RoO1xuICAgIHZhciBsaXN0ZW5lcnMgPSBhcnJheUNsb25lKGhhbmRsZXIsIGxlbik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSlcbiAgICAgIGxpc3RlbmVyc1tpXS5jYWxsKHNlbGYsIGFyZzEsIGFyZzIpO1xuICB9XG59XG5mdW5jdGlvbiBlbWl0VGhyZWUoaGFuZGxlciwgaXNGbiwgc2VsZiwgYXJnMSwgYXJnMiwgYXJnMykge1xuICBpZiAoaXNGbilcbiAgICBoYW5kbGVyLmNhbGwoc2VsZiwgYXJnMSwgYXJnMiwgYXJnMyk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uY2FsbChzZWxmLCBhcmcxLCBhcmcyLCBhcmczKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBlbWl0TWFueShoYW5kbGVyLCBpc0ZuLCBzZWxmLCBhcmdzKSB7XG4gIGlmIChpc0ZuKVxuICAgIGhhbmRsZXIuYXBwbHkoc2VsZiwgYXJncyk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uYXBwbHkoc2VsZiwgYXJncyk7XG4gIH1cbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gZW1pdCh0eXBlKSB7XG4gIHZhciBlciwgaGFuZGxlciwgbGVuLCBhcmdzLCBpLCBldmVudHM7XG4gIHZhciBkb0Vycm9yID0gKHR5cGUgPT09ICdlcnJvcicpO1xuXG4gIGV2ZW50cyA9IHRoaXMuX2V2ZW50cztcbiAgaWYgKGV2ZW50cylcbiAgICBkb0Vycm9yID0gKGRvRXJyb3IgJiYgZXZlbnRzLmVycm9yID09IG51bGwpO1xuICBlbHNlIGlmICghZG9FcnJvcilcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgLy8gSWYgdGhlcmUgaXMgbm8gJ2Vycm9yJyBldmVudCBsaXN0ZW5lciB0aGVuIHRocm93LlxuICBpZiAoZG9FcnJvcikge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSlcbiAgICAgIGVyID0gYXJndW1lbnRzWzFdO1xuICAgIGlmIChlciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICB0aHJvdyBlcjsgLy8gVW5oYW5kbGVkICdlcnJvcicgZXZlbnRcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQXQgbGVhc3QgZ2l2ZSBzb21lIGtpbmQgb2YgY29udGV4dCB0byB0aGUgdXNlclxuICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcignVW5oYW5kbGVkIFwiZXJyb3JcIiBldmVudC4gKCcgKyBlciArICcpJyk7XG4gICAgICBlcnIuY29udGV4dCA9IGVyO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBoYW5kbGVyID0gZXZlbnRzW3R5cGVdO1xuXG4gIGlmICghaGFuZGxlcilcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgdmFyIGlzRm4gPSB0eXBlb2YgaGFuZGxlciA9PT0gJ2Z1bmN0aW9uJztcbiAgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgc3dpdGNoIChsZW4pIHtcbiAgICAgIC8vIGZhc3QgY2FzZXNcbiAgICBjYXNlIDE6XG4gICAgICBlbWl0Tm9uZShoYW5kbGVyLCBpc0ZuLCB0aGlzKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMjpcbiAgICAgIGVtaXRPbmUoaGFuZGxlciwgaXNGbiwgdGhpcywgYXJndW1lbnRzWzFdKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMzpcbiAgICAgIGVtaXRUd28oaGFuZGxlciwgaXNGbiwgdGhpcywgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0pO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSA0OlxuICAgICAgZW1pdFRocmVlKGhhbmRsZXIsIGlzRm4sIHRoaXMsIGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdLCBhcmd1bWVudHNbM10pO1xuICAgICAgYnJlYWs7XG4gICAgICAvLyBzbG93ZXJcbiAgICBkZWZhdWx0OlxuICAgICAgYXJncyA9IG5ldyBBcnJheShsZW4gLSAxKTtcbiAgICAgIGZvciAoaSA9IDE7IGkgPCBsZW47IGkrKylcbiAgICAgICAgYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07XG4gICAgICBlbWl0TWFueShoYW5kbGVyLCBpc0ZuLCB0aGlzLCBhcmdzKTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuZnVuY3Rpb24gX2FkZExpc3RlbmVyKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIsIHByZXBlbmQpIHtcbiAgdmFyIG07XG4gIHZhciBldmVudHM7XG4gIHZhciBleGlzdGluZztcblxuICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICBldmVudHMgPSB0YXJnZXQuX2V2ZW50cztcbiAgaWYgKCFldmVudHMpIHtcbiAgICBldmVudHMgPSB0YXJnZXQuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICB0YXJnZXQuX2V2ZW50c0NvdW50ID0gMDtcbiAgfSBlbHNlIHtcbiAgICAvLyBUbyBhdm9pZCByZWN1cnNpb24gaW4gdGhlIGNhc2UgdGhhdCB0eXBlID09PSBcIm5ld0xpc3RlbmVyXCIhIEJlZm9yZVxuICAgIC8vIGFkZGluZyBpdCB0byB0aGUgbGlzdGVuZXJzLCBmaXJzdCBlbWl0IFwibmV3TGlzdGVuZXJcIi5cbiAgICBpZiAoZXZlbnRzLm5ld0xpc3RlbmVyKSB7XG4gICAgICB0YXJnZXQuZW1pdCgnbmV3TGlzdGVuZXInLCB0eXBlLFxuICAgICAgICAgIGxpc3RlbmVyLmxpc3RlbmVyID8gbGlzdGVuZXIubGlzdGVuZXIgOiBsaXN0ZW5lcik7XG5cbiAgICAgIC8vIFJlLWFzc2lnbiBgZXZlbnRzYCBiZWNhdXNlIGEgbmV3TGlzdGVuZXIgaGFuZGxlciBjb3VsZCBoYXZlIGNhdXNlZCB0aGVcbiAgICAgIC8vIHRoaXMuX2V2ZW50cyB0byBiZSBhc3NpZ25lZCB0byBhIG5ldyBvYmplY3RcbiAgICAgIGV2ZW50cyA9IHRhcmdldC5fZXZlbnRzO1xuICAgIH1cbiAgICBleGlzdGluZyA9IGV2ZW50c1t0eXBlXTtcbiAgfVxuXG4gIGlmICghZXhpc3RpbmcpIHtcbiAgICAvLyBPcHRpbWl6ZSB0aGUgY2FzZSBvZiBvbmUgbGlzdGVuZXIuIERvbid0IG5lZWQgdGhlIGV4dHJhIGFycmF5IG9iamVjdC5cbiAgICBleGlzdGluZyA9IGV2ZW50c1t0eXBlXSA9IGxpc3RlbmVyO1xuICAgICsrdGFyZ2V0Ll9ldmVudHNDb3VudDtcbiAgfSBlbHNlIHtcbiAgICBpZiAodHlwZW9mIGV4aXN0aW5nID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAvLyBBZGRpbmcgdGhlIHNlY29uZCBlbGVtZW50LCBuZWVkIHRvIGNoYW5nZSB0byBhcnJheS5cbiAgICAgIGV4aXN0aW5nID0gZXZlbnRzW3R5cGVdID1cbiAgICAgICAgICBwcmVwZW5kID8gW2xpc3RlbmVyLCBleGlzdGluZ10gOiBbZXhpc3RpbmcsIGxpc3RlbmVyXTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgd2UndmUgYWxyZWFkeSBnb3QgYW4gYXJyYXksIGp1c3QgYXBwZW5kLlxuICAgICAgaWYgKHByZXBlbmQpIHtcbiAgICAgICAgZXhpc3RpbmcudW5zaGlmdChsaXN0ZW5lcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBleGlzdGluZy5wdXNoKGxpc3RlbmVyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgbGlzdGVuZXIgbGVha1xuICAgIGlmICghZXhpc3Rpbmcud2FybmVkKSB7XG4gICAgICBtID0gJGdldE1heExpc3RlbmVycyh0YXJnZXQpO1xuICAgICAgaWYgKG0gJiYgbSA+IDAgJiYgZXhpc3RpbmcubGVuZ3RoID4gbSkge1xuICAgICAgICBleGlzdGluZy53YXJuZWQgPSB0cnVlO1xuICAgICAgICB2YXIgdyA9IG5ldyBFcnJvcignUG9zc2libGUgRXZlbnRFbWl0dGVyIG1lbW9yeSBsZWFrIGRldGVjdGVkLiAnICtcbiAgICAgICAgICAgIGV4aXN0aW5nLmxlbmd0aCArICcgXCInICsgU3RyaW5nKHR5cGUpICsgJ1wiIGxpc3RlbmVycyAnICtcbiAgICAgICAgICAgICdhZGRlZC4gVXNlIGVtaXR0ZXIuc2V0TWF4TGlzdGVuZXJzKCkgdG8gJyArXG4gICAgICAgICAgICAnaW5jcmVhc2UgbGltaXQuJyk7XG4gICAgICAgIHcubmFtZSA9ICdNYXhMaXN0ZW5lcnNFeGNlZWRlZFdhcm5pbmcnO1xuICAgICAgICB3LmVtaXR0ZXIgPSB0YXJnZXQ7XG4gICAgICAgIHcudHlwZSA9IHR5cGU7XG4gICAgICAgIHcuY291bnQgPSBleGlzdGluZy5sZW5ndGg7XG4gICAgICAgIGlmICh0eXBlb2YgY29uc29sZSA9PT0gJ29iamVjdCcgJiYgY29uc29sZS53YXJuKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCclczogJXMnLCB3Lm5hbWUsIHcubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGFyZ2V0O1xufVxuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZExpc3RlbmVyID0gZnVuY3Rpb24gYWRkTGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHtcbiAgcmV0dXJuIF9hZGRMaXN0ZW5lcih0aGlzLCB0eXBlLCBsaXN0ZW5lciwgZmFsc2UpO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbiA9IEV2ZW50RW1pdHRlci5wcm90b3R5cGUuYWRkTGlzdGVuZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucHJlcGVuZExpc3RlbmVyID1cbiAgICBmdW5jdGlvbiBwcmVwZW5kTGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgIHJldHVybiBfYWRkTGlzdGVuZXIodGhpcywgdHlwZSwgbGlzdGVuZXIsIHRydWUpO1xuICAgIH07XG5cbmZ1bmN0aW9uIG9uY2VXcmFwcGVyKCkge1xuICBpZiAoIXRoaXMuZmlyZWQpIHtcbiAgICB0aGlzLnRhcmdldC5yZW1vdmVMaXN0ZW5lcih0aGlzLnR5cGUsIHRoaXMud3JhcEZuKTtcbiAgICB0aGlzLmZpcmVkID0gdHJ1ZTtcbiAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCk7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLmNhbGwodGhpcy50YXJnZXQsIGFyZ3VtZW50c1swXSk7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLmNhbGwodGhpcy50YXJnZXQsIGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdKTtcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCwgYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0sXG4gICAgICAgICAgICBhcmd1bWVudHNbMl0pO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7ICsraSlcbiAgICAgICAgICBhcmdzW2ldID0gYXJndW1lbnRzW2ldO1xuICAgICAgICB0aGlzLmxpc3RlbmVyLmFwcGx5KHRoaXMudGFyZ2V0LCBhcmdzKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gX29uY2VXcmFwKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIpIHtcbiAgdmFyIHN0YXRlID0geyBmaXJlZDogZmFsc2UsIHdyYXBGbjogdW5kZWZpbmVkLCB0YXJnZXQ6IHRhcmdldCwgdHlwZTogdHlwZSwgbGlzdGVuZXI6IGxpc3RlbmVyIH07XG4gIHZhciB3cmFwcGVkID0gYmluZC5jYWxsKG9uY2VXcmFwcGVyLCBzdGF0ZSk7XG4gIHdyYXBwZWQubGlzdGVuZXIgPSBsaXN0ZW5lcjtcbiAgc3RhdGUud3JhcEZuID0gd3JhcHBlZDtcbiAgcmV0dXJuIHdyYXBwZWQ7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uIG9uY2UodHlwZSwgbGlzdGVuZXIpIHtcbiAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gJ2Z1bmN0aW9uJylcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gIHRoaXMub24odHlwZSwgX29uY2VXcmFwKHRoaXMsIHR5cGUsIGxpc3RlbmVyKSk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5wcmVwZW5kT25jZUxpc3RlbmVyID1cbiAgICBmdW5jdGlvbiBwcmVwZW5kT25jZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgICB0aGlzLnByZXBlbmRMaXN0ZW5lcih0eXBlLCBfb25jZVdyYXAodGhpcywgdHlwZSwgbGlzdGVuZXIpKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbi8vIEVtaXRzIGEgJ3JlbW92ZUxpc3RlbmVyJyBldmVudCBpZiBhbmQgb25seSBpZiB0aGUgbGlzdGVuZXIgd2FzIHJlbW92ZWQuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyID1cbiAgICBmdW5jdGlvbiByZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikge1xuICAgICAgdmFyIGxpc3QsIGV2ZW50cywgcG9zaXRpb24sIGksIG9yaWdpbmFsTGlzdGVuZXI7XG5cbiAgICAgIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICAgICAgaWYgKCFldmVudHMpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICBsaXN0ID0gZXZlbnRzW3R5cGVdO1xuICAgICAgaWYgKCFsaXN0KVxuICAgICAgICByZXR1cm4gdGhpcztcblxuICAgICAgaWYgKGxpc3QgPT09IGxpc3RlbmVyIHx8IGxpc3QubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7XG4gICAgICAgIGlmICgtLXRoaXMuX2V2ZW50c0NvdW50ID09PSAwKVxuICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgZGVsZXRlIGV2ZW50c1t0eXBlXTtcbiAgICAgICAgICBpZiAoZXZlbnRzLnJlbW92ZUxpc3RlbmVyKVxuICAgICAgICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIGxpc3QubGlzdGVuZXIgfHwgbGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBsaXN0ICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHBvc2l0aW9uID0gLTE7XG5cbiAgICAgICAgZm9yIChpID0gbGlzdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIGlmIChsaXN0W2ldID09PSBsaXN0ZW5lciB8fCBsaXN0W2ldLmxpc3RlbmVyID09PSBsaXN0ZW5lcikge1xuICAgICAgICAgICAgb3JpZ2luYWxMaXN0ZW5lciA9IGxpc3RbaV0ubGlzdGVuZXI7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IGk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocG9zaXRpb24gPCAwKVxuICAgICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAgIGlmIChwb3NpdGlvbiA9PT0gMClcbiAgICAgICAgICBsaXN0LnNoaWZ0KCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBzcGxpY2VPbmUobGlzdCwgcG9zaXRpb24pO1xuXG4gICAgICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMSlcbiAgICAgICAgICBldmVudHNbdHlwZV0gPSBsaXN0WzBdO1xuXG4gICAgICAgIGlmIChldmVudHMucmVtb3ZlTGlzdGVuZXIpXG4gICAgICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIG9yaWdpbmFsTGlzdGVuZXIgfHwgbGlzdGVuZXIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycyA9XG4gICAgZnVuY3Rpb24gcmVtb3ZlQWxsTGlzdGVuZXJzKHR5cGUpIHtcbiAgICAgIHZhciBsaXN0ZW5lcnMsIGV2ZW50cywgaTtcblxuICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICAgICAgaWYgKCFldmVudHMpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAvLyBub3QgbGlzdGVuaW5nIGZvciByZW1vdmVMaXN0ZW5lciwgbm8gbmVlZCB0byBlbWl0XG4gICAgICBpZiAoIWV2ZW50cy5yZW1vdmVMaXN0ZW5lcikge1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgICB0aGlzLl9ldmVudHNDb3VudCA9IDA7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnRzW3R5cGVdKSB7XG4gICAgICAgICAgaWYgKC0tdGhpcy5fZXZlbnRzQ291bnQgPT09IDApXG4gICAgICAgICAgICB0aGlzLl9ldmVudHMgPSBvYmplY3RDcmVhdGUobnVsbCk7XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgZGVsZXRlIGV2ZW50c1t0eXBlXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgLy8gZW1pdCByZW1vdmVMaXN0ZW5lciBmb3IgYWxsIGxpc3RlbmVycyBvbiBhbGwgZXZlbnRzXG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB2YXIga2V5cyA9IG9iamVjdEtleXMoZXZlbnRzKTtcbiAgICAgICAgdmFyIGtleTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICBrZXkgPSBrZXlzW2ldO1xuICAgICAgICAgIGlmIChrZXkgPT09ICdyZW1vdmVMaXN0ZW5lcicpIGNvbnRpbnVlO1xuICAgICAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ3JlbW92ZUxpc3RlbmVyJyk7XG4gICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgbGlzdGVuZXJzID0gZXZlbnRzW3R5cGVdO1xuXG4gICAgICBpZiAodHlwZW9mIGxpc3RlbmVycyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVycyk7XG4gICAgICB9IGVsc2UgaWYgKGxpc3RlbmVycykge1xuICAgICAgICAvLyBMSUZPIG9yZGVyXG4gICAgICAgIGZvciAoaSA9IGxpc3RlbmVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXJzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5mdW5jdGlvbiBfbGlzdGVuZXJzKHRhcmdldCwgdHlwZSwgdW53cmFwKSB7XG4gIHZhciBldmVudHMgPSB0YXJnZXQuX2V2ZW50cztcblxuICBpZiAoIWV2ZW50cylcbiAgICByZXR1cm4gW107XG5cbiAgdmFyIGV2bGlzdGVuZXIgPSBldmVudHNbdHlwZV07XG4gIGlmICghZXZsaXN0ZW5lcilcbiAgICByZXR1cm4gW107XG5cbiAgaWYgKHR5cGVvZiBldmxpc3RlbmVyID09PSAnZnVuY3Rpb24nKVxuICAgIHJldHVybiB1bndyYXAgPyBbZXZsaXN0ZW5lci5saXN0ZW5lciB8fCBldmxpc3RlbmVyXSA6IFtldmxpc3RlbmVyXTtcblxuICByZXR1cm4gdW53cmFwID8gdW53cmFwTGlzdGVuZXJzKGV2bGlzdGVuZXIpIDogYXJyYXlDbG9uZShldmxpc3RlbmVyLCBldmxpc3RlbmVyLmxlbmd0aCk7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24gbGlzdGVuZXJzKHR5cGUpIHtcbiAgcmV0dXJuIF9saXN0ZW5lcnModGhpcywgdHlwZSwgdHJ1ZSk7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJhd0xpc3RlbmVycyA9IGZ1bmN0aW9uIHJhd0xpc3RlbmVycyh0eXBlKSB7XG4gIHJldHVybiBfbGlzdGVuZXJzKHRoaXMsIHR5cGUsIGZhbHNlKTtcbn07XG5cbkV2ZW50RW1pdHRlci5saXN0ZW5lckNvdW50ID0gZnVuY3Rpb24oZW1pdHRlciwgdHlwZSkge1xuICBpZiAodHlwZW9mIGVtaXR0ZXIubGlzdGVuZXJDb3VudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBlbWl0dGVyLmxpc3RlbmVyQ291bnQodHlwZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGxpc3RlbmVyQ291bnQuY2FsbChlbWl0dGVyLCB0eXBlKTtcbiAgfVxufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5saXN0ZW5lckNvdW50ID0gbGlzdGVuZXJDb3VudDtcbmZ1bmN0aW9uIGxpc3RlbmVyQ291bnQodHlwZSkge1xuICB2YXIgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuXG4gIGlmIChldmVudHMpIHtcbiAgICB2YXIgZXZsaXN0ZW5lciA9IGV2ZW50c1t0eXBlXTtcblxuICAgIGlmICh0eXBlb2YgZXZsaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfSBlbHNlIGlmIChldmxpc3RlbmVyKSB7XG4gICAgICByZXR1cm4gZXZsaXN0ZW5lci5sZW5ndGg7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIDA7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuZXZlbnROYW1lcyA9IGZ1bmN0aW9uIGV2ZW50TmFtZXMoKSB7XG4gIHJldHVybiB0aGlzLl9ldmVudHNDb3VudCA+IDAgPyBSZWZsZWN0Lm93bktleXModGhpcy5fZXZlbnRzKSA6IFtdO1xufTtcblxuLy8gQWJvdXQgMS41eCBmYXN0ZXIgdGhhbiB0aGUgdHdvLWFyZyB2ZXJzaW9uIG9mIEFycmF5I3NwbGljZSgpLlxuZnVuY3Rpb24gc3BsaWNlT25lKGxpc3QsIGluZGV4KSB7XG4gIGZvciAodmFyIGkgPSBpbmRleCwgayA9IGkgKyAxLCBuID0gbGlzdC5sZW5ndGg7IGsgPCBuOyBpICs9IDEsIGsgKz0gMSlcbiAgICBsaXN0W2ldID0gbGlzdFtrXTtcbiAgbGlzdC5wb3AoKTtcbn1cblxuZnVuY3Rpb24gYXJyYXlDbG9uZShhcnIsIG4pIHtcbiAgdmFyIGNvcHkgPSBuZXcgQXJyYXkobik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgKytpKVxuICAgIGNvcHlbaV0gPSBhcnJbaV07XG4gIHJldHVybiBjb3B5O1xufVxuXG5mdW5jdGlvbiB1bndyYXBMaXN0ZW5lcnMoYXJyKSB7XG4gIHZhciByZXQgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcmV0Lmxlbmd0aDsgKytpKSB7XG4gICAgcmV0W2ldID0gYXJyW2ldLmxpc3RlbmVyIHx8IGFycltpXTtcbiAgfVxuICByZXR1cm4gcmV0O1xufVxuXG5mdW5jdGlvbiBvYmplY3RDcmVhdGVQb2x5ZmlsbChwcm90bykge1xuICB2YXIgRiA9IGZ1bmN0aW9uKCkge307XG4gIEYucHJvdG90eXBlID0gcHJvdG87XG4gIHJldHVybiBuZXcgRjtcbn1cbmZ1bmN0aW9uIG9iamVjdEtleXNQb2x5ZmlsbChvYmopIHtcbiAgdmFyIGtleXMgPSBbXTtcbiAgZm9yICh2YXIgayBpbiBvYmopIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrKSkge1xuICAgIGtleXMucHVzaChrKTtcbiAgfVxuICByZXR1cm4gaztcbn1cbmZ1bmN0aW9uIGZ1bmN0aW9uQmluZFBvbHlmaWxsKGNvbnRleHQpIHtcbiAgdmFyIGZuID0gdGhpcztcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZm4uYXBwbHkoY29udGV4dCwgYXJndW1lbnRzKTtcbiAgfTtcbn1cbiIsIi8qXG5vYmplY3QtYXNzaWduXG4oYykgU2luZHJlIFNvcmh1c1xuQGxpY2Vuc2UgTUlUXG4qL1xuXG4ndXNlIHN0cmljdCc7XG4vKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqL1xudmFyIGdldE93blByb3BlcnR5U3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7XG52YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O1xudmFyIHByb3BJc0VudW1lcmFibGUgPSBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlO1xuXG5mdW5jdGlvbiB0b09iamVjdCh2YWwpIHtcblx0aWYgKHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZCkge1xuXHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdC5hc3NpZ24gY2Fubm90IGJlIGNhbGxlZCB3aXRoIG51bGwgb3IgdW5kZWZpbmVkJyk7XG5cdH1cblxuXHRyZXR1cm4gT2JqZWN0KHZhbCk7XG59XG5cbmZ1bmN0aW9uIHNob3VsZFVzZU5hdGl2ZSgpIHtcblx0dHJ5IHtcblx0XHRpZiAoIU9iamVjdC5hc3NpZ24pIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBEZXRlY3QgYnVnZ3kgcHJvcGVydHkgZW51bWVyYXRpb24gb3JkZXIgaW4gb2xkZXIgVjggdmVyc2lvbnMuXG5cblx0XHQvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD00MTE4XG5cdFx0dmFyIHRlc3QxID0gbmV3IFN0cmluZygnYWJjJyk7ICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ldy13cmFwcGVyc1xuXHRcdHRlc3QxWzVdID0gJ2RlJztcblx0XHRpZiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGVzdDEpWzBdID09PSAnNScpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD0zMDU2XG5cdFx0dmFyIHRlc3QyID0ge307XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG5cdFx0XHR0ZXN0MlsnXycgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpXSA9IGk7XG5cdFx0fVxuXHRcdHZhciBvcmRlcjIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0ZXN0MikubWFwKGZ1bmN0aW9uIChuKSB7XG5cdFx0XHRyZXR1cm4gdGVzdDJbbl07XG5cdFx0fSk7XG5cdFx0aWYgKG9yZGVyMi5qb2luKCcnKSAhPT0gJzAxMjM0NTY3ODknKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0Ly8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzA1NlxuXHRcdHZhciB0ZXN0MyA9IHt9O1xuXHRcdCdhYmNkZWZnaGlqa2xtbm9wcXJzdCcuc3BsaXQoJycpLmZvckVhY2goZnVuY3Rpb24gKGxldHRlcikge1xuXHRcdFx0dGVzdDNbbGV0dGVyXSA9IGxldHRlcjtcblx0XHR9KTtcblx0XHRpZiAoT2JqZWN0LmtleXMoT2JqZWN0LmFzc2lnbih7fSwgdGVzdDMpKS5qb2luKCcnKSAhPT1cblx0XHRcdFx0J2FiY2RlZmdoaWprbG1ub3BxcnN0Jykge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdHJldHVybiB0cnVlO1xuXHR9IGNhdGNoIChlcnIpIHtcblx0XHQvLyBXZSBkb24ndCBleHBlY3QgYW55IG9mIHRoZSBhYm92ZSB0byB0aHJvdywgYnV0IGJldHRlciB0byBiZSBzYWZlLlxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHNob3VsZFVzZU5hdGl2ZSgpID8gT2JqZWN0LmFzc2lnbiA6IGZ1bmN0aW9uICh0YXJnZXQsIHNvdXJjZSkge1xuXHR2YXIgZnJvbTtcblx0dmFyIHRvID0gdG9PYmplY3QodGFyZ2V0KTtcblx0dmFyIHN5bWJvbHM7XG5cblx0Zm9yICh2YXIgcyA9IDE7IHMgPCBhcmd1bWVudHMubGVuZ3RoOyBzKyspIHtcblx0XHRmcm9tID0gT2JqZWN0KGFyZ3VtZW50c1tzXSk7XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gZnJvbSkge1xuXHRcdFx0aWYgKGhhc093blByb3BlcnR5LmNhbGwoZnJvbSwga2V5KSkge1xuXHRcdFx0XHR0b1trZXldID0gZnJvbVtrZXldO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChnZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHtcblx0XHRcdHN5bWJvbHMgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZnJvbSk7XG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHN5bWJvbHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYgKHByb3BJc0VudW1lcmFibGUuY2FsbChmcm9tLCBzeW1ib2xzW2ldKSkge1xuXHRcdFx0XHRcdHRvW3N5bWJvbHNbaV1dID0gZnJvbVtzeW1ib2xzW2ldXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiB0bztcbn07XG4iXX0=
