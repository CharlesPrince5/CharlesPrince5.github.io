(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
// Â© 2001-2015 INOVx Solutions, Inc.
// 114 Pacifica Suite 300, Irvine, CA 92618 USA
// All rights reserved.
//
// This software is confidential, proprietary and unpublished property of
// INOVx Solutions, Inc.  It may NOT be copied in part or in whole on any
// medium, either electronic or printed, without the express written consent
// of INOVx Solutions, Inc.
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var ReactDOM = require("react-dom");
var RoleApp = require("./components/RoleApp");
try {
    InovxLoader.updateHelp('organization-roles');
}
catch (e) {
}
ReactDOM.render(React.createElement(RoleApp, null), document.getElementById('roleapp'));

},{"./components/RoleApp":3,"react":"react","react-dom":"react-dom"}],2:[function(require,module,exports){
"use strict";
// This file is only a template for actions.  Copy and paste this to your application's actions .ts file and start off from there
// Rename all things with App_Name.
// Naming convention for actions is "[App Name]Actions.ts" i.e. UsersActions.ts, EntitlementActions.ts
var Inovx = require("shared.web.client");
var RoleConstants = require('./../constants/RoleConstants');
var RoleServices = require('./../services/RoleServices');
var RoleStore = require('./../stores/RoleStore');
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
var FormHelper = Inovx.Shared.Common.FormHelper;
function _finishEdit() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: RoleConstants.ROLE_FINISH_EDIT
    });
}
function _receiveAllRoles(data) {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: RoleConstants.ROLE_GET_ALL,
        data: data
    });
}
function sendInvalidSave() {
    Inovx.Shared.Flux.AppDispatcher.dispatch({
        actionType: RoleConstants.ROLE_INVALID_ADD
    });
}
var RoleActions = {
    getAllRoles: function (callback, errorCallback, ignoreDefaultError) {
        RoleServices.getAll(function (data) {
            if (callback !== undefined && callback != null) {
                callback();
            }
            _receiveAllRoles(data);
        }, function (error) {
            if (errorCallback) {
                errorCallback(error);
            }
        }, ignoreDefaultError);
    },
    beginAdd: function () {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: RoleConstants.ROLE_BEGIN_ADD
        });
    },
    createRole: function (callback) {
        if (RoleStore.getIsValidObject(RoleConstants.ROLE_ADD_FORM)) {
            if (!SystemStore.isActionInProgress(RoleConstants.ROLE_ADD)) {
                SystemActions.beginAction(RoleConstants.ROLE_ADD);
                RoleServices.createRole(FormHelper.trim(RoleStore.getRole()), function () {
                    RoleActions.refreshData();
                    if (callback !== undefined && callback != null) {
                        callback();
                    }
                    _finishEdit();
                    SystemActions.endAction(RoleConstants.ROLE_ADD);
                }, function (error) {
                    SystemActions.endAction(RoleConstants.ROLE_ADD);
                });
            }
        }
        else {
            sendInvalidSave();
        }
    },
    beginEdit: function (role) {
        RoleServices.getRoleDetail(role.ID, function (role) {
            Inovx.Shared.Flux.AppDispatcher.dispatch({
                actionType: RoleConstants.ROLE_BEGIN_EDIT,
                role: role
            });
        }, function (error) {
        });
    },
    editRole: function (callback) {
        if (RoleStore.getIsValidObject(RoleConstants.ROLE_ADD_FORM)) {
            if (!SystemStore.isActionInProgress(RoleConstants.ROLE_EDIT)) {
                SystemActions.beginAction(RoleConstants.ROLE_EDIT);
                RoleServices.editRole(FormHelper.trim(RoleStore.getRole()), function (data) {
                    RoleActions.refreshData();
                    if (callback !== undefined && callback != null) {
                        callback();
                    }
                    _finishEdit();
                    SystemActions.endAction(RoleConstants.ROLE_EDIT);
                }, function (error) {
                    SystemActions.endAction(RoleConstants.ROLE_EDIT);
                });
            }
        }
        else {
            sendInvalidSave();
        }
    },
    finishEdit: function () {
        if (RoleStore.getHasChanges()) {
            var callbackFunct = RoleStore.getIsEditing() ? RoleActions.editRole : RoleActions.createRole;
            SystemActions.displaySaveChangesDialog({
                message: InovxLoader.t("common:msgBox.saveChanges"),
                confirmCallback: callbackFunct,
                cancelCallback: _finishEdit
            });
        }
        else {
            _finishEdit();
        }
    },
    deleteRole: function (role, callback) {
        if (!SystemStore.isActionInProgress(RoleConstants.ROLE_DELETE)) {
            SystemActions.beginAction(RoleConstants.ROLE_DELETE);
            RoleServices.deleteRole(role, function () {
                RoleActions.refreshData();
                if (callback !== undefined && callback != null) {
                    callback();
                }
                SystemActions.endAction(RoleConstants.ROLE_DELETE);
            }, function (error) {
                SystemActions.endAction(RoleConstants.ROLE_DELETE);
            });
        }
    },
    editCurrentRole: function (comp, key, value) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: RoleConstants.ROLE_UPDATE_EDIT,
            component: comp,
            key: key,
            value: value
        });
    },
    addUsers: function (users) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: RoleConstants.ROLE_ADD_USER,
            users: users
        });
    },
    deleteAuthorizedUser: function (user) {
        Inovx.Shared.Flux.AppDispatcher.dispatch({
            actionType: RoleConstants.ROLE_DELETE_USER,
            user: user
        });
    },
    refreshData: function () {
        this.getAllRoles();
    }
};
module.exports = RoleActions;

},{"./../constants/RoleConstants":5,"./../services/RoleServices":6,"./../stores/RoleStore":7,"shared.web.client":"shared.web.client"}],3:[function(require,module,exports){
"use strict";
// This file is only a template for BaseAppComponents.  Copy and paste this to your application .tsx file and start off from there
// Rename all things with App_Name.
// Naming convention for BaseAppComponents is "[App Name]App.tsx" i.e. UsersApp.tsx, EntitlementApp.tsx
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var React = require("react");
var Inovx = require("shared.web.client");
var RoleForm = require("./RoleForm");
var RoleStore = require("./../stores/RoleStore");
var RoleActions = require("./../actions/RoleActions");
var RoleConstants = require("./../constants/RoleConstants");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
function getRoleState() {
    return {
        allRoles: RoleStore.getAll(),
        modalVisible: RoleStore.getModalVisible(),
        isActionInProgress: SystemStore.isActionInProgress(RoleConstants.ROLE_DELETE)
    };
}
var Role = /** @class */ (function (_super) {
    __extends(Role, _super);
    function Role(props, context) {
        var _this = _super.call(this, 'role', props, context) || this;
        _this._initialize = function () {
            RoleActions.getAllRoles(function () {
                _this._appLoaded = true;
            }, function (error) {
                _this._handlePermissionError(error);
            }, true);
        };
        _this._addRole = function () {
            RoleActions.beginAdd();
        };
        _this._beginEditRole = function (e, role) {
            RoleActions.beginEdit(role);
        };
        _this._deleteRole = function (e, role) {
            var messageObject = {
                message: InovxLoader.t('role:message.confirmDelete'),
                confirmCallback: function () {
                    RoleActions.deleteRole(role, null);
                }
            };
            SystemActions.displayConfirmationMessage(messageObject);
        };
        _this._hideModal = function () {
            RoleActions.finishEdit();
        };
        _this._onChange = function () {
            _this.setState(getRoleState());
        };
        _this._onSystemChange = function () {
            _this.setState({ isActionInProgress: SystemStore.isActionInProgress(RoleConstants.ROLE_DELETE) });
        };
        _this.state = getRoleState();
        return _this;
    }
    Role.prototype.componentWillMount = function () {
        this.componentWillMountBase();
    };
    Role.prototype.componentDidMount = function () {
        RoleStore.addChangeListener(this._onChange);
        SystemStore.addChangeListener(this._onSystemChange);
    };
    Role.prototype.componentWillUnmount = function () {
        RoleStore.removeChangeListener(this._onChange);
        SystemStore.addChangeListener(this._onSystemChange);
    };
    Role.prototype.render = function () {
        var iconHeaderProps = {
            iconUrl: "".concat(UrlUtilities.getBaseApplicationUrl(), "/images/OrganizationRoles.png"),
            iconAtt: { alt: "Organization Roles" },
            title: InovxLoader.t("role:header.organizationRoles"),
            rcClass: "cd-btn add-btn",
            onClick: this._addRole,
            btnUrl: "".concat(UrlUtilities.getBaseApplicationUrl(), "/images/addOrganizationRole.png"),
            btnAtt: {
                alt: InovxLoader.t("role:header.newRole"),
                title: InovxLoader.t("role:header.newRole"),
                id: 'roleApp-add-btn'
            }
        };
        var columns = [{
                field: "Name",
                headerText: InovxLoader.t("role:common.roleName"),
                width: "35%",
                type: "string"
            }, {
                field: "Description",
                headerText: InovxLoader.t("role:common.description"),
                type: "string"
            }];
        var dataSource = this.state.allRoles;
        var defaultSort = [{
                field: "Name",
                dir: "ascending"
            }];
        var commands = {
            headerText: InovxLoader.t("role:common.actions"),
            command: [{
                    iconClassName: "glyphicon glyphicon-pencil",
                    click: this._beginEditRole
                }, {
                    iconClassName: "glyphicon glyphicon-trash",
                    click: this._deleteRole
                }],
            width: "85px"
        };
        return (React.createElement(Inovx.Shared.Core.ReactLoader, { appReady: this.isAppLoaded(), errorStatus: this._errorStatus },
            React.createElement("div", { className: "role-app-content" },
                React.createElement(Inovx.Shared.Controls.If, { condition: this.state.isActionInProgress, class: 'temp-modal-loader' },
                    React.createElement("div", { className: "action-in-progress-loader-lrg" })),
                React.createElement(Inovx.Shared.Layout.IconHeader, __assign({}, iconHeaderProps)),
                React.createElement(Inovx.Shared.Controls.Grid, { dataSource: dataSource, commands: commands, columns: columns, defaultSort: defaultSort, pageable: { pageCount: 5, pageSizes: [10, 20, 50], pageSize: 10 }, sort: true, filter: true })),
            React.createElement(Inovx.Shared.Controls.ModalSlider, { isOpen: this.state.modalVisible, onClose: this._hideModal },
                React.createElement(RoleForm, null))));
    };
    return Role;
}(Inovx.Shared.ReactExt.BaseAppComponent));
module.exports = Role;

},{"./../actions/RoleActions":2,"./../constants/RoleConstants":5,"./../stores/RoleStore":7,"./RoleForm":4,"react":"react","shared.web.client":"shared.web.client"}],4:[function(require,module,exports){
"use strict";
// A '.tsx' file enables JSX support in the TypeScript compiler, 
// for more information see the following page on the TypeScript wiki:
// https://github.com/Microsoft/TypeScript/wiki/JSX
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var React = require("react");
var Inovx = require("shared.web.client");
var RoleActions = require("./../actions/RoleActions");
var RoleStore = require("./../stores/RoleStore");
var RoleConstants = require("./../constants/RoleConstants");
var SystemActions = Inovx.Shared.System.Actions;
var SystemStore = Inovx.Shared.System.Store;
var InovxControls = Inovx.Shared.Controls;
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
function getIsActionInProgress() {
    return SystemStore.isActionInProgress(RoleConstants.ROLE_ADD) ||
        SystemStore.isActionInProgress(RoleConstants.ROLE_EDIT);
}
var _actionInProgressMsg;
function getRoleFormState() {
    return {
        isAdding: RoleStore.getIsAdding(),
        isEditing: RoleStore.getIsEditing(),
        allRoles: RoleStore.getAll(),
        role: RoleStore.getRole(),
        isActionInProgress: getIsActionInProgress(),
        actionInProgressMsg: _actionInProgressMsg,
        validation: RoleStore.getValidation(RoleConstants.ROLE_ADD_FORM)
    };
}
var RoleForm = /** @class */ (function (_super) {
    __extends(RoleForm, _super);
    function RoleForm(props) {
        var _this = _super.call(this, props) || this;
        _this._validateUser = function () {
            var form = _this.refs["assignUser"];
            if (form.isValid(_this._isEmptyOrNull)) {
                return true;
            }
            return false;
        };
        _this._roleHasUser = function (userName, authorizedUsers) {
            for (var index in authorizedUsers) {
                if (authorizedUsers[index].UserName == userName) {
                    return true;
                }
            }
            ;
            return false;
        };
        _this._assignUserToRole = function (users) {
            if (users.length > 0) {
                RoleActions.addUsers(users);
            }
        };
        _this._deleteAuthorizedUser = function (e, user) {
            RoleActions.deleteAuthorizedUser(user);
        };
        _this._isEmptyOrNull = function (value) {
            return value && value.trim().length > 0;
        };
        _this._saveRole = function () {
            if (_this.state.isAdding) {
                RoleActions.createRole();
            }
            else {
                RoleActions.editRole();
            }
        };
        _this._cancel = function () {
            RoleActions.finishEdit();
        };
        _this._loadState = function () {
            _this.setState(getRoleFormState());
        };
        _this._onChange = function (event) {
            RoleActions.editCurrentRole(RoleConstants.ROLE_ADD_FORM, event.target.name, event.target.value);
        };
        _this._systemChange = function () {
            _this.setState({ isActionInProgress: getIsActionInProgress() });
        };
        _this._checkForUnsavedChanges = function (event) {
            if (RoleStore.getHasChanges()) {
                event.returnValue = InovxLoader.t("common:msgBox.browserSaveChanges");
            }
            ;
        };
        _this.state = getRoleFormState();
        _actionInProgressMsg = InovxLoader.t("role:form.saving");
        return _this;
    }
    RoleForm.prototype.componentDidMount = function () {
        RoleStore.addChangeListener(this._loadState);
        SystemStore.addChangeListener(this._systemChange);
        window.addEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    RoleForm.prototype.componentWillUnmount = function () {
        RoleStore.removeChangeListener(this._loadState);
        SystemStore.removeChangeListener(this._systemChange);
        window.removeEventListener('beforeunload', this._checkForUnsavedChanges);
    };
    RoleForm.prototype.render = function () {
        var inputObj = {
            className: 'form-control',
            type: 'text'
        };
        var role = this.state.role;
        var roleNameInput = jQuery.extend({
            name: 'Name',
            id: 'roleApp-name-input',
            value: role.Name
        }, inputObj);
        var roleDescriptionInput = jQuery.extend({
            name: 'Description',
            id: 'roleApp-desc-input',
            value: role.Description
        }, inputObj);
        var header = this.state.isAdding ? InovxLoader.t('role:header.newRole') : InovxLoader.t('role:header.editRole');
        var columns = [{
                field: "UserName",
                headerText: InovxLoader.t("role:form.userName"),
                width: "40%"
            }, {
                field: "Enabled",
                headerText: InovxLoader.t("role:form.userStatus"),
                values: [
                    { value: true, text: InovxLoader.t("role:common.enabled") },
                    { value: false, text: InovxLoader.t("role:common.disabled") }
                ]
            }];
        var userDataSource = this.state.role.Users;
        var userDefaultSort = [{
                field: "UserName",
                dir: "ascending"
            }];
        var userCommands = {
            headerText: InovxLoader.t("role:common.actions"),
            command: [{
                    iconClassName: 'glyphicon glyphicon-trash',
                    click: this._deleteAuthorizedUser
                }],
            width: "85px",
        };
        return (React.createElement(InovxControls.StaticHeaderForm, { title: header, saveOnClick: this._saveRole, saveBtnId: "roleApp-save-btn", cancelOnClick: this._cancel, cancelBtnId: "roleApp-cancel-btn", isActionInProgress: this.state.isActionInProgress, inProgressMessage: this.state.actionInProgressMsg },
            React.createElement(InovxControls.FormField, { title: "".concat(InovxLoader.t("role:common.roleName"), "*"), inputName: 'Name' },
                React.createElement(InovxControls.ValidationInput, __assign({}, roleNameInput, { className: "form-control", onChange: this._onChange, validation: this.state.validation['Name'] }))),
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("role:common.description"), inputName: 'Description' },
                React.createElement("textarea", __assign({}, roleDescriptionInput, { onChange: this._onChange }))),
            React.createElement(InovxControls.FormField, { title: InovxLoader.t("role:form.assignUsers"), inputName: 'AssignUsers' },
                React.createElement(InovxControls.MultiSelect, { minLength: 1, displayProp: "UserName", url: "".concat(UrlUtilities.getApiUrl(), "/RoleApi/api/user/SearchUsers"), onClick: this._assignUserToRole, parameters: { maxNumberOfResults: 5 }, numParameter: 'maxNumberOfResults', searchProperty: 'searchString', btnLabel: InovxLoader.t("role:form.add"), keyProp: "UserID" })),
            React.createElement(Inovx.Shared.Controls.Grid, { dataSource: userDataSource, commands: userCommands, columns: columns, defaultSort: userDefaultSort, sort: true })));
    };
    return RoleForm;
}(React.Component));
module.exports = RoleForm;

},{"./../actions/RoleActions":2,"./../constants/RoleConstants":5,"./../stores/RoleStore":7,"react":"react","shared.web.client":"shared.web.client"}],5:[function(require,module,exports){
"use strict";
// This file is only a template for constants.  Copy and paste this to your application's constants .ts file and start off from there
// Rename all things with App_Name.
// Naming convention for constants is "[App Name]Constants.ts" i.e. UsersConstants.ts, EntitlementConstants.ts
var keymirror = require("fbjs/lib/keymirror");
// convention for constants is
// [App_Name]_[Action]
var RoleConstants = keymirror({
    ROLE_ADD_FORM: null,
    ROLE_INVALID_ADD: null,
    ROLE_GET_ALL: null,
    ROLE_GET_DETAIL: null,
    ROLE_BEGIN_ADD: null,
    ROLE_BEGIN_EDIT: null,
    ROLE_FINISH_EDIT: null,
    ROLE_UPDATE_EDIT: null,
    ROLE_DELETE: null,
    ROLE_ADD: null,
    ROLE_EDIT: null,
    ROLE_ADD_USER: null,
    ROLE_DELETE_USER: null
});
module.exports = RoleConstants;

},{"fbjs/lib/keymirror":"fbjs/lib/keymirror"}],6:[function(require,module,exports){
"use strict";
// This file is only a template for services.  Copy and paste this to your application's service .ts file and start off from there
// Rename all things with App_Name.
// Naming convention for services is "[App Name]Services.ts" i.e. UsersServices.ts, EntitlementServices.ts
var Inovx = require("shared.web.client");
var assign = require("object-assign");
var UrlUtilities = Inovx.Shared.Common.UrlUtilities;
var url = UrlUtilities.getApiUrl() + '/RoleApi/api/role';
var RoleServices = assign({}, Inovx.Shared.Flux.BaseService, {
    //Replace method accordingly
    getAll: function (successCallback, errorCallback, ignoreDefaultError) {
        var _this = this;
        this.get(url, null, function (retData) {
            successCallback(retData);
        }, function (error) {
            if (!ignoreDefaultError) {
                _this.handleWebApiError(error);
            }
            errorCallback(error);
        });
    },
    getRoleDetail: function (id, successCallback, errorCallback) {
        var _this = this;
        this.get("".concat(url, "/").concat(id), null, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    createRole: function (role, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/Create"), role, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    editRole: function (role, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/Update"), role, function (retData) {
            successCallback(retData);
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    },
    deleteRole: function (role, successCallback, errorCallback) {
        var _this = this;
        this.post("".concat(url, "/Delete"), { ID: role.ID, VersionToken: role.VersionToken }, function () {
            successCallback();
        }, function (error) {
            _this.handleWebApiError(error);
            errorCallback(error);
        });
    }
});
module.exports = RoleServices;

},{"object-assign":9,"shared.web.client":"shared.web.client"}],7:[function(require,module,exports){
"use strict";
// This file is only a template for Stores.  Copy and paste this to your application store .ts file and start off from there
// Rename all things with App_Name.
// Naming convention for Stores is "[App Name]Store.ts" i.e. UserStore.ts, EntitlementStore.ts
var NodeEvents = require("events");
var Inovx = require("shared.web.client");
var RoleConstants = require("./../constants/RoleConstants");
var assign = require("object-assign");
var EventEmitter = NodeEvents.EventEmitter;
var CommonMessages = Inovx.Shared.Common.CommonMessages;
var CHANGE_EVENT = 'Role.change';
var FORM_ADD_ROLE_NAME = RoleConstants.ROLE_ADD_FORM;
var _roles = [], _role = getBlankRole(), _modalVisible = false, _beginAdd = false, _beginEdit = false, _hasChanges = false, _validation = {};
function setAddingRole() {
    _beginAdd = _modalVisible = true;
    _beginEdit = false;
    _hasChanges = false;
    _role = getBlankRole();
    _initalizeValidation(FORM_ADD_ROLE_NAME);
}
function setEditingRole(role) {
    _modalVisible = _beginEdit = true;
    _beginAdd = false;
    _hasChanges = false;
    _role = $.extend({}, role);
    _initalizeValidation(FORM_ADD_ROLE_NAME);
}
function _initalizeValidation(comp) {
    switch (comp) {
        case FORM_ADD_ROLE_NAME:
            var valiObj = _validation[FORM_ADD_ROLE_NAME] = {};
            for (var k in _role) {
                _setValidValidation(FORM_ADD_ROLE_NAME, k);
            }
            break;
    }
}
function _setValidValidation(comp, name) {
    if (_validation[comp][name]) {
        _validation[comp][name].invalidInput = false;
        _validation[comp][name].invalidValue = false;
    }
    else {
        _validation[comp][name] = _getNewValidationObject();
    }
}
function _getNewValidationObject() {
    return {
        invalidInput: false,
        invalidValue: false
    };
}
function _validate(comp) {
    switch (comp) {
        case FORM_ADD_ROLE_NAME:
            return _validateObject(comp, _role);
    }
    return false;
}
function _ensureValidObject(comp, obj) {
    for (var k in obj) {
        switch (comp) {
            case FORM_ADD_ROLE_NAME:
                var objType = typeof (obj[k]);
                if (objType !== 'function') {
                    if (obj[k] === null || objType !== 'object') {
                        _updateChanges(k, obj[k]);
                    }
                    else {
                        _ensureValidObject(comp, obj[k]);
                    }
                }
        }
    }
}
function _validateObject(comp, obj) {
    _ensureValidObject(comp, obj);
    var ret = true;
    for (var k in _validation[FORM_ADD_ROLE_NAME]) {
        if (_validation[FORM_ADD_ROLE_NAME][k].invalidValue) {
            return false;
        }
    }
    return ret;
}
function _updateChanges(name, value) {
    switch (name) {
        case "Name":
            _role[name] = value;
            if (value) {
                var dupName = false;
                for (var i = 0; i < _roles.length; i++) {
                    if (_role.Name.toUpperCase() === _roles[i].Name.toUpperCase()
                        && _role.ID.toUpperCase() !== _roles[i].ID.toUpperCase()) {
                        dupName = true;
                        break;
                    }
                }
                if (dupName) {
                    _validation[FORM_ADD_ROLE_NAME][name].invalidValue = true;
                    _validation[FORM_ADD_ROLE_NAME][name].invalidValueMessage = InovxLoader.t("role:message.invalidRole");
                }
                else {
                    _setValidValidation(FORM_ADD_ROLE_NAME, name);
                }
            }
            else {
                _validation[FORM_ADD_ROLE_NAME][name].invalidValue = true;
                _validation[FORM_ADD_ROLE_NAME][name].invalidValueMessage = CommonMessages.Validation.Required;
            }
            break;
        default:
            if (name != 'ID' && name != 'VersionToken') {
                _role[name] = value;
            }
            _setValidValidation(FORM_ADD_ROLE_NAME, name);
            break;
    }
}
function finishedEditingRole() {
    _modalVisible = false;
    _hasChanges = false;
}
function updateCurrentRole(comp, key, value) {
    switch (comp) {
        case FORM_ADD_ROLE_NAME:
            _updateChanges(key, value);
            _hasChanges = true;
            break;
    }
}
function addUsers(users) {
    for (var indx in users) {
        var exists = false;
        for (var grpIndx in _role.Users) {
            if (users[indx].UserID === _role.Users[grpIndx].UserID) {
                exists = true;
                break;
            }
        }
        if (!exists) {
            _role.Users.push(users[indx]);
        }
    }
    _hasChanges = true;
}
function deleteAuthorizedUser(user) {
    var authorizedUsers = _role.Users;
    for (var index in authorizedUsers) {
        if (authorizedUsers[index].UserName == user.UserName) {
            authorizedUsers.splice(index, 1);
            _hasChanges = true;
        }
    }
}
function loadAllRoles(data) {
    _roles = data;
}
function getBlankRole() {
    return { ID: "", VersionToken: "", Name: "", Description: "", Users: [] };
}
function getBlankUser() {
    return { UserID: null, UserName: null, UserVersionToken: null, FirstName: null, LastName: null, Enabled: null };
}
var RoleStore = assign({}, EventEmitter.prototype, {
    // Add store getters here
    getAll: function () {
        return _roles;
    },
    getRole: function () {
        return _role;
    },
    getIsAdding: function () {
        return _beginAdd;
    },
    getIsEditing: function () {
        return _beginEdit;
    },
    getModalVisible: function () {
        return _modalVisible;
    },
    getHasChanges: function () {
        return _hasChanges;
    },
    getValidation: function (key) {
        return _validation[key];
    },
    getIsValidObject: function (key) {
        return _validate(key);
    },
    emitChange: function () {
        this.emit(CHANGE_EVENT);
    },
    addChangeListener: function (callback) {
        this.on(CHANGE_EVENT, callback);
    },
    removeChangeListener: function (callback) {
        this.removeListener(CHANGE_EVENT, callback);
    }
});
Inovx.Shared.Flux.AppDispatcher.register(function (payload) {
    switch (payload.actionType) {
        case RoleConstants.ROLE_GET_ALL:
            loadAllRoles(payload.data);
            break;
        case RoleConstants.ROLE_BEGIN_ADD:
            setAddingRole();
            break;
        case RoleConstants.ROLE_BEGIN_EDIT:
            setEditingRole(payload.role);
            break;
        case RoleConstants.ROLE_FINISH_EDIT:
            finishedEditingRole();
            break;
        case RoleConstants.ROLE_UPDATE_EDIT:
            updateCurrentRole(payload.component, payload.key, payload.value);
            break;
        case RoleConstants.ROLE_ADD_USER:
            addUsers(payload.users);
            break;
        case RoleConstants.ROLE_DELETE_USER:
            deleteAuthorizedUser(payload.user);
            break;
        case RoleConstants.ROLE_INVALID_ADD:
            break;
        default: return true;
    }
    RoleStore.emitChange();
    return true;
});
module.exports = RoleStore;

},{"./../constants/RoleConstants":5,"events":8,"object-assign":9,"shared.web.client":"shared.web.client"}],8:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var objectCreate = Object.create || objectCreatePolyfill
var objectKeys = Object.keys || objectKeysPolyfill
var bind = Function.prototype.bind || functionBindPolyfill

function EventEmitter() {
  if (!this._events || !Object.prototype.hasOwnProperty.call(this, '_events')) {
    this._events = objectCreate(null);
    this._eventsCount = 0;
  }

  this._maxListeners = this._maxListeners || undefined;
}
module.exports = EventEmitter;

// Backwards-compat with node 0.10.x
EventEmitter.EventEmitter = EventEmitter;

EventEmitter.prototype._events = undefined;
EventEmitter.prototype._maxListeners = undefined;

// By default EventEmitters will print a warning if more than 10 listeners are
// added to it. This is a useful default which helps finding memory leaks.
var defaultMaxListeners = 10;

var hasDefineProperty;
try {
  var o = {};
  if (Object.defineProperty) Object.defineProperty(o, 'x', { value: 0 });
  hasDefineProperty = o.x === 0;
} catch (err) { hasDefineProperty = false }
if (hasDefineProperty) {
  Object.defineProperty(EventEmitter, 'defaultMaxListeners', {
    enumerable: true,
    get: function() {
      return defaultMaxListeners;
    },
    set: function(arg) {
      // check whether the input is a positive number (whose value is zero or
      // greater and not a NaN).
      if (typeof arg !== 'number' || arg < 0 || arg !== arg)
        throw new TypeError('"defaultMaxListeners" must be a positive number');
      defaultMaxListeners = arg;
    }
  });
} else {
  EventEmitter.defaultMaxListeners = defaultMaxListeners;
}

// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
EventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {
  if (typeof n !== 'number' || n < 0 || isNaN(n))
    throw new TypeError('"n" argument must be a positive number');
  this._maxListeners = n;
  return this;
};

function $getMaxListeners(that) {
  if (that._maxListeners === undefined)
    return EventEmitter.defaultMaxListeners;
  return that._maxListeners;
}

EventEmitter.prototype.getMaxListeners = function getMaxListeners() {
  return $getMaxListeners(this);
};

// These standalone emit* functions are used to optimize calling of event
// handlers for fast cases because emit() itself often has a variable number of
// arguments and can be deoptimized because of that. These functions always have
// the same number of arguments and thus do not get deoptimized, so the code
// inside them can execute faster.
function emitNone(handler, isFn, self) {
  if (isFn)
    handler.call(self);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self);
  }
}
function emitOne(handler, isFn, self, arg1) {
  if (isFn)
    handler.call(self, arg1);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1);
  }
}
function emitTwo(handler, isFn, self, arg1, arg2) {
  if (isFn)
    handler.call(self, arg1, arg2);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1, arg2);
  }
}
function emitThree(handler, isFn, self, arg1, arg2, arg3) {
  if (isFn)
    handler.call(self, arg1, arg2, arg3);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].call(self, arg1, arg2, arg3);
  }
}

function emitMany(handler, isFn, self, args) {
  if (isFn)
    handler.apply(self, args);
  else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      listeners[i].apply(self, args);
  }
}

EventEmitter.prototype.emit = function emit(type) {
  var er, handler, len, args, i, events;
  var doError = (type === 'error');

  events = this._events;
  if (events)
    doError = (doError && events.error == null);
  else if (!doError)
    return false;

  // If there is no 'error' event listener then throw.
  if (doError) {
    if (arguments.length > 1)
      er = arguments[1];
    if (er instanceof Error) {
      throw er; // Unhandled 'error' event
    } else {
      // At least give some kind of context to the user
      var err = new Error('Unhandled "error" event. (' + er + ')');
      err.context = er;
      throw err;
    }
    return false;
  }

  handler = events[type];

  if (!handler)
    return false;

  var isFn = typeof handler === 'function';
  len = arguments.length;
  switch (len) {
      // fast cases
    case 1:
      emitNone(handler, isFn, this);
      break;
    case 2:
      emitOne(handler, isFn, this, arguments[1]);
      break;
    case 3:
      emitTwo(handler, isFn, this, arguments[1], arguments[2]);
      break;
    case 4:
      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);
      break;
      // slower
    default:
      args = new Array(len - 1);
      for (i = 1; i < len; i++)
        args[i - 1] = arguments[i];
      emitMany(handler, isFn, this, args);
  }

  return true;
};

function _addListener(target, type, listener, prepend) {
  var m;
  var events;
  var existing;

  if (typeof listener !== 'function')
    throw new TypeError('"listener" argument must be a function');

  events = target._events;
  if (!events) {
    events = target._events = objectCreate(null);
    target._eventsCount = 0;
  } else {
    // To avoid recursion in the case that type === "newListener"! Before
    // adding it to the listeners, first emit "newListener".
    if (events.newListener) {
      target.emit('newListener', type,
          listener.listener ? listener.listener : listener);

      // Re-assign `events` because a newListener handler could have caused the
      // this._events to be assigned to a new object
      events = target._events;
    }
    existing = events[type];
  }

  if (!existing) {
    // Optimize the case of one listener. Don't need the extra array object.
    existing = events[type] = listener;
    ++target._eventsCount;
  } else {
    if (typeof existing === 'function') {
      // Adding the second element, need to change to array.
      existing = events[type] =
          prepend ? [listener, existing] : [existing, listener];
    } else {
      // If we've already got an array, just append.
      if (prepend) {
        existing.unshift(listener);
      } else {
        existing.push(listener);
      }
    }

    // Check for listener leak
    if (!existing.warned) {
      m = $getMaxListeners(target);
      if (m && m > 0 && existing.length > m) {
        existing.warned = true;
        var w = new Error('Possible EventEmitter memory leak detected. ' +
            existing.length + ' "' + String(type) + '" listeners ' +
            'added. Use emitter.setMaxListeners() to ' +
            'increase limit.');
        w.name = 'MaxListenersExceededWarning';
        w.emitter = target;
        w.type = type;
        w.count = existing.length;
        if (typeof console === 'object' && console.warn) {
          console.warn('%s: %s', w.name, w.message);
        }
      }
    }
  }

  return target;
}

EventEmitter.prototype.addListener = function addListener(type, listener) {
  return _addListener(this, type, listener, false);
};

EventEmitter.prototype.on = EventEmitter.prototype.addListener;

EventEmitter.prototype.prependListener =
    function prependListener(type, listener) {
      return _addListener(this, type, listener, true);
    };

function onceWrapper() {
  if (!this.fired) {
    this.target.removeListener(this.type, this.wrapFn);
    this.fired = true;
    switch (arguments.length) {
      case 0:
        return this.listener.call(this.target);
      case 1:
        return this.listener.call(this.target, arguments[0]);
      case 2:
        return this.listener.call(this.target, arguments[0], arguments[1]);
      case 3:
        return this.listener.call(this.target, arguments[0], arguments[1],
            arguments[2]);
      default:
        var args = new Array(arguments.length);
        for (var i = 0; i < args.length; ++i)
          args[i] = arguments[i];
        this.listener.apply(this.target, args);
    }
  }
}

function _onceWrap(target, type, listener) {
  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };
  var wrapped = bind.call(onceWrapper, state);
  wrapped.listener = listener;
  state.wrapFn = wrapped;
  return wrapped;
}

EventEmitter.prototype.once = function once(type, listener) {
  if (typeof listener !== 'function')
    throw new TypeError('"listener" argument must be a function');
  this.on(type, _onceWrap(this, type, listener));
  return this;
};

EventEmitter.prototype.prependOnceListener =
    function prependOnceListener(type, listener) {
      if (typeof listener !== 'function')
        throw new TypeError('"listener" argument must be a function');
      this.prependListener(type, _onceWrap(this, type, listener));
      return this;
    };

// Emits a 'removeListener' event if and only if the listener was removed.
EventEmitter.prototype.removeListener =
    function removeListener(type, listener) {
      var list, events, position, i, originalListener;

      if (typeof listener !== 'function')
        throw new TypeError('"listener" argument must be a function');

      events = this._events;
      if (!events)
        return this;

      list = events[type];
      if (!list)
        return this;

      if (list === listener || list.listener === listener) {
        if (--this._eventsCount === 0)
          this._events = objectCreate(null);
        else {
          delete events[type];
          if (events.removeListener)
            this.emit('removeListener', type, list.listener || listener);
        }
      } else if (typeof list !== 'function') {
        position = -1;

        for (i = list.length - 1; i >= 0; i--) {
          if (list[i] === listener || list[i].listener === listener) {
            originalListener = list[i].listener;
            position = i;
            break;
          }
        }

        if (position < 0)
          return this;

        if (position === 0)
          list.shift();
        else
          spliceOne(list, position);

        if (list.length === 1)
          events[type] = list[0];

        if (events.removeListener)
          this.emit('removeListener', type, originalListener || listener);
      }

      return this;
    };

EventEmitter.prototype.removeAllListeners =
    function removeAllListeners(type) {
      var listeners, events, i;

      events = this._events;
      if (!events)
        return this;

      // not listening for removeListener, no need to emit
      if (!events.removeListener) {
        if (arguments.length === 0) {
          this._events = objectCreate(null);
          this._eventsCount = 0;
        } else if (events[type]) {
          if (--this._eventsCount === 0)
            this._events = objectCreate(null);
          else
            delete events[type];
        }
        return this;
      }

      // emit removeListener for all listeners on all events
      if (arguments.length === 0) {
        var keys = objectKeys(events);
        var key;
        for (i = 0; i < keys.length; ++i) {
          key = keys[i];
          if (key === 'removeListener') continue;
          this.removeAllListeners(key);
        }
        this.removeAllListeners('removeListener');
        this._events = objectCreate(null);
        this._eventsCount = 0;
        return this;
      }

      listeners = events[type];

      if (typeof listeners === 'function') {
        this.removeListener(type, listeners);
      } else if (listeners) {
        // LIFO order
        for (i = listeners.length - 1; i >= 0; i--) {
          this.removeListener(type, listeners[i]);
        }
      }

      return this;
    };

function _listeners(target, type, unwrap) {
  var events = target._events;

  if (!events)
    return [];

  var evlistener = events[type];
  if (!evlistener)
    return [];

  if (typeof evlistener === 'function')
    return unwrap ? [evlistener.listener || evlistener] : [evlistener];

  return unwrap ? unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);
}

EventEmitter.prototype.listeners = function listeners(type) {
  return _listeners(this, type, true);
};

EventEmitter.prototype.rawListeners = function rawListeners(type) {
  return _listeners(this, type, false);
};

EventEmitter.listenerCount = function(emitter, type) {
  if (typeof emitter.listenerCount === 'function') {
    return emitter.listenerCount(type);
  } else {
    return listenerCount.call(emitter, type);
  }
};

EventEmitter.prototype.listenerCount = listenerCount;
function listenerCount(type) {
  var events = this._events;

  if (events) {
    var evlistener = events[type];

    if (typeof evlistener === 'function') {
      return 1;
    } else if (evlistener) {
      return evlistener.length;
    }
  }

  return 0;
}

EventEmitter.prototype.eventNames = function eventNames() {
  return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [];
};

// About 1.5x faster than the two-arg version of Array#splice().
function spliceOne(list, index) {
  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)
    list[i] = list[k];
  list.pop();
}

function arrayClone(arr, n) {
  var copy = new Array(n);
  for (var i = 0; i < n; ++i)
    copy[i] = arr[i];
  return copy;
}

function unwrapListeners(arr) {
  var ret = new Array(arr.length);
  for (var i = 0; i < ret.length; ++i) {
    ret[i] = arr[i].listener || arr[i];
  }
  return ret;
}

function objectCreatePolyfill(proto) {
  var F = function() {};
  F.prototype = proto;
  return new F;
}
function objectKeysPolyfill(obj) {
  var keys = [];
  for (var k in obj) if (Object.prototype.hasOwnProperty.call(obj, k)) {
    keys.push(k);
  }
  return k;
}
function functionBindPolyfill(context) {
  var fn = this;
  return function () {
    return fn.apply(context, arguments);
  };
}

},{}],9:[function(require,module,exports){
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/

'use strict';
/* eslint-disable no-unused-vars */
var getOwnPropertySymbols = Object.getOwnPropertySymbols;
var hasOwnProperty = Object.prototype.hasOwnProperty;
var propIsEnumerable = Object.prototype.propertyIsEnumerable;

function toObject(val) {
	if (val === null || val === undefined) {
		throw new TypeError('Object.assign cannot be called with null or undefined');
	}

	return Object(val);
}

function shouldUseNative() {
	try {
		if (!Object.assign) {
			return false;
		}

		// Detect buggy property enumeration order in older V8 versions.

		// https://bugs.chromium.org/p/v8/issues/detail?id=4118
		var test1 = new String('abc');  // eslint-disable-line no-new-wrappers
		test1[5] = 'de';
		if (Object.getOwnPropertyNames(test1)[0] === '5') {
			return false;
		}

		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
		var test2 = {};
		for (var i = 0; i < 10; i++) {
			test2['_' + String.fromCharCode(i)] = i;
		}
		var order2 = Object.getOwnPropertyNames(test2).map(function (n) {
			return test2[n];
		});
		if (order2.join('') !== '0123456789') {
			return false;
		}

		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
		var test3 = {};
		'abcdefghijklmnopqrst'.split('').forEach(function (letter) {
			test3[letter] = letter;
		});
		if (Object.keys(Object.assign({}, test3)).join('') !==
				'abcdefghijklmnopqrst') {
			return false;
		}

		return true;
	} catch (err) {
		// We don't expect any of the above to throw, but better to be safe.
		return false;
	}
}

module.exports = shouldUseNative() ? Object.assign : function (target, source) {
	var from;
	var to = toObject(target);
	var symbols;

	for (var s = 1; s < arguments.length; s++) {
		from = Object(arguments[s]);

		for (var key in from) {
			if (hasOwnProperty.call(from, key)) {
				to[key] = from[key];
			}
		}

		if (getOwnPropertySymbols) {
			symbols = getOwnPropertySymbols(from);
			for (var i = 0; i < symbols.length; i++) {
				if (propIsEnumerable.call(from, symbols[i])) {
					to[symbols[i]] = from[symbols[i]];
				}
			}
		}
	}

	return to;
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJiaW4vanMtb3V0L2FwcC9BcHAuanMiLCJiaW4vanMtb3V0L2FwcC9hY3Rpb25zL1JvbGVBY3Rpb25zLmpzIiwiYmluL2pzLW91dC9hcHAvY29tcG9uZW50cy9Sb2xlQXBwLmpzIiwiYmluL2pzLW91dC9hcHAvY29tcG9uZW50cy9Sb2xlRm9ybS5qcyIsImJpbi9qcy1vdXQvYXBwL2NvbnN0YW50cy9Sb2xlQ29uc3RhbnRzLmpzIiwiYmluL2pzLW91dC9hcHAvc2VydmljZXMvUm9sZVNlcnZpY2VzLmpzIiwiYmluL2pzLW91dC9hcHAvc3RvcmVzL1JvbGVTdG9yZS5qcyIsIm5vZGVfbW9kdWxlcy9ldmVudHMvZXZlbnRzLmpzIiwibm9kZV9tb2R1bGVzL29iamVjdC1hc3NpZ24vaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25KQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gwqkgMjAwMS0yMDE1IElOT1Z4IFNvbHV0aW9ucywgSW5jLlxyXG4vLyAxMTQgUGFjaWZpY2EgU3VpdGUgMzAwLCBJcnZpbmUsIENBIDkyNjE4IFVTQVxyXG4vLyBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vL1xyXG4vLyBUaGlzIHNvZnR3YXJlIGlzIGNvbmZpZGVudGlhbCwgcHJvcHJpZXRhcnkgYW5kIHVucHVibGlzaGVkIHByb3BlcnR5IG9mXHJcbi8vIElOT1Z4IFNvbHV0aW9ucywgSW5jLiAgSXQgbWF5IE5PVCBiZSBjb3BpZWQgaW4gcGFydCBvciBpbiB3aG9sZSBvbiBhbnlcclxuLy8gbWVkaXVtLCBlaXRoZXIgZWxlY3Ryb25pYyBvciBwcmludGVkLCB3aXRob3V0IHRoZSBleHByZXNzIHdyaXR0ZW4gY29uc2VudFxyXG4vLyBvZiBJTk9WeCBTb2x1dGlvbnMsIEluYy5cclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG52YXIgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XHJcbnZhciBSZWFjdERPTSA9IHJlcXVpcmUoXCJyZWFjdC1kb21cIik7XHJcbnZhciBSb2xlQXBwID0gcmVxdWlyZShcIi4vY29tcG9uZW50cy9Sb2xlQXBwXCIpO1xyXG50cnkge1xyXG4gICAgSW5vdnhMb2FkZXIudXBkYXRlSGVscCgnb3JnYW5pemF0aW9uLXJvbGVzJyk7XHJcbn1cclxuY2F0Y2ggKGUpIHtcclxufVxyXG5SZWFjdERPTS5yZW5kZXIoUmVhY3QuY3JlYXRlRWxlbWVudChSb2xlQXBwLCBudWxsKSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JvbGVhcHAnKSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gVGhpcyBmaWxlIGlzIG9ubHkgYSB0ZW1wbGF0ZSBmb3IgYWN0aW9ucy4gIENvcHkgYW5kIHBhc3RlIHRoaXMgdG8geW91ciBhcHBsaWNhdGlvbidzIGFjdGlvbnMgLnRzIGZpbGUgYW5kIHN0YXJ0IG9mZiBmcm9tIHRoZXJlXHJcbi8vIFJlbmFtZSBhbGwgdGhpbmdzIHdpdGggQXBwX05hbWUuXHJcbi8vIE5hbWluZyBjb252ZW50aW9uIGZvciBhY3Rpb25zIGlzIFwiW0FwcCBOYW1lXUFjdGlvbnMudHNcIiBpLmUuIFVzZXJzQWN0aW9ucy50cywgRW50aXRsZW1lbnRBY3Rpb25zLnRzXHJcbnZhciBJbm92eCA9IHJlcXVpcmUoXCJzaGFyZWQud2ViLmNsaWVudFwiKTtcclxudmFyIFJvbGVDb25zdGFudHMgPSByZXF1aXJlKCcuLy4uL2NvbnN0YW50cy9Sb2xlQ29uc3RhbnRzJyk7XHJcbnZhciBSb2xlU2VydmljZXMgPSByZXF1aXJlKCcuLy4uL3NlcnZpY2VzL1JvbGVTZXJ2aWNlcycpO1xyXG52YXIgUm9sZVN0b3JlID0gcmVxdWlyZSgnLi8uLi9zdG9yZXMvUm9sZVN0b3JlJyk7XHJcbnZhciBTeXN0ZW1BY3Rpb25zID0gSW5vdnguU2hhcmVkLlN5c3RlbS5BY3Rpb25zO1xyXG52YXIgU3lzdGVtU3RvcmUgPSBJbm92eC5TaGFyZWQuU3lzdGVtLlN0b3JlO1xyXG52YXIgRm9ybUhlbHBlciA9IElub3Z4LlNoYXJlZC5Db21tb24uRm9ybUhlbHBlcjtcclxuZnVuY3Rpb24gX2ZpbmlzaEVkaXQoKSB7XHJcbiAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICBhY3Rpb25UeXBlOiBSb2xlQ29uc3RhbnRzLlJPTEVfRklOSVNIX0VESVRcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIF9yZWNlaXZlQWxsUm9sZXMoZGF0YSkge1xyXG4gICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgYWN0aW9uVHlwZTogUm9sZUNvbnN0YW50cy5ST0xFX0dFVF9BTEwsXHJcbiAgICAgICAgZGF0YTogZGF0YVxyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gc2VuZEludmFsaWRTYXZlKCkge1xyXG4gICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgYWN0aW9uVHlwZTogUm9sZUNvbnN0YW50cy5ST0xFX0lOVkFMSURfQUREXHJcbiAgICB9KTtcclxufVxyXG52YXIgUm9sZUFjdGlvbnMgPSB7XHJcbiAgICBnZXRBbGxSb2xlczogZnVuY3Rpb24gKGNhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBpZ25vcmVEZWZhdWx0RXJyb3IpIHtcclxuICAgICAgICBSb2xlU2VydmljZXMuZ2V0QWxsKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkICYmIGNhbGxiYWNrICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3JlY2VpdmVBbGxSb2xlcyhkYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgaWYgKGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgaWdub3JlRGVmYXVsdEVycm9yKTtcclxuICAgIH0sXHJcbiAgICBiZWdpbkFkZDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgICAgICBhY3Rpb25UeXBlOiBSb2xlQ29uc3RhbnRzLlJPTEVfQkVHSU5fQUREXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgY3JlYXRlUm9sZTogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKFJvbGVTdG9yZS5nZXRJc1ZhbGlkT2JqZWN0KFJvbGVDb25zdGFudHMuUk9MRV9BRERfRk9STSkpIHtcclxuICAgICAgICAgICAgaWYgKCFTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoUm9sZUNvbnN0YW50cy5ST0xFX0FERCkpIHtcclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuYmVnaW5BY3Rpb24oUm9sZUNvbnN0YW50cy5ST0xFX0FERCk7XHJcbiAgICAgICAgICAgICAgICBSb2xlU2VydmljZXMuY3JlYXRlUm9sZShGb3JtSGVscGVyLnRyaW0oUm9sZVN0b3JlLmdldFJvbGUoKSksIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBSb2xlQWN0aW9ucy5yZWZyZXNoRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkICYmIGNhbGxiYWNrICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgX2ZpbmlzaEVkaXQoKTtcclxuICAgICAgICAgICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmVuZEFjdGlvbihSb2xlQ29uc3RhbnRzLlJPTEVfQUREKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFJvbGVDb25zdGFudHMuUk9MRV9BREQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHNlbmRJbnZhbGlkU2F2ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBiZWdpbkVkaXQ6IGZ1bmN0aW9uIChyb2xlKSB7XHJcbiAgICAgICAgUm9sZVNlcnZpY2VzLmdldFJvbGVEZXRhaWwocm9sZS5JRCwgZnVuY3Rpb24gKHJvbGUpIHtcclxuICAgICAgICAgICAgSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiBSb2xlQ29uc3RhbnRzLlJPTEVfQkVHSU5fRURJVCxcclxuICAgICAgICAgICAgICAgIHJvbGU6IHJvbGVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZWRpdFJvbGU6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgIGlmIChSb2xlU3RvcmUuZ2V0SXNWYWxpZE9iamVjdChSb2xlQ29uc3RhbnRzLlJPTEVfQUREX0ZPUk0pKSB7XHJcbiAgICAgICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKFJvbGVDb25zdGFudHMuUk9MRV9FRElUKSkge1xyXG4gICAgICAgICAgICAgICAgU3lzdGVtQWN0aW9ucy5iZWdpbkFjdGlvbihSb2xlQ29uc3RhbnRzLlJPTEVfRURJVCk7XHJcbiAgICAgICAgICAgICAgICBSb2xlU2VydmljZXMuZWRpdFJvbGUoRm9ybUhlbHBlci50cmltKFJvbGVTdG9yZS5nZXRSb2xlKCkpLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFJvbGVBY3Rpb25zLnJlZnJlc2hEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQgJiYgY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBfZmluaXNoRWRpdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFJvbGVDb25zdGFudHMuUk9MRV9FRElUKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFJvbGVDb25zdGFudHMuUk9MRV9FRElUKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzZW5kSW52YWxpZFNhdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZmluaXNoRWRpdDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChSb2xlU3RvcmUuZ2V0SGFzQ2hhbmdlcygpKSB7XHJcbiAgICAgICAgICAgIHZhciBjYWxsYmFja0Z1bmN0ID0gUm9sZVN0b3JlLmdldElzRWRpdGluZygpID8gUm9sZUFjdGlvbnMuZWRpdFJvbGUgOiBSb2xlQWN0aW9ucy5jcmVhdGVSb2xlO1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmRpc3BsYXlTYXZlQ2hhbmdlc0RpYWxvZyh7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBJbm92eExvYWRlci50KFwiY29tbW9uOm1zZ0JveC5zYXZlQ2hhbmdlc1wiKSxcclxuICAgICAgICAgICAgICAgIGNvbmZpcm1DYWxsYmFjazogY2FsbGJhY2tGdW5jdCxcclxuICAgICAgICAgICAgICAgIGNhbmNlbENhbGxiYWNrOiBfZmluaXNoRWRpdFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIF9maW5pc2hFZGl0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGRlbGV0ZVJvbGU6IGZ1bmN0aW9uIChyb2xlLCBjYWxsYmFjaykge1xyXG4gICAgICAgIGlmICghU3lzdGVtU3RvcmUuaXNBY3Rpb25JblByb2dyZXNzKFJvbGVDb25zdGFudHMuUk9MRV9ERUxFVEUpKSB7XHJcbiAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuYmVnaW5BY3Rpb24oUm9sZUNvbnN0YW50cy5ST0xFX0RFTEVURSk7XHJcbiAgICAgICAgICAgIFJvbGVTZXJ2aWNlcy5kZWxldGVSb2xlKHJvbGUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIFJvbGVBY3Rpb25zLnJlZnJlc2hEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCAmJiBjYWxsYmFjayAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFJvbGVDb25zdGFudHMuUk9MRV9ERUxFVEUpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIFN5c3RlbUFjdGlvbnMuZW5kQWN0aW9uKFJvbGVDb25zdGFudHMuUk9MRV9ERUxFVEUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZWRpdEN1cnJlbnRSb2xlOiBmdW5jdGlvbiAoY29tcCwga2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIElub3Z4LlNoYXJlZC5GbHV4LkFwcERpc3BhdGNoZXIuZGlzcGF0Y2goe1xyXG4gICAgICAgICAgICBhY3Rpb25UeXBlOiBSb2xlQ29uc3RhbnRzLlJPTEVfVVBEQVRFX0VESVQsXHJcbiAgICAgICAgICAgIGNvbXBvbmVudDogY29tcCxcclxuICAgICAgICAgICAga2V5OiBrZXksXHJcbiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGFkZFVzZXJzOiBmdW5jdGlvbiAodXNlcnMpIHtcclxuICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgYWN0aW9uVHlwZTogUm9sZUNvbnN0YW50cy5ST0xFX0FERF9VU0VSLFxyXG4gICAgICAgICAgICB1c2VyczogdXNlcnNcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBkZWxldGVBdXRob3JpemVkVXNlcjogZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICBJbm92eC5TaGFyZWQuRmx1eC5BcHBEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgICAgICAgICAgYWN0aW9uVHlwZTogUm9sZUNvbnN0YW50cy5ST0xFX0RFTEVURV9VU0VSLFxyXG4gICAgICAgICAgICB1c2VyOiB1c2VyXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgcmVmcmVzaERhdGE6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmdldEFsbFJvbGVzKCk7XHJcbiAgICB9XHJcbn07XHJcbm1vZHVsZS5leHBvcnRzID0gUm9sZUFjdGlvbnM7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVJvbGVBY3Rpb25zLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG4vLyBUaGlzIGZpbGUgaXMgb25seSBhIHRlbXBsYXRlIGZvciBCYXNlQXBwQ29tcG9uZW50cy4gIENvcHkgYW5kIHBhc3RlIHRoaXMgdG8geW91ciBhcHBsaWNhdGlvbiAudHN4IGZpbGUgYW5kIHN0YXJ0IG9mZiBmcm9tIHRoZXJlXHJcbi8vIFJlbmFtZSBhbGwgdGhpbmdzIHdpdGggQXBwX05hbWUuXHJcbi8vIE5hbWluZyBjb252ZW50aW9uIGZvciBCYXNlQXBwQ29tcG9uZW50cyBpcyBcIltBcHAgTmFtZV1BcHAudHN4XCIgaS5lLiBVc2Vyc0FwcC50c3gsIEVudGl0bGVtZW50QXBwLnRzeFxyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxudmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkge1xyXG4gICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHtcclxuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxyXG4gICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfTtcclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59O1xyXG52YXIgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XHJcbnZhciBJbm92eCA9IHJlcXVpcmUoXCJzaGFyZWQud2ViLmNsaWVudFwiKTtcclxudmFyIFJvbGVGb3JtID0gcmVxdWlyZShcIi4vUm9sZUZvcm1cIik7XHJcbnZhciBSb2xlU3RvcmUgPSByZXF1aXJlKFwiLi8uLi9zdG9yZXMvUm9sZVN0b3JlXCIpO1xyXG52YXIgUm9sZUFjdGlvbnMgPSByZXF1aXJlKFwiLi8uLi9hY3Rpb25zL1JvbGVBY3Rpb25zXCIpO1xyXG52YXIgUm9sZUNvbnN0YW50cyA9IHJlcXVpcmUoXCIuLy4uL2NvbnN0YW50cy9Sb2xlQ29uc3RhbnRzXCIpO1xyXG52YXIgU3lzdGVtQWN0aW9ucyA9IElub3Z4LlNoYXJlZC5TeXN0ZW0uQWN0aW9ucztcclxudmFyIFN5c3RlbVN0b3JlID0gSW5vdnguU2hhcmVkLlN5c3RlbS5TdG9yZTtcclxudmFyIFVybFV0aWxpdGllcyA9IElub3Z4LlNoYXJlZC5Db21tb24uVXJsVXRpbGl0aWVzO1xyXG5mdW5jdGlvbiBnZXRSb2xlU3RhdGUoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGFsbFJvbGVzOiBSb2xlU3RvcmUuZ2V0QWxsKCksXHJcbiAgICAgICAgbW9kYWxWaXNpYmxlOiBSb2xlU3RvcmUuZ2V0TW9kYWxWaXNpYmxlKCksXHJcbiAgICAgICAgaXNBY3Rpb25JblByb2dyZXNzOiBTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoUm9sZUNvbnN0YW50cy5ST0xFX0RFTEVURSlcclxuICAgIH07XHJcbn1cclxudmFyIFJvbGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoUm9sZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFJvbGUocHJvcHMsIGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCAncm9sZScsIHByb3BzLCBjb250ZXh0KSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBSb2xlQWN0aW9ucy5nZXRBbGxSb2xlcyhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5fYXBwTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5faGFuZGxlUGVybWlzc2lvbkVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fYWRkUm9sZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgUm9sZUFjdGlvbnMuYmVnaW5BZGQoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9iZWdpbkVkaXRSb2xlID0gZnVuY3Rpb24gKGUsIHJvbGUpIHtcclxuICAgICAgICAgICAgUm9sZUFjdGlvbnMuYmVnaW5FZGl0KHJvbGUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2RlbGV0ZVJvbGUgPSBmdW5jdGlvbiAoZSwgcm9sZSkge1xyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZU9iamVjdCA9IHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IElub3Z4TG9hZGVyLnQoJ3JvbGU6bWVzc2FnZS5jb25maXJtRGVsZXRlJyksXHJcbiAgICAgICAgICAgICAgICBjb25maXJtQ2FsbGJhY2s6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBSb2xlQWN0aW9ucy5kZWxldGVSb2xlKHJvbGUsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBTeXN0ZW1BY3Rpb25zLmRpc3BsYXlDb25maXJtYXRpb25NZXNzYWdlKG1lc3NhZ2VPYmplY3QpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2hpZGVNb2RhbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgUm9sZUFjdGlvbnMuZmluaXNoRWRpdCgpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX29uQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZShnZXRSb2xlU3RhdGUoKSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fb25TeXN0ZW1DaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgaXNBY3Rpb25JblByb2dyZXNzOiBTeXN0ZW1TdG9yZS5pc0FjdGlvbkluUHJvZ3Jlc3MoUm9sZUNvbnN0YW50cy5ST0xFX0RFTEVURSkgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5zdGF0ZSA9IGdldFJvbGVTdGF0ZSgpO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFJvbGUucHJvdG90eXBlLmNvbXBvbmVudFdpbGxNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmNvbXBvbmVudFdpbGxNb3VudEJhc2UoKTtcclxuICAgIH07XHJcbiAgICBSb2xlLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBSb2xlU3RvcmUuYWRkQ2hhbmdlTGlzdGVuZXIodGhpcy5fb25DaGFuZ2UpO1xyXG4gICAgICAgIFN5c3RlbVN0b3JlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX29uU3lzdGVtQ2hhbmdlKTtcclxuICAgIH07XHJcbiAgICBSb2xlLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBSb2xlU3RvcmUucmVtb3ZlQ2hhbmdlTGlzdGVuZXIodGhpcy5fb25DaGFuZ2UpO1xyXG4gICAgICAgIFN5c3RlbVN0b3JlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX29uU3lzdGVtQ2hhbmdlKTtcclxuICAgIH07XHJcbiAgICBSb2xlLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGljb25IZWFkZXJQcm9wcyA9IHtcclxuICAgICAgICAgICAgaWNvblVybDogXCJcIi5jb25jYXQoVXJsVXRpbGl0aWVzLmdldEJhc2VBcHBsaWNhdGlvblVybCgpLCBcIi9pbWFnZXMvT3JnYW5pemF0aW9uUm9sZXMucG5nXCIpLFxyXG4gICAgICAgICAgICBpY29uQXR0OiB7IGFsdDogXCJPcmdhbml6YXRpb24gUm9sZXNcIiB9LFxyXG4gICAgICAgICAgICB0aXRsZTogSW5vdnhMb2FkZXIudChcInJvbGU6aGVhZGVyLm9yZ2FuaXphdGlvblJvbGVzXCIpLFxyXG4gICAgICAgICAgICByY0NsYXNzOiBcImNkLWJ0biBhZGQtYnRuXCIsXHJcbiAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuX2FkZFJvbGUsXHJcbiAgICAgICAgICAgIGJ0blVybDogXCJcIi5jb25jYXQoVXJsVXRpbGl0aWVzLmdldEJhc2VBcHBsaWNhdGlvblVybCgpLCBcIi9pbWFnZXMvYWRkT3JnYW5pemF0aW9uUm9sZS5wbmdcIiksXHJcbiAgICAgICAgICAgIGJ0bkF0dDoge1xyXG4gICAgICAgICAgICAgICAgYWx0OiBJbm92eExvYWRlci50KFwicm9sZTpoZWFkZXIubmV3Um9sZVwiKSxcclxuICAgICAgICAgICAgICAgIHRpdGxlOiBJbm92eExvYWRlci50KFwicm9sZTpoZWFkZXIubmV3Um9sZVwiKSxcclxuICAgICAgICAgICAgICAgIGlkOiAncm9sZUFwcC1hZGQtYnRuJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgY29sdW1ucyA9IFt7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJOYW1lXCIsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJUZXh0OiBJbm92eExvYWRlci50KFwicm9sZTpjb21tb24ucm9sZU5hbWVcIiksXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogXCIzNSVcIixcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcclxuICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwiRGVzY3JpcHRpb25cIixcclxuICAgICAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoXCJyb2xlOmNvbW1vbi5kZXNjcmlwdGlvblwiKSxcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcclxuICAgICAgICAgICAgfV07XHJcbiAgICAgICAgdmFyIGRhdGFTb3VyY2UgPSB0aGlzLnN0YXRlLmFsbFJvbGVzO1xyXG4gICAgICAgIHZhciBkZWZhdWx0U29ydCA9IFt7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJOYW1lXCIsXHJcbiAgICAgICAgICAgICAgICBkaXI6IFwiYXNjZW5kaW5nXCJcclxuICAgICAgICAgICAgfV07XHJcbiAgICAgICAgdmFyIGNvbW1hbmRzID0ge1xyXG4gICAgICAgICAgICBoZWFkZXJUZXh0OiBJbm92eExvYWRlci50KFwicm9sZTpjb21tb24uYWN0aW9uc1wiKSxcclxuICAgICAgICAgICAgY29tbWFuZDogW3tcclxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiBcImdseXBoaWNvbiBnbHlwaGljb24tcGVuY2lsXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgY2xpY2s6IHRoaXMuX2JlZ2luRWRpdFJvbGVcclxuICAgICAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiBcImdseXBoaWNvbiBnbHlwaGljb24tdHJhc2hcIixcclxuICAgICAgICAgICAgICAgICAgICBjbGljazogdGhpcy5fZGVsZXRlUm9sZVxyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgIHdpZHRoOiBcIjg1cHhcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5Db3JlLlJlYWN0TG9hZGVyLCB7IGFwcFJlYWR5OiB0aGlzLmlzQXBwTG9hZGVkKCksIGVycm9yU3RhdHVzOiB0aGlzLl9lcnJvclN0YXR1cyB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInJvbGUtYXBwLWNvbnRlbnRcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuQ29udHJvbHMuSWYsIHsgY29uZGl0aW9uOiB0aGlzLnN0YXRlLmlzQWN0aW9uSW5Qcm9ncmVzcywgY2xhc3M6ICd0ZW1wLW1vZGFsLWxvYWRlcicgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImFjdGlvbi1pbi1wcm9ncmVzcy1sb2FkZXItbHJnXCIgfSkpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eC5TaGFyZWQuTGF5b3V0Lkljb25IZWFkZXIsIF9fYXNzaWduKHt9LCBpY29uSGVhZGVyUHJvcHMpKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnguU2hhcmVkLkNvbnRyb2xzLkdyaWQsIHsgZGF0YVNvdXJjZTogZGF0YVNvdXJjZSwgY29tbWFuZHM6IGNvbW1hbmRzLCBjb2x1bW5zOiBjb2x1bW5zLCBkZWZhdWx0U29ydDogZGVmYXVsdFNvcnQsIHBhZ2VhYmxlOiB7IHBhZ2VDb3VudDogNSwgcGFnZVNpemVzOiBbMTAsIDIwLCA1MF0sIHBhZ2VTaXplOiAxMCB9LCBzb3J0OiB0cnVlLCBmaWx0ZXI6IHRydWUgfSkpLFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5Db250cm9scy5Nb2RhbFNsaWRlciwgeyBpc09wZW46IHRoaXMuc3RhdGUubW9kYWxWaXNpYmxlLCBvbkNsb3NlOiB0aGlzLl9oaWRlTW9kYWwgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoUm9sZUZvcm0sIG51bGwpKSkpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBSb2xlO1xyXG59KElub3Z4LlNoYXJlZC5SZWFjdEV4dC5CYXNlQXBwQ29tcG9uZW50KSk7XHJcbm1vZHVsZS5leHBvcnRzID0gUm9sZTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Um9sZUFwcC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gQSAnLnRzeCcgZmlsZSBlbmFibGVzIEpTWCBzdXBwb3J0IGluIHRoZSBUeXBlU2NyaXB0IGNvbXBpbGVyLCBcclxuLy8gZm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIHRoZSBmb2xsb3dpbmcgcGFnZSBvbiB0aGUgVHlwZVNjcmlwdCB3aWtpOlxyXG4vLyBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQvd2lraS9KU1hcclxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSlcclxuICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufTtcclxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xyXG52YXIgSW5vdnggPSByZXF1aXJlKFwic2hhcmVkLndlYi5jbGllbnRcIik7XHJcbnZhciBSb2xlQWN0aW9ucyA9IHJlcXVpcmUoXCIuLy4uL2FjdGlvbnMvUm9sZUFjdGlvbnNcIik7XHJcbnZhciBSb2xlU3RvcmUgPSByZXF1aXJlKFwiLi8uLi9zdG9yZXMvUm9sZVN0b3JlXCIpO1xyXG52YXIgUm9sZUNvbnN0YW50cyA9IHJlcXVpcmUoXCIuLy4uL2NvbnN0YW50cy9Sb2xlQ29uc3RhbnRzXCIpO1xyXG52YXIgU3lzdGVtQWN0aW9ucyA9IElub3Z4LlNoYXJlZC5TeXN0ZW0uQWN0aW9ucztcclxudmFyIFN5c3RlbVN0b3JlID0gSW5vdnguU2hhcmVkLlN5c3RlbS5TdG9yZTtcclxudmFyIElub3Z4Q29udHJvbHMgPSBJbm92eC5TaGFyZWQuQ29udHJvbHM7XHJcbnZhciBVcmxVdGlsaXRpZXMgPSBJbm92eC5TaGFyZWQuQ29tbW9uLlVybFV0aWxpdGllcztcclxuZnVuY3Rpb24gZ2V0SXNBY3Rpb25JblByb2dyZXNzKCkge1xyXG4gICAgcmV0dXJuIFN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhSb2xlQ29uc3RhbnRzLlJPTEVfQUREKSB8fFxyXG4gICAgICAgIFN5c3RlbVN0b3JlLmlzQWN0aW9uSW5Qcm9ncmVzcyhSb2xlQ29uc3RhbnRzLlJPTEVfRURJVCk7XHJcbn1cclxudmFyIF9hY3Rpb25JblByb2dyZXNzTXNnO1xyXG5mdW5jdGlvbiBnZXRSb2xlRm9ybVN0YXRlKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpc0FkZGluZzogUm9sZVN0b3JlLmdldElzQWRkaW5nKCksXHJcbiAgICAgICAgaXNFZGl0aW5nOiBSb2xlU3RvcmUuZ2V0SXNFZGl0aW5nKCksXHJcbiAgICAgICAgYWxsUm9sZXM6IFJvbGVTdG9yZS5nZXRBbGwoKSxcclxuICAgICAgICByb2xlOiBSb2xlU3RvcmUuZ2V0Um9sZSgpLFxyXG4gICAgICAgIGlzQWN0aW9uSW5Qcm9ncmVzczogZ2V0SXNBY3Rpb25JblByb2dyZXNzKCksXHJcbiAgICAgICAgYWN0aW9uSW5Qcm9ncmVzc01zZzogX2FjdGlvbkluUHJvZ3Jlc3NNc2csXHJcbiAgICAgICAgdmFsaWRhdGlvbjogUm9sZVN0b3JlLmdldFZhbGlkYXRpb24oUm9sZUNvbnN0YW50cy5ST0xFX0FERF9GT1JNKVxyXG4gICAgfTtcclxufVxyXG52YXIgUm9sZUZvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoUm9sZUZvcm0sIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBSb2xlRm9ybShwcm9wcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl92YWxpZGF0ZVVzZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBmb3JtID0gX3RoaXMucmVmc1tcImFzc2lnblVzZXJcIl07XHJcbiAgICAgICAgICAgIGlmIChmb3JtLmlzVmFsaWQoX3RoaXMuX2lzRW1wdHlPck51bGwpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fcm9sZUhhc1VzZXIgPSBmdW5jdGlvbiAodXNlck5hbWUsIGF1dGhvcml6ZWRVc2Vycykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpbmRleCBpbiBhdXRob3JpemVkVXNlcnMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhdXRob3JpemVkVXNlcnNbaW5kZXhdLlVzZXJOYW1lID09IHVzZXJOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fYXNzaWduVXNlclRvUm9sZSA9IGZ1bmN0aW9uICh1c2Vycykge1xyXG4gICAgICAgICAgICBpZiAodXNlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgUm9sZUFjdGlvbnMuYWRkVXNlcnModXNlcnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fZGVsZXRlQXV0aG9yaXplZFVzZXIgPSBmdW5jdGlvbiAoZSwgdXNlcikge1xyXG4gICAgICAgICAgICBSb2xlQWN0aW9ucy5kZWxldGVBdXRob3JpemVkVXNlcih1c2VyKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9pc0VtcHR5T3JOdWxsID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZSAmJiB2YWx1ZS50cmltKCkubGVuZ3RoID4gMDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLl9zYXZlUm9sZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKF90aGlzLnN0YXRlLmlzQWRkaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBSb2xlQWN0aW9ucy5jcmVhdGVSb2xlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBSb2xlQWN0aW9ucy5lZGl0Um9sZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBSb2xlQWN0aW9ucy5maW5pc2hFZGl0KCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfdGhpcy5fbG9hZFN0YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZShnZXRSb2xlRm9ybVN0YXRlKCkpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX29uQ2hhbmdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIFJvbGVBY3Rpb25zLmVkaXRDdXJyZW50Um9sZShSb2xlQ29uc3RhbnRzLlJPTEVfQUREX0ZPUk0sIGV2ZW50LnRhcmdldC5uYW1lLCBldmVudC50YXJnZXQudmFsdWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX3N5c3RlbUNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBpc0FjdGlvbkluUHJvZ3Jlc3M6IGdldElzQWN0aW9uSW5Qcm9ncmVzcygpIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgX3RoaXMuX2NoZWNrRm9yVW5zYXZlZENoYW5nZXMgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKFJvbGVTdG9yZS5nZXRIYXNDaGFuZ2VzKCkpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gSW5vdnhMb2FkZXIudChcImNvbW1vbjptc2dCb3guYnJvd3NlclNhdmVDaGFuZ2VzXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIF90aGlzLnN0YXRlID0gZ2V0Um9sZUZvcm1TdGF0ZSgpO1xyXG4gICAgICAgIF9hY3Rpb25JblByb2dyZXNzTXNnID0gSW5vdnhMb2FkZXIudChcInJvbGU6Zm9ybS5zYXZpbmdcIik7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgUm9sZUZvcm0ucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIFJvbGVTdG9yZS5hZGRDaGFuZ2VMaXN0ZW5lcih0aGlzLl9sb2FkU3RhdGUpO1xyXG4gICAgICAgIFN5c3RlbVN0b3JlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX3N5c3RlbUNoYW5nZSk7XHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIHRoaXMuX2NoZWNrRm9yVW5zYXZlZENoYW5nZXMpO1xyXG4gICAgfTtcclxuICAgIFJvbGVGb3JtLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBSb2xlU3RvcmUucmVtb3ZlQ2hhbmdlTGlzdGVuZXIodGhpcy5fbG9hZFN0YXRlKTtcclxuICAgICAgICBTeXN0ZW1TdG9yZS5yZW1vdmVDaGFuZ2VMaXN0ZW5lcih0aGlzLl9zeXN0ZW1DaGFuZ2UpO1xyXG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLl9jaGVja0ZvclVuc2F2ZWRDaGFuZ2VzKTtcclxuICAgIH07XHJcbiAgICBSb2xlRm9ybS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBpbnB1dE9iaiA9IHtcclxuICAgICAgICAgICAgY2xhc3NOYW1lOiAnZm9ybS1jb250cm9sJyxcclxuICAgICAgICAgICAgdHlwZTogJ3RleHQnXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgcm9sZSA9IHRoaXMuc3RhdGUucm9sZTtcclxuICAgICAgICB2YXIgcm9sZU5hbWVJbnB1dCA9IGpRdWVyeS5leHRlbmQoe1xyXG4gICAgICAgICAgICBuYW1lOiAnTmFtZScsXHJcbiAgICAgICAgICAgIGlkOiAncm9sZUFwcC1uYW1lLWlucHV0JyxcclxuICAgICAgICAgICAgdmFsdWU6IHJvbGUuTmFtZVxyXG4gICAgICAgIH0sIGlucHV0T2JqKTtcclxuICAgICAgICB2YXIgcm9sZURlc2NyaXB0aW9uSW5wdXQgPSBqUXVlcnkuZXh0ZW5kKHtcclxuICAgICAgICAgICAgbmFtZTogJ0Rlc2NyaXB0aW9uJyxcclxuICAgICAgICAgICAgaWQ6ICdyb2xlQXBwLWRlc2MtaW5wdXQnLFxyXG4gICAgICAgICAgICB2YWx1ZTogcm9sZS5EZXNjcmlwdGlvblxyXG4gICAgICAgIH0sIGlucHV0T2JqKTtcclxuICAgICAgICB2YXIgaGVhZGVyID0gdGhpcy5zdGF0ZS5pc0FkZGluZyA/IElub3Z4TG9hZGVyLnQoJ3JvbGU6aGVhZGVyLm5ld1JvbGUnKSA6IElub3Z4TG9hZGVyLnQoJ3JvbGU6aGVhZGVyLmVkaXRSb2xlJyk7XHJcbiAgICAgICAgdmFyIGNvbHVtbnMgPSBbe1xyXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwiVXNlck5hbWVcIixcclxuICAgICAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoXCJyb2xlOmZvcm0udXNlck5hbWVcIiksXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogXCI0MCVcIlxyXG4gICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJFbmFibGVkXCIsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJUZXh0OiBJbm92eExvYWRlci50KFwicm9sZTpmb3JtLnVzZXJTdGF0dXNcIiksXHJcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IFtcclxuICAgICAgICAgICAgICAgICAgICB7IHZhbHVlOiB0cnVlLCB0ZXh0OiBJbm92eExvYWRlci50KFwicm9sZTpjb21tb24uZW5hYmxlZFwiKSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgdmFsdWU6IGZhbHNlLCB0ZXh0OiBJbm92eExvYWRlci50KFwicm9sZTpjb21tb24uZGlzYWJsZWRcIikgfVxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9XTtcclxuICAgICAgICB2YXIgdXNlckRhdGFTb3VyY2UgPSB0aGlzLnN0YXRlLnJvbGUuVXNlcnM7XHJcbiAgICAgICAgdmFyIHVzZXJEZWZhdWx0U29ydCA9IFt7XHJcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJVc2VyTmFtZVwiLFxyXG4gICAgICAgICAgICAgICAgZGlyOiBcImFzY2VuZGluZ1wiXHJcbiAgICAgICAgICAgIH1dO1xyXG4gICAgICAgIHZhciB1c2VyQ29tbWFuZHMgPSB7XHJcbiAgICAgICAgICAgIGhlYWRlclRleHQ6IElub3Z4TG9hZGVyLnQoXCJyb2xlOmNvbW1vbi5hY3Rpb25zXCIpLFxyXG4gICAgICAgICAgICBjb21tYW5kOiBbe1xyXG4gICAgICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWU6ICdnbHlwaGljb24gZ2x5cGhpY29uLXRyYXNoJyxcclxuICAgICAgICAgICAgICAgICAgICBjbGljazogdGhpcy5fZGVsZXRlQXV0aG9yaXplZFVzZXJcclxuICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICB3aWR0aDogXCI4NXB4XCIsXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5TdGF0aWNIZWFkZXJGb3JtLCB7IHRpdGxlOiBoZWFkZXIsIHNhdmVPbkNsaWNrOiB0aGlzLl9zYXZlUm9sZSwgc2F2ZUJ0bklkOiBcInJvbGVBcHAtc2F2ZS1idG5cIiwgY2FuY2VsT25DbGljazogdGhpcy5fY2FuY2VsLCBjYW5jZWxCdG5JZDogXCJyb2xlQXBwLWNhbmNlbC1idG5cIiwgaXNBY3Rpb25JblByb2dyZXNzOiB0aGlzLnN0YXRlLmlzQWN0aW9uSW5Qcm9ncmVzcywgaW5Qcm9ncmVzc01lc3NhZ2U6IHRoaXMuc3RhdGUuYWN0aW9uSW5Qcm9ncmVzc01zZyB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBcIlwiLmNvbmNhdChJbm92eExvYWRlci50KFwicm9sZTpjb21tb24ucm9sZU5hbWVcIiksIFwiKlwiKSwgaW5wdXROYW1lOiAnTmFtZScgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5vdnhDb250cm9scy5WYWxpZGF0aW9uSW5wdXQsIF9fYXNzaWduKHt9LCByb2xlTmFtZUlucHV0LCB7IGNsYXNzTmFtZTogXCJmb3JtLWNvbnRyb2xcIiwgb25DaGFuZ2U6IHRoaXMuX29uQ2hhbmdlLCB2YWxpZGF0aW9uOiB0aGlzLnN0YXRlLnZhbGlkYXRpb25bJ05hbWUnXSB9KSkpLFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuRm9ybUZpZWxkLCB7IHRpdGxlOiBJbm92eExvYWRlci50KFwicm9sZTpjb21tb24uZGVzY3JpcHRpb25cIiksIGlucHV0TmFtZTogJ0Rlc2NyaXB0aW9uJyB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInRleHRhcmVhXCIsIF9fYXNzaWduKHt9LCByb2xlRGVzY3JpcHRpb25JbnB1dCwgeyBvbkNoYW5nZTogdGhpcy5fb25DaGFuZ2UgfSkpKSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJbm92eENvbnRyb2xzLkZvcm1GaWVsZCwgeyB0aXRsZTogSW5vdnhMb2FkZXIudChcInJvbGU6Zm9ybS5hc3NpZ25Vc2Vyc1wiKSwgaW5wdXROYW1lOiAnQXNzaWduVXNlcnMnIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4Q29udHJvbHMuTXVsdGlTZWxlY3QsIHsgbWluTGVuZ3RoOiAxLCBkaXNwbGF5UHJvcDogXCJVc2VyTmFtZVwiLCB1cmw6IFwiXCIuY29uY2F0KFVybFV0aWxpdGllcy5nZXRBcGlVcmwoKSwgXCIvUm9sZUFwaS9hcGkvdXNlci9TZWFyY2hVc2Vyc1wiKSwgb25DbGljazogdGhpcy5fYXNzaWduVXNlclRvUm9sZSwgcGFyYW1ldGVyczogeyBtYXhOdW1iZXJPZlJlc3VsdHM6IDUgfSwgbnVtUGFyYW1ldGVyOiAnbWF4TnVtYmVyT2ZSZXN1bHRzJywgc2VhcmNoUHJvcGVydHk6ICdzZWFyY2hTdHJpbmcnLCBidG5MYWJlbDogSW5vdnhMb2FkZXIudChcInJvbGU6Zm9ybS5hZGRcIiksIGtleVByb3A6IFwiVXNlcklEXCIgfSkpLFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KElub3Z4LlNoYXJlZC5Db250cm9scy5HcmlkLCB7IGRhdGFTb3VyY2U6IHVzZXJEYXRhU291cmNlLCBjb21tYW5kczogdXNlckNvbW1hbmRzLCBjb2x1bW5zOiBjb2x1bW5zLCBkZWZhdWx0U29ydDogdXNlckRlZmF1bHRTb3J0LCBzb3J0OiB0cnVlIH0pKSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFJvbGVGb3JtO1xyXG59KFJlYWN0LkNvbXBvbmVudCkpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IFJvbGVGb3JtO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Sb2xlRm9ybS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gVGhpcyBmaWxlIGlzIG9ubHkgYSB0ZW1wbGF0ZSBmb3IgY29uc3RhbnRzLiAgQ29weSBhbmQgcGFzdGUgdGhpcyB0byB5b3VyIGFwcGxpY2F0aW9uJ3MgY29uc3RhbnRzIC50cyBmaWxlIGFuZCBzdGFydCBvZmYgZnJvbSB0aGVyZVxyXG4vLyBSZW5hbWUgYWxsIHRoaW5ncyB3aXRoIEFwcF9OYW1lLlxyXG4vLyBOYW1pbmcgY29udmVudGlvbiBmb3IgY29uc3RhbnRzIGlzIFwiW0FwcCBOYW1lXUNvbnN0YW50cy50c1wiIGkuZS4gVXNlcnNDb25zdGFudHMudHMsIEVudGl0bGVtZW50Q29uc3RhbnRzLnRzXHJcbnZhciBrZXltaXJyb3IgPSByZXF1aXJlKFwiZmJqcy9saWIva2V5bWlycm9yXCIpO1xyXG4vLyBjb252ZW50aW9uIGZvciBjb25zdGFudHMgaXNcclxuLy8gW0FwcF9OYW1lXV9bQWN0aW9uXVxyXG52YXIgUm9sZUNvbnN0YW50cyA9IGtleW1pcnJvcih7XHJcbiAgICBST0xFX0FERF9GT1JNOiBudWxsLFxyXG4gICAgUk9MRV9JTlZBTElEX0FERDogbnVsbCxcclxuICAgIFJPTEVfR0VUX0FMTDogbnVsbCxcclxuICAgIFJPTEVfR0VUX0RFVEFJTDogbnVsbCxcclxuICAgIFJPTEVfQkVHSU5fQUREOiBudWxsLFxyXG4gICAgUk9MRV9CRUdJTl9FRElUOiBudWxsLFxyXG4gICAgUk9MRV9GSU5JU0hfRURJVDogbnVsbCxcclxuICAgIFJPTEVfVVBEQVRFX0VESVQ6IG51bGwsXHJcbiAgICBST0xFX0RFTEVURTogbnVsbCxcclxuICAgIFJPTEVfQUREOiBudWxsLFxyXG4gICAgUk9MRV9FRElUOiBudWxsLFxyXG4gICAgUk9MRV9BRERfVVNFUjogbnVsbCxcclxuICAgIFJPTEVfREVMRVRFX1VTRVI6IG51bGxcclxufSk7XHJcbm1vZHVsZS5leHBvcnRzID0gUm9sZUNvbnN0YW50cztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Um9sZUNvbnN0YW50cy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gVGhpcyBmaWxlIGlzIG9ubHkgYSB0ZW1wbGF0ZSBmb3Igc2VydmljZXMuICBDb3B5IGFuZCBwYXN0ZSB0aGlzIHRvIHlvdXIgYXBwbGljYXRpb24ncyBzZXJ2aWNlIC50cyBmaWxlIGFuZCBzdGFydCBvZmYgZnJvbSB0aGVyZVxyXG4vLyBSZW5hbWUgYWxsIHRoaW5ncyB3aXRoIEFwcF9OYW1lLlxyXG4vLyBOYW1pbmcgY29udmVudGlvbiBmb3Igc2VydmljZXMgaXMgXCJbQXBwIE5hbWVdU2VydmljZXMudHNcIiBpLmUuIFVzZXJzU2VydmljZXMudHMsIEVudGl0bGVtZW50U2VydmljZXMudHNcclxudmFyIElub3Z4ID0gcmVxdWlyZShcInNoYXJlZC53ZWIuY2xpZW50XCIpO1xyXG52YXIgYXNzaWduID0gcmVxdWlyZShcIm9iamVjdC1hc3NpZ25cIik7XHJcbnZhciBVcmxVdGlsaXRpZXMgPSBJbm92eC5TaGFyZWQuQ29tbW9uLlVybFV0aWxpdGllcztcclxudmFyIHVybCA9IFVybFV0aWxpdGllcy5nZXRBcGlVcmwoKSArICcvUm9sZUFwaS9hcGkvcm9sZSc7XHJcbnZhciBSb2xlU2VydmljZXMgPSBhc3NpZ24oe30sIElub3Z4LlNoYXJlZC5GbHV4LkJhc2VTZXJ2aWNlLCB7XHJcbiAgICAvL1JlcGxhY2UgbWV0aG9kIGFjY29yZGluZ2x5XHJcbiAgICBnZXRBbGw6IGZ1bmN0aW9uIChzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIGlnbm9yZURlZmF1bHRFcnJvcikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5nZXQodXJsLCBudWxsLCBmdW5jdGlvbiAocmV0RGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2socmV0RGF0YSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGlmICghaWdub3JlRGVmYXVsdEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVXZWJBcGlFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZ2V0Um9sZURldGFpbDogZnVuY3Rpb24gKGlkLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuZ2V0KFwiXCIuY29uY2F0KHVybCwgXCIvXCIpLmNvbmNhdChpZCksIG51bGwsIGZ1bmN0aW9uIChyZXREYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXREYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBjcmVhdGVSb2xlOiBmdW5jdGlvbiAocm9sZSwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLnBvc3QoXCJcIi5jb25jYXQodXJsLCBcIi9DcmVhdGVcIiksIHJvbGUsIGZ1bmN0aW9uIChyZXREYXRhKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXREYXRhKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3RoaXMuaGFuZGxlV2ViQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBlZGl0Um9sZTogZnVuY3Rpb24gKHJvbGUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvVXBkYXRlXCIpLCByb2xlLCBmdW5jdGlvbiAocmV0RGF0YSkge1xyXG4gICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2socmV0RGF0YSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZGVsZXRlUm9sZTogZnVuY3Rpb24gKHJvbGUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wb3N0KFwiXCIuY29uY2F0KHVybCwgXCIvRGVsZXRlXCIpLCB7IElEOiByb2xlLklELCBWZXJzaW9uVG9rZW46IHJvbGUuVmVyc2lvblRva2VuIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKCk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF90aGlzLmhhbmRsZVdlYkFwaUVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5tb2R1bGUuZXhwb3J0cyA9IFJvbGVTZXJ2aWNlcztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Um9sZVNlcnZpY2VzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG4vLyBUaGlzIGZpbGUgaXMgb25seSBhIHRlbXBsYXRlIGZvciBTdG9yZXMuICBDb3B5IGFuZCBwYXN0ZSB0aGlzIHRvIHlvdXIgYXBwbGljYXRpb24gc3RvcmUgLnRzIGZpbGUgYW5kIHN0YXJ0IG9mZiBmcm9tIHRoZXJlXHJcbi8vIFJlbmFtZSBhbGwgdGhpbmdzIHdpdGggQXBwX05hbWUuXHJcbi8vIE5hbWluZyBjb252ZW50aW9uIGZvciBTdG9yZXMgaXMgXCJbQXBwIE5hbWVdU3RvcmUudHNcIiBpLmUuIFVzZXJTdG9yZS50cywgRW50aXRsZW1lbnRTdG9yZS50c1xyXG52YXIgTm9kZUV2ZW50cyA9IHJlcXVpcmUoXCJldmVudHNcIik7XHJcbnZhciBJbm92eCA9IHJlcXVpcmUoXCJzaGFyZWQud2ViLmNsaWVudFwiKTtcclxudmFyIFJvbGVDb25zdGFudHMgPSByZXF1aXJlKFwiLi8uLi9jb25zdGFudHMvUm9sZUNvbnN0YW50c1wiKTtcclxudmFyIGFzc2lnbiA9IHJlcXVpcmUoXCJvYmplY3QtYXNzaWduXCIpO1xyXG52YXIgRXZlbnRFbWl0dGVyID0gTm9kZUV2ZW50cy5FdmVudEVtaXR0ZXI7XHJcbnZhciBDb21tb25NZXNzYWdlcyA9IElub3Z4LlNoYXJlZC5Db21tb24uQ29tbW9uTWVzc2FnZXM7XHJcbnZhciBDSEFOR0VfRVZFTlQgPSAnUm9sZS5jaGFuZ2UnO1xyXG52YXIgRk9STV9BRERfUk9MRV9OQU1FID0gUm9sZUNvbnN0YW50cy5ST0xFX0FERF9GT1JNO1xyXG52YXIgX3JvbGVzID0gW10sIF9yb2xlID0gZ2V0QmxhbmtSb2xlKCksIF9tb2RhbFZpc2libGUgPSBmYWxzZSwgX2JlZ2luQWRkID0gZmFsc2UsIF9iZWdpbkVkaXQgPSBmYWxzZSwgX2hhc0NoYW5nZXMgPSBmYWxzZSwgX3ZhbGlkYXRpb24gPSB7fTtcclxuZnVuY3Rpb24gc2V0QWRkaW5nUm9sZSgpIHtcclxuICAgIF9iZWdpbkFkZCA9IF9tb2RhbFZpc2libGUgPSB0cnVlO1xyXG4gICAgX2JlZ2luRWRpdCA9IGZhbHNlO1xyXG4gICAgX2hhc0NoYW5nZXMgPSBmYWxzZTtcclxuICAgIF9yb2xlID0gZ2V0QmxhbmtSb2xlKCk7XHJcbiAgICBfaW5pdGFsaXplVmFsaWRhdGlvbihGT1JNX0FERF9ST0xFX05BTUUpO1xyXG59XHJcbmZ1bmN0aW9uIHNldEVkaXRpbmdSb2xlKHJvbGUpIHtcclxuICAgIF9tb2RhbFZpc2libGUgPSBfYmVnaW5FZGl0ID0gdHJ1ZTtcclxuICAgIF9iZWdpbkFkZCA9IGZhbHNlO1xyXG4gICAgX2hhc0NoYW5nZXMgPSBmYWxzZTtcclxuICAgIF9yb2xlID0gJC5leHRlbmQoe30sIHJvbGUpO1xyXG4gICAgX2luaXRhbGl6ZVZhbGlkYXRpb24oRk9STV9BRERfUk9MRV9OQU1FKTtcclxufVxyXG5mdW5jdGlvbiBfaW5pdGFsaXplVmFsaWRhdGlvbihjb21wKSB7XHJcbiAgICBzd2l0Y2ggKGNvbXApIHtcclxuICAgICAgICBjYXNlIEZPUk1fQUREX1JPTEVfTkFNRTpcclxuICAgICAgICAgICAgdmFyIHZhbGlPYmogPSBfdmFsaWRhdGlvbltGT1JNX0FERF9ST0xFX05BTUVdID0ge307XHJcbiAgICAgICAgICAgIGZvciAodmFyIGsgaW4gX3JvbGUpIHtcclxuICAgICAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oRk9STV9BRERfUk9MRV9OQU1FLCBrKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBfc2V0VmFsaWRWYWxpZGF0aW9uKGNvbXAsIG5hbWUpIHtcclxuICAgIGlmIChfdmFsaWRhdGlvbltjb21wXVtuYW1lXSkge1xyXG4gICAgICAgIF92YWxpZGF0aW9uW2NvbXBdW25hbWVdLmludmFsaWRJbnB1dCA9IGZhbHNlO1xyXG4gICAgICAgIF92YWxpZGF0aW9uW2NvbXBdW25hbWVdLmludmFsaWRWYWx1ZSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgX3ZhbGlkYXRpb25bY29tcF1bbmFtZV0gPSBfZ2V0TmV3VmFsaWRhdGlvbk9iamVjdCgpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIF9nZXROZXdWYWxpZGF0aW9uT2JqZWN0KCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpbnZhbGlkSW5wdXQ6IGZhbHNlLFxyXG4gICAgICAgIGludmFsaWRWYWx1ZTogZmFsc2VcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gX3ZhbGlkYXRlKGNvbXApIHtcclxuICAgIHN3aXRjaCAoY29tcCkge1xyXG4gICAgICAgIGNhc2UgRk9STV9BRERfUk9MRV9OQU1FOlxyXG4gICAgICAgICAgICByZXR1cm4gX3ZhbGlkYXRlT2JqZWN0KGNvbXAsIF9yb2xlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxufVxyXG5mdW5jdGlvbiBfZW5zdXJlVmFsaWRPYmplY3QoY29tcCwgb2JqKSB7XHJcbiAgICBmb3IgKHZhciBrIGluIG9iaikge1xyXG4gICAgICAgIHN3aXRjaCAoY29tcCkge1xyXG4gICAgICAgICAgICBjYXNlIEZPUk1fQUREX1JPTEVfTkFNRTpcclxuICAgICAgICAgICAgICAgIHZhciBvYmpUeXBlID0gdHlwZW9mIChvYmpba10pO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9ialR5cGUgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqW2tdID09PSBudWxsIHx8IG9ialR5cGUgIT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF91cGRhdGVDaGFuZ2VzKGssIG9ialtrXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfZW5zdXJlVmFsaWRPYmplY3QoY29tcCwgb2JqW2tdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIF92YWxpZGF0ZU9iamVjdChjb21wLCBvYmopIHtcclxuICAgIF9lbnN1cmVWYWxpZE9iamVjdChjb21wLCBvYmopO1xyXG4gICAgdmFyIHJldCA9IHRydWU7XHJcbiAgICBmb3IgKHZhciBrIGluIF92YWxpZGF0aW9uW0ZPUk1fQUREX1JPTEVfTkFNRV0pIHtcclxuICAgICAgICBpZiAoX3ZhbGlkYXRpb25bRk9STV9BRERfUk9MRV9OQU1FXVtrXS5pbnZhbGlkVmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiByZXQ7XHJcbn1cclxuZnVuY3Rpb24gX3VwZGF0ZUNoYW5nZXMobmFtZSwgdmFsdWUpIHtcclxuICAgIHN3aXRjaCAobmFtZSkge1xyXG4gICAgICAgIGNhc2UgXCJOYW1lXCI6XHJcbiAgICAgICAgICAgIF9yb2xlW25hbWVdID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGR1cE5hbWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3JvbGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9yb2xlLk5hbWUudG9VcHBlckNhc2UoKSA9PT0gX3JvbGVzW2ldLk5hbWUudG9VcHBlckNhc2UoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiBfcm9sZS5JRC50b1VwcGVyQ2FzZSgpICE9PSBfcm9sZXNbaV0uSUQudG9VcHBlckNhc2UoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXBOYW1lID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGR1cE5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBfdmFsaWRhdGlvbltGT1JNX0FERF9ST0xFX05BTUVdW25hbWVdLmludmFsaWRWYWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgX3ZhbGlkYXRpb25bRk9STV9BRERfUk9MRV9OQU1FXVtuYW1lXS5pbnZhbGlkVmFsdWVNZXNzYWdlID0gSW5vdnhMb2FkZXIudChcInJvbGU6bWVzc2FnZS5pbnZhbGlkUm9sZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oRk9STV9BRERfUk9MRV9OQU1FLCBuYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW0ZPUk1fQUREX1JPTEVfTkFNRV1bbmFtZV0uaW52YWxpZFZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF92YWxpZGF0aW9uW0ZPUk1fQUREX1JPTEVfTkFNRV1bbmFtZV0uaW52YWxpZFZhbHVlTWVzc2FnZSA9IENvbW1vbk1lc3NhZ2VzLlZhbGlkYXRpb24uUmVxdWlyZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgaWYgKG5hbWUgIT0gJ0lEJyAmJiBuYW1lICE9ICdWZXJzaW9uVG9rZW4nKSB7XHJcbiAgICAgICAgICAgICAgICBfcm9sZVtuYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF9zZXRWYWxpZFZhbGlkYXRpb24oRk9STV9BRERfUk9MRV9OQU1FLCBuYW1lKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZmluaXNoZWRFZGl0aW5nUm9sZSgpIHtcclxuICAgIF9tb2RhbFZpc2libGUgPSBmYWxzZTtcclxuICAgIF9oYXNDaGFuZ2VzID0gZmFsc2U7XHJcbn1cclxuZnVuY3Rpb24gdXBkYXRlQ3VycmVudFJvbGUoY29tcCwga2V5LCB2YWx1ZSkge1xyXG4gICAgc3dpdGNoIChjb21wKSB7XHJcbiAgICAgICAgY2FzZSBGT1JNX0FERF9ST0xFX05BTUU6XHJcbiAgICAgICAgICAgIF91cGRhdGVDaGFuZ2VzKGtleSwgdmFsdWUpO1xyXG4gICAgICAgICAgICBfaGFzQ2hhbmdlcyA9IHRydWU7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGFkZFVzZXJzKHVzZXJzKSB7XHJcbiAgICBmb3IgKHZhciBpbmR4IGluIHVzZXJzKSB7XHJcbiAgICAgICAgdmFyIGV4aXN0cyA9IGZhbHNlO1xyXG4gICAgICAgIGZvciAodmFyIGdycEluZHggaW4gX3JvbGUuVXNlcnMpIHtcclxuICAgICAgICAgICAgaWYgKHVzZXJzW2luZHhdLlVzZXJJRCA9PT0gX3JvbGUuVXNlcnNbZ3JwSW5keF0uVXNlcklEKSB7XHJcbiAgICAgICAgICAgICAgICBleGlzdHMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFleGlzdHMpIHtcclxuICAgICAgICAgICAgX3JvbGUuVXNlcnMucHVzaCh1c2Vyc1tpbmR4XSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgX2hhc0NoYW5nZXMgPSB0cnVlO1xyXG59XHJcbmZ1bmN0aW9uIGRlbGV0ZUF1dGhvcml6ZWRVc2VyKHVzZXIpIHtcclxuICAgIHZhciBhdXRob3JpemVkVXNlcnMgPSBfcm9sZS5Vc2VycztcclxuICAgIGZvciAodmFyIGluZGV4IGluIGF1dGhvcml6ZWRVc2Vycykge1xyXG4gICAgICAgIGlmIChhdXRob3JpemVkVXNlcnNbaW5kZXhdLlVzZXJOYW1lID09IHVzZXIuVXNlck5hbWUpIHtcclxuICAgICAgICAgICAgYXV0aG9yaXplZFVzZXJzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIF9oYXNDaGFuZ2VzID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gbG9hZEFsbFJvbGVzKGRhdGEpIHtcclxuICAgIF9yb2xlcyA9IGRhdGE7XHJcbn1cclxuZnVuY3Rpb24gZ2V0QmxhbmtSb2xlKCkge1xyXG4gICAgcmV0dXJuIHsgSUQ6IFwiXCIsIFZlcnNpb25Ub2tlbjogXCJcIiwgTmFtZTogXCJcIiwgRGVzY3JpcHRpb246IFwiXCIsIFVzZXJzOiBbXSB9O1xyXG59XHJcbmZ1bmN0aW9uIGdldEJsYW5rVXNlcigpIHtcclxuICAgIHJldHVybiB7IFVzZXJJRDogbnVsbCwgVXNlck5hbWU6IG51bGwsIFVzZXJWZXJzaW9uVG9rZW46IG51bGwsIEZpcnN0TmFtZTogbnVsbCwgTGFzdE5hbWU6IG51bGwsIEVuYWJsZWQ6IG51bGwgfTtcclxufVxyXG52YXIgUm9sZVN0b3JlID0gYXNzaWduKHt9LCBFdmVudEVtaXR0ZXIucHJvdG90eXBlLCB7XHJcbiAgICAvLyBBZGQgc3RvcmUgZ2V0dGVycyBoZXJlXHJcbiAgICBnZXRBbGw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX3JvbGVzO1xyXG4gICAgfSxcclxuICAgIGdldFJvbGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX3JvbGU7XHJcbiAgICB9LFxyXG4gICAgZ2V0SXNBZGRpbmc6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2JlZ2luQWRkO1xyXG4gICAgfSxcclxuICAgIGdldElzRWRpdGluZzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfYmVnaW5FZGl0O1xyXG4gICAgfSxcclxuICAgIGdldE1vZGFsVmlzaWJsZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfbW9kYWxWaXNpYmxlO1xyXG4gICAgfSxcclxuICAgIGdldEhhc0NoYW5nZXM6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX2hhc0NoYW5nZXM7XHJcbiAgICB9LFxyXG4gICAgZ2V0VmFsaWRhdGlvbjogZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHJldHVybiBfdmFsaWRhdGlvbltrZXldO1xyXG4gICAgfSxcclxuICAgIGdldElzVmFsaWRPYmplY3Q6IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICByZXR1cm4gX3ZhbGlkYXRlKGtleSk7XHJcbiAgICB9LFxyXG4gICAgZW1pdENoYW5nZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuZW1pdChDSEFOR0VfRVZFTlQpO1xyXG4gICAgfSxcclxuICAgIGFkZENoYW5nZUxpc3RlbmVyOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgICAgICB0aGlzLm9uKENIQU5HRV9FVkVOVCwgY2FsbGJhY2spO1xyXG4gICAgfSxcclxuICAgIHJlbW92ZUNoYW5nZUxpc3RlbmVyOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKENIQU5HRV9FVkVOVCwgY2FsbGJhY2spO1xyXG4gICAgfVxyXG59KTtcclxuSW5vdnguU2hhcmVkLkZsdXguQXBwRGlzcGF0Y2hlci5yZWdpc3RlcihmdW5jdGlvbiAocGF5bG9hZCkge1xyXG4gICAgc3dpdGNoIChwYXlsb2FkLmFjdGlvblR5cGUpIHtcclxuICAgICAgICBjYXNlIFJvbGVDb25zdGFudHMuUk9MRV9HRVRfQUxMOlxyXG4gICAgICAgICAgICBsb2FkQWxsUm9sZXMocGF5bG9hZC5kYXRhKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBSb2xlQ29uc3RhbnRzLlJPTEVfQkVHSU5fQUREOlxyXG4gICAgICAgICAgICBzZXRBZGRpbmdSb2xlKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgUm9sZUNvbnN0YW50cy5ST0xFX0JFR0lOX0VESVQ6XHJcbiAgICAgICAgICAgIHNldEVkaXRpbmdSb2xlKHBheWxvYWQucm9sZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgUm9sZUNvbnN0YW50cy5ST0xFX0ZJTklTSF9FRElUOlxyXG4gICAgICAgICAgICBmaW5pc2hlZEVkaXRpbmdSb2xlKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgUm9sZUNvbnN0YW50cy5ST0xFX1VQREFURV9FRElUOlxyXG4gICAgICAgICAgICB1cGRhdGVDdXJyZW50Um9sZShwYXlsb2FkLmNvbXBvbmVudCwgcGF5bG9hZC5rZXksIHBheWxvYWQudmFsdWUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFJvbGVDb25zdGFudHMuUk9MRV9BRERfVVNFUjpcclxuICAgICAgICAgICAgYWRkVXNlcnMocGF5bG9hZC51c2Vycyk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgUm9sZUNvbnN0YW50cy5ST0xFX0RFTEVURV9VU0VSOlxyXG4gICAgICAgICAgICBkZWxldGVBdXRob3JpemVkVXNlcihwYXlsb2FkLnVzZXIpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFJvbGVDb25zdGFudHMuUk9MRV9JTlZBTElEX0FERDpcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDogcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBSb2xlU3RvcmUuZW1pdENoYW5nZSgpO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbn0pO1xyXG5tb2R1bGUuZXhwb3J0cyA9IFJvbGVTdG9yZTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Um9sZVN0b3JlLmpzLm1hcCIsIi8vIENvcHlyaWdodCBKb3llbnQsIEluYy4gYW5kIG90aGVyIE5vZGUgY29udHJpYnV0b3JzLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhXG4vLyBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlXG4vLyBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmdcbi8vIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCxcbi8vIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXRcbi8vIHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZVxuLy8gZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWRcbi8vIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1Ncbi8vIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0Zcbi8vIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU5cbi8vIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLFxuLy8gREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SXG4vLyBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFXG4vLyBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG52YXIgb2JqZWN0Q3JlYXRlID0gT2JqZWN0LmNyZWF0ZSB8fCBvYmplY3RDcmVhdGVQb2x5ZmlsbFxudmFyIG9iamVjdEtleXMgPSBPYmplY3Qua2V5cyB8fCBvYmplY3RLZXlzUG9seWZpbGxcbnZhciBiaW5kID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgfHwgZnVuY3Rpb25CaW5kUG9seWZpbGxcblxuZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkge1xuICBpZiAoIXRoaXMuX2V2ZW50cyB8fCAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMsICdfZXZlbnRzJykpIHtcbiAgICB0aGlzLl9ldmVudHMgPSBvYmplY3RDcmVhdGUobnVsbCk7XG4gICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwO1xuICB9XG5cbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gdGhpcy5fbWF4TGlzdGVuZXJzIHx8IHVuZGVmaW5lZDtcbn1cbm1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyO1xuXG4vLyBCYWNrd2FyZHMtY29tcGF0IHdpdGggbm9kZSAwLjEwLnhcbkV2ZW50RW1pdHRlci5FdmVudEVtaXR0ZXIgPSBFdmVudEVtaXR0ZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX2V2ZW50cyA9IHVuZGVmaW5lZDtcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX21heExpc3RlbmVycyA9IHVuZGVmaW5lZDtcblxuLy8gQnkgZGVmYXVsdCBFdmVudEVtaXR0ZXJzIHdpbGwgcHJpbnQgYSB3YXJuaW5nIGlmIG1vcmUgdGhhbiAxMCBsaXN0ZW5lcnMgYXJlXG4vLyBhZGRlZCB0byBpdC4gVGhpcyBpcyBhIHVzZWZ1bCBkZWZhdWx0IHdoaWNoIGhlbHBzIGZpbmRpbmcgbWVtb3J5IGxlYWtzLlxudmFyIGRlZmF1bHRNYXhMaXN0ZW5lcnMgPSAxMDtcblxudmFyIGhhc0RlZmluZVByb3BlcnR5O1xudHJ5IHtcbiAgdmFyIG8gPSB7fTtcbiAgaWYgKE9iamVjdC5kZWZpbmVQcm9wZXJ0eSkgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sICd4JywgeyB2YWx1ZTogMCB9KTtcbiAgaGFzRGVmaW5lUHJvcGVydHkgPSBvLnggPT09IDA7XG59IGNhdGNoIChlcnIpIHsgaGFzRGVmaW5lUHJvcGVydHkgPSBmYWxzZSB9XG5pZiAoaGFzRGVmaW5lUHJvcGVydHkpIHtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEV2ZW50RW1pdHRlciwgJ2RlZmF1bHRNYXhMaXN0ZW5lcnMnLCB7XG4gICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRNYXhMaXN0ZW5lcnM7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uKGFyZykge1xuICAgICAgLy8gY2hlY2sgd2hldGhlciB0aGUgaW5wdXQgaXMgYSBwb3NpdGl2ZSBudW1iZXIgKHdob3NlIHZhbHVlIGlzIHplcm8gb3JcbiAgICAgIC8vIGdyZWF0ZXIgYW5kIG5vdCBhIE5hTikuXG4gICAgICBpZiAodHlwZW9mIGFyZyAhPT0gJ251bWJlcicgfHwgYXJnIDwgMCB8fCBhcmcgIT09IGFyZylcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJkZWZhdWx0TWF4TGlzdGVuZXJzXCIgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlcicpO1xuICAgICAgZGVmYXVsdE1heExpc3RlbmVycyA9IGFyZztcbiAgICB9XG4gIH0pO1xufSBlbHNlIHtcbiAgRXZlbnRFbWl0dGVyLmRlZmF1bHRNYXhMaXN0ZW5lcnMgPSBkZWZhdWx0TWF4TGlzdGVuZXJzO1xufVxuXG4vLyBPYnZpb3VzbHkgbm90IGFsbCBFbWl0dGVycyBzaG91bGQgYmUgbGltaXRlZCB0byAxMC4gVGhpcyBmdW5jdGlvbiBhbGxvd3Ncbi8vIHRoYXQgdG8gYmUgaW5jcmVhc2VkLiBTZXQgdG8gemVybyBmb3IgdW5saW1pdGVkLlxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5zZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbiBzZXRNYXhMaXN0ZW5lcnMobikge1xuICBpZiAodHlwZW9mIG4gIT09ICdudW1iZXInIHx8IG4gPCAwIHx8IGlzTmFOKG4pKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wiblwiIGFyZ3VtZW50IG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtcbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gbjtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5mdW5jdGlvbiAkZ2V0TWF4TGlzdGVuZXJzKHRoYXQpIHtcbiAgaWYgKHRoYXQuX21heExpc3RlbmVycyA9PT0gdW5kZWZpbmVkKVxuICAgIHJldHVybiBFdmVudEVtaXR0ZXIuZGVmYXVsdE1heExpc3RlbmVycztcbiAgcmV0dXJuIHRoYXQuX21heExpc3RlbmVycztcbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5nZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbiBnZXRNYXhMaXN0ZW5lcnMoKSB7XG4gIHJldHVybiAkZ2V0TWF4TGlzdGVuZXJzKHRoaXMpO1xufTtcblxuLy8gVGhlc2Ugc3RhbmRhbG9uZSBlbWl0KiBmdW5jdGlvbnMgYXJlIHVzZWQgdG8gb3B0aW1pemUgY2FsbGluZyBvZiBldmVudFxuLy8gaGFuZGxlcnMgZm9yIGZhc3QgY2FzZXMgYmVjYXVzZSBlbWl0KCkgaXRzZWxmIG9mdGVuIGhhcyBhIHZhcmlhYmxlIG51bWJlciBvZlxuLy8gYXJndW1lbnRzIGFuZCBjYW4gYmUgZGVvcHRpbWl6ZWQgYmVjYXVzZSBvZiB0aGF0LiBUaGVzZSBmdW5jdGlvbnMgYWx3YXlzIGhhdmVcbi8vIHRoZSBzYW1lIG51bWJlciBvZiBhcmd1bWVudHMgYW5kIHRodXMgZG8gbm90IGdldCBkZW9wdGltaXplZCwgc28gdGhlIGNvZGVcbi8vIGluc2lkZSB0aGVtIGNhbiBleGVjdXRlIGZhc3Rlci5cbmZ1bmN0aW9uIGVtaXROb25lKGhhbmRsZXIsIGlzRm4sIHNlbGYpIHtcbiAgaWYgKGlzRm4pXG4gICAgaGFuZGxlci5jYWxsKHNlbGYpO1xuICBlbHNlIHtcbiAgICB2YXIgbGVuID0gaGFuZGxlci5sZW5ndGg7XG4gICAgdmFyIGxpc3RlbmVycyA9IGFycmF5Q2xvbmUoaGFuZGxlciwgbGVuKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKVxuICAgICAgbGlzdGVuZXJzW2ldLmNhbGwoc2VsZik7XG4gIH1cbn1cbmZ1bmN0aW9uIGVtaXRPbmUoaGFuZGxlciwgaXNGbiwgc2VsZiwgYXJnMSkge1xuICBpZiAoaXNGbilcbiAgICBoYW5kbGVyLmNhbGwoc2VsZiwgYXJnMSk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uY2FsbChzZWxmLCBhcmcxKTtcbiAgfVxufVxuZnVuY3Rpb24gZW1pdFR3byhoYW5kbGVyLCBpc0ZuLCBzZWxmLCBhcmcxLCBhcmcyKSB7XG4gIGlmIChpc0ZuKVxuICAgIGhhbmRsZXIuY2FsbChzZWxmLCBhcmcxLCBhcmcyKTtcbiAgZWxzZSB7XG4gICAgdmFyIGxlbiA9IGhhbmRsZXIubGVuZ3RoO1xuICAgIHZhciBsaXN0ZW5lcnMgPSBhcnJheUNsb25lKGhhbmRsZXIsIGxlbik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSlcbiAgICAgIGxpc3RlbmVyc1tpXS5jYWxsKHNlbGYsIGFyZzEsIGFyZzIpO1xuICB9XG59XG5mdW5jdGlvbiBlbWl0VGhyZWUoaGFuZGxlciwgaXNGbiwgc2VsZiwgYXJnMSwgYXJnMiwgYXJnMykge1xuICBpZiAoaXNGbilcbiAgICBoYW5kbGVyLmNhbGwoc2VsZiwgYXJnMSwgYXJnMiwgYXJnMyk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uY2FsbChzZWxmLCBhcmcxLCBhcmcyLCBhcmczKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBlbWl0TWFueShoYW5kbGVyLCBpc0ZuLCBzZWxmLCBhcmdzKSB7XG4gIGlmIChpc0ZuKVxuICAgIGhhbmRsZXIuYXBwbHkoc2VsZiwgYXJncyk7XG4gIGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBsaXN0ZW5lcnNbaV0uYXBwbHkoc2VsZiwgYXJncyk7XG4gIH1cbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gZW1pdCh0eXBlKSB7XG4gIHZhciBlciwgaGFuZGxlciwgbGVuLCBhcmdzLCBpLCBldmVudHM7XG4gIHZhciBkb0Vycm9yID0gKHR5cGUgPT09ICdlcnJvcicpO1xuXG4gIGV2ZW50cyA9IHRoaXMuX2V2ZW50cztcbiAgaWYgKGV2ZW50cylcbiAgICBkb0Vycm9yID0gKGRvRXJyb3IgJiYgZXZlbnRzLmVycm9yID09IG51bGwpO1xuICBlbHNlIGlmICghZG9FcnJvcilcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgLy8gSWYgdGhlcmUgaXMgbm8gJ2Vycm9yJyBldmVudCBsaXN0ZW5lciB0aGVuIHRocm93LlxuICBpZiAoZG9FcnJvcikge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSlcbiAgICAgIGVyID0gYXJndW1lbnRzWzFdO1xuICAgIGlmIChlciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICB0aHJvdyBlcjsgLy8gVW5oYW5kbGVkICdlcnJvcicgZXZlbnRcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQXQgbGVhc3QgZ2l2ZSBzb21lIGtpbmQgb2YgY29udGV4dCB0byB0aGUgdXNlclxuICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcignVW5oYW5kbGVkIFwiZXJyb3JcIiBldmVudC4gKCcgKyBlciArICcpJyk7XG4gICAgICBlcnIuY29udGV4dCA9IGVyO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBoYW5kbGVyID0gZXZlbnRzW3R5cGVdO1xuXG4gIGlmICghaGFuZGxlcilcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgdmFyIGlzRm4gPSB0eXBlb2YgaGFuZGxlciA9PT0gJ2Z1bmN0aW9uJztcbiAgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgc3dpdGNoIChsZW4pIHtcbiAgICAgIC8vIGZhc3QgY2FzZXNcbiAgICBjYXNlIDE6XG4gICAgICBlbWl0Tm9uZShoYW5kbGVyLCBpc0ZuLCB0aGlzKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMjpcbiAgICAgIGVtaXRPbmUoaGFuZGxlciwgaXNGbiwgdGhpcywgYXJndW1lbnRzWzFdKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMzpcbiAgICAgIGVtaXRUd28oaGFuZGxlciwgaXNGbiwgdGhpcywgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0pO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSA0OlxuICAgICAgZW1pdFRocmVlKGhhbmRsZXIsIGlzRm4sIHRoaXMsIGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdLCBhcmd1bWVudHNbM10pO1xuICAgICAgYnJlYWs7XG4gICAgICAvLyBzbG93ZXJcbiAgICBkZWZhdWx0OlxuICAgICAgYXJncyA9IG5ldyBBcnJheShsZW4gLSAxKTtcbiAgICAgIGZvciAoaSA9IDE7IGkgPCBsZW47IGkrKylcbiAgICAgICAgYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07XG4gICAgICBlbWl0TWFueShoYW5kbGVyLCBpc0ZuLCB0aGlzLCBhcmdzKTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuZnVuY3Rpb24gX2FkZExpc3RlbmVyKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIsIHByZXBlbmQpIHtcbiAgdmFyIG07XG4gIHZhciBldmVudHM7XG4gIHZhciBleGlzdGluZztcblxuICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICBldmVudHMgPSB0YXJnZXQuX2V2ZW50cztcbiAgaWYgKCFldmVudHMpIHtcbiAgICBldmVudHMgPSB0YXJnZXQuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICB0YXJnZXQuX2V2ZW50c0NvdW50ID0gMDtcbiAgfSBlbHNlIHtcbiAgICAvLyBUbyBhdm9pZCByZWN1cnNpb24gaW4gdGhlIGNhc2UgdGhhdCB0eXBlID09PSBcIm5ld0xpc3RlbmVyXCIhIEJlZm9yZVxuICAgIC8vIGFkZGluZyBpdCB0byB0aGUgbGlzdGVuZXJzLCBmaXJzdCBlbWl0IFwibmV3TGlzdGVuZXJcIi5cbiAgICBpZiAoZXZlbnRzLm5ld0xpc3RlbmVyKSB7XG4gICAgICB0YXJnZXQuZW1pdCgnbmV3TGlzdGVuZXInLCB0eXBlLFxuICAgICAgICAgIGxpc3RlbmVyLmxpc3RlbmVyID8gbGlzdGVuZXIubGlzdGVuZXIgOiBsaXN0ZW5lcik7XG5cbiAgICAgIC8vIFJlLWFzc2lnbiBgZXZlbnRzYCBiZWNhdXNlIGEgbmV3TGlzdGVuZXIgaGFuZGxlciBjb3VsZCBoYXZlIGNhdXNlZCB0aGVcbiAgICAgIC8vIHRoaXMuX2V2ZW50cyB0byBiZSBhc3NpZ25lZCB0byBhIG5ldyBvYmplY3RcbiAgICAgIGV2ZW50cyA9IHRhcmdldC5fZXZlbnRzO1xuICAgIH1cbiAgICBleGlzdGluZyA9IGV2ZW50c1t0eXBlXTtcbiAgfVxuXG4gIGlmICghZXhpc3RpbmcpIHtcbiAgICAvLyBPcHRpbWl6ZSB0aGUgY2FzZSBvZiBvbmUgbGlzdGVuZXIuIERvbid0IG5lZWQgdGhlIGV4dHJhIGFycmF5IG9iamVjdC5cbiAgICBleGlzdGluZyA9IGV2ZW50c1t0eXBlXSA9IGxpc3RlbmVyO1xuICAgICsrdGFyZ2V0Ll9ldmVudHNDb3VudDtcbiAgfSBlbHNlIHtcbiAgICBpZiAodHlwZW9mIGV4aXN0aW5nID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAvLyBBZGRpbmcgdGhlIHNlY29uZCBlbGVtZW50LCBuZWVkIHRvIGNoYW5nZSB0byBhcnJheS5cbiAgICAgIGV4aXN0aW5nID0gZXZlbnRzW3R5cGVdID1cbiAgICAgICAgICBwcmVwZW5kID8gW2xpc3RlbmVyLCBleGlzdGluZ10gOiBbZXhpc3RpbmcsIGxpc3RlbmVyXTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgd2UndmUgYWxyZWFkeSBnb3QgYW4gYXJyYXksIGp1c3QgYXBwZW5kLlxuICAgICAgaWYgKHByZXBlbmQpIHtcbiAgICAgICAgZXhpc3RpbmcudW5zaGlmdChsaXN0ZW5lcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBleGlzdGluZy5wdXNoKGxpc3RlbmVyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgbGlzdGVuZXIgbGVha1xuICAgIGlmICghZXhpc3Rpbmcud2FybmVkKSB7XG4gICAgICBtID0gJGdldE1heExpc3RlbmVycyh0YXJnZXQpO1xuICAgICAgaWYgKG0gJiYgbSA+IDAgJiYgZXhpc3RpbmcubGVuZ3RoID4gbSkge1xuICAgICAgICBleGlzdGluZy53YXJuZWQgPSB0cnVlO1xuICAgICAgICB2YXIgdyA9IG5ldyBFcnJvcignUG9zc2libGUgRXZlbnRFbWl0dGVyIG1lbW9yeSBsZWFrIGRldGVjdGVkLiAnICtcbiAgICAgICAgICAgIGV4aXN0aW5nLmxlbmd0aCArICcgXCInICsgU3RyaW5nKHR5cGUpICsgJ1wiIGxpc3RlbmVycyAnICtcbiAgICAgICAgICAgICdhZGRlZC4gVXNlIGVtaXR0ZXIuc2V0TWF4TGlzdGVuZXJzKCkgdG8gJyArXG4gICAgICAgICAgICAnaW5jcmVhc2UgbGltaXQuJyk7XG4gICAgICAgIHcubmFtZSA9ICdNYXhMaXN0ZW5lcnNFeGNlZWRlZFdhcm5pbmcnO1xuICAgICAgICB3LmVtaXR0ZXIgPSB0YXJnZXQ7XG4gICAgICAgIHcudHlwZSA9IHR5cGU7XG4gICAgICAgIHcuY291bnQgPSBleGlzdGluZy5sZW5ndGg7XG4gICAgICAgIGlmICh0eXBlb2YgY29uc29sZSA9PT0gJ29iamVjdCcgJiYgY29uc29sZS53YXJuKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCclczogJXMnLCB3Lm5hbWUsIHcubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGFyZ2V0O1xufVxuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZExpc3RlbmVyID0gZnVuY3Rpb24gYWRkTGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHtcbiAgcmV0dXJuIF9hZGRMaXN0ZW5lcih0aGlzLCB0eXBlLCBsaXN0ZW5lciwgZmFsc2UpO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbiA9IEV2ZW50RW1pdHRlci5wcm90b3R5cGUuYWRkTGlzdGVuZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucHJlcGVuZExpc3RlbmVyID1cbiAgICBmdW5jdGlvbiBwcmVwZW5kTGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgIHJldHVybiBfYWRkTGlzdGVuZXIodGhpcywgdHlwZSwgbGlzdGVuZXIsIHRydWUpO1xuICAgIH07XG5cbmZ1bmN0aW9uIG9uY2VXcmFwcGVyKCkge1xuICBpZiAoIXRoaXMuZmlyZWQpIHtcbiAgICB0aGlzLnRhcmdldC5yZW1vdmVMaXN0ZW5lcih0aGlzLnR5cGUsIHRoaXMud3JhcEZuKTtcbiAgICB0aGlzLmZpcmVkID0gdHJ1ZTtcbiAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCk7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLmNhbGwodGhpcy50YXJnZXQsIGFyZ3VtZW50c1swXSk7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLmNhbGwodGhpcy50YXJnZXQsIGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdKTtcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCwgYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0sXG4gICAgICAgICAgICBhcmd1bWVudHNbMl0pO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7ICsraSlcbiAgICAgICAgICBhcmdzW2ldID0gYXJndW1lbnRzW2ldO1xuICAgICAgICB0aGlzLmxpc3RlbmVyLmFwcGx5KHRoaXMudGFyZ2V0LCBhcmdzKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gX29uY2VXcmFwKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIpIHtcbiAgdmFyIHN0YXRlID0geyBmaXJlZDogZmFsc2UsIHdyYXBGbjogdW5kZWZpbmVkLCB0YXJnZXQ6IHRhcmdldCwgdHlwZTogdHlwZSwgbGlzdGVuZXI6IGxpc3RlbmVyIH07XG4gIHZhciB3cmFwcGVkID0gYmluZC5jYWxsKG9uY2VXcmFwcGVyLCBzdGF0ZSk7XG4gIHdyYXBwZWQubGlzdGVuZXIgPSBsaXN0ZW5lcjtcbiAgc3RhdGUud3JhcEZuID0gd3JhcHBlZDtcbiAgcmV0dXJuIHdyYXBwZWQ7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uIG9uY2UodHlwZSwgbGlzdGVuZXIpIHtcbiAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gJ2Z1bmN0aW9uJylcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gIHRoaXMub24odHlwZSwgX29uY2VXcmFwKHRoaXMsIHR5cGUsIGxpc3RlbmVyKSk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5wcmVwZW5kT25jZUxpc3RlbmVyID1cbiAgICBmdW5jdGlvbiBwcmVwZW5kT25jZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgICB0aGlzLnByZXBlbmRMaXN0ZW5lcih0eXBlLCBfb25jZVdyYXAodGhpcywgdHlwZSwgbGlzdGVuZXIpKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbi8vIEVtaXRzIGEgJ3JlbW92ZUxpc3RlbmVyJyBldmVudCBpZiBhbmQgb25seSBpZiB0aGUgbGlzdGVuZXIgd2FzIHJlbW92ZWQuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyID1cbiAgICBmdW5jdGlvbiByZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikge1xuICAgICAgdmFyIGxpc3QsIGV2ZW50cywgcG9zaXRpb24sIGksIG9yaWdpbmFsTGlzdGVuZXI7XG5cbiAgICAgIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICAgICAgaWYgKCFldmVudHMpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICBsaXN0ID0gZXZlbnRzW3R5cGVdO1xuICAgICAgaWYgKCFsaXN0KVxuICAgICAgICByZXR1cm4gdGhpcztcblxuICAgICAgaWYgKGxpc3QgPT09IGxpc3RlbmVyIHx8IGxpc3QubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7XG4gICAgICAgIGlmICgtLXRoaXMuX2V2ZW50c0NvdW50ID09PSAwKVxuICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgZGVsZXRlIGV2ZW50c1t0eXBlXTtcbiAgICAgICAgICBpZiAoZXZlbnRzLnJlbW92ZUxpc3RlbmVyKVxuICAgICAgICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIGxpc3QubGlzdGVuZXIgfHwgbGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBsaXN0ICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHBvc2l0aW9uID0gLTE7XG5cbiAgICAgICAgZm9yIChpID0gbGlzdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIGlmIChsaXN0W2ldID09PSBsaXN0ZW5lciB8fCBsaXN0W2ldLmxpc3RlbmVyID09PSBsaXN0ZW5lcikge1xuICAgICAgICAgICAgb3JpZ2luYWxMaXN0ZW5lciA9IGxpc3RbaV0ubGlzdGVuZXI7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IGk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocG9zaXRpb24gPCAwKVxuICAgICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAgIGlmIChwb3NpdGlvbiA9PT0gMClcbiAgICAgICAgICBsaXN0LnNoaWZ0KCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBzcGxpY2VPbmUobGlzdCwgcG9zaXRpb24pO1xuXG4gICAgICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMSlcbiAgICAgICAgICBldmVudHNbdHlwZV0gPSBsaXN0WzBdO1xuXG4gICAgICAgIGlmIChldmVudHMucmVtb3ZlTGlzdGVuZXIpXG4gICAgICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIG9yaWdpbmFsTGlzdGVuZXIgfHwgbGlzdGVuZXIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycyA9XG4gICAgZnVuY3Rpb24gcmVtb3ZlQWxsTGlzdGVuZXJzKHR5cGUpIHtcbiAgICAgIHZhciBsaXN0ZW5lcnMsIGV2ZW50cywgaTtcblxuICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICAgICAgaWYgKCFldmVudHMpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAvLyBub3QgbGlzdGVuaW5nIGZvciByZW1vdmVMaXN0ZW5lciwgbm8gbmVlZCB0byBlbWl0XG4gICAgICBpZiAoIWV2ZW50cy5yZW1vdmVMaXN0ZW5lcikge1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgICB0aGlzLl9ldmVudHNDb3VudCA9IDA7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnRzW3R5cGVdKSB7XG4gICAgICAgICAgaWYgKC0tdGhpcy5fZXZlbnRzQ291bnQgPT09IDApXG4gICAgICAgICAgICB0aGlzLl9ldmVudHMgPSBvYmplY3RDcmVhdGUobnVsbCk7XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgZGVsZXRlIGV2ZW50c1t0eXBlXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgLy8gZW1pdCByZW1vdmVMaXN0ZW5lciBmb3IgYWxsIGxpc3RlbmVycyBvbiBhbGwgZXZlbnRzXG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB2YXIga2V5cyA9IG9iamVjdEtleXMoZXZlbnRzKTtcbiAgICAgICAgdmFyIGtleTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICBrZXkgPSBrZXlzW2ldO1xuICAgICAgICAgIGlmIChrZXkgPT09ICdyZW1vdmVMaXN0ZW5lcicpIGNvbnRpbnVlO1xuICAgICAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ3JlbW92ZUxpc3RlbmVyJyk7XG4gICAgICAgIHRoaXMuX2V2ZW50cyA9IG9iamVjdENyZWF0ZShudWxsKTtcbiAgICAgICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgbGlzdGVuZXJzID0gZXZlbnRzW3R5cGVdO1xuXG4gICAgICBpZiAodHlwZW9mIGxpc3RlbmVycyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVycyk7XG4gICAgICB9IGVsc2UgaWYgKGxpc3RlbmVycykge1xuICAgICAgICAvLyBMSUZPIG9yZGVyXG4gICAgICAgIGZvciAoaSA9IGxpc3RlbmVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXJzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5mdW5jdGlvbiBfbGlzdGVuZXJzKHRhcmdldCwgdHlwZSwgdW53cmFwKSB7XG4gIHZhciBldmVudHMgPSB0YXJnZXQuX2V2ZW50cztcblxuICBpZiAoIWV2ZW50cylcbiAgICByZXR1cm4gW107XG5cbiAgdmFyIGV2bGlzdGVuZXIgPSBldmVudHNbdHlwZV07XG4gIGlmICghZXZsaXN0ZW5lcilcbiAgICByZXR1cm4gW107XG5cbiAgaWYgKHR5cGVvZiBldmxpc3RlbmVyID09PSAnZnVuY3Rpb24nKVxuICAgIHJldHVybiB1bndyYXAgPyBbZXZsaXN0ZW5lci5saXN0ZW5lciB8fCBldmxpc3RlbmVyXSA6IFtldmxpc3RlbmVyXTtcblxuICByZXR1cm4gdW53cmFwID8gdW53cmFwTGlzdGVuZXJzKGV2bGlzdGVuZXIpIDogYXJyYXlDbG9uZShldmxpc3RlbmVyLCBldmxpc3RlbmVyLmxlbmd0aCk7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24gbGlzdGVuZXJzKHR5cGUpIHtcbiAgcmV0dXJuIF9saXN0ZW5lcnModGhpcywgdHlwZSwgdHJ1ZSk7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJhd0xpc3RlbmVycyA9IGZ1bmN0aW9uIHJhd0xpc3RlbmVycyh0eXBlKSB7XG4gIHJldHVybiBfbGlzdGVuZXJzKHRoaXMsIHR5cGUsIGZhbHNlKTtcbn07XG5cbkV2ZW50RW1pdHRlci5saXN0ZW5lckNvdW50ID0gZnVuY3Rpb24oZW1pdHRlciwgdHlwZSkge1xuICBpZiAodHlwZW9mIGVtaXR0ZXIubGlzdGVuZXJDb3VudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBlbWl0dGVyLmxpc3RlbmVyQ291bnQodHlwZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGxpc3RlbmVyQ291bnQuY2FsbChlbWl0dGVyLCB0eXBlKTtcbiAgfVxufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5saXN0ZW5lckNvdW50ID0gbGlzdGVuZXJDb3VudDtcbmZ1bmN0aW9uIGxpc3RlbmVyQ291bnQodHlwZSkge1xuICB2YXIgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuXG4gIGlmIChldmVudHMpIHtcbiAgICB2YXIgZXZsaXN0ZW5lciA9IGV2ZW50c1t0eXBlXTtcblxuICAgIGlmICh0eXBlb2YgZXZsaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfSBlbHNlIGlmIChldmxpc3RlbmVyKSB7XG4gICAgICByZXR1cm4gZXZsaXN0ZW5lci5sZW5ndGg7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIDA7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuZXZlbnROYW1lcyA9IGZ1bmN0aW9uIGV2ZW50TmFtZXMoKSB7XG4gIHJldHVybiB0aGlzLl9ldmVudHNDb3VudCA+IDAgPyBSZWZsZWN0Lm93bktleXModGhpcy5fZXZlbnRzKSA6IFtdO1xufTtcblxuLy8gQWJvdXQgMS41eCBmYXN0ZXIgdGhhbiB0aGUgdHdvLWFyZyB2ZXJzaW9uIG9mIEFycmF5I3NwbGljZSgpLlxuZnVuY3Rpb24gc3BsaWNlT25lKGxpc3QsIGluZGV4KSB7XG4gIGZvciAodmFyIGkgPSBpbmRleCwgayA9IGkgKyAxLCBuID0gbGlzdC5sZW5ndGg7IGsgPCBuOyBpICs9IDEsIGsgKz0gMSlcbiAgICBsaXN0W2ldID0gbGlzdFtrXTtcbiAgbGlzdC5wb3AoKTtcbn1cblxuZnVuY3Rpb24gYXJyYXlDbG9uZShhcnIsIG4pIHtcbiAgdmFyIGNvcHkgPSBuZXcgQXJyYXkobik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgKytpKVxuICAgIGNvcHlbaV0gPSBhcnJbaV07XG4gIHJldHVybiBjb3B5O1xufVxuXG5mdW5jdGlvbiB1bndyYXBMaXN0ZW5lcnMoYXJyKSB7XG4gIHZhciByZXQgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcmV0Lmxlbmd0aDsgKytpKSB7XG4gICAgcmV0W2ldID0gYXJyW2ldLmxpc3RlbmVyIHx8IGFycltpXTtcbiAgfVxuICByZXR1cm4gcmV0O1xufVxuXG5mdW5jdGlvbiBvYmplY3RDcmVhdGVQb2x5ZmlsbChwcm90bykge1xuICB2YXIgRiA9IGZ1bmN0aW9uKCkge307XG4gIEYucHJvdG90eXBlID0gcHJvdG87XG4gIHJldHVybiBuZXcgRjtcbn1cbmZ1bmN0aW9uIG9iamVjdEtleXNQb2x5ZmlsbChvYmopIHtcbiAgdmFyIGtleXMgPSBbXTtcbiAgZm9yICh2YXIgayBpbiBvYmopIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrKSkge1xuICAgIGtleXMucHVzaChrKTtcbiAgfVxuICByZXR1cm4gaztcbn1cbmZ1bmN0aW9uIGZ1bmN0aW9uQmluZFBvbHlmaWxsKGNvbnRleHQpIHtcbiAgdmFyIGZuID0gdGhpcztcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZm4uYXBwbHkoY29udGV4dCwgYXJndW1lbnRzKTtcbiAgfTtcbn1cbiIsIi8qXG5vYmplY3QtYXNzaWduXG4oYykgU2luZHJlIFNvcmh1c1xuQGxpY2Vuc2UgTUlUXG4qL1xuXG4ndXNlIHN0cmljdCc7XG4vKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqL1xudmFyIGdldE93blByb3BlcnR5U3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7XG52YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O1xudmFyIHByb3BJc0VudW1lcmFibGUgPSBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlO1xuXG5mdW5jdGlvbiB0b09iamVjdCh2YWwpIHtcblx0aWYgKHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZCkge1xuXHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdC5hc3NpZ24gY2Fubm90IGJlIGNhbGxlZCB3aXRoIG51bGwgb3IgdW5kZWZpbmVkJyk7XG5cdH1cblxuXHRyZXR1cm4gT2JqZWN0KHZhbCk7XG59XG5cbmZ1bmN0aW9uIHNob3VsZFVzZU5hdGl2ZSgpIHtcblx0dHJ5IHtcblx0XHRpZiAoIU9iamVjdC5hc3NpZ24pIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBEZXRlY3QgYnVnZ3kgcHJvcGVydHkgZW51bWVyYXRpb24gb3JkZXIgaW4gb2xkZXIgVjggdmVyc2lvbnMuXG5cblx0XHQvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD00MTE4XG5cdFx0dmFyIHRlc3QxID0gbmV3IFN0cmluZygnYWJjJyk7ICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ldy13cmFwcGVyc1xuXHRcdHRlc3QxWzVdID0gJ2RlJztcblx0XHRpZiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGVzdDEpWzBdID09PSAnNScpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD0zMDU2XG5cdFx0dmFyIHRlc3QyID0ge307XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG5cdFx0XHR0ZXN0MlsnXycgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpXSA9IGk7XG5cdFx0fVxuXHRcdHZhciBvcmRlcjIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0ZXN0MikubWFwKGZ1bmN0aW9uIChuKSB7XG5cdFx0XHRyZXR1cm4gdGVzdDJbbl07XG5cdFx0fSk7XG5cdFx0aWYgKG9yZGVyMi5qb2luKCcnKSAhPT0gJzAxMjM0NTY3ODknKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0Ly8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzA1NlxuXHRcdHZhciB0ZXN0MyA9IHt9O1xuXHRcdCdhYmNkZWZnaGlqa2xtbm9wcXJzdCcuc3BsaXQoJycpLmZvckVhY2goZnVuY3Rpb24gKGxldHRlcikge1xuXHRcdFx0dGVzdDNbbGV0dGVyXSA9IGxldHRlcjtcblx0XHR9KTtcblx0XHRpZiAoT2JqZWN0LmtleXMoT2JqZWN0LmFzc2lnbih7fSwgdGVzdDMpKS5qb2luKCcnKSAhPT1cblx0XHRcdFx0J2FiY2RlZmdoaWprbG1ub3BxcnN0Jykge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdHJldHVybiB0cnVlO1xuXHR9IGNhdGNoIChlcnIpIHtcblx0XHQvLyBXZSBkb24ndCBleHBlY3QgYW55IG9mIHRoZSBhYm92ZSB0byB0aHJvdywgYnV0IGJldHRlciB0byBiZSBzYWZlLlxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHNob3VsZFVzZU5hdGl2ZSgpID8gT2JqZWN0LmFzc2lnbiA6IGZ1bmN0aW9uICh0YXJnZXQsIHNvdXJjZSkge1xuXHR2YXIgZnJvbTtcblx0dmFyIHRvID0gdG9PYmplY3QodGFyZ2V0KTtcblx0dmFyIHN5bWJvbHM7XG5cblx0Zm9yICh2YXIgcyA9IDE7IHMgPCBhcmd1bWVudHMubGVuZ3RoOyBzKyspIHtcblx0XHRmcm9tID0gT2JqZWN0KGFyZ3VtZW50c1tzXSk7XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gZnJvbSkge1xuXHRcdFx0aWYgKGhhc093blByb3BlcnR5LmNhbGwoZnJvbSwga2V5KSkge1xuXHRcdFx0XHR0b1trZXldID0gZnJvbVtrZXldO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChnZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHtcblx0XHRcdHN5bWJvbHMgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZnJvbSk7XG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHN5bWJvbHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYgKHByb3BJc0VudW1lcmFibGUuY2FsbChmcm9tLCBzeW1ib2xzW2ldKSkge1xuXHRcdFx0XHRcdHRvW3N5bWJvbHNbaV1dID0gZnJvbVtzeW1ib2xzW2ldXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiB0bztcbn07XG4iXX0=
